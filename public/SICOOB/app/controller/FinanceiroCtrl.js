///################################################################################################
app.controller("FinancasCtrl", function ($scope, RestService, Upload) {

    ///############################################################################################
    $scope.testeRelatorioOFX = function () {
        APIService.getData("/../ofx/upload", function (resp) {
            $scope.infoOFX = resp.data;
        })
    }
    ///############################################################################################
    $scope.upload = function (file) {
        Upload.upload({
            url: '/api/sicoob/ofx/upload',
            data: { file: file }
        }).then(function (resp) {
            $scope.infoOFX = resp.data;
        }, function (resp) {
            console.log('Error status: ' + resp.status);
        }, function (evt) {
            var progressPercentage = parseInt(100.0 * evt.loaded / evt.total);
            console.log('progress: ' + progressPercentage + '% ' + evt.config.data.file.name);
        });
    };
    ///############################################################################################
    $scope.exportXLS = function () {
        alasql('SELECT * INTO XLSX("exportacao.xlsx",{headers:true}) FROM ?', [$scope.infoOFX.transacoes]);
    }
    ///############################################################################################
    ///############################################################################################
    ///############################################################################################
    ///############################################################################################
    ///############################################################################################
    ///############################################################################################
    ///############################################################################################
    ///############################################################################################
    ///############################################################################################
    ///############################################################################################
    ///############################################################################################
    ///############################################################################################
    ///############################################################################################
    ///############################################################################################
});
///################################################################################################
app.controller("FinancasDashCtrl", function ($scope, RestService, Upload) {

    ///############################################################################################
    var hoje = new Date();
    $scope.init = function () {
        $scope.hoje = hoje;
        $scope.resumo = {
            receitas: 39508.34,
            despesas: 28736.07
        }
    }
    ///############################################################################################
    ///############################################################################################
    ///############################################################################################
    
    $scope.init();
});
///################################################################################################
app.controller("FinancasMovCtrl", function ($scope, APIService, Upload, $modal) {

    
    //var modalCategory = $modal({ templateUrl: 'app/view/Finances/Modals/ModalFinanceCategory.html', show: false, scope: $scope, });

    ///############################################################################################
    $scope.init = function () {
        APIService.getData("/finances/accounts/2/movimentacoes", function (resp) {
            $scope.movimentacoesContaList = resp.data;
            for (var i = 0; i < $scope.movimentacoesContaList.length; i++) {
                var saldo = 0;
                var item = $scope.movimentacoesContaList[i];
                if (i == 0) {
                    saldo = $scope.relatorio.saldo_inicial + item.valor;
                } else {
                    saldo = parseFloat($scope.movimentacoesContaList[i - 1].saldo) + parseFloat(item.valor);
                }
                $scope.movimentacoesContaList[i].saldo = saldo;
            }

            console.log($scope.movimentacoesContaList);
        });
    }
    ///############################################################################################
    ///############################################################################################
    ///############################################################################################
    ///############################################################################################
    
    $scope.init();
});
///################################################################################################
app.controller("FinancasCentroCustoCtrl", function ($scope, APIService, Upload, $modal) {
    $scope.form = {};

    var modalCategory = $modal({ templateUrl: 'app/view/Financeiro/Modal/ModalNovaCategoria.html', show: false, scope: $scope, });
    ///############################################################################################
    $scope.init = function () {
        APIService.getData("/finances/accounts/categories", function (resp) { $scope.categoriesList = resp.data; });
    }
    ///############################################################################################
    $scope.novaCategoriaModal = function () {
        $scope.form.id_pai = null;
        modalCategory.show();
    }
    ///############################################################################################
    $scope.addCategoriaFilho = function(item) {
        $scope.form.id_pai = item.id;
        $scope.form.tipo_operacao = item.tipo;
        $scope.form.nome = item.nome + " / ";
        modalCategory.show();
    }
    ///############################################################################################
    $scope.salvarCategoria = function(form) {
        //console.log(form);
        APIService.postData("/finances/accounts/categories", form, function (resp) {
            $scope.form = {};
            modalCategory.hide();
            $scope.init();
        });
    }
    ///############################################################################################
    ///############################################################################################
    ///############################################################################################
    
    $scope.init();
});
///################################################################################################
app.controller("FinancasContasCtrl", function ($scope, APIService, Upload) {

    ///############################################################################################
    $scope.init = function () {
        $scope.resumo = {
            receitas: 39508.34,
            despesas: 28736.07
        }

        APIService.getData("/finances/dashboard/accounts", function (resp) {
            $scope.listaContasBancarias = resp.data;
        });
    }
    ///############################################################################################
    ///############################################################################################
    ///############################################################################################
    
    $scope.init();
});
///################################################################################################
///################################################################################################
///################################################################################################
///################################################################################################