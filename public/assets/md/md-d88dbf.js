!function(){"use strict";var a="prod",t="app.meudinheiroweb.com.br"===window.location.hostname,o=angular.module("ngAnalytics",[]);o.constant("analyticsEnv",a);var e=t?["$q","asyncLoader",function(a,t){var o=a.defer(),e={app:"rudder-stack-plugin",version:100,plugins:[{name:"rudderstack",initialize:function(a){rudderanalytics.load("20pGCU7OMUG4MBIZepfwKqhPvPD","https://meudinheiryfqf.dataplane.rudderstack.com")},ready:function(a){rudderanalytics.ready((function(){o.resolve(!0)}))},track:function(a){var t=a.payload;rudderanalytics.track(t.event,t.properties,t.options,t.callback)},identify:function(a){var t=a.payload;"string"==typeof t.userId?rudderanalytics.identify(t.userId,t.traits,t.options,t.callback):rudderanalytics.identify(t.traits,t.options,t.callback)},reset:function(){rudderanalytics.reset(!0),window.posthog&&window.posthog.reset(),window.mixpanel&&window.mixpanel.reset()},loaded:function(){return window.rudderanalytics&&!!rudderanalytics.initialized}}]},n=t("https://unpkg.com/analytics/dist/analytics.min.js");return t("https://cdn.rudderlabs.com/v1.1/rudder-analytics.min.js").then((function(){return n.then((function(){var a=window._analytics.init(e);return window.Anal=a,o.promise.then((function(){return a}))}))}))}]:angular.noop,n=["identify","track","reset","user"],r=t?["analyticsPromise","asyncLoader","$q","$timeout",function(t,o,e,r){var i,c=this;function s(a,n){var c=e.defer(),s=r((function(){c.resolve(!1)}),n||3e3);return i||(i=o("https://cdn.jsdelivr.net/npm/statsig-js/build/statsig-prod-web-sdk.min.js").then((function(){return t.then((function(a){var t=a.user(),o={};return t&&(o.userID=t.userId||t.anonymousId),window.statsig.initialize("client-NnBRh7hkbpicxW4y2IJLfSerEB4she4tv8c36PR6x6Z",o)}))}))),i.then((function(t){a(c)})),e.race([c.promise,s])}n.forEach((function(o){c[o]=function(){var e=Array.prototype.slice.call(arguments,0);return t.then((function(t){try{var n=t[o].apply(null,e);return"identify"==o&&localStorage&&localStorage.setItem("meudinheiro::analyticsEnv",a),n}catch(a){console.error(a)}}))}})),c.runUsetiful=function(a){return t.then((function(t){var e=t.user();if(e)return window.usetifulTags={},window.usetifulTags.userId=e.userId,a&&angular.forEach(a,(function(a,t){window.usetifulTags[t]=a})),o("https://www.usetiful.com/dist/usetiful.js",(function(a){a.setAttribute("id","usetifulScript"),a.dataset.token="f47025b8ef8f184edf098c376b2977db"}))}))},c.ff=function(a,t){return s((function(t){t.resolve(window.statsig.checkGate(a))}),t)},c.exp=function(a){return s((function(t){t.resolve(window.statsig.getExperiment(a))}))},c.askForWebPushPermission=function(){return t.then((function(a){}))}}]:["$q",function(a){var t=this;n.push("askForWebPushPermission");var o=function(){return a.when(!1)};t.ff=o,t.exp=o,t.runUsetiful=o,n.forEach((function(o){t[o]=function(){return a.when({})}}))}];o.factory("analyticsPromise",e),o.service("analytics",r),o.factory("asyncLoader",["$q",function(a){return function(t,o){var e=a.defer(),n=function(){e.resolve()},r=document.getElementsByTagName("head")[0],i=document.createElement("script");return i.setAttribute("type","text/javascript"),i.src=t,i.async=1,o&&o(i),i.addEventListener?i.addEventListener("load",n,!1):i.onreadystatechange=function(){"loaded"!==i.readyState&&"complete"!==i.readyState||(i.onreadystatechange=null,n())},r.appendChild(i),e.promise}}])}(),function(){"use strict";angular.module("md",["ngMessages","ngAnimate","ngSanitize","ngMaterial","angularFileUpload","datePicker","ui.utils.masks","angularMoment","ui.validate","googlechart","ui.router","ct.ui.router.extras.core","ct.ui.router.extras.previous","ct.ui.router.extras.transition","ngAutodisable","toastr","as.sortable","mdwCroppieApp","ngAnalytics"]).value("googleChartApiConfig",{version:"1.1",optionalSettings:{packages:["corechart"],language:"pt-br"}}).config(["$windowProvider","$mdIconProvider","$sceDelegateProvider",function(a,t,o){var e=a.$get();o.resourceUrlWhitelist(["self","https://s3.amazonaws.com/img.meudinheiroweb.com.br/**"]);for(var n=1;n<=e.mdconfig.cntMoedas;n++)t.icon("moeda-"+n,"https://s3.amazonaws.com/img.meudinheiroweb.com.br/bandeiras/"+n+".svg",20)}]).constant("MD_INVEST_MOD",null!==location.pathname.match(/^\/u\/\d+\/investimentos($|\/?)/)).constant("MD_IN_PRODUCTION","app.meudinheiroweb.com.br"===window.location.hostname).constant("MAX_DATE_LANCS",moment().endOf("year").add(window.mdconfig.maxYears||5,"years")).constant("IS_ADMIN_ACCESS",!!window.mdconfig.isadmin).constant("DATA_INICIO_RENTABILIDADE",window.mdconfig.dataInicioRentabilidade||"2018-01-01").run(["$http","$sce","$templateCache","$rootScope","$window",function(a,t,o,e,n){n.mdjsv="2.0.14",e.mdconfig=angular.copy(n.mdconfig),e.mdwTemplateHtmlVersion=n.mdwTemplateHtmlVersion,e.mdwFrontVersionNo=n.mdwFrontVersionNo,e.mdwAppVersionNo=n.mdwAppVersionNo,e.pageTitle=t.trustAsHtml(e.mdconfig.usuario.conta.nome),["lancamentos/editarLancamento.html"].forEach((function(t){a.get("partials/"+t,{cache:o})}))}])}(),function(){"use strict";var a,t=(a={"à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","ç":"c","è":"e","é":"e","ê":"e","ë":"e","ì":"i","í":"i","î":"i","ï":"i","ñ":"n","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","ß":"s","ù":"u","ú":"u","û":"u","ü":"u","ÿ":"y","À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","Ç":"C","È":"E","É":"E","Ê":"E","Ë":"E","Ì":"I","Í":"I","Î":"I","Ï":"I","Ñ":"N","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O",SS:"S","Ù":"U","Ú":"U","Û":"U","Ü":"U","Ÿ":"Y"},function(t){if(!t)return"";for(var o="",e=0;e<t.length;e++)o+=a[t.charAt(e)]||t.charAt(e);return o});angular.module("md").value("mdwAccentFold",t)}(),function(){"use strict";function a(a){this.state=function(t,o){return t.templates=t.templates||[],o.resolve=angular.extend({mdtheming:["$q","$timeout","$rootScope","mdwTopmenu","$http","$templateCache",function(a,o,e,n,r,i){e.loadingState=!0,angular.isDefined(t.title)&&(n.title=t.title);var c=[o(angular.noop,5)];return t.templates.forEach((function(a){c.push(r.get("partials/"+a.replace(/^\/*(partials\/)?/,""),{cache:i}))})),a.all(c).then((function(){e.loadingState=!1}))}]},o.resolve||{}),a.state(t.id,o)},this.$get=[function(){return{}}]}a.$inject=["$stateProvider"],angular.module("md").provider("mdwBaseState",a)}(),function(){"use strict";angular.module("md").provider("mdwCache",(function(){this.$get=["$http","$timeout","$httpParamSerializer","moment","mdwUrlAssembler",function(a,t,o,e,n){return function(a,t){return new r(a,t)};function r(r,i){var c,s={};function l(){c=e().add(100,"ms")}function u(a){return angular.isObject(a)?o(a):a}l(),this.get=function(o,e){e=e||{};var c=i||{};angular.isObject(o)&&(c=o);var l=u(o);return angular.isDefined(s[l])?t((function(){return angular.isDefined(s[l])?s[l]:d()}),100):d();function d(){return e.params=c,s[l]=a.get(n(r,c),e).then((function(a){return a.data}))}},this.clear=function(a){var t=u(a);delete s[t]},this.reset=function(a){c.isAfter(e())&&!0!==a||(l(),s={})}}}]}))}(),function(){"use strict";function a(a,t){this.getColorAtIndex=function(o,e,n){e=angular.isUndefined(e)||!e?[]:e,e=angular.isArray(e)?e:[e];var r=["blue","green","yellow","red","brown","indigo","amber","pink","deep-orange","blue-grey","light-blue","deep-purple","teal"].filter((function(a){return-1==e.indexOf(a)})),i=n?["A400","600","500","400","300"]:["300","400","500","600","A400"],c=o%r.length,s=parseInt(o/r.length)%i.length;return t.rgbaToHex(a.getThemeColor(r[c]+"-"+i[s]))},this.getHexColor=function(o,e){return t.rgbaToHex(a.getThemeColor(o+"-"+(e||"500")))}}a.$inject=["$mdColors","$mdColorUtil"],angular.module("md").service("mdwColors",a)}(),function(){"use strict";var a=(new Date).getTime().toString()+function(a,t,o){o=o||"0";var e=a.toString();if(e.length>=t)return e;return new Array(t-e.length+1).join(o)+e}(2147483647*Math.random()|0,10),t=location.hostname;angular.module("md").provider("mdwCrosstab",(function(){r.$inject=["$timeout","$injector"];var o=this,e={};function n(a,t,o){e[t]&&console.error("Evento "+t+" ja definido"),e[t]={type:a,handler:o}}function r(o,n){function r(){return n.get("usuariosService").usuario.conta.id}crosstab.on("mdwCrosstab",(function(n){var i=r(),c=n.data;if(c.tabId!=a&&c.domain==t){var s=e[c.event];(2!=s.type||i&&c.cid&&i==c.cid)&&o((function(){s.handler(c.data)}))}})),this.emit=function(o,e){var n=r();try{crosstab.broadcast("mdwCrosstab",{tabId:a,domain:t,event:o,cid:n,data:e})}catch(a){console.error(a)}}}o.registerAll=function(a,t){return n(1,a,t)},o.registerSame=function(a,t){return n(2,a,t)},o.$get=["$timeout","$injector",function(a,t){return new r(a,t)}]}))}(),function(){"use strict";function a(a){return function(t,o){return a.isMoment(t)?a(t):(t&&10==t.length&&(t+=" 02:00:00"),a(t,o))}}function t(a){return function(t,o,e){return t&&10==t.length&&(t+="T02:00:00"),a("date")(t,o,e)}}a.$inject=["moment"],t.$inject=["$filter"],angular.module("md").factory("mdwMoment",a).filter("mdwDate",t)}(),function(){"use strict";var a=1e7;function t(t,o){const e=10**o;return Math.round((t+Number.EPSILON)*a*(e*a)/1e14)/e}angular.module("md").value("numberRound",t).value("currencyRound",(a=>t(a,2)))}(),function(){"use strict";angular.module("md").provider("mdwObserver",(function(){this.createEvent=o,this.$get=function(){return function(t){return new a(t)};function a(a){var t=this,e=[];t.add=function(a){var t=e.length;if(!angular.isFunction(a))throw Error("Observers devem ser funcoes validas");return e.push(a),function(){e[t]=null}},t.unshift=function(a){e.unshift(a)},t.notify=function(a){var t=o(a);if(n[t.id])return;n[t.id]=!0;for(var r=0;r<e.length;r++)e[r]&&-1==t.trace.indexOf(e[r])&&(t.trace.push(e[r]),e[r].call(window,t))},t.createEvent=o;var n={}}}}));var a=0;function t(t){this.id=++a,this.data=t,this.trace=[]}function o(a){return a instanceof t?a:new t(a)}}(),function(){"use strict";t.$inject=["mdwCrosstabProvider","mdwObserverProvider"],e.$inject=["mdwObserverProvider"];try{angular.module("md").provider("mdwResource",e).provider("mdwResourceObserver",(function(){this.$get=function(){return function(t,o){angular.isFunction(o)?a.all[t].push(o):angular.isObject(o)&&(o.insert&&a.insert[t].push(o.insert),o.update&&a.update[t].push(o.update),o.delete&&a.delete[t].push(o.delete))}}})).config(t)}catch(a){console.log(a)}var a={insert:{},update:{},delete:{},all:{}};function t(a,t){a.registerSame("mdwResource",(function(a){var e=t.createEvent(a.data);o(a.type,a.event,e)}))}function o(t,o,e){angular.forEach(a[o][t]||[],(function(a){a(e)})),angular.forEach(a.all[t]||[],(function(a){a(e,o)}))}function e(t){var e={};this.define=function(t,o){if(e[t])throw new Error("Tipo "+t+" ja definido",e[t]);e[t]=o,a.all[t]||angular.forEach(a,(function(o,e){a[e][t]=[]}))},this.$get=["$http","mdwCrosstab","mdwUrlAssembler",function(a,n,r){function i(a,t,o){n.emit("mdwResource",{type:a,event:t,data:o})}return function(a){return new c(a,e[a])};function c(e,n){var c=this;c.insert=function(c){return a.post(r(n,c),c).then((function(a){var n=t.createEvent(a.data);return o(e,"insert",n),i(e,"insert",n),a.data}))},c.update=function(c){return a.put(r(n,c),c).then((function(a){var n=t.createEvent(a.data);return o(e,"update",n),i(e,"update",n),a.data}))},c.delete=function(c,s){return a.delete(r(n,c),{params:s||{}}).then((function(a){var n=t.createEvent(c);o(e,"delete",n),i(e,"delete",n)}))}}}]}}(),function(){"use strict";angular.module("md").provider("mdwStateDialog",(function(){this.getState=function(a){var t=a.map||{},o=!0;return{url:a.url||"",params:a.params||{},data:angular.extend({},a.data||{},{isDialog:!0}),onEnter:["$state","$stateParams","$previousState","$injector",function(e,n,r,i){var c=a.action.split("."),s={};o=!0,angular.forEach(n,(function(a,o){s[t[o]||o]=a}));i.get(c[0])[c[1]](s).finally((function(){o&&(r.get()?window.history.back():e.go("^"))}))}],onExit:function(){o=!1}}},this.$get=[function(){return{}}]}))}(),function(){"use strict";angular.module("md").value("mdwTextColorBgBased",(function(a){var t=parseInt(a.substr(0,2),16),o=parseInt(a.substr(2,2),16),e=parseInt(a.substr(4,2),16);return Math.round((299*t+587*o+114*e)/1e3)>125?"000":"FFF"}))}(),function(){"use strict";angular.module("md").value("mdwUrlAssembler",(function(a,t){if(-1!=a.indexOf(":")){if(!angular.isObject(t))throw new Error("Eh necessario passar parametros para a url: "+a);return a.replace(/\/\:\w+/g,(function(a){var o=a.replace("/:","");return(t&&t[o]?"/"+t[o]:"")+("/"==a[a.length-1]?"/":"")}))}return a}))}(),function(){"use strict";function a(a,t,o,e){o.state({id:"bp",title:"Balanço patrimonial"},{abstract:!0,url:"/bp",template:"<div layout='row' flex ui-view></div>",controller:["$scope","mdwTopmenu",function(a,t){t.setTabs(a,[{label:"Mensal",state:"bp.mensal.dados"},{label:"Evolução",state:"bp.evolucao.dados"}])}],controllerAs:"vm"}),a.state("bp.mensal",{url:"/mensal",abstract:!0,templateUrl:"partials/bp/mensal/mensal.html",controllerAs:"vm",controller:"BPMensalController"}),a.state("bp.mensal.dados",{url:"?inicio",templateUrl:"partials/bp/mensal/dados.html",controllerAs:"vm",controller:"BPMensalDadosController",params:{contas:null}}),a.state("bp.evolucao",{abstract:!0,url:"/evolucao",templateUrl:"partials/bp/evolucao/evolucao.html",controllerAs:"vm",controller:"BPEvolucaoController"}),a.state("bp.evolucao.dados",{url:"?inicio&p&intervalo",templateUrl:"partials/bp/evolucao/dados.html",controllerAs:"vm",controller:"BPEvolucaoDadosController",params:{contas:null}})}a.$inject=["$stateProvider","mdwStateDialogProvider","mdwBaseStateProvider","MD_INVEST_MOD"],angular.module("md").config(a)}(),function(){"use strict";function a(a,t){return t.saldo-a.saldo}function t(t,e,n,r,i){var c=this,s=e("/api/v2/bp/mensal"),l=e("/api/v2/bp/evolucao"),u=t(),d=i.getConfig("bp",{m:1,c:null});function m(){return d.m=c.moeda,d.c=c.contasFiltradas,i.updateConfig("bp",d)}c.moeda=d.m,c.contasFiltradas=d.c,c.addObserver=u.add,r.addObserver((function(a){s.reset(),l.reset(),u.notify(a)})),c.carregarMes=function(t,o){return o&&(o=o.join()),s.get({data:moment(t).format("YYYY-MM-DD"),moeda:c.moeda,contas:o}).then((function(t){if(t._ordenado)return t;t._ordenado=!0,t.ativo.imobilizado.ativos.sort(a),t.ativo.disponivel.ativos.sort(a);var o=[];return angular.isArray,angular.forEach(t.ativo.realizavel.ativos,(function(a,t){o.push({ativos:a.ativos,tipo:t,saldo:a.saldo})})),t.ativo.realizavel.ativos=o,t.ativo.realizavel.ativos.sort(a),t.ativo.realizavel.ativos.forEach((function(t){t.ativos.sort(a)})),t.passivo.devedor.ativos.sort(a),t.passivo.exigivel.ativos.sort(a),t}))},c.carregarEvolucao=function(a,t,o,e){return o&&(o=o.join()),l.get({inicio:moment(a).format("YYYY-MM-DD"),fim:moment(t).format("YYYY-MM-DD"),intervalo:e,contas:o})},c.exportarMes=function(a,t){return s.get({data:moment(a).format("YYYY-MM-DD"),moeda:c.moeda,format:t})},c.updateMoeda=function(a){c.moeda=a,u.notify(),m(),u.notify()},c.filtros=function(){var a,t=angular.copy(c.contasFiltradas);return n.show({id:"filtro-contas-bp",templateUrl:"/partials/bp/filtroContas.html",controller:o,bindToController:!0,controllerAs:"vm",locals:{contasFiltradas:t}}).then((function(t){return t&&"limpar"!=t?(c.contasFiltradas=t.contas,a=c.contasFiltradas.length):(a=null,c.contasFiltradas=[]),m(),{quantFiltradas:a}}))}}function o(a,t,o){var e=this;e.$onInit=function(){e.mapDados={},e.lista=t.contas.filter((function(a){return a.status&&"CARTEIRA_INVEST"!=a.tipo})),e.lista.sort((function(a,t){return a.nome<t.nome?-1:1})),e.lista.forEach((function(a){e.contasFiltradas&&-1!=e.contasFiltradas.indexOf(a.id)?e.mapDados[a.id]=!0:e.mapDados[a.id]=!1})),e.dados&&e.dados.forEach((function(a){e.mapDados[a]=!0}))},e.limparFiltros=function(){e.contasFiltradas=null,a.hide("limpar")},e.filtrar=function(){return e.contasFiltradas=[],angular.forEach(e.mapDados,(function(a,t){a&&e.contasFiltradas.push(+t)})),e.contasFiltradas.length?a.hide({contas:e.contasFiltradas}):a.cancel()}}t.$inject=["mdwObserver","mdwCache","$mdDialog","rentabilidadeDatasource","configuracoesService"],o.$inject=["$mdDialog","cadastrosDatasource","configuracoesService"],angular.module("md").service("bpService",t)}(),function(){"use strict";t.$inject=["$state","BPEvolucaoService","bpService","DATA_INICIO_RENTABILIDADE"],a.$inject=["configuracoesService","DATA_INICIO_RENTABILIDADE"],o.$inject=["$scope","$stateParams","bpService","$filter","mdwDarkModeService","BPEvolucaoService","$timeout"];function a(a,t){var o=this;o.config=a.getConfig("bpevol",{p:13,i:"m",c:"c"}),o.periodo=o.config.p,o.intervalo=o.config.i,o.chartType=o.config.c,o.verificaIntervalo=function(){return"y"==o.intervalo?"year":"month"},o.salvarConfiguracoes=function(){const t={i:o.intervalo,p:o.periodo,c:o.chartType};angular.equals(t,o.config)||(o.config=t,a.updateConfig("bpevol",o.config))}}function t(a,t,o,e){var n=this;const r=moment().year(),i=moment(e).year();n.service=t,n.moeda=o.moeda;var c=o.contasFiltradas;n.quantFiltradas=c?c.length:null,n.max=moment().startOf("month"),n.min=moment(e),n.periodosMeses=[],n.periodosAnos=[],n.intervaloAnos=[],n.$onInit=function(){for(let a=0;a<13;a++)n.periodosMeses.push(a+1);for(let a=i,t=1;a<=r;a++,t++)n.intervaloAnos.push(a),n.periodosAnos.push(t);"y"==n.service.intervalo&&(n.ano=r-(n.service.periodo-1))},n.onChangeIntervalo=function(){const a=Math.min(n.periodosAnos.at(-1),10);n.service.periodo="y"==n.service.intervalo?a:13,n.ano=i},n.onChangeInicio=function(){const a=n.service.periodo-1;if(n.ano+a>r){const a=r-n.ano;n.service.periodo=a+1}},n.onChangePeriodo=function(){const a=n.service.periodo-1;if("m"==n.service.intervalo){moment(n.service.inicio).startOf("month").add(a,"month").format("YYYY-MM-DD")>moment().startOf("month").format("YYYY-MM-DD")&&(n.service.inicio=moment().startOf("month").subtract(a,"month"))}else if("y"==n.service.intervalo&&n.ano+a>r){const t=r-a,o=t<i;n.ano=o?i:t}},n.carregar=function(){n.service.salvarConfiguracoes(),n.service.inicio="y"==n.service.intervalo?moment(n.ano+"-01-01"):n.service.inicio,a.go(".",{inicio:moment(n.service.inicio).format("YYYY-MM-DD"),p:n.service.periodo,intervalo:n.service.intervalo})},n.printConfig={controller:"BPEvolucaoDadosController",templateUrl:"/partials/bp/evolucao/print.html"},n.calendarioConfig={restrict:["m"],interval:"m"},n.filtros=function(){return o.filtros().then((function(t){n.quantFiltradas=t?t.quantFiltradas:n.quantFiltradas,a.go("bp.evolucao.dados",{contas:o.contasFiltradas})}))},n.onChangeMoeda=function(a){o.updateMoeda(a),n.moeda=a}}function o(a,t,o,e,n,r,i){var c=this;c.service=r;var s=[{type:"string"},{type:"number",label:"BRL (R$)"},{type:"number",label:"Descontado IPCA (R$)"},{type:"number",label:"USD ($)"}],l=o.addObserver(d),u=n.onChange((function(){n.prepareChartOptions(c.chart.options),n.prepareChartOptions(c.chartPerc.options)}));function d(){c.moeda=o.moeda,c.loading=!0;let a=c.service.verificaIntervalo();c.service.periodo=t.p||c.service.periodo,c.service.inicio=t.inicio?moment(t.inicio).startOf(a):moment().startOf(a).subtract(c.service.periodo-1,a);var r=c.service.inicio.format("YYYY-MM-DD"),l=moment(c.service.inicio).add(c.service.periodo-1,a).format("YYYY-MM-DD"),u=t.intervalo||c.service.intervalo,d=t.contas;d||(d=o.contasFiltradas),o.carregarEvolucao(r,l,d,u).then((function(a){c.loading=!1,c.bp=a,c.bpIntervalo=u,c.chartPerc={type:"LineChart",data:{cols:s,rows:[]},options:n.prepareChartOptions({lineWidth:2,crosshair:{orientation:"vertical",trigger:"both",color:"#bbb"},backgroundColor:"transparent",chartArea:{width:"90%"},hAxis:{gridlines:{color:"transparent"}},vAxis:{baseline:0,baselineColor:"#888",gridlines:{color:"#e2e2e2"},format:"percent",textPosition:"in"},legend:{position:"bottom"},focusTarget:"category",tooltip:{isHtml:!0}}),formatters:{date:[{columnNum:0,pattern:"MMMM 'de' yyyy"}]}},c.chart={type:"c"==c.service.chartType?"ColumnChart":"LineChart",data:{cols:s,rows:[]},options:n.prepareChartOptions({hAxis:{gridlines:{color:"transparent"}},vAxis:{format:"short"},legend:{position:"bottom"},focusTarget:"category",chartArea:{width:"80%",height:"80%"}}),formatters:{date:[{columnNum:0,pattern:"MMMM 'de' yyyy"}]}},i((()=>{a.forEach((function(t,o){var n=[],r=[],i="y"==u?t.data:moment(t.data).format("MMM YY");n.push({v:i}),r.push({v:i});for(var s=0;!a[s].saldo[0]&&s+1!=a.length;)s++;t.variacao=[],t.varFin=[],t.saldo.forEach((function(i,c){var l=a[s].saldo[c]||i,u=i?(i-l)/Math.abs(l):0;n.push({v:i,f:e("currency")(i,"")}),r.push({v:u,f:e("number")(100*u,2)+"%"}),o>0&&a[o-1].saldo[c]&&(t.variacao[c]=(i-a[o-1].saldo[c])/Math.abs(a[o-1].saldo[c]),t.varFin[c]=i-a[o-1].saldo[c])})),c.chart.data.rows.push({c:n}),c.chartPerc.data.rows.push({c:r})}))}))}))}a.$on("$destroy",(function(){l(),u()})),c.$onInit=d,c.setChartType=function(a){c.service.chartType=a,c.service.salvarConfiguracoes(),d()}}angular.module("md").service("BPEvolucaoService",a).controller("BPEvolucaoController",t).controller("BPEvolucaoDadosController",o)}(),function(){"use strict";function a(a,t,o,e,n,r){var i=this;i.maxDate=moment().endOf("month"),i.minDate=moment(r),i.calendarioConfig={restrict:["m"]};var c=t.contasFiltradas;i.moeda=t.moeda,i.quantFiltradas=c?c.length:null,i.printConfig={controller:"BPMensalDadosController",templateUrl:"/partials/bp/mensal/print.html"},i.inicio=o.inicio||moment().format("YYYY-MM-DD"),i.getExportBPMensal=function(){return t.exportarMes(i.inicio,"csv").then((function(a){!function(a,t,o){if(null!=o&&navigator.msSaveBlob)return navigator.msSaveBlob(new Blob([o],{type:t}),a);var e=angular.element("<a style='display: none;'/>"),n=window.URL.createObjectURL(new Blob([o],{type:t}));e.attr("href",n),e.attr("download",a),angular.element(document.body).append(e),e[0].click(),window.URL.revokeObjectURL(n),e.remove()}(i.nomeArquivo+".csv","text/csv",a)}))},i.nomeArquivo="Meu_Dinheiro_BP_export"+moment().format("YYYYMMDDHHmmSS");var s=n.onSuccess({from:"bp.mensal.dados",to:"bp.mensal.dados"},(function(a){i.inicio=a.params().inicio}));a.$on("$destroy",(function(){s()})),i.filtros=function(){return t.filtros().then((function(a){i.quantFiltradas=a?a.quantFiltradas:i.quantFiltradas,e.go("bp.mensal.dados",{contas:t.contasFiltradas})}))},i.onChangeMoeda=function(a){t.updateMoeda(a),i.moeda=a}}function t(a,t,o,e,n,r){var i=this;function c(){i.ativos={},i.contas={};var a=o.contas;a||(a=t.contasFiltradas),e.carregarGrupos().then((function(a){a[1].forEach((function(a){i.ativos[a.id]=a}))})),n.contas.forEach((function(a){i.contas[a.id]=a})),i.moeda=t.moeda,i.inicio=o.inicio||moment().format("YYYY-MM-DD"),i.isMesAtual=moment().format("YYYY-MM")==moment(i.inicio).format("YYYY-MM"),i.ontem=moment().startOf("day").subtract(1,"hour").format("DD/MM/YYYY"),i.loading=!0,t.carregarMes(i.inicio,a).then((function(a){i.loading=!1,i.bp=a,i.pl=a.ativo.saldo-a.passivo.saldo}))}i.$onInit=c,i.grupos=angular.extend({contas:"Contas"},r),a.$on("$destroy",t.addObserver(c))}a.$inject=["$scope","bpService","$stateParams","$state","$transitions","DATA_INICIO_RENTABILIDADE"],t.$inject=["$scope","bpService","$stateParams","ativosService","cadastrosDatasource","GRUPOS_ATIVOS"],angular.module("md").controller("BPMensalController",a).controller("BPMensalDadosController",t)}(),function(){"use strict";function a(a,t,o,e,n){n.changeTemplateUrl("/partials/busca/buscaTopmenu.html",this,!0),this.voltar=function(){e.prevState?o.go(e.prevState.name,e.prevState.params):o.go("visaogeral.paineis")};var r=t.onBefore({to:function(a){return 0!==a.name.indexOf("busca")}},(function(){n.changeTemplateUrl(null,null,!1),r()}))}function t(a,t,o,e,n,r){var i=this;if(n.setParams(e.b),e.b){i.loading=!0,i.lancamentosBase=[],i.lancamentos=[],i.service=n,i.selection=r({controller:i,templateUrl:"/partials/extratoConta/acoesLoteTopmenu.html",getLancamentos:function(){return i.lancamentos}});var c=t.addObserver(s);a.$on("$destroy",(function(){c(),i.selection.clearSelection()})),a.$watchCollection("vm.lancamentos",(function(){i.selection.updateSelection()})),s()}function s(){var a=n.getParams(!0),t={finalidade:o.lancamentos.FIN_BUSCA,regime:a.regime,inicio:a.inicio,fim:a.fim,inicioc:a.inicioInc,fimc:a.fimInc,agruparDetalhes:!i.service.params.agruparDetalhes,ndocumento:a.ndocumento,valor:a.valor,intervaloValores:!angular.isUndefined(a.intervaloValores)&&a.intervaloValores,valorIni:a.valorIni,valorFim:a.valorFim,status:a.status,tipoLancamento:a.tipo,palavras:a.palavras,idLancamento:a.idLancamento};["categorias","contas","centros","contatos","tags","formas","projetos"].forEach((function(o){a[o]&&(t[o]={ids:a[o]})}));var e={pageSize:200,onBeforeFetch:function(a){i.loading=!0},onFetch:function(a,t){i.loading=!1,i.lancamentos=a,i.meta=t}};i.paginator=o.lancamentos.list(t,{},e),i.paginator.fetch(1)}}a.$inject=["$rootScope","$transitions","$state","buscaService","mdwTopmenu"],t.$inject=["$scope","lancamentosDatasource","relatoriosDatasource","$stateParams","buscaService","selecaoLancamentosLote"],angular.module("md").controller("BuscaController",a).controller("BuscaLancamentosController",t)}(),function(){"use strict";function a(a,t,o){a.state("busca",{url:"/busca",template:"<ui-view layout='row' flex/>",controller:"BuscaController",controllerAs:"vm",abstract:!0}).state("busca.lancamentos",{url:"?b",templateUrl:"partials/busca/busca.html",controller:"BuscaLancamentosController",controllerAs:"vm"}),t.addStates("busca.lancamentos")}a.$inject=["$stateProvider","lancamentosRoutesProvider","mdwBaseStateProvider"],angular.module("md").config(a)}(),function(){"use strict";function a(a,t,o){var e=this,n=["categorias","contas","contatos","centros","projetos","tags","formas"],r=["inicio","fim","inicioInc","fimInc"];function i(a){var t={};return angular.forEach(e.params,(function(e,n){e&&(angular.isArray(e)?e.length>0&&(t[n]=a?e:e.join(",")):r.indexOf(n)>=0?t[n]=o(e).format("YYYY-MM-DD"):t[n]=e)})),t}function c(){e.params={fim:o().endOf("month"),categorias:[],contas:[],contatos:[],centros:[],projetos:[],formas:[],tags:[],status:15,tipo:15,regime:"ca",idLancamento:null}}e.toggleIntervaloVal=function(){e.params.intervaloValores=!e.params.intervaloValores,e.params.intervaloValores?e.params.valor=null:(e.params.valorIni=null,e.params.valorFim=null)},e.params={},e.setParams=function(a){var t={};if(a){var o=decodeURIComponent(a).replace(/%27/g,"'");t=angular.fromJson(o)}angular.forEach(t,(function(a,o){-1!=n.indexOf(o)&&(t[o]=a.split(","))})),e.params=angular.extend(e.params,t),e.params.fim&&(e.params.fim=moment(e.params.fim))},e.go=function(){var t=angular.toJson(i()).replace(/'/g,"%27");a.go("busca.lancamentos",{b:encodeURIComponent(t)})},e.buscaValida=function(){return!0},e.getParams=i,e.reset=c,c()}a.$inject=["$state","$httpParamSerializer","mdwMoment"],angular.module("md").service("buscaService",a)}(),function(){"use strict";function a(a,t){return o.$inject=["$transitions","$stateParams","$mdPanel","buscaService"],{require:"mdwInputBuscaLancamentos",restrict:"E",scope:!0,template:['<form id="form-input-busca-lancamentos" ng-submit="vm.submit()" flex layout="row" autocomplete="off">',"<md-input-container flex md-no-float >","<md-icon>search</md-icon>",'<input id="input-busca-lancamentos" ng-model="vm.service.params.palavras" type="text" placeholder="Buscar lançamentos">',"</md-input-container>","</form>"].join(""),controllerAs:"vm",controller:o,bindToController:!0,link:function(o,e,n,r){var i=document.getElementById("input-busca-lancamentos"),c=angular.element(i);function s(){r.width=document.getElementById("form-input-busca-lancamentos").clientWidth,r.closePanel()}c.bind("focus",r.toggleBuscaAvancada),c.bind("click",r.toggleBuscaAvancada),angular.element(t).bind("resize",s),o.$on("$destroy",(function(){angular.element(t).unbind("resize",s)})),a((function(){r.width=document.getElementById("form-input-busca-lancamentos").clientWidth,r.$stateParams.b||c.focus()}),0)}};function o(a,t,o,e){var n=this;n.$stateParams=t,n.service=e,n.submit=c,n.toggleBuscaAvancada=function(){if(r)return;(a=c,t=o.newPanelPosition().relativeTo("#form-input-busca-lancamentos").addPanelPosition(o.xPosition.ALIGN_START,o.yPosition.BELOW),r=o.create({templateUrl:"/partials/busca/buscaAvancada.html",panelClass:"busca-lancamentos-avancada",position:t,zIndex:1,attachTo:angular.element(document.body),focusOnOpen:!1,clickOutsideToClose:!0,controllerAs:"vm",bindToController:!0,onDomRemoved:function(a,t,o){r=null,angular.element(document.getElementsByClassName("date-picker-date-time")).remove()},controller:["mdPanelRef","cadastrosDatasource","configuracoesService","buscaService","MAX_DATE_LANCS",function(t,o,e,n,r){var i=this;i.service=n,i.ds=o,i.configuracoesService=e;var c=e.getConfig("buscalanc",{r:"ca"});i.maxDate=r,i.status=[],i.tipo=[],i.regime=i.service.params.regime||c.r,["status","tipo"].forEach((function(a){[1,2,4,8].forEach((function(t){i.service.params[a]&t&&i[a].push(t)}))})),i.setStatus=function(){i.service.params.status=0,i.status.forEach((function(a){i.service.params.status|=a}))},i.setTipo=function(){i.service.params.tipo=0,i.tipo.forEach((function(a){i.service.params.tipo|=a}))},i.setRegime=function(){i.service.params.regime=i.regime,c.r=i.regime,e.updateConfig("buscalanc",c)},i.buscar=function(){a()}}],locals:{width:n.width}})).open();var a,t},n.closePanel=s;var r,i=a.onBefore({to:function(a){return 0!==a.name.indexOf("busca")}},(function(){s(),i()}));function c(){n.service.buscaValida()&&(s(),e.go())}function s(){r&&r.close()}}}a.$inject=["$timeout","$window"],angular.module("md").directive("mdwInputBuscaLancamentos",a)}(),function(){"use strict";t.$inject=["mdwResourceProvider"],o.$inject=["mdwCache","mdwObserver","mdwTextColorBgBased","mdwResourceObserver","$q","$http"],angular.module("md").config(t).service("cadastrosDatasource",o);var a=["categorias","centros","contatos","projetos","contas","formas","regras","plasticos","tags","contatos/categorias","contatos/campos"];function t(t){angular.forEach(a,(function(a){var o="regras"!=a?"/cadastros":"";t.define(a,o+"/"+a+"/:id")}))}function o(t,o,e,n,r,i){var c=this,s=o(),l={},u={},d=function(a){a.textColor=e(a.cor)};angular.forEach(a,(function(a){var e="regras"!=a?"/cadastros":"";l[a]=t(e+"/"+a+"/:id",{paginate:!1}),c[a]=[],u[a]=o("cadastrosDatasource - "+a),n(a,{insert:function(t){"tags"!=a&&"projetos"!=a||d(t.data),c[a].push(t.data),u[a].notify(t),s.notify(t)},delete:function(t){for(var o=-1,e=0;e<c[a].length;e++)if(c[a][e].id==t.data.id){o=e;break}o>=0&&(c[a].splice(o,1),u[a].notify(t),s.notify(t))},update:function(t){"tags"!=a&&"projetos"!=a||d(t.data);for(var o=0;o<c[a].length;o++)if(c[a][o].id==t.data.id)return c[a][o]=t.data,u[a].notify(t),void s.notify(t)}})})),n("contas",(function(a){"CARTAOCREDITO"==a.data.tipo&&(l.plasticos.reset(),c.carregar("plasticos"))})),c.addObserver=function(a,t){return u[a].add(t)},c.notify=function(a){var t=u[a].createEvent(a);return u[a].notify(t),t},c.reload=function(a){return l[a].reset(),c.carregar(a).then((function(){u[a].notify()}))},c.addGlobalObserver=function(a){return s.add(a)},c.carregar=function(t){if(t)return l[t].get("").then((function(a){return"tags"!=t&&"projetos"!=t||a.map(d),c[t]=a}));var o=[];return angular.forEach(a,(function(a){o.push(c.carregar(a))})),r.all(o)},c.get=function(a,t,o){if(!c[a])throw new Error("Tipo "+a+" nao definido");if(!t)return c[a];for(var e=0;e<c[a].length;e++)if(c[a][e].id==t)return c[a][e]?o?c[a][e]:r.resolve(c[a][e]):l[a].get({id:t})}}}(),function(){"use strict";var a=angular.module("md");["centros","projetos","contas","lancamentos"].forEach((function(t){a.filter(t+"Rest",["usuariosService",function(a){return function(o,e){return"lancamentos"!=t?o.filter((function(o){return!a.hasRest(t,o.id)})):o.filter((function(o){return!a.hasRest(t,o.id,e||"v")}))}}])}))}(),function(){"use strict";angular.module("md").directive("cadastroStatus",(function(){return{restrict:"A",link:function(a,t,o,e){a.termo=1==a.status?"Ativo":"Inativo",a.classe=function(){return 1==a.status?"label-success":"label-danger"}},scope:{status:"=cadastroStatus"},template:"<span class='label' ng-class='classe()'>{{termo}}</span>"}}))}(),function(){"use strict";t.$inject=["$scope","$mdDialog","$state","mdwTopmenu","categoriasService","cadastrosDatasource"],angular.module("md").controller("CategoriasController",t);var a=["d","r","t"];function t(t,o,e,n,r,i){var c=this;function s(){var t=i.categorias,o={};c.tipos=[],c.numCategoriosAtivas=0,c.numCategoriasInativas=0,t.forEach((function(a){"t"!=a.tipo&&(a.status&&(c.numCategoriasAtivas+=1),a.status||(c.exibirSwitch=!0,c.numCategoriasInativas+=1),o[a.tipo]||(o[a.tipo]=[]),o[a.tipo].push(a))})),c.numCategoriasAtivas==o.r.length+o.d.length&&(c.exibirSwitch=!1,c.exibirApenasAtivos=!0),c.numCategoriasInativas==o.r.length+o.d.length&&(c.exibirSwitch=!1,c.exibirApenasAtivos=!1),angular.forEach(o,(function(a,t){c.tipos.push({tipo:t,categorias:a})})),c.tipos.sort((function(t,o){return a.indexOf(t.tipo)-a.indexOf(o.tipo)}))}n.title="Categorias",c.toggleStatus=function(a){if(a.filhos)for(var t=0;t<a.filhos.length;t++)if(a.filhos[t].status)return o.show(o.alert().title("Erro ao desabilitar").textContent("Não é possível desabilitar uma categoria que possua subcategorias ativas.").ok("Fechar")),!1;var e=angular.copy(a);return e.status=!e.status,e.nome=e.nomeRel,c.agrupar(),r.update(e).then((function(){a.status=e.status}))},c.exibirApenasAtivos=!0,c.exibirSwitch=!1,c.novo=function(){e.go("categorias.nova")},c.importar=function(){r.importar()},c.exportar=function(){r.exportar()},t.$on("$destroy",i.addObserver("categorias",s)),c.agrupar=s,s()}}(),function(){"use strict";function a(a,t){this.get=function(t,o){return a.get("categorias",t,o)},this.getCategoriaTipoLancamento=function(t){for(var o=a.categorias,e=0;e<o.length;e++)if(o[e].tipoL==t)return o[e]}}a.$inject=["cadastrosDatasource","mdwObserver"],angular.module("md").service("categoriasDatasource",a)}(),function(){"use strict";function a(a,t,o){o.state({id:"categorias",title:"Categorias",templates:["cadastros/categorias/categorias.html"]},{url:"/cadastros/categorias",templateUrl:"partials/cadastros/categorias/categorias.html",controller:"CategoriasController",controllerAs:"vm",data:{permmd:"cadastros.categorias"}}),a.state("categorias.nova",t.getState({url:"/nova",params:{id:null,tipo:"d"},action:"categoriasService.novo",data:{permmdt:"g"}})).state("categorias.editar",t.getState({url:"/editar/:id",action:"categoriasService.editar",data:{permmdt:"g"}})).state("categorias.excluir",t.getState({url:"/excluir/:id",action:"categoriasService.excluir",data:{permmdt:"e"}}))}a.$inject=["$stateProvider","mdwStateDialogProvider","mdwBaseStateProvider"],angular.module("md").config(a)}(),function(){function a(a,t,o,e,n,r,i){var c=n("categorias");return{create:function(a){return c.insert(a).then((function(a){return i.recordAdded("Categoria"),o.showSimple("Categoria criada"),a}))},update:function(a){return c.update(a).then((function(a){return a.pai||e.categorias.forEach((function(t){t.pai==a.id&&(t.nome=a.nomeRel+"/"+t.nomeRel,t._ordenacao=a.nomeRel+a.id+t.nomeRel)})),o.showSimple("Categoria atualizada"),e.notify("categorias"),a}))},delete:function(a,t){return c.delete(a,t).then((function(){o.showSimple("Categoria excluída")}))},exportar:function(){return t("categorias")},importar:function(){return a.show({id:"importar-categorias",templateUrl:"/partials/cadastros/categorias/importarCategorias.html",controller:"importarCategoriasController",controllerAs:"vm"})},novo:function(a){return s({nome:a?a.nome:"",tipo:a&&a.tipo||"d",pai:a&&a.id||0})},editar:s,excluir:function(a){return r("categorias",this,a,(function(){return e.get("categorias",a.id).then((function(a){return e.categorias.filter((function(t){return t.status&&t.id!=a.id&&t.tipo===a.tipo}))}))}),{desassociar:!1,mover:!0})}};function s(t){var o=!!t&&!!t.id;return a.show({id:"edicao-categoria",templateUrl:"/partials/cadastros/categorias/editarCategoria.html",controller:"EditarCategoriaController",controllerAs:"vm",resolve:{categoria:function(){return o?e.get("categorias",t.id):t},categoriasPai:function(){return o?e.get("categorias",t.id).then((function(a){return e.categorias.filter((function(t){return t.pai==a.id})).length>0?[]:e.categorias.filter((function(t){return!t.pai&&t.id!=a.id&&t.tipo==a.tipo}))})):e.categorias.filter((function(a){return!a.pai&&a.id!=t.id}))}}})}}a.$inject=["$mdDialog","exportacaoCadastro","$mdToast","cadastrosDatasource","mdwResource","excluirCadastro","mdwAnalytics"],angular.module("md").factory("categoriasService",a)}(),function(){"use strict";function a(a,t,o,e,n,r){var i=this,c=!!e&&!!e.id;i.edicao=c,i.categoria=angular.extend({nome:"",nomeRel:"",tipo:"d"},e||{}),i.edicao&&(i.categoria.nome=i.categoria.nomeRel),i.categoriasPai=n,i.categoriaPai=i.categoria.pai,i.tipo="d"==i.categoria.tipo?"despesa":"receita",i.ok=function(e){var n=c?r.update(i.categoria):r.create(i.categoria);return i.salvando=!0,n.then((function(n){return a.hide(n).then((function(){e&&t((function(){o.go("categorias.nova",{tipo:i.categoria.tipo,id:i.categoria.pai})}),100)}))})).finally((function(){i.salvando=!1}))}}a.$inject=["$mdDialog","$timeout","$state","categoria","categoriasPai","categoriasService"],angular.module("md").controller("EditarCategoriaController",a)}(),function(){"use strict";function a(a,t,o,e,n,r){var i=this;i.excluirSemLanc=null,i.isUploading=!1,i.confirmarSenha=!1,i.senhaInput=!1,i.senha="",i.error=!1,i.senhaValida=!0,i.fileItem=null;var c=["xlsx","xls","csv"];i.catSis=[],e.categorias.forEach((function(a){!a.sistema||a.tipoL||"d"!=a.tipo&&"r"!=a.tipo||i.catSis.push(a)})),i.uploader=new a({url:"/api/v1/cadastros/categorias/importar",headers:t.getHeaders(),filters:[{name:"type",fn:function(a){return-1!=c.indexOf(function(a){return a.name.substr(a.name.lastIndexOf(".")+1).toLowerCase()}(a))}}]}),i.uploader.onAfterAddingFile=function(a){i.error=!1,i.isUploading=!0,a.formData=[{excluirSemLanc:i.excluirSemLanc,senha:i.senha}],a.upload()},i.uploader.onSuccessItem=function(a,t,o,c){var s=t.quant;e.reload("categorias").then((function(a){i.isUploading=!1,n.showSimple(s+" categorias cadastradas"),r.hide()}))},i.uploader.onProgressItem=function(){i.isUploading=!0},i.uploader.onErrorItem=function(a,t){i.fileItem=a,i.isUploading=!1,401==t.status?i.senhaValida=!1:i.error=t.error},i.tentarNovamente=function(a){i.error=!1,i.isUploading=!0,i.senhaValida=!0,a.formData=[{excluirSemLanc:i.excluirSemLanc,senha:i.senha}],a.upload()},i.close=function(){r.hide()},i.senhaDelecao=function(){1==i.excluirSemLanc?i.senhaInput=!0:i.senhaInput=!1}}a.$inject=["FileUploader","mdHeadersFactory","$http","cadastrosDatasource","$mdToast","$mdDialog"],angular.module("md").controller("importarCategoriasController",a)}(),function(){"use strict";function a(a,t,o,e){var n=this;n.categoria=t,n.categorias=e.categorias,n.mover=function(){return n.categoria.pai=n.destino||null,o.update(n.categoria).then((function(t){return a.hide(t)}))},n.destino=0,n.dismiss=a.cancel}a.$inject=["$mdDialog","categoria","categoriasService","cadastrosDatasource"],angular.module("md").controller("MoverCategoriaController",a)}(),function(){"use strict";function a(a){var t=this;t.ngDisabled=!1,t.descricao="",t.buscarCategorias=function(t){var o=a.categorias;return t&&0!=t.length?o.filter((function(a){return a.nome.match(new RegExp("(^"+t+")|(\\s+"+t+")","i"))})):o},t.selectCategoria=function(a){}}a.$inject=["cadastrosDatasource"],angular.module("md").directive("mdwSelectCategorias",(function(){return{require:"^ngModel",scope:{ngModel:"=",ngDisabled:"=?ngDisabled"},restrict:"E",controllerAs:"$ctrl",controller:a,template:["<md-autocomplete",'md-selected-item="$ctrl.selectedItem"','md-search-text="$ctrl.descricao"','md-selected-item-change="$ctrl.selectCategoria(cat)"','md-items="cat in $ctrl.buscarCategorias($ctrl.descricao)"','md-item-text="cat.nome"','md-min-length="0"','md-floating-label="Categoria"','md-menu-class="mdw-select-categorias">',"<md-item-template>",'<span class="cat-title">',"<md-icon>{{cat.tipo}}</md-icon>","<span> {{cat.nome}} </span>","</span>",'<span class="item-metadata">',"{{cat.tipo}}","</span>","</md-item-template>","</md-autocomplete>"].join(" ")}}))}(),function(){"use strict";angular.module("md").filter("tipoCategoria",(function(){return function(a){return"r"==a?"Receita":"Despesa"}}))}(),function(){"use strict";function a(a,t,o,e,n,r){var i=this;function c(){i.centros=[],i.numCentrosAtivos=0,i.numCentrosInativos=0,n.centros.forEach((function(a){a.status&&(i.numCentrosAtivos+=1),a.status||(i.exbirSwitch=!0,i.numCentrosInativos+=1),i.centros.push(a)})),i.numCentrosAtivos==i.centros.length&&(i.exibirApenasAtivos=!0,i.exbirSwitch=!1),i.numCentrosInativos==i.centros.length&&(i.exibirApenasAtivos=!1,i.exbirSwitch=!1)}o.title="Centros",i.exibirApenasAtivos=!0,i.hasAdicional=r.getAdicionaisAtivos().length>0,i.toggleStatus=function(a){a.status=!a.status,e.update(a),i.agrupar()},i.agrupar=c,i.exbirSwitch=!1,i.exportar=function(){return t("centros")},c(),a.$on("$destroy",n.addObserver("centros",c))}a.$inject=["$scope","exportacaoCadastro","mdwTopmenu","centrosService","cadastrosDatasource","usuariosService"],angular.module("md").controller("CentrosController",a)}(),function(){"use strict";function a(a,t,o){o.state({id:"centros",title:"Centros",templates:["cadastros/centros/centros.html"]},{url:"/cadastros/centros",templateUrl:"partials/cadastros/centros/centros.html",controller:"CentrosController",controllerAs:"vm",data:{permmd:"cadastros.centros"}}),a.state("centros.novo",t.getState({url:"/novo",params:{id:null,tipo:"d"},action:"centrosService.novo",data:{permmdt:"g"}})).state("centros.editar",t.getState({url:"/editar/:id",action:"centrosService.editar",data:{permmdt:"g"}})).state("centros.excluir",t.getState({url:"/excluir/:id",action:"centrosService.excluir",data:{permmdt:"e"}})).state("centros.restricoes",t.getState({url:"/restricoes/:id",action:"centrosService.restricoes",data:{permmdt:"g",permmdadmin:!0}}))}a.$inject=["$stateProvider","mdwStateDialogProvider","mdwBaseStateProvider"],angular.module("md").config(a)}(),function(){"use strict";function a(a,t,o,e,n,r,i,c){var s=e("centros");return{create:function(a){return s.insert(a).then((function(a){return c.recordAdded("Centro"),o.showSimple("Centro criado"),a}))},update:function(a){return s.update(a).then((function(a){return o.showSimple("Centro atualizado"),a}))},delete:function(a,t){return s.delete(a,t).then((function(a){return o.showSimple("Centro excluído"),a}))},novo:function(a){return i.dialogPlano("centros",(function(){return l(a)}))},editar:l,excluir:function(a){return n("centros",this,a,(function(){return r.centros.filter((function(t){return t.status&&t.id!=a.id}))}),{desassociar:!0,mover:!0})},restricoes:function(a){return i.definirRestricoesCentro(r.get("centros",a.id,!0))}};function l(t){var o=!!t&&!!t.id;return a.show({id:"edicao-centro",templateUrl:"/partials/cadastros/centros/editarCentro.html",controller:"EditarCentroController",size:"sm",controllerAs:"vm",resolve:{centro:function(){return o?r.get("centros",t.id):t}}})}}a.$inject=["$mdDialog","$timeout","$mdToast","mdwResource","excluirCadastro","cadastrosDatasource","usuariosService","mdwAnalytics"],angular.module("md").factory("centrosService",a)}(),function(){"use strict";function a(a,t,o,e,n,r){var i=this,c=!!o&&!!o.id;i.edicao=c,i.centro=angular.extend({nome:"",tipo:"a"},o||{}),i.ok=function(o){var s=c?e.update(i.centro):e.create(i.centro);return i.salvando=!0,s.then((function(e){return n.hide(e).then((function(){i.edicao||t((function(){r.definirRestricoesCentro(e).finally((function(){o&&t((function(){a.go("centros.novo")}),100)}))}),100)}))})).finally((function(){i.salvando=!1}))},i.dismiss=function(){n.cancel()}}a.$inject=["$state","$timeout","centro","centrosService","$mdDialog","usuariosService"],angular.module("md").controller("EditarCentroController",a)}(),function(){"use strict";angular.module("md").filter("tipoCentro",(function(){return function(a){return"a"==a?"Ambos":"d"==a?"Custo":"Lucro"}}))}(),function(){"use strict";function a(a,t){var o=this,e=o.conta;o.ok=function(){e.status=!e.status,e.encerrada=o.encerrar;var n=angular.copy(e);return e.banco&&(n.banco=e.banco.id),t.update(n).then((function(){return a.hide()}))}}a.$inject=["$mdDialog","contasService"],angular.module("md").controller("AlterarStatusContaController",a)}(),function(){"use strict";t.$inject=["$scope","$mdDialog","exportacaoCadastro","$filter","mdwTopmenu","contasService","mdwAccentFold","cadastrosDatasource","usuariosService","conexoesService","conexoesUpdate"],angular.module("md").controller("ContasController",t);var a=["CONTA CORRENTE","DINHEIRO","CARTAOCREDITO","INVESTIMENTO","OUTROS"];function t(t,o,e,n,r,i,c,s,l,u,d){var m=this;function f(){var a=new RegExp(c(m.busca),"i");m.tipos.forEach((function(t){t.contasOriginal||(t.contasOriginal=t.contas),null==m.busca||""==m.busca?t.contas=t.contasOriginal:t.contas=t.contasOriginal.filter((function(t){return!t.nome||null!=t.nome.match(a)}))}))}function p(){m.possuiInativa=!1,m.possuiAtiva=!1;var t=n("contasRest")(s.contas);t=t.filter((function(a){return"CARTEIRA_INVEST"!=a.tipo}));var o={};m.tipos=[],m.cntContas=0;for(var e=0;e<t.length;e++)if(t[e].status){m.possuiAtiva=!0;break}m.possuiAtiva||(m.exibirApenasAtivas=!1),t.forEach((function(a){!a.status&&(m.possuiInativa=!0,m.exibirApenasAtivas)||(o[a.tipo]||(o[a.tipo]=[]),o[a.tipo].push(a),m.cntContas++)})),angular.forEach(o,(function(a,t){m.tipos.push({tipo:t,contas:a})})),m.tipos.sort((function(t,o){return a.indexOf(t.tipo)-a.indexOf(o.tipo)})),f()}r.title="Contas",m.hasAdicional=l.getAdicionaisAtivos().length>0,m.validadorPlano=l.validarPlanoAtual(),m.exibirApenasAtivas=!0,m.agrupar=p,m.filtrar=f,m.exportar=function(){return e("contas")},m.pu=d.updateCtrl,t.$on("$destroy",s.addObserver("contas",p)),p(),m.bancoSelector={onChange:function(a,t){var o=angular.copy(t);o.banco=a.id,i.update(o).then((function(a){t.banco=a.banco}))}},m.conexoesEnabled=u.isEnabled(),m.toggleStatus=function(a){var t="CARTAOCREDITO"==a.tipo;if(a.status||!t||a.contada){if(a.status&&!t)return i.inativar(a);a.status=!a.status;var e=angular.copy(a);a.banco&&(e.banco=a.banco.id),i.update(e)}else o.show(o.alert().clickOutsideToClose(!0).title("Reativação de cartão de crédito").textContent("Antes de reativar seu cartão, você deve editá-lo e informar uma conta de previsão de débito").ok("Fechar"))},m.vincularConexao=function(a){return u.vincularConexao(a)}}}(),function(){"use strict";angular.module("md").constant("TIPOS_CONTA",["CONTA CORRENTE","DINHEIRO","CARTAOCREDITO","INVESTIMENTO","OUTROS"]).filter("tipoConta",(function(){return function(a){switch(a){case"CONTA CORRENTE":return"Conta Corrente";case"DINHEIRO":return"Conta Dinheiro";case"OUTROS":return"Outros";case"INVESTIMENTO":return"Conta de Investimentos";case"CARTAOCREDITO":return"Cartão de Crédito"}}})).filter("tipoInvestimento",(function(){return function(a){switch(a){case 1:return"Carteira de ativos";case 2:return"Poupança";case 3:return"Fundos";case 4:return"Previdência privada";case 5:return"Título de capitalização";case 6:return"Imóveis";case 7:return"CDB";case 8:return"RDB";case 9:return"LCA";case 10:return"LCI";case 11:return"Outros";case 12:return"LC"}}})).filter("liquidezConta",(function(){return function(a){switch(a){case 1:return"Imediatamente";case 2:return"No futuro";case 0:return"Imobilizado"}}}))}(),function(){"use strict";function a(a,t,o,e){e||(o.state({id:"contas",title:"Contas",templates:["cadastros/contas/contas.html"]},{abstract:!0,url:"/cadastros/contas",template:"<div layout='row' flex ui-view></div>",controller:["$scope","mdwTopmenu","conexoesService",function(a,t,o){t.preservStateParams=!0,o.isEnabled()&&t.setTabs(a,[{label:"Contas",state:"contas.listar"},{label:"Conexões",state:"contas.conexoes"}])}],controllerAs:"vm",data:{permmd:"cadastros.contas"}}),a.state("contas.listar",{url:"",templateUrl:"partials/cadastros/contas/contas.html",controller:"ContasController",controllerAs:"vm"}).state("contas.conexoes",{url:"/conexoes",templateUrl:"partials/conexoes/conexoes.html",controller:"ConexoesController",controllerAs:"vm",params:{nova:!1}}).state("contas.conexoes.nova",t.getState({url:"/nova",action:"conexoesService.configurarConexao"})).state("contas.conexoes.editar",t.getState({url:"/configurar/:id",action:"conexoesService.configurarConexao"})).state("contas.listar.novo",t.getState({url:"/novo",action:"contasService.novo",data:{permmdt:"g"}})).state("contas.listar.editar",t.getState({url:"/editar/:id",action:"contasService.editar",data:{permmdt:"g"}})).state("contas.listar.excluir",t.getState({url:"/excluir/:id",action:"contasService.excluir",data:{permmdt:"e"}})).state("contas.listar.restricoes",t.getState({url:"/restricoes/:id",action:"contasService.restricoes",data:{permmdt:"g",permmdadmin:!0}})))}a.$inject=["$stateProvider","mdwStateDialogProvider","mdwBaseStateProvider","MD_INVEST_MOD"],angular.module("md").config(a)}(),function(){"use strict";function a(a,t,o,e,n,r,i,c,s,l,u,d,m){v.$inject=["idConta"];var f=r("contas");return m.addObserver((function(){m.carregarConexoes().then((function(a){var t={};a.forEach((function(a){a.accounts.forEach((function(a){t[a.conta]=a}))})),i.contas.forEach((function(a){var o=t[a.id];a.connection=o?o.connection:void 0,a.connectionAccount=o?o.id:void 0}))}))})),{create:function(a){return f.insert(a).then((function(a){return s.validarPlanoAtual(!0),o.showSimple("Conta criada"),a}))},update:function(a){return f.update(a).then((function(a){return s.validarPlanoAtual(!0),o.showSimple("Conta atualizada"),a}))},delete:function(a){return f.delete(a).then((function(){s.validarPlanoAtual(!0),o.showSimple("Conta excluída"),m.notify()}))},novo:function(a){return s.dialogPlanoNcontas((function(){return p(a)}))},editar:p,inativar:function(a){return t.show({id:"status_contas",templateUrl:"/partials/cadastros/contas/alterar_status.html",controller:"AlterarStatusContaController",controllerAs:"vm",bindToController:!0,resolve:{conta:function(){return i.get("contas",a.id)}}})},excluir:function(o){var r=this,i=a.defer(),s=c.addObserver((function(a){var o=angular.isObject(a.data)?a.data.message:a.data;i.resolve(t.show(t.alert().title("Não é possível excluir esta conta").textContent(o).ok("Ok"))),s()}));return l(),e.get("/cadastros/contas/validarExclusao/"+o.id).then((function(){return s(),n("contas",r,o,null,{desassociar:!1,mover:!1}).then((function(a){i.resolve(a)})).catch((function(a){i.reject(a)}))})),i.promise},tiposConta:function(){return e.get("/cadastros/contas/tipos",{cache:!0}).then((function(a){return a.data}))},saldos:function(a,t){return e.get("/cadastros/contas/saldos",{params:{inicio:a,fim:t}}).then((function(a){return a.data}))},queryBancos:function(a){return e.get("/cadastros/contas/bancos",{params:a,cache:!0}).then((function(a){return a.data}))},editarUltimoExtrato:v,carregarContasCaixa:function(a,t){return i.contas.filter((function(o){var e=(o.status||o.encerrada)&&1==o.liquidez&&"CARTAOCREDITO"!=o.tipo&&"CARTEIRA_INVEST"!=o.tipo&&(t||!d.moeda||o.moeda==d.moeda);return e&&a?!s.hasRest("contas",o.id):e}))},carregarContasPR:function(a,t){return i.contas.filter((function(o){var e=(o.status||o.encerrada)&&"CARTAOCREDITO"!=o.tipo&&"CARTEIRA_INVEST"!=o.tipo&&(t||!d.moeda||o.moeda==d.moeda);return e&&a?!s.hasRest("contas",o.id):e}))},carregarCartoes:function(a,t){return i.contas.filter((function(o){var e=("CARTAOCREDITO"==o.tipo&&!a||"CARTAOCREDITO"!=o.tipo&&a)&&(o.status||o.encerrada)&&"CARTEIRA_INVEST"!=o.tipo;return e&&t?!s.hasRest("contas",o.id):e}))},restricoes:function(a){return s.definirRestricoesConta(i.get("contas",a.id,!0))}};function p(a){!!a&&!!a.id&&(a=i.get("contas",a.id,!0));var o={};return a&&a.id&&"CARTAOCREDITO"==a.tipo&&(o.plasticos=function(){return angular.copy(i.plasticos.filter((function(t){return t.conta==a.id})))},o.primeiraFatura=function(){return u.carregarPrimeiraFatura(a.id)}),t.show({id:"edicao_contas",templateUrl:"/partials/cadastros/contas/editarConta.html",bindToController:!0,controller:"EditarContaController",controllerAs:"vm",locals:{conta:angular.copy(a)},resolve:o})}function v(a){var n=i.get("contas",a,!0);return t.show({id:"editar-ultimo-extrato",templateUrl:"/partials/cadastros/contas/editarUltimoExtrato.html",controller:function(){var o=this;o.ok=function(){var r=Math.abs(o.dados.valor)*o.dados.sinal,i=moment(o.dados.data).format("YYYY-MM-DD");return e.put("/cadastros/contas/"+a+"/atualizarUltimoExtrato",{data:i,saldo:r}).then((function(){n.saldoUltimoExtrato=r,n.dataUltimoExtrato=i,t.hide()}))}},bindToController:!0,controllerAs:"vm",locals:{conta:n,dados:{valor:n.saldoUltimoExtrato,data:n.dataUltimoExtrato,sinal:n.saldoUltimoExtrato>0?1:-1}}}).then((function(){o.showSimple("Informações atualizadas")}))}}a.$inject=["$q","$mdDialog","$mdToast","$http","excluirCadastro","mdwResource","cadastrosDatasource","mdwApiError","usuariosService","mdwDialogLoading","cartoesDatasource","moedaService","conexoesApi"],angular.module("md").factory("contasService",a)}(),function(){"use strict";function a(a,t,o,e,n,r,i,c,s,l,u,d,m,f,p){var v=this,g=!!v.conta&&!!v.conta.id,h="YYYY-MM-DD";g||f.accountSetupStarted(),v.hasCartao=l.planoHasCartoes();var C,b,A=!1;function x(){return 1==v.tipo?"CONTA CORRENTE":2==v.tipo?"CARTAOCREDITO":3==v.tipo?"DINHEIRO":4==v.tipo?"OUTROS":5==v.tipo?"INVESTIMENTO":void 0}v.moedas=m.disponiveis,v.edicao=g,v.preCreate=!g,v.rentabilidade=0,v.today=n().endOf("day"),v.ds=s,v.dismiss=r.cancel,v.queryBancos=function(a){return i.queryBancos({nome:a}).then((function(a){return a}))},v.restricaoMoeda=!1,v.selectorBanco={onChange:function(a){v.banco=a}},v.filtroContas=function(a){return v.conta.moeda==a.moeda&&(a.tipo.match(/CONTA CORRENTE|DINHEIRO|OUTROS/)||"INVESTIMENTO"==a.tipo&&2==a.tipoInvestimento)},v.isEdicaoCartao=v.conta&&"CARTAOCREDITO"==v.conta.tipo,v.blockEditarTipo=v.isEdicaoCartao||v.conta&&"INVESTIMENTO"==v.conta.tipo&&1!=v.conta.tipoInvestimento,v.bancoSelector={},v.$onInit=function(){if(v.edicao){switch(v.avancada=!0,v.conta.tipo){case"CONTA CORRENTE":v.tipo=1;break;case"CARTAOCREDITO":v.tipo=2;break;case"DINHEIRO":v.tipo=3;break;case"OUTROS":v.tipo=4;break;case"INVESTIMENTO":v.tipo=5;break;default:v.bloquearEdicao=!0}v.nome=v.conta.nome,2==v.tipo?(v.cartao=v.conta,v.cartao.plasticos=v.plasticos,v.cartao.saldoFaturaAnterior=v.primeiraFatura.valor):v.sinal=v.conta.saldoInicial>=0?1:-1,v.conta.dataSaldoInicial=n(v.conta.dataSaldoInicial),v.bancoSelector.banco=v.conta.banco}else v.sinal=1,v.nome="",v.tipo=v.isEdicaoCartao?2:1,v.conexao=v.conta.conexao,v.conta={dataSaldoInicial:n(),saldoInicial:0,exibirBP:!0,liquidez:1,moeda:d.utilizacao.moeda},v.cartao={proximoVencimento:n().date(20).format(h),limite:0,tipoLimite:1,saldoFaturaAnterior:0,contada:null,fechamento:10,plasticos:[{tipo:"T",titular:!0,nome:"",status:!0}]},function(){if(!v.conexao||!v.conexao.connection)return;var a=v.conexao.connection,t=v.conexao.account;if(v.nome=a.connector.name,v.tipo="CONTA CORRENTE"==t.type?1:2,v.conta.banco=a.connector.banco,!t.creationInfo)return;if(1==v.tipo)v.conta.saldoInicial=t.creationInfo.balance||0;else{t.creationInfo.balanceDueDate&&(v.cartao.proximoVencimento=t.creationInfo.balanceDueDate),t.creationInfo.balanceCloseDate&&(v.cartao.fechamento=n(v.cartao.proximoVencimento).diff(t.creationInfo.balanceCloseDate,"days")),t.creationInfo.plastics&&(v.cartao.plasticos=[],t.creationInfo.plastics.forEach((function(a,t){v.cartao.plasticos.push({tipo:0==t?"T":"A",titular:0==t,nome:a,status:!0})}))),t.creationInfo.creditLimit&&(v.cartao.limite=t.creationInfo.creditLimit);var o=a.accounts.filter((function(a){return"CONTA CORRENTE"==a.type}))[0];o&&(v.cartao.contada=o.conta)}}();v.banco=v.conta.banco,a.$watch("vm.banco",(function(a){a&&(v.conta.banco=a)})),v.cartao&&(!function(){if(v.cartao.fechamento=parseInt(v.cartao.fechamento,10),v.cartao.plasticos.forEach((function(a){a.titular="T"==a.tipo})),v.possuiFaturaFechada=!!v.primeiraFatura&&!n(v.primeiraFatura.vencimento).add(1,"months").isSame(v.cartao.proximoVencimento,"month"),v.sinalSaldoAnterior=v.cartao.saldoFaturaAnterior>0?1:-1,C=v.cartao.proximoVencimento,v.vencimento=n(v.cartao.proximoVencimento).date(),v.proximoFechamento=function(){return n(v.cartao.proximoVencimento).subtract(v.cartao.fechamento,"days").format("YYYY-MM-DD")},v.possuiFaturaFechada){b=n(v.cartao.proximoVencimento),v.vencimentos=[];for(t=0;t<2;t++)v.vencimentos.push(b.clone().add(t,"months").format(h))}else{var a=24;b=n().date(v.vencimento).subtract(a,"months"),v.vencimentos=[];for(var t=0;t<a+3;t++)v.vencimentos.push(b.clone().add(t,"months").format(h))}}(),a.$watch("vm.vencimento",(function(a){if(a)if(v.possuiFaturaFechada){v.vencimentos=[];for(t=0;t<2;t++)v.vencimentos.push(b.clone().add(t,"months").date(a).format(h));v.cartao.proximoVencimento=v.vencimentos[0]}else{for(var t=0;t<v.vencimentos.length;t++){var o=a>(r=(e=n(v.vencimentos[t])).daysInMonth())?r:a;v.vencimentos[t]=e.date(o).format(h)}var e,r;o=a>(r=(e=n(v.cartao.proximoVencimento)).daysInMonth())?r:a;v.cartao.proximoVencimento=e.date(o).format(h)}})),v.possuiFaturaFechada||a.$watch("vm.cartao.proximoVencimento",(function(a){var t=n(a).date(1).subtract(1,"months"),o=t.daysInMonth(),e=v.vencimento>o?o:v.vencimento;v.dataFaturaAnterior=t.date(e).format("DD/MM/YYYY")})))},v.onChangeNome=function(){2!=v.tipo?v.conta.nome=v.nome:v.cartao.nome=v.nome},v.onChangeTipo=function(){},v.ok=function(a){var s=2!=v.tipo?function(a){var e=angular.copy(v.conta);e.tipo=x(),e.nome=v.nome,e.saldoInicial=Math.abs(v.conta.saldoInicial)*v.sinal,v.banco&&v.banco.id?e.banco=v.banco.id:e.banco=g?0:void 0;v.conexao&&(e.account=v.conexao.account.id);var n=g?i.update(e):i.create(e);return v.salvando=!0,n.then((function(n){return v.conta.saldoInicial=e.saldoInicial,v.conta.banco=v.banco,v.conexao&&p.notify(),r.hide(n).then((function(){v.edicao||t((function(){l.definirRestricoesConta(n).finally((function(){a&&t((function(){o.go("contas.novo")}),100)}))}),100)}))})).finally((function(){v.salvando=!1}))}(a):function(a){var e=angular.copy(v.cartao);if(e.tipo="CARTAOCREDITO",e.nome=v.nome,e.moeda=v.conta.moeda,e.saldoFaturaAnterior=Math.abs(v.cartao.saldoFaturaAnterior)*v.sinalSaldoAnterior,e.banco=v.banco&&v.banco.id,v.salvando=!0,A=v.possuiFaturaFechada&&n(C).format("YYYY-MM")<n(v.cartao.proximoVencimento).format("YYYY-MM"),v.edicao&&A)return r.show({id:"alterar-vencimento",templateUrl:"partials/cartoes/avisoTrocaVencimento.html",bindToController:!0,controllerAs:"vm",locals:{novoVencimento:v.cartao.proximoVencimento,vencimento:C},controller:function(){this.ok=r.hide}}).then(i);return i();function i(){var n=o.current.name;return v.conexao&&(e.account=v.conexao.account.id),(g?c.update(e):c.create(e)).then((function(e){return r.hide(e).then((function(){v.conexao&&p.notify(),m.atualizarMoedasUtilizadas(),v.edicao||t((function(){"fatura.listar.novo"!=n&&"cartoes.semcartoes.novo"!=n||u.alterarCartao(e.id),t((function(){l.definirRestricoesConta(e).finally((function(){a&&t((function(){o.go(n)}),100)}))}),100)}),100)}))})).finally((function(){v.salvando=!1}))}}(a);return g||s.then((function(a){var t=e("tipoConta")(x()),o=0!=v.conta.saldoInicial;f.accountSetupCompleted(t,o)})),s},v.onChangeTitular=function(a){v.cartao.plasticos.forEach((function(t){t.titular=t==a,t.tipo=t.titular?"T":"A"}))},v.maisAdicional=function(){v.cartao.plasticos.push({nome:"",tipo:"A",titular:!1,status:!0})},v.menosAdicional=function(a){if(a.id)a.status=!a.status;else{var t=v.cartao.plasticos.indexOf(a);v.cartao.plasticos.splice(t,1)}},v.checkPlanoMoeda=function(){v.conta.id||v.conta.moeda==d.utilizacao.moeda?v.restricaoMoeda=!1:m.getNumContas().then((function(a){var t=l.planoGetMoedas();v.restricaoMoeda=a>=t,v.totalMoedas=t}))}}a.$inject=["$scope","$timeout","$state","$filter","moment","$mdDialog","contasService","cartoesService","cadastrosDatasource","usuariosService","faturaService","configuracoesService","moedaService","mdwAnalytics","conexoesApi"],angular.module("md").controller("EditarContaController",a)}(),function(){"use strict";function a(a){var t="default";switch(a){case"CARTAOCREDITO":t+="-cartao";break;case"INVESTIMENTO":case"CARTEIRA_INVEST":t+="-investimento";break;case"DINHEIRO":t+="-carteira"}return t}function t(a){if(a){var t,o="áàãâäéèêëíìîïóòõôöúùûüçÁÀÃÂÄÉÈÊËÍÌÎÏÓÒÕÖÔÚÙÛÜÇ(",e="",n={value:""};for(t=0;t<a.length;t++)o.search(a.substr(t,1))>=0?e+="aaaaaeeeeiiiiooooouuuucAAAAAEEEEIIIIOOOOOUUUUC ".substr(o.search(a.substr(t,1)),1):e+=a.substr(t,1);return n.value=e.toLowerCase(),n.value.replace(/ /g," ")}}angular.module("md").directive("mdwBancoSelector",(function(){return o.$inject=["$scope","contasService","$mdPanel","$mdDialog"],{require:"mdwBancoSelector",restrict:"A",scope:{config:"=?mdwBancoSelector",filter:"=?",conta:"=",dim:"@?"},template:'<button tabindex="-1" type="button" ng-class="{\'list-empty\' : vm.bancos.length == 1 || vm.viewOnly}" class="mdw-banco-selector-trigger" ng-click="vm.open()" ng-style="vm.style"><img ng-src="https://s3.amazonaws.com/img.meudinheiroweb.com.br/bankicons/{{vm.selected.img}}.jpg"></button>',controller:o,controllerAs:"vm",bindToController:!0,link:function(a,t,o,e){e.$elem=angular.element(t).find("button")[0],e.viewOnly=angular.isDefined(o.viewOnly)}};function o(o,e,n,r){var i,c,s,l=this;l.$onInit=function(){i=angular.extend({onChange:angular.noop},l.config||{})};var u,d=o.$watch("vm.conta",(function(a){a&&(m(a.tipo),p(),d())}));function m(t){s={id:0,nome:a(c=t),img:a(c),isDefault:!0}}function f(a){l.selected=a,i.onChange(a,l.conta)}function p(){return u||(u=e.queryBancos({imagens:!0}).then((function(a){a.push(s);for(var t=[],o=a.length-1;o>=0;--o)a[o].img.match(/def(?:_)?[a-z]*/i)&&(t.push(a[o]),a.splice(o,1));var e=[];return e.bancos=a,e.outros=t,e})))}o.$watch("vm.conta.tipo",(function(a){a&&(m(a),l.selected&&!l.selected.isDefault||(l.selected=s))})),o.$watch("vm.conta.banco",(function(a){l.selected=a||s}),!0),l.dim&&(l.style={width:l.dim+"px",height:l.dim+"px"}),o.$watch("vm.filter",(function(a,o){a&&a.length>2&&null!=l.iniciando?p().then((function(o){for(var e=o.bancos.concat(o.outros),n=0;n<e.length;n++)if(e[n].id){var r=t(a.replace("(","").replace(")","").replace("+",""));if(-1!=t(e[n].nome.replace("(","").replace(")","").replace("+","")).search(r))return f(e[n])}})):o&&!a&&(l.selected=s),l.iniciando=!1})),l.open=function(){if(!l.viewOnly)return r.show({id:"bancos-selector-dialog",templateUrl:"/partials/cadastros/contas/mdwBancoSelector.html",controllerAs:"vm",bindToController:!0,controller:function(){var a=this;a.loading=!0,p().then((function(t){a.loading=!1,a.bancos=t.bancos,a.outros=t.outros}))},locals:{conta:l.conta,select:function(a){r.hide(),f(a)}}})}}})).component("mdwBancoViewer",function(){return t.$inject=["$scope","cadastrosDatasource"],{bindings:{conta:"=",dim:"=?"},template:'<img alt="{{$ctrl.title}}" title="{{$ctrl.title}}" ng-style="$ctrl.style" ng-src="https://s3.amazonaws.com/img.meudinheiroweb.com.br/bankicons/{{$ctrl.icon}}.jpg"/>',controller:t};function t(t,o){var e=this;function n(a){e.style={width:a+"px",height:a+"px"}}function r(t){t&&o.get("contas",t).then((function(t){if(e.title=t.nome,t.banco&&t.banco.img)return e.icon=t.banco.img;e.icon=a(t.tipo)}))}e.$onInit=function(){e.dim&&t.$watch("$ctrl.dim",(function(){n(e.dim)})),n(e.dim||30),r(e.conta),t.$watch("$ctrl.conta",r)}}}())}(),function(){"use strict";function a(a,t){this.ds=t}a.$inject=["mdwTopmenu","cadastrosDatasource"],angular.module("md").controller("CamposContatoController",a)}(),function(){"use strict";function a(a,t){a.state("contatos.campos",{url:"/campos",templateUrl:"partials/cadastros/contatos/campos/campos.html",controller:"CamposContatoController",controllerAs:"vm",data:{permmd:"cadastros.contatos"}}).state("contatos.campos.novo",t.getState({url:"/novo",action:"camposContatoService.novo",data:{permmdt:"g"}})).state("contatos.campos.editar",t.getState({url:"/editar/:id",action:"camposContatoService.editar",data:{permmdt:"g"}})).state("contatos.campos.excluir",t.getState({url:"/excluir/:id",action:"camposContatoService.excluir",data:{permmdt:"e"}}))}a.$inject=["$stateProvider","mdwStateDialogProvider"],angular.module("md").config(a)}(),function(){"use strict";function a(a,t,o,e,n){const r=e("contatos/campos");return{create:function(a){return r.insert(a).then((function(a){return o.showSimple("Campo de contato criado"),a}))},update:function(a){return r.update(a).then((function(a){return o.showSimple("Campo de contato atualizado"),a}))},delete:function(a){return r.delete(a).then((function(){o.showSimple("Campo de contato excluído")}))},novo:i,editar:i,excluir:function(t){return a.show({id:"excluir-campo-contato",templateUrl:"/partials/cadastros/contatos/campos/excluirCampoContato.html",controller:["campo","contatos","$mdDialog","camposContatoService",function(a,t,o,e){const n=this;n.$onInit=function(){n.contatos=t,n.nome=a.nome,n.msg=t.length>0?"Não é possível excluir a campo, pois existem contatos assossiados a ela":"Confirma a exclusão de "},n.dismiss=function(){o.cancel()},n.excluir=function(){return e.delete(a).then(o.hide)},n.desassociarExcluir=function(){return e.desassociarExcluir(a.id).then(o.hide)}}],controllerAs:"vm",resolve:{campo:function(){return n.get("contatos/campos",t.id)},contatos:function(){const a=n.contatos.filter((a=>a.campos.length>0));return 0==a.length?[]:function(){const o=[];for(const e of a)for(const a of e.campos)if(a.campo==t.id){o.push(e);break}return o}()}}})},desassociarExcluir:function(a){return t.delete(`/api/v2/cadastros/contatos/campo/${a}`).then((function(a){n.reload("contatos/campos"),n.reload("contatos"),o.showSimple("Campo personalizado de contato excluído")}))}};function i(t){var o=!!t&&!!t.id;return a.show({id:"edicao-cmp-contato",templateUrl:"/partials/cadastros/contatos/campos/editarCampoContato.html",controller:"EditarCampoContatoController",controllerAs:"vm",resolve:{campo:function(){return o?n.get("contatos/campos",t.id):t}}})}}a.$inject=["$mdDialog","$http","$mdToast","mdwResource","cadastrosDatasource"],angular.module("md").factory("camposContatoService",a)}(),function(){"use strict";function a(a,t,o){var e=this,n=!!t&&!!t.id;e.edicao=n,e.campo=angular.copy(t||{}),e.ok=function(){return(n?o.update(e.campo):o.create(e.campo)).then((function(t){return a.hide(t)}))},e.dismiss=function(){a.cancel()}}a.$inject=["$mdDialog","campo","camposContatoService"],angular.module("md").controller("EditarCampoContatoController",a)}(),function(){"use strict";function a(a,t){this.ds=t}a.$inject=["mdwTopmenu","cadastrosDatasource"],angular.module("md").controller("CategoriasContatoController",a)}(),function(){"use strict";function a(a,t){a.state("contatos.categorias",{url:"/categorias",templateUrl:"partials/cadastros/contatos/categorias/categorias.html",controller:"CategoriasContatoController",controllerAs:"vm",data:{permmd:"cadastros.contatos"}}).state("contatos.categorias.nova",t.getState({url:"/nova",action:"categoriasContatoService.novo",data:{permmdt:"g"}})).state("contatos.categorias.editar",t.getState({url:"/editar/:id",action:"categoriasContatoService.editar",data:{permmdt:"g"}})).state("contatos.categorias.excluir",t.getState({url:"/excluir/:id",action:"categoriasContatoService.excluir",data:{permmdt:"e"}}))}a.$inject=["$stateProvider","mdwStateDialogProvider"],angular.module("md").config(a)}(),function(){"use strict";function a(a,t,o,e,n){var r=e("contatos/categorias");return{create:function(a){return r.insert(a).then((function(a){return o.showSimple("Categoria de contato criada"),a}))},update:function(a){return r.update(a).then((function(a){return o.showSimple("Categoria de contato atualizada"),a}))},delete:i,novo:c,editar:c,excluir:function(e){return a.show({id:"excluir-categoria-contato",templateUrl:"/partials/cadastros/contatos/categorias/excluirCategoriaContato.html",controller:["categoria","contatos","$mdDialog",function(a,e,r){this.msg="Confirma a exclusão de ",this.contatos=e,this.nome=a.nome,this.dismiss=function(){r.cancel()},this.excluir=function(){return i(a).then(r.hide)},this.desassociarExcluir=function(){return(e=a.id,t.delete(`/api/v2/cadastros/contatos/categoria/${e}`).then((function(a){n.reload("contatos/categorias"),n.reload("contatos"),o.showSimple("Categoria de contato excluída")}))).then(r.hide);var e}}],controllerAs:"vm",resolve:{categoria:function(){return n.get("contatos/categorias",e.id)},contatos:function(){return n.contatos.filter((function(a){return a.categoria==e.id}))}}})}};function i(a){return r.delete(a).then((function(){o.showSimple("Categoria de contato excluída")}))}function c(t){var o=!!t&&!!t.id;return a.show({id:"edicao-cat-contato",templateUrl:"/partials/cadastros/contatos/categorias/editarCategoriaContato.html",controller:"EditarCategoriaContatoController",controllerAs:"vm",resolve:{categoria:function(){return o?n.get("contatos/categorias",t.id):t}}})}}a.$inject=["$mdDialog","$http","$mdToast","mdwResource","cadastrosDatasource"],angular.module("md").factory("categoriasContatoService",a)}(),function(){"use strict";function a(a,t,o){var e=this,n=!!t&&!!t.id;e.edicao=n,e.categoria=angular.copy(t||{}),e.ok=function(){return(n?o.update(e.categoria):o.create(e.categoria)).then((function(t){return a.hide(t)}))},e.dismiss=function(){a.cancel()}}a.$inject=["$mdDialog","categoria","categoriasContatoService"],angular.module("md").controller("EditarCategoriaContatoController",a)}(),function(){"use strict";angular.module("md").constant("CONTATO_TIPOS_PESSOA",[{id:"f",nome:"Física"},{id:"j",nome:"Jurídica"}]).constant("CONTATO_TIPOS_CONTATO",[{id:"c",nome:"Cliente"},{id:"f",nome:"Fornecedor"},{id:"a",nome:"Cliente e Fornecedor"}])}(),function(){"use strict";function a(a,t,o,e,n,r,i,c){var s=this;function l(){var a=c(s.busca).replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");s.contatosBase=o.contatos,s.numContatosInativos=0,s.numContatosAtivos=0,function(){s.mapCategorias||(s.mapCategorias={});for(const a of s.categorias)s.mapCategorias[a.id]=a}();var t=new RegExp("(^"+a+")|("+(s.busca.length<4?"\\s+":"")+a+")","i"),e=new RegExp("^"+a);s.contatos=o.contatos.filter((function(a){var o=s.filterManager.filtrar(a);if(a.status&&(s.numContatosAtivos+=1),a.status||(s.exibirSwitch=!0,s.numContatosInativos+=1),!o)return!1;if(c(a.nome).match(t)||a.nascimento&&moment(a.nascimento).format("DD/MM/YYYY").match(t)||a.razaoSocial&&c(a.razaoSocial).match(t)||a.cpf&&a.cpf.replace(/[^0-9.]/g,"").match(e))return!0;if(a.campos)for(var n=0;n<a.campos.length;n++)if(a.campos[n].valor.match(t))return!0;return!1})),s.numContatosInativos==s.contatos.length&&(s.exibirApenasAtivos=!1,s.exibirSwitch=!1),s.numContatosAtivos==s.contatos.length&&(s.exibirApenasAtivos=!0,s.exibirSwitch=!1)}n.title="Contatos",s.filtrosService=r,s.filterManager=r.getManagerContatos({funcionalidade:51,onUpdate:l}),s.filtrar=l,s.busca="",s.campos=o["contatos/campos"],s.categorias=o["contatos/categorias"],a.$on("$destroy",o.addObserver("contatos",l)),s.$onInit=l,s.exibirApenasAtivos=!0,s.exibirSwitch=!1,s.selection=i({controller:s,templateUrl:"/partials/cadastros/contatos/lote/acoesLoteTopmenu.html",getContatos:function(){return s.contatos}}),a.$watchCollection("vm.contatos",s.selection.clearSelection),s.toggleStatus=function(a){a.status=!a.status,e.update(a)},s.detalhar=function(a){return t.go("contatos.detalhar",a)},s.importar=function(){return e.importar()},s.exportar=function(){var a=s.contatos.map((function(a){return a.id}));return e.exportar(a)}}a.$inject=["$scope","$state","cadastrosDatasource","contatosService","mdwTopmenu","filtrosService","selecaoContatosLote","mdwAccentFold"],angular.module("md").controller("ContatosController",a)}(),function(){"use strict";function a(a,t,o){o.state({id:"contatos",title:"Contatos",templates:["cadastros/contatos/contatos.html"]},{url:"/cadastros/contatos",abstract:!0,templateUrl:"partials/cadastros/contatos/contatos.html",controller:["cadastrosDatasource","$scope",function(a,t){var o=this;o.contatos=a.contatos,o.categorias=a["contatos/categorias"],o.campos=a["contatos/campos"],t.$on("$destroy",a.addObserver("contatos/categorias",(()=>{o.categorias=a["contatos/categorias"]}))),t.$on("$destroy",a.addObserver("contatos/campos",(()=>{o.campos=a["contatos/campos"]}))),t.$on("$destroy",a.addObserver("contatos",(function(){o.contatos=a.contatos})))}],controllerAs:"vm",data:{permmd:"cadastros.contatos"}}),a.state("contatos.listar",{url:"",templateUrl:"partials/cadastros/contatos/listar.html",controller:"ContatosController",controllerAs:"vm"}).state("contatos.listar.novo",t.getState({url:"/novo",action:"contatosService.novo",data:{permmdt:"g"}})).state("contatos.listar.detalhar",t.getState({url:"/detalhar/:id",action:"contatosService.detalhar"})).state("contatos.listar.excluir",t.getState({url:"/excluir/:id",action:"contatosService.excluir",data:{permmdt:"e"}})).state("contatos.listar.exportar",t.getState({url:"/exportar?:idsContatos",action:"contatosService.exportar"}))}a.$inject=["$stateProvider","mdwStateDialogProvider","mdwBaseStateProvider"],angular.module("md").config(a)}(),function(){"use strict";function a(a,t,o,e,n,r,i,c,s){var l=r("contatos");return{create:function(a){return l.insert(a).then((function(a){return s.recordAdded("Contato"),t.showSimple("Contato criado"),a}))},update:function(a){return l.update(a).then((function(a){return t.showSimple("Contato atualizado"),a}))},delete:function(a,o){return l.delete(a,o).then((function(){t.showSimple("Contato excluído")}))},novo:function(a){return c.dialogPlano("contatos",(function(){return u(a)}))},detalhar:u,excluir:function(a){return n("contatos",this,a,(function(){return i.contatos.filter((function(t){return t.status&&t.id!=a.id}))}),{desassociar:!0,mover:!0})},verificarDuplicidade:function(t){return o.get("/cadastros/contatos/verificarDuplicidadeContato",{params:t}).then((function(t){return 0==t.data.length?e.resolve(t.data):a.show({templateUrl:"/partials/cadastros/contatos/notificarDadosDuplicados.html",controller:"notificarDadosDuplicadosController",controllerAs:"vm",resolve:{contato:["$q",function(a){return a.resolve(t.data)}]}})}))},consultarCep:function(a){return o.get("https://viacep.com.br/ws/"+a+"/json/",{cache:!0,timeout:1e4,handleErrors:!1}).then((function(a){return a.data}))},getListaColunasExportacao:function(){return o.get("/cadastros/contatos/listacolunasexportacao",{cache:!0}).then((function(a){return a.data}))},exportar:function(t){return a.show({id:"exportar-contato",templateUrl:"/partials/cadastros/contatos/exportarContatos.html",controller:"ExportarContatosController",controllerAs:"vm",resolve:{colunasExportacao:["contatosService",function(a){return a.getListaColunasExportacao()}]},locals:{idsContatos:t}})},importar:function(){return a.show({id:"importar-contato",templateUrl:"/partials/cadastros/contatos/importarContatos.html",controller:"importarContatosController",controllerAs:"vm"})},consultarCNPJ:function(a){return o.get("/cadastros/contatos/consultarCnpj",{params:{cnpj:a},cache:!0}).then((function(a){return a.data}))},editarLote:function(o){return a.show({id:"editar-contatos-lote",templateUrl:"/partials/cadastros/contatos/lote/editarLote.html",controllerAs:"vm",bindToController:!0,locals:{ids:o,campos:i["contatos/campos"]||[]},controller:["$mdDialog","$http",function(a,o){const e=this;e.ok=function(){const n=function(){const a={ids:e.ids};(e.categoria||0==e.categoria)&&(a.categoria=e.categoria);if(e.selectCampos&&e.selectCampos.length>0){a.campos=[];for(const t of e.selectCampos)a.campos.push(e.personalizados[t])}return a}();if(!n.categoria&&!n.campos&&0!==n.categoria)return a.hide();!function(n){o.post("cadastros/contatos/editarlote",n).then((function(o){i.reload("contatos");const n=1==e.ids.length?"":"s";return t.showSimple(e.ids.length+" contato"+n+" editados"+n),a.hide()}))}(n)},e.$onInit=function(){if(0!=e.campos.length){e.personalizados={};for(const a of e.campos)e.personalizados[a.id]=a,e.personalizados[a.id].valor=""}}}]})},excluirLote:function(t){return a.show({id:"exluir-contatos-lote",templateUrl:"/partials/cadastros/contatos/lote/excluirLote.html",controller:"ExcluirLoteContatosController",controllerAs:"vm",resolve:{destinos:function(){return i.contatos.filter((function(a){return a.status&&!t.includes(a.id.toString())}))}},locals:{ids:t}})}};function u(t){var o=!!t.id;return a.show({id:"dialog-editar-contato",templateUrl:"/partials/cadastros/contatos/editarContato.html",controller:"EditarContatoController",size:"sm",controllerAs:"vm",resolve:{contato:function(){return o?i.get("contatos",t.id):t}},fullscreen:!0})}}a.$inject=["$mdDialog","$mdToast","$http","$q","excluirCadastro","mdwResource","cadastrosDatasource","usuariosService","mdwAnalytics"],angular.module("md").factory("contatosService",a)}(),function(){"use strict";function a(a,t,o,e,n,r,i,c,s,l,u,d){var m=this,f=!!r&&!!r.id;if(m.anexos=[],m.edicao=f,m.ufs=c,m.anexarDocumentos=function(){u.anexar().then((function(a){a&&(m.contato.anexos=m.contato.anexos||[],a=a.filter((function(a){for(var t=!1,o=0;o<m.contato.anexos.length;o++)if(m.contato.anexos[o]==a){t=!0;break}return!t})),m.contato.anexos=m.contato.anexos.concat(a))}))},m.unlinkAnexo=function(a){var t=m.contato.anexos.indexOf(a.id);m.contato.anexos.splice(t,1)},m.contato=angular.extend({tipoPessoa:"j",tipoContato:"c",campos:{}},r||{}),r.id&&m.contato.campos){var p=m.contato.campos;m.contato.campos={},p.forEach((function(a){m.contato.campos[a.campo]=a.valor}))}function v(){if(m.contato.cep&&m.contato.cep.match(/^[0-9]{8}$/))return m.loadingExtra=!0,l.consultarCep(m.contato.cep).then((function(a){m.contato.endereco=a.logradouro,m.contato.bairro=a.bairro,m.contato.cidade=a.localidade,m.contato.uf=a.uf,m.contato.complemento=a.complemento})).finally((function(){m.loadingExtra=!1}))}r.id&&d.carregarDocumentosContato(r.id).then((function(a){m.anexos=a,m.contato.anexos=a.map((function(a){return a.id})),e.$watchCollection("vm.contato.anexos",(function(a){a&&(m.anexos=[],a.forEach((function(a){d.get(a).then((function(a){m.anexos.push(a)}))})))}))})),m.infoAdicional=m.edicao,m.ok=function(n){if(!e.form.$valid)return;return m.salvando=!0,l.verificarDuplicidade(m.contato).then((function(){var e=angular.copy(m.contato),r=[];return angular.forEach(e.campos,(function(a,t){r.push({campo:t,valor:a})})),e.campos=r,(m.edicao?l.update(e):l.create(e)).then((function(e){return o.hide(e).then((function(){m.edicao||n&&a((function(){t.go("contatos.listar.novo")}),100)}))}))})).finally((function(){m.salvando=!1}))},m.ds=i,m.campos=m.ds["contatos/campos"],m.cep=v,m.addCat=function(){return s.novo().then((function(a){m.contato.categoria=a.id}))},m.dismiss=function(){o.cancel()},m.changeCep=function(){e.form.cep&&e.form.cep.$valid&&v()},m.changeCnpj=function(){e.form.cnpj&&e.form.cnpj.$valid&&(m.loadingExtra=!0,l.consultarCNPJ(m.contato.cpf).then((function(a){if(a){var t=angular.copy(m.contato.campos);angular.extend(m.contato,a),m.contato.campos=t,m.infoAdicional=!0}})).finally((function(){m.loadingExtra=!1})))}}a.$inject=["$timeout","$state","$mdDialog","$scope","$http","contato","cadastrosDatasource","BR_UFS","categoriasContatoService","contatosService","documentosService","documentosDatasource"],angular.module("md").controller("EditarContatoController",a)}(),function(){"use strict";function a(a,t,o,e){var n=this;n.colunasExportacao=[],n.getLinkDownload=i;var r={colunasComunsPfPj:"Incluir as seguintes colunas:",colunasPf:"Pessoa física",colunasPj:"Pessoa jurídica",colunasAdicionais:"Adicionais",personalizados:"Campos personalizados"};function i(){return n.config.colunas=[],n.config.personalizados=[],n.colunasExportacao.forEach((function(a){var t="personalizados"==a.id?"personalizados":"colunas";a.itens.forEach((function(a){a.checked&&n.config[t].push(a.id)}))})),e.post("cadastros/contatos/exportar",n.config).then((function(a){return function(a,t,o){if(null!=o&&navigator.msSaveBlob)return navigator.msSaveBlob(new Blob([o],{type:t}),a);var e=angular.element("<a style='display: none;'/>"),n=window.URL.createObjectURL(new Blob([o],{type:t}));e.attr("href",n),e.attr("download",a),angular.element(document.body).append(e),e[0].click(),window.URL.revokeObjectURL(n),e.remove()}(n.nomeArquivo,"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",function(a){for(var t=new ArrayBuffer(a.length),o=new Uint8Array(t),e=0;e!=a.length;++e)o[e]=255&a.charCodeAt(e);return t}(atob(a.data))),o.hide()}))}angular.forEach(a,(function(a,t){var o={id:t,label:r[t],itens:[]};n.colunasExportacao.push(o),angular.forEach(a,(function(a,t){angular.isObject(a)?o.itens.push({id:a.id,nome:a.nome,checked:!0}):o.itens.push({id:a,nome:a,checked:!0})}))})),n.config={ids:t},n.getLinkDownload=i,n.nomeArquivo="Meu_Dinheiro_Contatos"}a.$inject=["colunasExportacao","idsContatos","$mdDialog","$http"],angular.module("md").controller("ExportarContatosController",a)}(),function(){"use strict";function a(a,t,o,e,n,r,i){var c=this;c.permiteDupli=!1,c.concluido=!1,c.uploader=new a({url:"/api/v1/cadastros/contatos/importarArquivo",headers:t.getHeaders()}),c.uploader.onAfterAddingFile=function(a){c.error=!1,a.formData=[{tipo:4,permiteDupli:c.permiteDupli}],a.upload()},c.importar=function(){return o.post("cadastros/contatos/importar",c.params).then((function(a){c.quant=a.data.quant,e.reload("contatos").then((function(a){n.showSimple(c.quant+" contatos cadastrados"),r.hide()}))}))},c.uploader.onSuccessItem=function(a,t,o,e){c.isUploading=!1,c.logs=t.logs,c.quantContatoFail=t.quantContatoFail,c.quantContatoDupli=t.quantContatoDupli,c.hasUploaded=!0,c.contatos=t.contatos,c.params={contatos:c.contatos}},c.uploader.onProgressItem=function(){c.isUploading=!0},c.uploader.onErrorItem=function(a,t){c.isUploading=!1,c.error=t.error},c.close=function(){r.hide()}}a.$inject=["FileUploader","mdHeadersFactory","$http","cadastrosDatasource","$mdToast","$mdDialog","$q"],angular.module("md").controller("importarContatosController",a)}(),function(){"use strict";function a(a,t,o,e,n,r,i){var c=this;c.ids=o,c.mover=c.desassociar=!0,c.validarSenha=i.utilizacao.senhaDelecao,c.destinos=n,c.excluir=function(){return c.senhaInvalida=!1,c.validarSenha?a.post("/apiweb/usuarios/validarSenha",{senha:c.senha}).then((function(a){if(a.data)return o();c.senhaInvalida=!0})):o();function o(){return a.post("cadastros/contatos/excluirlote",{ids:c.ids,idDestino:c.idDestino}).then((function(a){r.reload("contatos");var o=1==c.ids.length?"":"s";return e.showSimple(c.ids.length+" contato"+o+" excluído"+o),t.hide()}))}},c.dismiss=function(){t.cancel()}}a.$inject=["$http","$mdDialog","ids","$mdToast","destinos","cadastrosDatasource","configuracoesService"],angular.module("md").controller("ExcluirLoteContatosController",a)}(),function(){"use strict";angular.module("md").service("selecaoContatosLote",["mdwTopmenu","contatosService",function(a,t){return function(a){return new o(a)};function o(o){var e=this,n=o.controller,r=e.getContatos=o.getContatos;function i(){return!angular.equals({},e.selected)}function c(){i()?a.changeTemplateUrl(o.templateUrl,n):a.restorePrevious()}function s(){return Object.keys(e.selected).length}e.acaoLote=function(a,o){return t[a](Object.keys(e.selected),o)},e.selected={},e.clearSelection=function(){if(!i())return;e.selected={},c()},e.hasSelection=i,e.countSelected=s,e.toggleSelected=function(a){e.selected[a]||delete e.selected[a];c()},e.toggleAll=function(){var a=r();s()==a.length?(e.selected={},c()):a.forEach((function(a){e.selected[a.id]=!0}))}}}])}(),function(){"use strict";function a(a,t){var o=this;o.dadosDuplicados=t,o.close=function(){a.hide()},o.dismiss=function(){a.cancel()}}a.$inject=["$mdDialog","contato"],angular.module("md").controller("notificarDadosDuplicadosController",a)}(),function(){"use strict";function a(a,t,o,e){var n=this;n.desassociar=n.config.desassociar,n.mover=n.config.mover,n.validarSenha=o.utilizacao.senhaDelecao,n.configuracoesService=o,n.excluir=function(){return n.senhaInvalida=!1,n.validarSenha?a.post("/apiweb/usuarios/validarSenha",{senha:n.senha}).then((function(a){if(a.data)return o();n.senhaInvalida=!0})):o();function o(){return n.service.delete(n.model,{idDestino:n.idDestino}).then((function(){return function(){if("tags"==n.tipoCadastro)return void e.regras.forEach((a=>{if(!a.tags)return;const t=a.tags.indexOf(n.model.id);t>-1&&a.tags.splice(t,1)}));if(n.tipoCadastro=n.tipoCadastro.slice(0,-1),!r.includes(n.tipoCadastro))return;e.regras.forEach((a=>{a[n.tipoCadastro]==n.model.id&&(a[n.tipoCadastro]=0==n.idDestino?null:n.idDestino)}))}(),t.hide()}))}};const r=["categoria","centro","projeto","contato"];n.dismiss=function(){t.cancel()}}a.$inject=["$http","$mdDialog","configuracoesService","cadastrosDatasource"],angular.module("md").controller("ExcluirCadastroController",a)}(),function(){"use strict";function a(a,t){return function(o,e,n,r,i){return a.show({id:"exluir-cadastro",templateUrl:"/partials/cadastros/excluirCadastro.html",controller:"ExcluirCadastroController",controllerAs:"vm",bindToController:!0,resolve:{model:function(){return t.get(o,n.id)},destinos:i.mover?r:function(){return[]}},locals:{service:e,config:i,tipoCadastro:o}})}}a.$inject=["$mdDialog","cadastrosDatasource"],angular.module("md").factory("excluirCadastro",a)}(),function(){"use strict";function a(a){return function(t){return a.post("cadastros/"+t+"/exportar").then((function(a){!function(a,t,o){if(null!=o&&navigator.msSaveBlob)return navigator.msSaveBlob(new Blob([o],{type:t}),a);var e=angular.element("<a style='display: none;'/>"),n=window.URL.createObjectURL(new Blob([o],{type:t}));e.attr("href",n),e.attr("download",a),angular.element(document.body).append(e),e[0].click(),window.URL.revokeObjectURL(n),e.remove()}("Meu_Dinheiro_"+t,"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",function(a){for(var t=new ArrayBuffer(a.length),o=new Uint8Array(t),e=0;e!=a.length;++e)o[e]=255&a.charCodeAt(e);return t}(atob(a.data)))}))}}a.$inject=["$http"],angular.module("md").factory("exportacaoCadastro",a)}(),function(){"use strict";function a(a,t,o,e,n){var r=this,i=!!e&&!!e.id;r.edicao=i,r.forma=angular.copy(e||{}),r.ok=function(e){var c=i?n.update(r.forma):n.create(r.forma);return r.salvando=!0,c.then((function(n){return t.hide(n).then((function(){r.edicao||e&&o((function(){a.go("formas.nova")}),100)}))})).finally((function(){r.salvando=!1}))},r.dismiss=function(){t.cancel()}}a.$inject=["$state","$mdDialog","$timeout","forma","formasService"],angular.module("md").controller("EditarFormaController",a)}(),function(){"use strict";function a(a,t,o,e,n,r){var i=this;function c(){i.formas=[],i.numFormasAtivas=0,i.numFormasInativas=0,e.formas.forEach((function(a){a.status&&(i.numFormasAtivas+=1),a.status||(i.exibirSwitch=!0,i.numFormasInativas+=1),i.formas.push(a)})),i.numFormasAtivas==i.formas.length&&(i.exibirSwitch=!1,i.exibirApenasAtivos=!0),i.numFormasInativas==i.formas.length&&(i.exibirSwitch=!1,i.exibirApenasAtivos=!1)}t.title="Formas de pagamento",i.exibirApenasAtivos=!0,i.exibirSwitch=!1,i.toggleStatus=function(a){a.status=!a.status,n.update(a),i.agrupar()},i.exportar=function(){return o("formas")},i.agrupar=c,c(),a.$on("$destroy",e.addObserver("formas",c))}a.$inject=["$scope","mdwTopmenu","exportacaoCadastro","cadastrosDatasource","formasService","importacaoService"],angular.module("md").controller("FormasController",a)}(),function(){"use strict";function a(a,t,o){o.state({id:"formas",title:"Formas de pagamento",templates:["cadastros/formas/formas.html"]},{url:"/cadastros/formas",templateUrl:"partials/cadastros/formas/formas.html",controller:"FormasController",controllerAs:"vm",data:{permmd:"cadastros.formas"}}),a.state("formas.nova",t.getState({url:"/nova",action:"formasService.novo",data:{permmdt:"g"}})).state("formas.editar",t.getState({url:"/editar/:id",action:"formasService.editar",data:{permmdt:"g"}})).state("formas.excluir",t.getState({url:"/excluir/:id",action:"formasService.excluir",data:{permmdt:"e"}}))}a.$inject=["$stateProvider","mdwStateDialogProvider","mdwBaseStateProvider"],angular.module("md").config(a)}(),function(){"use strict";function a(a,t,o,e,n,r,i){var c=e("formas");return{create:function(a){return c.insert(a).then((function(a){return i.recordAdded("Forma"),t.showSimple("Forma de pagamento criada"),a}))},update:function(a){return c.update(a).then((function(a){return t.showSimple("Forma de pagamento atulizada"),a}))},delete:function(a){return c.delete(a).then((function(){t.showSimple("Forma de pagamento excluída")}))},novo:function(a){return r.dialogPlano("formas",(function(){return s(a)}))},editar:s,excluir:function(a){return o("formas",this,a,null,{desassociar:!0,mover:!1})}};function s(t){var o=!!t&&!!t.id;return a.show({id:"edicao-forma",templateUrl:"/partials/cadastros/formas/editarForma.html",controller:"EditarFormaController",size:"sm",controllerAs:"vm",resolve:{forma:function(){return o?n.get("formas",t.id):t}}})}}a.$inject=["$mdDialog","$mdToast","excluirCadastro","mdwResource","cadastrosDatasource","usuariosService","mdwAnalytics"],angular.module("md").factory("formasService",a)}(),function(){"use strict";t.$inject=["cadastrosDatasource"];var a=angular.module("md");function t(a){return{template:"{{nome}} <md-tooltip ng-if='label' >{{label}}</md-tooltip>",require:"ngModel",scope:{placeholder:"=placeholder",label:"@",tipo:"@mdwNomeCadastro",id:"=ngModel"},link:function(t,o,e){t.nome=t.placeholder||"",t.$watch("id",(function(e){e?(o.removeClass("ng-hide"),a.get(t.tipo,t.id).then((function(a){t.nome=a.nome}))):o.addClass("ng-hide")}))}}}a.filter("nomeCadastro",["cadastrosDatasource",function(a){return function(t,o){return a.get(o,t,!0).nome}}]),a.directive("mdwNomeCadastro",t)}(),function(){"use strict";function a(a,t,o,e,n,r){var i=this,c=!!e&&!!e.id,s=!!e&&!!e._isTelaLancamento;i.edicao=c,i.projeto=angular.extend({metaDespesa:0,metaReceita:0},e||{}),i.definirMetas=!0,i.edicao&&(i.definirMetas=e.metas),i.ok=function(e){var l=angular.copy(i.projeto);i.definirMetas||(l.metaReceita=l.metaDespesa=0);l.inicio&&(l.inicio=moment(l.inicio).format("YYYY-MM-DD"));l.fim&&(l.fim=moment(l.fim).format("YYYY-MM-DD"));var u=c?n.update(l):n.create(l);return i.salvando=!0,u.then((function(n){return a.hide(n).then((function(){i.edicao||t((function(){r.definirRestricoesProjeto(n).finally((function(){s||(i.definirMetas?t((function(){o.go("projetos.metas",n)}),100):e&&t((function(){o.go("projetos.novo")}),100))}))}),100)}))})).finally((function(){i.salvando=!1}))},i.dismiss=function(){a.cancel()}}a.$inject=["$mdDialog","$timeout","$state","projeto","projetosService","usuariosService"],angular.module("md").controller("EditarProjetoController",a)}(),function(){"use strict";function a(a,t,o,e,n,r){var i=this,c={};function s(){var a=i.custom.id,t=0;i.meses.forEach((function(o){t+=i.metas[a][o]})),i.somaMeses=t}function l(a){var t=0;i.somaMeses=i.metas[a].geral,i.meses.forEach((function(o){i.metas[a][o]=parseFloat((i.metas[a].geral/i.meses.length).toFixed(2)),t+=i.metas[a][o]}));var o=i.metas[a].geral-t;i.metas[a][i.meses[i.meses.length-1]]+=o}function u(a){if(a.filhos){var t=0;a.filhos.forEach((function(a){t+=Math.abs(i.metas[a.id].geral)})),t>0&&(a.expanded=!0)}}function d(a,t){var o=t||"geral";if(!a.filhos||!i.metas[a.id]||!i.metas[a.id][o])return!0;var e=a.filhos.reduce((function(a,t){return a+(i.metas[t.id][o]||0)}),0);return Math.abs(e).toFixed(2)<=Math.abs(i.metas[a.id][o]).toFixed(2)}function m(a){for(var t=0,o=0;o<i.meses.length;o++)t+=i.metas[a.id][i.meses[o]]||0;return Math.abs(t).toFixed(2)<=Math.abs(i.metas[a.id].geral).toFixed(2)}i.ds=n,i.despesas=[],i.receitas=[],i.meses=[],i.metas={},i.metasOrg={},i.distribuir=l,i.apagarMeta=function(a){i.metas[a.id].geral=0,i.meses.forEach((function(t){i.metas[a.id][t]=0}))},i.atualizarPai=u,i.ok=function(){for(var s=[],u=n.categorias,f=0;f<u.length;f++){var p=u[f],v=i.metas[p.id];if(v){for(var g=0,h=0;h<i.meses.length;h++)g+=v[i.meses[h]]||0;var C=!g;if(!v.geral){if(!g)continue;v.geral=g}if(c[p.id]){if(!d(c[p.id]))return void e.notify("A valor da categoria <strong>"+p.nome+"</strong> deve ser maior ou igual a soma das filhas");for(h=0;h<i.meses.length;h++)if(!d(c[p.id],i.meses[h]))return void e.notify("A valor da categoria <strong>"+p.nome+"</strong> deve ser maior ou igual a soma das filhas em "+o(i.meses[h]).format("MMM/YYYY"))}if(C)l(p.id);else if(!m(p))return void e.notify("A soma da distribuição mensal da categoria <strong>"+p.nome+"</strong> deve ser menor ou igual à meta geral definida.");var b=[];i.meses.forEach((function(a){v[a]&&b.push({data:a,meta:v[a]})})),s.push({categoria:p.id,datas:b,meta:v.geral})}}return r.definirMetas(i.projeto.id,s).then((function(){a.hide(),t.showSimple("Metas mensais atualizadas")}))},i.hasAlteracao=function(a){return!i.loading&&Math.abs(i.metas[a].geral)!=Math.abs(i.metasOrg[a].geral)},i.customize=function(a){i.custom=a,i.somaMeses=0,s()},i.atualizarSomaMeses=s,i.floatcmp=function(a,t){var o=Math.abs(a)-Math.abs(t);return Math.abs(o)<1e-4?0:o},function(){c={};var a=o(i.projeto.inicio),t=o(i.projeto.fim);for(;a.format("YYYYMM")<=t.format("YYYYMM");)i.meses.push(a.format("YYYY-MM")+"-01"),a.add(1,"month");var e=n.categorias.filter((function(a){return a.tipo.match(/(r|d)/)}));e.forEach((function(a){i.metas[a.id]={geral:0}})),e.forEach((function(a){a.pai?(c[a.pai]||(c[a.id]={filhos:[]}),c[a.pai].filhos.push(a)):(c[a.id]||(c[a.id]={filhos:[]}),c[a.id].id=a.id,c[a.id].nome=a.nome,c[a.id].tipo=a.tipo)})),angular.forEach(c,(function(a){"d"==a.tipo?i.despesas.push(a):i.receitas.push(a)})),i.loading=!0,r.carregarMetas(i.projeto.id).then((function(a){i.loading=!1,a.forEach((function(a){var t=a.data?a.data:"geral";i.metas[a.categoria][t]=Math.abs(a.valor)})),angular.forEach(c,u),i.metasOrg=angular.copy(i.metas)}))}()}a.$inject=["$mdDialog","$mdToast","mdwMoment","mdwApiError","cadastrosDatasource","projetosService"],angular.module("md").controller("MetasProjetoController",a)}(),function(){"use strict";function a(a,t,o,e,n,r){var i=this;function c(){i.projetos=[],i.numProjetosAtivos=0,i.numProjetosInativos=0,r.projetos.forEach((function(a){a.status&&(i.numProjetosAtivos+=1),a.status||(i.exibirSwitch=!0,i.numProjetosInativos+=1),i.projetos.push(a)})),i.numProjetosAtivos==i.projetos.length&&(i.exibirApenasAtivos=!0,i.exibirSwitch=!1),i.numProjetosInativos==i.projetos.length&&(i.exibirApenasAtivos=!1,i.exibirSwitch=!1)}e.title="Projetos",i.ds=r,i.hasAdicional=t.getAdicionaisAtivos().length>0,i.toggleStatus=function(a){a.status=!a.status,n.update(a),i.agrupar()},i.exibirApenasAtivos=!0,i.exibirSwitch=!1,i.definirMetas=function(){return $mdDialog.show({id:"definir-meta-orcamento",templateUrl:"/partials/metas/orcamento/definir.html",controller:"MetasOrcamentoDefinirController",controllerAs:"vm",bindToController:!0,locals:{mes:attr("inicio").format("YYYY-MM-DD"),tipo:attr("tipo")}})},i.exportar=function(){return o("projetos")},i.agrupar=c,c(),a.$on("$destroy",r.addObserver("projetos",c))}a.$inject=["$scope","usuariosService","exportacaoCadastro","mdwTopmenu","projetosService","cadastrosDatasource"],angular.module("md").controller("ProjetosController",a)}(),function(){"use strict";function a(a,t,o,e){var n=this,r=e(),i=o("/cadastros/projetos/:id/metas");n.addObserverMetas=r.add,n.get=function(a,o){return t.get("projetos",a,o)},n.carregarMetas=function(a){return i.get({id:a})},n.definirMetas=function(t,o){return a.post("/cadastros/projetos/"+t+"/metas",{metas:o}).then((function(a){return i.reset(),r.notify(),a.data}))}}a.$inject=["$http","cadastrosDatasource","mdwCache","mdwObserver"],angular.module("md").service("projetosDatasource",a)}(),function(){"use strict";function a(a,t,o){o.state({id:"projetos",title:"Projetos",templates:["cadastros/projetos/projetos.html"]},{url:"/cadastros/projetos",templateUrl:"partials/cadastros/projetos/projetos.html",controller:"ProjetosController",controllerAs:"vm",data:{permmd:"cadastros.projetos"}}),a.state("projetos.novo",t.getState({url:"/novo",action:"projetosService.novo",data:{permmdt:"g"}})).state("projetos.editar",t.getState({url:"/editar/:id",action:"projetosService.editar",data:{permmdt:"g"}})).state("projetos.metas",t.getState({url:"/metas/:id",action:"projetosService.metas",data:{permmdt:"g"}})).state("projetos.excluir",t.getState({url:"/excluir/:id",action:"projetosService.excluir",data:{permmdt:"e"}})).state("projetos.restricoes",t.getState({url:"/restricoes/:id",action:"projetosService.restricoes",data:{permmdt:"g",permmdadmin:!0}}))}a.$inject=["$stateProvider","mdwStateDialogProvider","mdwBaseStateProvider"],angular.module("md").config(a)}(),function(){"use strict";function a(a,t,o,e,n,r,i,c){var s=e("projetos");return{create:function(a){return s.insert(a).then((function(a){return t.showSimple("Projeto criado"),c.recordAdded("Projeto"),a}))},update:function(a){return s.update(a).then((function(a){return t.showSimple("Projeto atualizado."),a}))},delete:function(a,o){return s.delete(a,o).then((function(){t.showSimple("Projeto excluído")}))},novo:function(a){return i.dialogPlano("projetos",(function(){return l(a)}))},editar:l,metas:function(t){return a.show({id:"metas-projeto",templateUrl:"/partials/cadastros/projetos/metas.html",controller:"MetasProjetoController",controllerAs:"vm",bindToController:!0,resolve:{projeto:function(){return n.get("projetos",t.id)}}})},carregarMetas:function(a){return r.carregarMetas(a)},definirMetas:function(a,t){return r.definirMetas(a,t)},excluir:function(a){return o("projetos",this,a,(function(){return n.projetos.filter((function(t){return t.status&&t.id!=a.id}))}),{desassociar:!0,mover:!0})},restricoes:function(a){return i.definirRestricoesProjeto(n.get("projetos",a.id,!0))}};function l(t){var o=!!t&&!!t.id;return a.show({id:"edicao-projeto",templateUrl:"/partials/cadastros/projetos/editarProjeto.html",controller:"EditarProjetoController",size:"sm",controllerAs:"vm",resolve:{projeto:function(){return o?n.get("projetos",t.id):t}}})}}a.$inject=["$mdDialog","$mdToast","excluirCadastro","mdwResource","cadastrosDatasource","projetosDatasource","usuariosService","mdwAnalytics"],angular.module("md").factory("projetosService",a)}(),function(){"use strict";o.$inject=["$injector","$timeout","mdwAccentFold"],angular.module("md").directive("mdwSelect",o);var a=1;function t(a,t){return!(!angular.isUndefined(a)&&!angular.isUndefined(t))||("in"==t.c?-1!=t.v.indexOf(a):"nin"==t.c?-1==t.v.indexOf(a):void 0)}function o(o,e,n){return r.$inject=["$scope","$filter","cadastrosDatasource","usuariosService","MD_INVEST_MOD"],{restrict:"A",templateUrl:"/partials/cadastros/mdwSelect.html",require:["mdwSelect","ngModel","?^form"],scope:{name:"@?",tipo:"@mdwSelect",tipos:"=?",service:"@?",datasource:"@?",filter:"=?",defaultValues:"=?",label:"@placeholder",model:"=ngModel",_btnNovo:"=?btnNovo",ngDisabled:"=?",ngRequired:"=?",lancamento:"=?"},controller:r,controllerAs:"vm",bindToController:!0,link:function(a,t,o,n){var r=n[0];a.form=n[2],r.optNone=angular.isDefined(o.optNone),r.unselectable=angular.isDefined(o.unselectable),angular.isUndefined(r.ngRequired)&&(r.ngRequired=angular.isDefined(o.required));angular.isUndefined(r.ngDisabled)&&(r.ngDisabled=angular.isDefined(o.disabled));!r.canView||0==r.getResult().length&&!r.btnNovo?angular.element(t).remove():e((function(){var t=angular.element(document.getElementById(r.inputId));function o(){e((function(){r.shouldTriggerFocus&&(r.prev=r.selected,r.searchText="")}),50)}function n(){r.showMaxMsg=!1,r.blurLock||r.selected||!r.prev||(r.selected=r.prev),r.blurLock=!1}t.bind("focus",o),t.bind("blur",n),a.$on("$destroy",(function(){t.unbind("focus",o),t.unbind("blur",n)}))}),0)}};function r(r,i,c,s,l){var u,d,m=this;function f(){var a=c.get(d);return"contas"!=d&&"centros"!=d&&"projetos"!=d||(a=i(d+"Rest")(a),"contas"==d&&(a=i("lancamentosRest")(a,"g"))),m.filter&&(a=i("filter")(a,m.filter,(function(a,t){return angular.equals(a,t)||angular.equals(a,parseFloat(t))}))),a=a.filter((function(a){if(a.permissoes){var o=a.permissoes;if(!o.visivel)return!1;if(m.lancamento&&o.lancamento){if("contas"==d&&m.lancamento.categoria){var e=c.get("categorias",m.lancamento.categoria,!0);if("contasD"==m.tipo&&o.lancamento.contaDestino){if(!t(e.tipoL,o.lancamento.contaDestino.categoria.tipoL))return!1}else if("contasO"==m.tipo&&o.lancamento.contaOrigem){if(!t(e.tipoL,o.lancamento.contaOrigem.categoria.tipoL))return!1}else if("contas"==m.tipo&&o.lancamento.conta&&!t(e.tipoL,o.lancamento.conta.categoria.tipoL))return!1}if("categorias"==m.tipo){if(!t(m.lancamento.tipo,o.lancamento.tipo))return!1;if(m.lancamento.conta&&o.lancamento.conta){if(!n(c.get("contas",m.lancamento.conta,!0),o.lancamento.conta))return!1}else{if(m.lancamento.contaOrigem&&o.lancamento.contaOrigem&&!n(c.get("contas",m.lancamento.contaOrigem,!0),o.lancamento.contaOrigem))return!1;if(m.lancamento.contaDestino&&o.lancamento.contaDestino&&!n(c.get("contas",m.lancamento.contaDestino,!0),o.lancamento.contaDestino))return!1}}}}return!1!==a.status;function n(a,o){return!!t(a.tipo,o.tipo)&&!!t(a.tipoInvestimento,o.tipoInvestimento)}})),"contas"==d&&(a=a.slice(0,s.usuario.plano.permissoes.ncontas)),a.sort("categorias"==d?function(a,t){return a._ordenacao<t._ordenacao?-1:1}:function(a,t){return a.nome.toLowerCase()<t.nome.toLowerCase()?-1:1}),a}function p(){if(m.defaultValues){var a,t=f(),o=angular.isFunction(m.defaultValues)?m.defaultValues():m.defaultValues;if(o){if(angular.isArray(o))for(var e=0;e<o.length&&!(a=i("filter")(t,o[e])[0]);e++);else a=i("filter")(t,o)[0];if(a)return void(m.model=a.id)}}m.model=null,m.searchText=null,m.selected=null}m.query=function(a){var t=a;a=n(a||"");var o,e=f(),r=(s=a,s.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")),i=a.length<4?"\\s+":"",c=new RegExp("(^"+r+")|("+i+r+")","i");var s;if("categorias"==d)o=function(a){return n(a.nome).match(c)||n(a.nomeRel).match(c)};else if("contatos"==d){var l=new RegExp("^"+r);o=function(a){return n(a.nome).match(c)||a.nascimento&&moment(a.nascimento).format("DD/MM/YYYY").match(c)||a.razaoSocial&&n(a.razaoSocial).match(c)||a.cpf&&a.cpf.replace(/[^0-9.]/g,"").match(l)}}else o=function(a){return n(a.nome).match(c)};e=a&&0!=a.length?e.filter(o):e,m.listSize=100,m.resultLen=e.length,m.showMaxMsg=m.resultLen>m.listSize,m.showMaxMsg&&(e=e.slice(0,m.listSize));m.optNone&&(m.selected||m.prev||m.unselectable)&&e.unshift({id:0,nome:"Nenhum"});m.btnNovo&&(m.lastSearch=t,e.push({id:-1,nome:"Adicionar "+m.label.toLowerCase(),icon:"add",create:!0}));return e},m.onSelect=function(a){if(m.shouldTriggerFocus=!1,e((function(){m.shouldTriggerFocus=!0}),500),a&&-1==a.id)return function(){var a=u;"contas"==u&&l&&(a+="Invest");return o.get(a+"Service").novo({nome:m.lastSearch||"",tipo:m.lancamento?m.lancamento.tipo:"",_isTelaLancamento:!0},m.tipos).then((function(a){m.model=a.id}),(function(){m.searchText=""}))}();if(a&&0===a.id)return m.showMaxMsg=!1,m.model=0,void(m.prev=null);a?(m.model=m.selected.id,m.prev=m.selected,m.showMaxMsg=!1):m.model=null},m.getResult=f,m.unselect=function(){m.searchText=null,m.model=null},m.blurLock=!1,m.onClickOption=function(){m.blurLock=!0},m.$onInit=function(){u=m.service||m.tipo,d=m.datasource||m.tipo,m.inputId="select-cadastro-"+a++,m.shouldTriggerFocus=!0,m.btnNovo=!1!==m._btnNovo&&s.canEdit("cadastros."+d),m.canView="categorias"==d||"contas"==d||s.hasPerm("cadastros."+d,"v"),function(){if(m.model){for(var a=f(),t=0;t<a.length;t++)if(a[t].id==m.model){m.selected=a[t];break}!m.selected&&m.defaultValues?p():m.selected=c.get(d,m.model)}else p();r.$watch("vm.model",(function(a,t){if(!a)return 0!==a&&0!==t&&(m.searchText=null),void(m.unselectable&&0===a||(m.model=null));m.selected=c.get(d,a,!0),m.searchText=m.selected.nome})),r.$watch("vm.filter",(function(a,t){a&&a!=t&&p()}),!0)}()}}}}(),function(){"use strict";t.$inject=["$injector","mdwAccentFold"],angular.module("md").directive("mdwSelectChips",t).directive("mdwChip",(function(){return{restrict:"A",scope:{chip:"=mdwChip"},link:function(a,t,o){var e=t.parent().parent();e.css("background-color","#"+a.chip.cor),e.css("color","#"+a.chip.textColor)}}}));var a=1;function t(t,o){return e.$inject=["$scope","$filter","cadastrosDatasource","usuariosService","colorPickerService","mdwResource","$mdToast"],{restrict:"A",templateUrl:"/partials/cadastros/mdwSelectChips.html",require:["mdwSelectChips","ngModel"],scope:{name:"@?",tipo:"@mdwSelectChips",service:"@?",datasource:"@?",filter:"=?",label:"@placeholder",model:"=ngModel",ngDisabled:"=?",ngRequired:"=?"},controller:e,controllerAs:"vm",bindToController:!0,link:function(a,t,o,e){var n=e[0];n.optadd=angular.isDefined(o.optadd),n.onlyactive=angular.isDefined(o.onlyactive),n.canView||angular.element(t).remove()}};function e(e,n,r,i,c,s,l){var u,d,m=this;function f(){m.model?angular.isArray(m.model)?m.selectedItems=m.model.map((function(a){return r.get(d,a,!0)})):m.selectedItems=[r.get(d,m.model,!0)]:m.selectedItems=[]}function p(){var a=r.get(d);return"contas"!=d&&"centros"!=d&&"projetos"!=d||(a=n(d+"Rest")(a),"contas"==d&&(a=n("lancamentosRest")(a,"g"))),m.filter&&(a=n("filter")(a,m.filter,(function(a,t){return angular.equals(a,t)||angular.equals(a,parseFloat(t))}))),m.onlyactive&&(a=a.filter((function(a){return!!a.status}))),a.sort("categorias"==d?function(a,t){return a._ordenacao<t._ordenacao?-1:1}:function(a,t){return a.nome.toLowerCase()<t.nome.toLowerCase()?-1:1}),a}m.query=function(a){a=a||"";var t=p(),e=(s=o(a),s.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")),n=a.length<4?"\\s+":"",r="categorias"!=d?function(a){return o(a.nome).match(new RegExp("(^"+e+")|("+n+e+")","i"))}:function(a){return o(a.nome).match(new RegExp("(^"+e+")|("+n+e+")","i"))||o(a.nomeRel).match(new RegExp("(^"+e+")|("+n+e+")","i"))};var s;t=a&&0!=a.length?t.filter(r):t,m.listSize=100,m.resultLen=t.length,m.showMaxMsg=m.resultLen>m.listSize,m.showMaxMsg&&(t=t.slice(0,m.listSize));if(m.optadd&&i.canEdit("cadastros."+d)){var l,u=new RegExp("^"+a+"$","i");for(l=0;l<t.length;l++)var f=t[l].nome.match(u);f||""===a||t.push({id:-1,nome:a,cor:c.randomColor()})}return t},m.onSelect=function(a){},m.getResult=p,m.onChangeItems=function(){if(m.selectedItems.length>0){var a=m.selectedItems[m.selectedItems.length-1];if(-1==a.id)return delete a.id,void function(a){var o=u;"contas"==u&&MD_INVEST_MOD&&(o+="Invest");return t.get(o+"Service").inserir(a).then((function(a){return a}))}(a).then((function(t){a.id=t.id,m.model=m.selectedItems.map((function(a){return a.id}))}))}m.model=m.selectedItems.map((function(a){return a.id}))},e.$watch("vm.model",f),m.$onInit=function(){u=m.service||m.tipo,d=m.datasource||m.tipo,m.inputId="select-cadastro-chips-"+a++,m.shouldTriggerFocus=!0,m.canView="categorias"==d||"contas"==d||i.hasPerm("cadastros."+d,"v"),m.selectedItems=[],f()}}}}(),function(){"use strict";function a(a,t,o,e,n){var r=this,i=!!e&&!!e.id,c=!!e&&!!e._isTelaLancamento;r.edicao=i,r.ok=function(e){var s=angular.copy(r.tag),l=i?n.update(s):n.create(s);return r.salvando=!0,l.then((function(n){return a.hide(n).then((function(){r.edicao||t((function(){c||e&&t((function(){o.go("tags.novo")}),100)}),100)}))})).finally((function(){r.salvando=!1}))},r.tag=angular.copy(e),r.dismiss=function(){a.cancel()}}a.$inject=["$mdDialog","$timeout","$state","tag","tagsService"],angular.module("md").controller("EditarTagController",a)}(),function(){"use strict";function a(a,t,o,e,n){var r=this;function i(){r.exibirSwitch=!0;var a=0,t=0;r.ds.tags.forEach((function(o){o.status?a+=1:t+=1})),r.exibirSwitch=a!=r.ds.tags.length&&t!=r.ds.tags.length,c()}function c(){var a=r.searchInput||"";r.tags=r.ds.tags.filter((function(t){return(!r.exibirSwitch||!r.exibirApenasAtivos||t.status)&&t.nome.toLowerCase().indexOf(a.toLowerCase())>=0}))}t.title="Tags",r.ds=e,r.tags=r.ds.tags,r.toggleStatus=function(a){r.exibirSwitch=!0,a.status=!a.status,o.update(a),r.agrupar()},r.count=r.tags.length,r.exibirApenasAtivos=!0,r.searchTag=c,r.exportar=function(){return n("tags")},r.agrupar=i,a.$on("$destroy",e.addObserver("tags",i)),r.$onInit=function(){i()}}a.$inject=["$scope","mdwTopmenu","tagsService","cadastrosDatasource","exportacaoCadastro"],angular.module("md").controller("TagsController",a)}(),function(){"use strict";function a(a,t,o){o.state({id:"tags",title:"Tags",templates:["cadastros/tags/tags.html"]},{url:"/cadastros/tags",templateUrl:"partials/cadastros/tags/tags.html",controller:"TagsController",controllerAs:"vm",data:{permmd:"cadastros.tags"}}),a.state("tags.novo",t.getState({url:"/novo",action:"tagsService.novo",data:{permmdt:"g"}})).state("tags.editar",t.getState({url:"/editar/:id",action:"tagsService.editar",data:{permmdt:"g"}})).state("tags.excluir",t.getState({url:"/excluir/:id",action:"tagsService.excluir",data:{permmdt:"e"}}))}a.$inject=["$stateProvider","mdwStateDialogProvider","mdwBaseStateProvider"],angular.module("md").config(a)}(),function(){"use strict";function a(a,t,o,e,n,r){var i=e("tags");return{create:c,update:function(a){return i.update(a).then((function(a){return t.showSimple("Tag atualizada."),a}))},delete:function(a,o){return i.delete(a,o).then((function(){t.showSimple("Tag excluída")}))},novo:function(a){return s(a)},inserir:c,editar:s,excluir:function(a){return o("tags",this,a,(function(){return n.projetos.filter((function(t){return t.status&&t.id!=a.id}))}),{desassociar:!0,mover:!1})}};function c(a){return i.insert(a).then((function(a){return t.showSimple("Tag criada"),r.recordAdded("Tag"),a}))}function s(t){var o=!!t&&!!t.id;return a.show({id:"edicao-tag",templateUrl:"/partials/cadastros/tags/editarTag.html",controller:"EditarTagController",size:"sm",controllerAs:"vm",resolve:{tag:function(){return o?n.get("tags",t.id):t}}})}}a.$inject=["$mdDialog","$mdToast","excluirCadastro","mdwResource","cadastrosDatasource","mdwAnalytics"],angular.module("md").factory("tagsService",a)}(),function(){"use strict";function a(a,t){var o=this;function e(){return a.carregarContasCaixa(!0,!0)}function n(){return a.carregarContasPR(!0,!0)}function r(a,o,r){var i={},c=r?n:e;var s,l=o&&o.length>0;return s=!l,i.r=s,c().forEach((function(a){i[a.id]=s})),l?o.forEach((function(a){angular.isDefined(i[a])&&(i[a]=!0)})):(i.r=t.utilizacao.residuo,a&&a.length>0&&a.forEach((function(a){i[a]=!1}))),i}o.getInativas=function(a){var t=[];return e().forEach((function(o){!1===a[o.id]&&t.push(o.id)})),!1===a.r&&t.push("r"),t},o.getFiltrosPR=function(a,t){return r(a,t,!0)},o.getFiltros=function(a,t){return r(a,t)}}a.$inject=["contasService","configuracoesService"],angular.module("md").service("filtroContasCaixa",a)}(),function(){"use strict";function a(a,t,o,e){var n=this;n.detalhar=function(a){var t=[];angular.forEach(n.relatorio.filtroContas,(function(a,o){a&&t.push("r"==o?"r":parseFloat(o))})),n.relatorio.detalharFluxo({visao:n.relatorio.getVisao(),data:a.data,contas:t,pendentes:n.relatorio.considerarPendentes,transfIntraCaixa:n.relatorio.transfIntraCaixa})},n.relatorio=t,n.filtrosService=o,n.relatorio.carregar();var r=t.addObserver(n.relatorio.carregar),i=e.onChange((function(){n.relatorio.chartF&&n.relatorio.chartR&&(e.prepareChartOptions(n.relatorio.chartF.options),e.prepareChartOptions(n.relatorio.chartR.options))}));a.$on("$destroy",(function(){r(),i()})),n.printConfig={controller:["caixaFluxoService",function(a){this.relatorio=a}],templateUrl:"/partials/caixa/fluxo/fluxo_print.html"}}a.$inject=["$scope","caixaFluxoService","filtrosService","mdwDarkModeService"],angular.module("md").controller("CaixaFluxoController",a)}(),function(){"use strict";function a(a,t,o,e){var n=this,r={pageSize:50,onBeforeFetch:function(a){n.loading=!0},onFetch:function(a,t){n.loading=!1,n.ls=a}},i=o.addObserver(m);a.$on("$destroy",(function(){i()}));var c=e.lancamentos.STATUS_PROJETADO;!1===t.pendentes&&(c&=~e.lancamentos.STATUS_PENDENTE);var s,l,u,d={finalidade:e.lancamentos.FIN_EXTRATO,contas:(s=[],l=!0,u=!1,angular.forEach(t.contas,(function(a){"r"!=a?(l=!1,s.push(a)):u=!0})),{residuo:u,faturas:!0,apenasResiduos:l=l&&u,ids:s,transferenciasIntracaixa:!t.transfIntraCaixa}),status:c};function m(){n.paginator=e.lancamentos.list(d,{},r),n.paginator.fetch(1)}n.visao=t.visao,n.data=t.data,"d"==t.visao?(d.inicio=t.data,d.fim=t.data):(d.inicio=moment(t.data).startOf("month").format("YYYY-MM-DD"),d.fim=t.data),n.$onInit=function(){m()}}a.$inject=["$scope","detalhes","caixaFluxoService","relatoriosDatasource"],angular.module("md").controller("CaixaFluxoDetalheController",a)}(),function(){"use strict";function a(a,t,o,e){o.state({id:"caixafluxo",title:"Fluxo de caixa",templates:["caixa/fluxo/fluxo.html","caixa/fluxo/listar.html"]},{url:"/caixa/fluxo",abstract:!0,templateUrl:"partials/caixa/fluxo/fluxo.html",controller:["mdwTopmenu","caixaFluxoService",function(a,t){this.relatorio=t}],controllerAs:"vm"}),a.state("caixafluxo.listar",{url:"?inicio&fim&i",templateUrl:"partials/caixa/fluxo/listar.html",controller:"CaixaFluxoController",controllerAs:"vm",data:{enableMoeda:!0},resolve:{security:["usuariosService","$q",function(a,t){if(!a.canView("relatorios.fluxodecaixa"))return t.reject(403)}]}}),e.addStates("caixafluxo.listar")}a.$inject=["$stateProvider","mdwStateDialogProvider","mdwBaseStateProvider","lancamentosRoutesProvider"],angular.module("md").config(a)}(),function(){"use strict";function a(a,t,o,e,n,r,i,c,s,l,u,d,m){var f=this,p=n(),v=m.getConfig("caixafluxo",{interval:"w",pendentes:!1,tic:!1,cs:[],scontas:null,fs:0,v:"m"});function g(){var a=d.getDefaultParams(f.intervalo,!0);f.inicio=o.inicio?e(o.inicio).format("YYYY-MM-DD"):a.inicio,f.fim=o.fim?e(o.fim).format("YYYY-MM-DD"):a.fim;var t=[],n=[];angular.forEach(f.filtroContas,(function(a,o){a&&t.push("r"==o?"r":parseFloat(o))})),angular.forEach(f.showContas,(function(a,t){a&&n.push(parseFloat(t))}));var i={inicio:f.inicio,fim:f.fim,contas:t,chartContas:n,visao:b(),pendentes:f.considerarPendentes,transferenciasIntracaixa:!f.transfIntraCaixa};return f.loading=!0,r.v2.fluxocaixa(i).then((function(a){return f.fluxo=a.fluxo,f.saldoAnterior=a.saldoAnterior,f.saldos=a.saldos,f.chartF=a.chart.fluxo,f.chartR=a.chart.resultado,f.cores=a.cores,f.contas=a.contas,f.totalEntradas=0,f.totalSaidas=0,a.fluxo.forEach((function(a){f.totalEntradas+=a.entradas,f.totalSaidas+=a.saidas})),f.resultado=f.totalEntradas+f.totalSaidas,l.then((function(){f.loading=!1}))}))}function h(){var a=[];angular.forEach(f.showContas,(function(t,o){t&&a.push(o)})),m.updateConfig("caixafluxo",{interval:f.intervalo,pendentes:f.considerarPendentes,tic:f.transfIntraCaixa,cs:i.getInativas(f.filtroContas),scontas:a,fs:f.fullscreen?1:0,v:f.visao})}function C(){var a=!0;angular.forEach(f.filtroContas,(function(t,o){t||(a=!1)})),f.checkboxAllContas=a}function b(){if(A())return f.visao;var a=moment(f.inicio),t=moment(f.fim);return Math.abs(a.diff(t,"months"))<1?"d":"m"}function A(){var a=moment(f.inicio),t=moment(f.fim),o=Math.abs(a.diff(t,"months"));return o>=1&&o<=3}f.detalharFluxo=function(a){t.show({id:"fluxo-caixa-detalhe",controller:"CaixaFluxoDetalheController",controllerAs:"vm",templateUrl:"/partials/caixa/fluxo/detalhe.html",locals:{detalhes:a}})},f.visao=v.v,f.intervalo=v.interval,f.considerarPendentes=v.pendentes,f.transfIntraCaixa=v.tic,f.fullscreen=1==v.fs,f.calendarioConfig={restrict:["w","m","t","s","y","p"],interval:f.intervalo,onUpdate:function(){f.intervalo!=this.currentInterval&&"p"!=this.currentInterval&&(f.calendarioConfig.interval=this.currentInterval,f.intervalo=this.currentInterval,h())}},f.inicio=null,f.fim=null,f.totalResiduo=0,f.filtroContas=i.getFiltros(v.cs,v.contas),f.showContas={},v.scontas?v.scontas.forEach((function(a){f.showContas[a]=!0})):f.showContas[0]=!0,f.residuoHabilitado=m.utilizacao.residuo,f.totalResiduo=0,r.addObserver("extrato",(function(a){p.notify(a)})),f.carregar=g,f.lancamentos=[],f.filtrarContas=function(){h(),g(),C()},f.toggleAllContas=function(){angular.forEach(f.filtroContas,(function(a,t){f.filtroContas[t]=f.checkboxAllContas})),f.filtroContas.r=f.checkboxAllContas,h(),g()},f.toggleConfig=function(){h(),g()},f.toggleResiduo=function(){h(),f.residuo=f.filtroContas.r,g(),C()},f.toggleShowConta=function(a){f.showContas[a]=!f.showContas[a],h(),g()},f.toggleFullscreen=function(){f.fullscreen=!f.fullscreen,h(),g()},f.toggleVisao=function(){f.visao="d"==f.visao?"m":"d",h(),g()},f.canChangeVisao=A,f.getVisao=b,f.addObserver=p.add}a.$inject=["$q","$mdDialog","$stateParams","mdwMoment","mdwObserver","relatoriosDatasource","filtroContasCaixa","contasService","cadastrosDatasource","googleChartApiPromise","mdwColors","mdwCalendarService","configuracoesService"],angular.module("md").service("caixaFluxoService",a)}(),function(){"use strict";function a(a,t,o,e){var n=this;n.relatorio=t,n.filtrosService=o,n.relatorio.carregar(),n.selection=e({controller:n,templateUrl:"/partials/caixa/lancamentos/acoesLoteTopmenu.html",getLancamentos:function(){return n.relatorio.lancamentos.filter((function(a){return!a._isSaldo}))}});var r=t.addObserver(n.relatorio.carregar);a.$on("$destroy",(function(){r(),n.selection.clearSelection()})),a.$watchCollection("vm.relatorio.lancamentos",(function(){n.selection.updateSelection()}))}a.$inject=["$scope","caixaLancamentosService","filtrosService","selecaoLancamentosLote"],angular.module("md").controller("CaixaLancamentosController",a)}(),function(){"use strict";function a(a,t,o){o.state({id:"caixalancamentos",title:"Lançamentos de caixa",templates:["caixa/lancamentos/lancamentos.html","caixa/lancamentos/listar.html"]},{url:"/caixa/lancamentos",abstract:!0,templateUrl:"partials/caixa/lancamentos/lancamentos.html",controller:["mdwTopmenu","caixaLancamentosService","filtrosService",function(a,t,o){this.relatorio=t,this.filtrosService=o}],controllerAs:"vm"}),a.state("caixalancamentos.listar",{url:"?inicio&fim&i&_p&_ps",templateUrl:"partials/caixa/lancamentos/listar.html",controller:"CaixaLancamentosController",controllerAs:"vm",data:{enableMoeda:!0},resolve:{security:["usuariosService","$q",function(a,t){if(!a.canView("relatorios.movimentacoes"))return t.reject(403)}]}}),t.addStates("caixalancamentos.listar")}a.$inject=["$stateProvider","lancamentosRoutesProvider","mdwBaseStateProvider"],angular.module("md").config(a)}(),function(){"use strict";function a(a,t,o,e,n,r,i,c,s,l,u,d,m){var f,p=this,v=r(),g=u.getConfig("caixalancamentos",{interval:"d",cs:[],fs:0,ls:!1,dm:!1,fsl:15,zbr:!1,oalf:!1}),h={};function C(){return p.filterManager.ready((function(){var t=d.getDefaultParams(p.intervalo,!0);p.inicio=e.inicio?n(e.inicio).format("YYYY-MM-DD"):t.inicio,p.fim=e.fim?n(e.fim).format("YYYY-MM-DD"):t.fim;var o=moment().format("YYYY-MM-DD");p.diaMensal&&p.inicio<=o&&p.fim>=o&&(p.inicio=o),function(){p.resultados={r:0,d:0,te:0,ts:0};var a=angular.extend(x(),{inicio:p.inicio,fim:p.fim});h.resultados=s.lancamentos.sum(a,{groupByTipo:!0}).then((function(a){a.sum.forEach((function(a){p.resultados[a.tipo]=a.projetado}))}))}(),function(){var t=c.carregarContasCaixa(!0).map((function(a){return a.id})),o={total:{projetado:0,confirmado:0}},e={total:{projetado:0,confirmado:0}},r={total:{projetado:0,confirmado:0}};t.forEach((function(a){o[a]={projetado:0,confirmado:0},e[a]={projetado:0,confirmado:0},r[a]={projetado:0,confirmado:0}}));var i=function(a,n){var i=angular.extend(A(),{ids:t,residuo:p.residuoHabilitado,faturas:!0,apenasResiduos:!1});return a=angular.extend({contas:i,finalidade:s.lancamentos.FIN_EXTRATO},a),s.lancamentos.sum(a,{groupBy:"conta"}).then((function(a){a.sum.forEach((function(a){if("residuo"==a.conta){if(0==a.projetado)return;o.residuo=o.residuo||{projetado:0,confirmado:0},n?e.residuo=e.residuo||{projetado:0,confirmado:0}:r.residuo=r.residuo||{projetado:0,confirmado:0}}o[a.conta]&&(o[a.conta].confirmado+=a.confirmado,o[a.conta].projetado+=a.projetado),!n&&e[a.conta]&&(r[a.conta].confirmado+=a.confirmado,r[a.conta].projetado+=a.projetado),n&&e[a.conta]&&(e[a.conta].confirmado+=a.confirmado,e[a.conta].projetado+=a.projetado)}))}))};p.dataSaldoAnterior=n(p.inicio).subtract(1,"day").format("YYYY-MM-DD"),h.saldos=a.all([i({inicio:p.inicio,fim:p.fim,status:s.lancamentos.STATUS_PROJETADO}),i({fim:p.dataSaldoAnterior,status:s.lancamentos.STATUS_PROJETADO},!0)]).then((function(){p.saldosConta=o,p.saldosAnt=e,p.saldosMes=r}))}(),function(){var a=angular.extend(x(),{inicio:p.inicio,fim:p.fim});p.hasLancMap={};var t={pageSize:200,onBeforeFetch:function(a){p.loading.lancamentos=!0},onFetch:function(a,t){f=t,S(a,p.hasLancMap).then((function(){p.loading.lancamentos=!1,p.lancamentos=[];var t,o=moment().toDate(),e=function(a){p.lancamentos.push({_isSaldo:!0,saldo:a.saldo,data:"pendente"==a.status?o:t.data})};p.linhasSaldo?(a.forEach((function(a){t&&"pendente"!=a.status&&t.data!=a.data&&e(t),p.lancamentos.push(a),t=a})),t&&e(t)):p.lancamentos=a}))},onCompleteIterate:function(a){p.lancamentosImp=a,S(p.lancamentosImp)}};p.paginator=s.lancamentos.list(a,{sumPrevPages:!0},t),h.lancamentos=p.paginator.fetch(1)}(),h.saldosTotais=h.saldos.then((function(){p.totalResiduo=0,p.saldos=[],p.saldosConta.total.confirmado=p.saldosConta.total.projetado=0,angular.forEach(p.saldosConta,(function(a,t){if("residuo"==t)t="r";else if("total"!=t){var o=m.get("contas",t,!0);p.saldos.push({conta:t,encerrada:o.encerrada,nome:o.nome,projetado:a.projetado,confirmado:a.confirmado})}p.filtroContas[t]&&(p.saldosConta.total.confirmado+=a.confirmado,p.saldosConta.total.projetado+=a.projetado)})),p.saldosAnt.total.confirmado=p.saldosAnt.total.projetado=0,angular.forEach(p.saldosAnt,(function(a,t){"residuo"==t&&(t="r"),p.filtroContas[t]&&("r"!=t||p.filtrosStatus[8])&&(p.saldosAnt.total.confirmado+=a.confirmado,p.saldosAnt.total.projetado+=a.projetado)})),D()}))}))}function b(){u.updateConfig("caixalancamentos",{interval:p.intervalo,filtro:p.filterManager.getId(),cs:i.getInativas(p.filtroContas),fs:p.fullscreen?1:0,ls:p.linhasSaldo,dm:p.diaMensal,fsl:p.filtroStatusLancamento,zbr:p.exibirLancamentosZebrados,oalf:p.exibirOrdermAlfabetica})}function A(){var a=[],t=p.filtroContas.r;return angular.forEach(p.filtroContas,(function(o,e){o&&"r"!=e&&(t=!1,a.push(e))})),{residuo:p.residuoHabilitado&&p.filtroContas.r,faturas:!0,apenasResiduos:t,ids:a}}function x(){var a=s.lancamentos.parseFiltros(p.filterManager);return angular.extend(a,{finalidade:s.lancamentos.FIN_EXTRATO,status:l.encode(p.filtrosStatus),contas:A(),ordenarDescricaoMesmaData:p.exibirOrdermAlfabetica})}function S(a,t){return h.saldosTotais.then((function(o){var e=p.saldosAnt.total.projetado+(f.sumPrevPages||0);a.forEach((function(a){e+=a.valor,a.saldo=e,t&&(t[a.conta]=!0,a.contaT&&(t[a.contaT]=!0))}))}))}function D(){p.contasFiltradas=[],p.saldos.forEach((function(a){p.filtroContas[a.conta]&&p.contasFiltradas.push(a)}))}p.loading={lancamentos:!0,saldoAnterior:!0,saldoPeriodo:!0,resultados:!0},p.exibirLancamentosZebrados=g.zbr,p.exibirOrdermAlfabetica=g.oalf,p.intervalo=g.interval,p.fullscreen=1==g.fs,p.linhasSaldo=g.ls,p.diaMensal=g.dm,p.filtroStatusLancamento=g.fsl,p.calendarioConfig={restrict:["d","w","m","t","s","a","p"],interval:p.intervalo,onUpdate:function(){p.intervalo!=this.currentInterval&&"p"!=this.currentInterval&&(p.calendarioConfig.interval=this.currentInterval,p.intervalo=this.currentInterval,b())}},p.printConfig={controller:["caixaLancamentosService",function(a){this.relatorio=a}],templateUrl:"/partials/caixa/lancamentos/lancamentos_print.html",paginate:function(){return p.paginator}},p.inicio=null,p.fim=null,p.filterManager=l.getManagerLancamentos({funcionalidade:1,onUpdate:function(){p.filterManager.getId()!=g.filtro&&b(),p.carregar()},contas:!1,status:!1,confAuto:!0,exibirCpr:!0,exibirRn:!0}),p.filterManager.startWith(g.filtro),p.filtrosStatus=l.decode(p.filtroStatusLancamento),p.filtroContas=i.getFiltros(g.cs,g.contas),p.contasFiltradas=[],p.residuoHabilitado=u.utilizacao.residuo,p.totalResiduo=0,s.addObserver("extrato",(function(a){v.notify(a)})),p.carregar=C,p.lancamentos=[],p.filtrarContas=function(){b();var a=!0;angular.forEach(p.filtroContas,(function(t,o){t||(a=!1)})),D(),p.checkboxAllContas=a,p.carregar()},p.toggleAllContas=function(){angular.forEach(p.filtroContas,(function(a,t){p.filtroContas[t]=p.checkboxAllContas})),b(),p.carregar()},p.toggleFiltroStatus=function(a){p.filtrosStatus[a]=!p.filtrosStatus[a],p.filtroStatusLancamento=l.encode(p.filtrosStatus),b(),p.carregar()},p.toggleFullscreen=function(){p.fullscreen=!p.fullscreen,b()},p.addObserver=v.add,p.outrasConfiguracoes=function(){t.show({id:"personalizar-extrato",templateUrl:"partials/extratoConta/configuracoes.html",locals:{service:p,config:{linhasSaldo:p.linhasSaldo,diaMensal:p.diaMensal,ordemAlfabetica:p.exibirOrdermAlfabetica,zebrados:p.exibirLancamentosZebrados}},bindToController:!0,controllerAs:"vm",controller:function(){var a=this;a.ok=function(){a.service.linhasSaldo=a.config.linhasSaldo,a.service.diaMensal=a.config.diaMensal,a.service.exibirOrdermAlfabetica=a.config.ordemAlfabetica,a.service.exibirLancamentosZebrados=a.config.zebrados,t.hide()}}}).then((function(){b(),C()}))}}a.$inject=["$q","$mdDialog","mdwPaginator","$stateParams","mdwMoment","mdwObserver","filtroContasCaixa","contasService","relatoriosDatasource","filtrosService","configuracoesService","mdwCalendarService","cadastrosDatasource"],angular.module("md").service("caixaLancamentosService",a)}(),function(){"use strict";function a(a,t,o,e,n){var r=this,i=a.match(/pagas|recebidas/);r.c=i,r.linkNovoLancamento=(i?"caixaprc.":"caixapr.")+a,r.relatorio=o(i),r.filtrosService=e,r.relatorio.carregar(a),r.selection=n({controller:r,templateUrl:"/partials/caixa/pr/acoesLoteTopmenu.html",getLancamentos:function(){return r.relatorio.lancamentos}});var c=r.relatorio.addObserver((function(){return r.relatorio.carregar(a)}));t.$on("$destroy",(function(){c(),r.selection.clearSelection()})),t.$watchCollection("vm.relatorio.lancamentos",(function(){r.selection.updateSelection()}))}a.$inject=["prview","$scope","caixaPRService","filtrosService","selecaoLancamentosLote"],angular.module("md").controller("CaixaPRController",a)}(),function(){"use strict";function a(a,t,o){o.state({id:"caixapr",title:"Contas a pagar e receber",templates:["caixa/pr/pr.html","caixa/pr/lancamentos.html"]},{url:"/caixa/pr",abstract:!0,templateUrl:"partials/caixa/pr/pr.html",controller:["$scope","$state","mdwTopmenu","caixaPRService","filtrosService","usuariosService",function(a,t,o,e,n,r){var i=this;i.relatorio=e(!1),i.filtrosService=n,o.preservStateParams=!0,i.novoLanc=function(){t.go(".lancamentosNovo",{tipo:"pagar"==i.relatorio.view?"d":"r"})},r.canView("relatorios.contaspagar")&&r.canView("relatorios.contasreceber")&&o.setTabs(a,[{label:"A pagar",state:"caixapr.pagar"},{label:"A receber",state:"caixapr.receber"}])}],controllerAs:"vm"}),["pagar","receber","resumo"].forEach((function(o){a.state("caixapr."+o,{url:"/"+o+"?inicio&fim&i",templateUrl:"partials/caixa/pr/lancamentos.html",controller:"CaixaPRController",controllerAs:"vm",resolve:{prview:function(){return o}},data:{permmd:"relatorios.contas"+o,enableMoeda:!0}}),t.addStates("caixapr."+o)})),o.state({id:"caixaprc",title:"Contas pagas e recebidas",templates:["caixa/pr/pr.html","caixa/pr/lancamentos.html"]},{url:"/caixa/prc",abstract:!0,templateUrl:"partials/caixa/pr/pr.html",controller:["$scope","$state","mdwTopmenu","caixaPRService","filtrosService","usuariosService",function(a,t,o,e,n,r){var i=this;i.relatorio=e(!0),i.filtrosService=n,i.c=!0,i.novoLanc=function(){t.go(".lancamentosNovo",{tipo:"pagas"==i.relatorio.view?"d":"r"})},o.preservStateParams=!0,r.canView("relatorios.contaspagar")&&r.canView("relatorios.contasreceber")&&o.setTabs(a,[{label:"Pagas",state:"caixaprc.pagas"},{label:"Recebidas",state:"caixaprc.recebidas"}])}],controllerAs:"vm"}),["pagas","recebidas"].forEach((function(o){var e="pagas"==o?"pagar":"receber";a.state("caixaprc."+o,{url:"/"+o+"?inicio&fim&i",templateUrl:"partials/caixa/pr/lancamentos.html",controller:"CaixaPRController",controllerAs:"vm",resolve:{prview:function(){return o}},data:{permmd:"relatorios.contas"+e,enableMoeda:!0}}),t.addStates("caixaprc."+o)}))}a.$inject=["$stateProvider","lancamentosRoutesProvider","mdwBaseStateProvider"],angular.module("md").config(a)}(),function(){"use strict";angular.module("md").factory("caixaPRService",["$q","$mdDialog","$stateParams","mdwPaginator","mdwMoment","mdwObserver","relatoriosDatasource","filtrosService","filtroContasCaixa","contasService","mdwCalendarService","configuracoesService","cadastrosDatasource",function(a,t,o,e,n,r,i,c,s,l,u,d,m){var f={};return function(a){var t=a?"c":"p";return f[t]?f[t]:f[t]=new p(a)};function p(a){var e=this,m=a?"caixaprc":"caixapr",f=r(),p=d.getConfig(m,{interval:"w",contas:null,pp:d.utilizacao.pendentesPresente,fs:0,fsl:15,zbr:!1,oalf:!1}),v={};function g(){d.updateConfig(m,{interval:e.intervalo,filtro:e.filterManager.getId(),pp:e.pendentesPresente,cs:s.getInativas(e.filtroContas),fs:e.fullscreen?1:0,contas:null,fsl:e.filtroStatusLancamento,zbr:e.exibirLancamentosZebrados,oalf:e.exibirOrdermAlfabetica})}function h(){g(),e.carregar()}e.loading={lancamentos:!0,saldos:!0,resultados:!0},e.exibirLancamentosZebrados=p.zbr,e.exibirOrdermAlfabetica=p.oalf,e.intervalo=p.interval,e.pendentesPresente=p.pp,e.fullscreen=1==p.fs,e.filtroStatusLancamento=p.fsl,e.calendarioConfig={restrict:["d","w","m","t","s","a","p","y"],interval:e.intervalo,onUpdate:function(){e.intervalo!=this.currentInterval&&"p"!=this.currentInterval&&(e.calendarioConfig.interval=this.currentInterval,e.intervalo=this.currentInterval,g())}},e.printConfig={controller:["caixaPRService",function(t){this.relatorio=t(a)}],templateUrl:"/partials/caixa/pr/pr_print.html",paginate:function(){return e.paginator}},e.inicio=null,e.fim=null,e.filterManager=c.getManagerLancamentos({funcionalidade:a?15:11,onUpdate:function(){e.filterManager.getId()!=p.filtro&&g(),e.carregar()},contas:!1,status:!1,confAuto:!0,exibirRn:!0}),e.filterManager.startWith(p.filtro),e.filtrosStatus=c.decode(e.filtroStatusLancamento),e.filtroContas=s.getFiltrosPR(p.cs,p.contas),i.addObserver(a?"prc":"pr",(function(a){f.notify(a)})),e.carregar=function(t){e.view=t||e.view;var r=u.getDefaultParams(e.intervalo,!0);function c(){var t,o=i.lancamentos.parseFiltros(e.filterManager),n=0;return a?(e.filtrosStatus[2]&&(n+=i.lancamentos.STATUS_CONFIRMADO),e.filtrosStatus[4]&&(n+=i.lancamentos.STATUS_CONCILIADO)):(e.filtrosStatus[1]&&(n+=i.lancamentos.STATUS_PENDENTE),e.filtrosStatus[8]&&(n+=i.lancamentos.STATUS_AGENDADO)),t="pagar"==e.view||"pagas"==e.view?-1:1,angular.extend(o,{inicio:e.inicio,fim:e.fim,cpr:!0,finalidade:i.lancamentos.FIN_EXTRATO,status:n,contas:s(),pendentesPresente:e.pendentesPresente,sinalLancamento:t,tipoLancamento:o.tipoLancamento,ordenarDescricaoMesmaData:e.exibirOrdermAlfabetica})}function s(){var a=[];return angular.forEach(e.filtroContas,(function(t,o){t&&"r"!=o&&a.push(o)})),{residuo:!1,faturas:!0,ids:a}}e.inicio=o.inicio?n(o.inicio).format("YYYY-MM-DD"):r.inicio,e.fim=o.fim?n(o.fim).format("YYYY-MM-DD"):r.fim,d={pageSize:100,onBeforeFetch:function(a){e.loading.lancamentos=!0},onFetch:function(a,t){e.loading.lancamentos=!1,e.lancamentos=a},onCompleteIterate:function(a){e.lancamentosImp=a}},m=c(),e.paginator=i.lancamentos.list(m,{},d),v.lancamentos=e.paginator.fetch(1),function(){var a={r:0,d:0,te:0,ts:0},t=c();i.lancamentos.parseFiltros(e.filterManager),t.sinalLancamento=void 0,v.resultados=i.lancamentos.sum(t,{groupByTipo:!0}).then((function(t){t.sum.forEach((function(t){a[t.tipo]+=t.projetado})),e.resultados=a}))}(),function(){var a=[],t=c();i.lancamentos.parseFiltros(e.filterManager),t.contas.ids=l.carregarContasPR(!0).map((function(a){return a.id})),t.contas.cartoes=!1,v.resultados=i.lancamentos.sum(t,{groupBy:"conta"}).then((function(t){e.saldoTotal=0,t.sum.forEach((function(t){a.push({conta:t.conta,valor:t.projetado}),e.filtroContas[t.conta]&&(e.saldoTotal+=t.projetado)})),e.saldos=a}))}();var d,m},e.lancamentos=[],e.lancamentosBase=[],e.toggleFiltroStatus=function(a){e.filtrosStatus[a]=!e.filtrosStatus[a],e.filtroStatusLancamento=c.encode(e.filtrosStatus),g(),e.carregar()},e.filtrarContas=function(){g(),e.carregar();var a=!0;angular.forEach(e.filtroContas,(function(t,o){t||(a=!1)})),e.checkboxAllContas=a},e.toggleAllContas=function(){angular.forEach(e.filtroContas,(function(a,t){e.filtroContas[t]=e.checkboxAllContas})),g(),e.carregar()},e.togglePendentes=h,e.toggleFullscreen=function(){e.fullscreen=!e.fullscreen,g()},e.outrasConfiguracoes=function(){t.show({id:"personalizar-pr",templateUrl:"partials/caixa/pr/configuracoes.html",locals:{c:a,service:e,config:{ordemAlfabetica:e.exibirOrdermAlfabetica,zebrados:e.exibirLancamentosZebrados,pendentesPresente:e.pendentesPresente}},bindToController:!0,controllerAs:"vm",controller:function(){var a=this;a.ok=function(){a.service.pendentesPresente=a.config.pendentesPresente,a.service.exibirOrdermAlfabetica=a.config.ordemAlfabetica,a.service.exibirLancamentosZebrados=a.config.zebrados,t.hide()}}}).then((function(){h()}))},e.addObserver=f.add}}])}(),function(){"use strict";function a(a,t,o,e,n){var r=this,i=o("cartoesDatasource"),c=t("/cartoes/:id/fatura/:vencimento"),s=t("/cartoes/:id/faturas"),l=t("/cartoes/:id/parcelasFuturas"),u=t("/cartoes/:id/primeiraFatura");r.cartoes=[],r.get=function(a,t){return e.get("contas",a,t)},r.carregarFatura=function(t,o){return c.get({id:t,vencimento:a(o).date(1).format("YYYY-MM-DD")})},r.carregarFaturas=function(a,t,o){return s.get({id:a,quantidade:t,inicio:o})},r.carregarParcelasFuturas=function(a,t){return l.get({id:a,totalizar:!!t})},r.carregarPrimeiraFatura=function(a){return u.get({id:a})},r.addObserver=i.add,e.addObserver("contas",(function(a){u.reset(),c.reset(),l.reset(),i.notify(a)})),n.addObserver((function(a){c.reset(),l.reset(),i.notify(a)}))}a.$inject=["moment","mdwCache","mdwObserver","cadastrosDatasource","lancamentosDatasource"],angular.module("md").service("cartoesDatasource",a)}(),function(){"use strict";function a(a,t,o,e){a.state("cartoes",{url:"/cartoes",template:"<ui-view/>"}).state("cartoes.semcartoes",{url:"",templateUrl:"partials/cartoes/semcartoes.html",controller:["$scope","mdwTopmenu",function(a,t){t.title="Cartões"}]}).state("cartoes.semcartoes.novo",t.getState({url:"/novo",action:"cartoesService.novo"})),e.state({id:"fatura",title:"Cartões de crédito",templates:["cartoes/fatura.html","cartoes/lancamentos.html"]},{abstract:!0,url:"/cartoes",templateUrl:"partials/cartoes/fatura.html",controller:"FaturaController",controllerAs:"vm"}),a.state("fatura.listar",{url:"/:conta?inicio",templateUrl:"partials/cartoes/lancamentos.html",controller:"FaturaLancamentosController",controllerAs:"vm",params:{agendarPagamento:null},onEnter:["$timeout","$state","$stateParams",function(a,t,o){a((function(){o.agendarPagamento&&t.go("fatura.listar.lancamentosNovo",o.agendarPagamento)}),0)}]}).state("fatura.listar.novo",t.getState({url:"/novo",action:"cartoesService.novo"})),a.state("fatura.listar.editarCartao",t.getState({url:"/editarcartao",action:"cartoesService.editar",data:{permmdt:"g"}})),a.state("fatura.listar.parcelasfuturas",t.getState({url:"/parcelasfuturas",action:"cartoesService.parcelasFuturas",data:{permmdt:"g"}})),o.addStates("fatura.listar")}a.$inject=["$stateProvider","mdwStateDialogProvider","lancamentosRoutesProvider","mdwBaseStateProvider"],angular.module("md").config(a).run(["$rootScope","$transitions","$injector",function(a,t,o){t.onSuccess({to:"cartoes"},(function(){o.get("faturaService").go()}))}])}(),function(){"use strict";function a(a,t,o,e,n,r,i,c,s,l,u){f.$inject=["params"];var d=r("contas");return{create:function(a){return d.insert(a).then((function(a){return l.validarPlanoAtual(!0),e.showSimple("Cartão criado"),a}))},update:function(a){return d.update(a).then((function(a){return l.validarPlanoAtual(!0),e.showSimple("Cartão atualizado"),a}))},delete:function(a){return d.delete(a).then((function(){l.validarPlanoAtual(!0),e.showSimple("Cartão excluído")}))},novo:function(){return l.dialogPlano("cartoes",(function(){return l.dialogPlanoNcontas((function(){return m()}))}))},editar:m,pagarFatura:f,fecharFatura:function(n){return o.show({id:"edicao-lancamento",templateUrl:"/partials/cartoes/pagarFatura.html",controller:"PagarFaturaController",controllerAs:"vm",bindToController:!0,resolve:{conta:["cadastrosDatasource",function(a){return a.get("contas",n.conta)}]},locals:{pagarFatura:function(o){return o.conta=n.conta,a.post("/cartoes/"+n.conta+"/pagar",o).then((function(a){return e.showSimple("Fatura fechada com sucesso"),a.data})).then((function(a){return t.go("fatura.listar",{conta:a.conta,inicio:moment(a.vencimento).add(1,"months").date(1).format("YYYY-MM-DD")}),c.reload("contas")}))}}})},reabrirFatura:function(t,o){return a.post("/cartoes/"+t+"/reabrir",{vencimento:o}).then((function(a){return e.showSimple("Fatura reaberta com sucesso"),a})).then((function(){return c.reload("contas")}))},parcelasFuturas:function(a){return o.show({id:"parcelas-futuras",templateUrl:"/partials/cartoes/parcelasFuturas.html",controller:"ParcelasFuturasController",controllerAs:"vm",bindToController:!0,resolve:{cartao:function(){return c.get("contas",a.conta).then((function(a){return a}))}}})},carregarParcelasFuturas:function(a){return s.carregarParcelasFuturas(a)}};function m(a){return i.editar({id:a?a.id||a.conta:null,tipo:"CARTAOCREDITO"})}function f(a){return u.novo({conta:a.conta,data:moment().format("YYYY-MM-DD"),tipo:"p"})}}a.$inject=["$http","$state","$mdDialog","$mdToast","excluirCadastro","mdwResource","contasService","cadastrosDatasource","cartoesDatasource","usuariosService","lancamentosService"],angular.module("md").factory("cartoesService",a)}(),function(){"use strict";function a(a,t,o,e,n){var r=this;function i(a){return!!a&&"d"==t.get("categorias",a,!0).tipo}function c(n,r,i){var c,l=[],u=[],d=0,m={},f=[];n.forEach((function(a){var o=a[r];c=a.conta,m[o]||(m[o]={nome:t.get(r+"s",o,!0).nome,total:0},f.push(m[o])),m[o].total+=a.valor}));var p=a("moedaConta")(c);f.sort((function(a,t){return a.total-t.total}));var v,g=[],h=!1;return f.forEach((function(t){var e=o.getColorAtIndex(d++);t.cor=e,u.push(e),h||(v&&(t.total>0&&v<0||t.total<0&&v>0)&&(h=!0),v=t.total>0?1:-1);var n=[{v:t.nome},{v:Math.abs(t.total),f:a("currency")(t.total,p)}];l.push({c:n}),n=[{v:t.nome},{v:t.total,f:a("currency")(t.total,p)},{v:e}],g.push({c:n})})),{chart:h?s(g):{type:"PieChart",data:{cols:[{type:"string",label:i},{type:"number",label:"Total"}],rows:l},options:e.prepareChartOptions({colors:u,pieHole:.4,backgroundColor:"transparent",legend:{position:"none"},chartArea:{width:"80%",height:"80%"},legend:{position:"none"},tooltip:{trigger:"selection"}})},dados:f}}function s(a){return{type:"ColumnChart",data:{cols:[{type:"string",label:"Vencimento"},{type:"number",label:"Total"},{role:"style"}],rows:a},options:e.prepareChartOptions({tooltip:{trigger:"selection"},hAxis:{gridlines:{color:"transparent"}},vAxis:{baseline:0,baselineColor:"#888"},legend:{position:"none"}})}}r.charts={},r.getPlasticoChart=function(a){return c(a.filter((function(a){return a.plastico})),"plastico","Cartão")},r.getDespChart=function(a){var t=[];return a.forEach((function(a){a.detalhes?a.detalhes.forEach((function(a){!a.transferencia&&i(a.categoria)&&t.push(a)})):!a.transferencia&&i(a.categoria)&&t.push(a)})),c(t,"categoria","Categoria")},r.getHistChart=function(t,e){var n,r=[],i=o.getHexColor("blue",300),c=o.getHexColor("blue",500),l=o.getHexColor("blue",600),u=a("moedaConta")(e),d=0,m=0;return t.forEach((function(a){a.valor<0&&(d+=a.valor,m++)})),n=d/m,t.forEach((function(t){var o=t.valor<1.3*n?l:t.valor>n?i:c,e=[{v:moment(t.vencimento).format("MMM YY")},{v:-1*t.valor,f:a("currency")(t.valor,u)},{v:o}];r.push({c:e})})),{chart:s(r),dados:t,media:n,total:d}}}a.$inject=["$filter","cadastrosDatasource","mdwColors","mdwDarkModeService","moedaService"],angular.module("md").service("cartoesChartService",a)}(),function(){"use strict";function a(a,t,o,e,n,r,i,c,s,l,u,d,m,f,p){var v=this;o.title="Cartões de crédito";var g=r.carregarCartoes(!1,!0).filter((function(a){return a.status}));function h(){var a=e(v.searchConta||""),t=a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),o=a.length<4?"\\s+":"",n=new RegExp("(^"+t+")|("+o+t+")","i");v.cartoes=g.filter((function(a){return null!==e(a.nome).match(n)})),v.cartoes.sort((function(a,t){return a.status&&!t.status?-1:!a.status&&t.status?1:a.nome<t.nome?-1:1}))}function C(){var a=v.fatura.fatura.vencimento;u.show({id:"confirmar-reabertura",templateUrl:"/partials/cartoes/confirmarReabertura.html",controller:["$mdDialog","cartao","vencimento","cartoesService",function(a,t,o,e){var n=this;n.vencimento=o,n.cartao=t,n.dismiss=a.cancel,n.ok=function(){return e.reabrirFatura(n.cartao.id,o).then((function(t){return a.hide(t)}))}}],controllerAs:"vm",locals:{cartao:v.fatura.cartao,vencimento:a}}).then((function(){d.go("fatura.listar",{conta:v.fatura.cartao.id,inicio:a})}))}v.hasSearch=g.length>7,v.fatura=n,v.resumo=n.resumo,v.filtrosService=c,v.reabrirFatura=C,v.pu=f.updateCtrl,v.$onInit=function(){h()},v.importarLancamentos=function(a){p.iniciar(a,v.fatura.cartaoId,"auto")},a.$watch("vm.fatura.cartaoId",(function(a,t){-1==a&&(v.fatura.cartaoId=t,d.go("fatura.listar.novo"))})),v.printConfig={controller:["faturaService",function(a){var t=this;t.fatura=a,t.resumo=t.fatura.resumo}],templateUrl:"/partials/cartoes/print.html"},v.canEdit=s.canEdit("cadastros.contas"),a.$on("$destroy",l.addObserver("contas",(function(){v.cartoes=r.carregarCartoes(!1,!0)}))),v.reabrirFatura=C,v.exportar=function(){var a=[];v.fatura.lancamentos.forEach((function(t){return a.push(t.id)})),m.exportar(a)},v.searchConta="",v.filtrarContas=function(a){h()},v.clearSearch=function(){v.searchConta="",h()},v.onKeydown=function(a){a.stopPropagation()},v.onOpen=function(a){if(v.hasSearch){var o=document.getElementsByClassName(a)[0],e=o.querySelector("md-content._md"),n=o.querySelector("md-select-header>input");t((function(){e.scrollTop-=48,n.focus()}),100)}}}a.$inject=["$scope","$timeout","mdwTopmenu","mdwAccentFold","faturaService","contasService","cartoesService","filtrosService","usuariosService","cadastrosDatasource","$mdDialog","$state","lancamentosService","conexoesUpdate","importacaoService"],angular.module("md").controller("FaturaController",a)}(),function(){"use strict";function a(a,t,o,e,n,r,i,c,s,l,u,d,m,f){var p=this,v=o("faturaService"),g=n.getConfig("fatura",{conta:null,psc:[],fs:0,cv:0,o:"u",tl:!1,fsl:3}),h=g.psc;p.plasticosLancamentos={},p.psc={};for(var C=0;C<h.length;C++)p.psc[h[C]]=!0;function b(){var a=[],t=[],o="u"==p.ordenacao?p.lancamentosBase:p.lancamentosBaseInvertida;if(p.searchOpen||(p.busca=""),p.busca){var n=new RegExp(d(p.busca),"i");o=o.filter((function(a){return null!=a.descricao.match(n)}))}if(angular.forEach(p.status,(function(a,o){a&&t.push(o.slice(0,-1))})),o.forEach((function(o){p.filterManager.filtrar(o)&&-1!=t.indexOf(o.conciliado?"conciliado":"nconciliado")&&a.push(o)})),p.lancamentos=[],p.timeView){let t={};a.forEach((function(a){a._beforeBreak=!1,t[a.data]?t[a.data]+=a.valor:t[a.data]=a.valor})),angular.forEach(t,(function(t,o){let e={_isSaldo:!0,saldo:t,data:o};a.push(e)}));var r=function(a,t){return a._isSaldo&&!t._isSaldo?-1:!a._isSaldo&&t._isSaldo?1:0};a.sort("u"==p.ordenacao?function(a,t){return a.data<t.data?-1:a.data>t.data?1:r(a,t)}:function(a,t){return a.data<t.data?1:a.data>t.data?-1:r(a,t)}),p.lancamentos=a}else A().length>1?a.forEach((function(t,o){if(t.plastico&&(0==o||t.plastico!=a[o-1].plastico)){var e=s.get("plasticos",t.plastico,!0);p.lancamentos.push({breakPlastico:!0,id:e.id,nome:e.nome}),o>0&&(a[o-1]._beforeBreak=!0)}t.plastico&&(p.plasticosLancamentos[t.plastico]=!0),t.plastico&&p.psc[t.plastico]||p.lancamentos.push(t)})):p.lancamentos=a;p.chartsView&&(p.plasticoChart=m.getPlasticoChart(a),p.despChart=m.getDespChart(a),p.loadingFaturasAnt=!0,i.carregarFaturas(p.cartao.id,12,p.fatura.vencimento).then((function(a){p.loadingFaturasAnt=!1;var t=angular.copy(a);t.sort((function(a,t){return a.vencimento<t.vencimento?-1:a.vencimento>t.vencimento?1:void 0})),p.historicoChart=m.getHistChart(t,p.cartao.id)}))),p.lancamentos=e.idLancGenerator(p.lancamentos)}function A(){return s.plasticos.filter((function(a){return a.conta==p.cartaoId}))}function x(){p.filtroStatusLancamento=function(){let a=0;return p.status.nconciliados&&(a|=2),p.status.conciliados&&(a|=1),a}(),g={conta:p.cartaoId,psc:h,filtro:p.filterManager.getId(),fs:p.fullscreen?1:0,cv:p.chartsView?1:0,o:p.ordenacao,tl:p.timeView,fsl:p.filtroStatusLancamento},n.updateConfig("fatura",g)}p.fullscreen=1==g.fs,p.chartsView=1==g.cv,p.ordenacao=g.o,p.filtroStatusLancamento=g.fsl,p.calendarioConfig={restrict:"m",baseText:"Ir para fatura aberta"},p.timeView=g.tl,p.filterManager=c.getManagerLancamentos({funcionalidade:32,onUpdate:function(){p.filterManager.getId()!=g.filtro&&x(),b()},contas:!1,status:!1}),p.filterManager.startWith(g.filtro),p.status=p.status||{nconciliados:c.checkBit(p.filtroStatusLancamento,2),conciliados:c.checkBit(p.filtroStatusLancamento,1)},i.addObserver(v.notify),p.cartaoId=null,p.loading=!0,p.lancamentos=[],p.lancamentosBase=[],p.resumo=new function(){var a=this;function t(){a.limite=0,a.totalFatura=0,a.saldoDevedor=0,a.valorFaturaAnterior=0,a.parcelasFuturas=0,a.disponivel=0,a.pagamentosConf=0,a.pagamentosAgen=0,a.receitas=0,a.despesas=0,a.transferencias=0,a.conciliado=0,a.nconciliado=0,a.plasticos={},a.plasticosLancamentos={},angular.forEach(A(),(function(t){a.plasticos[t.id]={valor:0,plastico:t}}))}a.reset=t,a.addTotalPlastico=function(t,o){a.plasticos[t]&&(a.plasticos[t].valor+=o)},a.setParams=function(t){a.vencimento=t.vencimento,a.valorFaturaAnterior=t.valorFaturaAnterior,a.fechamento=t.fechamento,a.disponivel=t.disponivel,a.pagamentosAgen=t.pagamentosAgen,a.pagamentosConf=t.pagamentosConf,a.totalFatura=t.totalFatura,a.totalPagar=t.totalPagar,a.totalFaturaAtual=t.totalFaturaAtual,a.totalFixo=t.totalFixo,a.conciliado=t.conciliado,a.nconciliado=t.nconciliado,a.receitas=t.receitas,a.despesas=t.despesas,a.transferencias=t.transferencias},t()},p.busca="",p.go=function(){var t=r.carregarCartoes(!1,!0);if(t.length<=0)return void a.go("cartoes.semcartoes");g.conta||(g.conta=t[0].id);let o;for(let a=0;a<t.length;a++)if(parseInt(t[a].id)==parseInt(g.conta)){o=t[a].id;break}let e=0;for(;!o||u.hasRest("contas",o,"v");)o=t[e++].id;a.go("fatura.listar",{conta:o})},p.init=function(){return p.loading=!0,p.lancamentos=[],p.lancamentosBase=[],i.get(t.conta).then((function(a){p.cartao=a,p.cartaoId=p.cartao.id,g.conta=p.cartaoId}))},p.alterarCartao=function(t){angular.isDefined(t)&&(p.cartaoId=t);if(-1==p.cartaoId)return;a.go("fatura.listar",{conta:p.cartaoId,inicio:void 0}),x()},p.carregar=function(){p.cartao=i.get(p.cartao.id,!0);var a=t.inicio||p.cartao.proximoVencimento;p.isFaturaPassada=moment(a).isBefore(p.cartao.proximoVencimento,"months"),p.isFaturaFutura=moment(a).isAfter(p.cartao.proximoVencimento,"months"),p.isFaturaAtual=moment(a).isSame(p.cartao.proximoVencimento,"months"),p.isFaturaAnterior=moment(a).add(1,"month").isSame(p.cartao.proximoVencimento,"months"),p.isProximaFatura=moment(a).subtract(1,"month").isSame(p.cartao.proximoVencimento,"months"),p.plasticos=A(),i.carregarPrimeiraFatura(p.cartao.id).then((function(a){p.primeiraFatura=moment(a.vencimento).add(1,"month").date(1)})),p.aposFechamento=!1,i.carregarFatura(p.cartao.id,a).then((function(a){p.fatura=a,p.resumo.reset(),p.resumo.limite=p.cartao.limite,p.resumo.setParams(a.resumo),p.aposFechamento=!moment(a.fechamento).isAfter(),p.lancamentosBase=a.lancamentos,p.lancamentosBaseInvertida=a.lancamentos.slice(),p.lancamentosBaseInvertida.sort((function(a,t){var o=0;if(a.plastico||t.plastico){if(!a.plastico)return-1;if(!t.plastico)return 1;var e=s.get("plasticos",a.plastico,!0),n=s.get("plasticos",t.plastico,!0),r="T"==e.tipo?1:0,i="T"==n.tipo?1:0;(o=i-r)||(o=n.id-e.id)}o||(o=t.data>a.data?1:a.data>t.data?-1:0);o||(o=t.valor-a.valor);return o})),p.loading=!1,b(),angular.forEach(p.lancamentosBase,(function(a){"p"==a.tipo&&a.valor>0||a.plastico&&p.resumo.addTotalPlastico(a.plastico,a.valor)})),p.isFaturaPassada||i.carregarParcelasFuturas(p.cartao.id,!0).then((function(a){p.resumo.parcelasFuturas=a}))}))},p.addObserver=v.add,p.toggleFiltroStatus=function(a){p.status[a]=!p.status[a],x(),b()},p.exportar=function(){return l.exportar({inicio:p.fatura.vencimento,fim:p.fatura.vencimento,tipo:2,def:{conta:p.cartao.id}}).then((function(){}))},p.togglePlastico=function(a){p.psc[a]=!p.psc[a],h=[],angular.forEach(p.psc,(function(a,t){a&&h.push(t)})),x(),b()},p.toggleFullscreen=function(){p.fullscreen=!p.fullscreen,x()},p.toggleCharts=function(){p.busca="",p.chartsView=!p.chartsView,b(),x()},p.prepararExibicao=b,p.toggleTimeLine=function(){p.timeView=!p.timeView,b(),x()},p.toggleSort=function(a){if("u"!=a&&"p"!=a)return;p.ordenacao=a,x(),b()},p.openSearch=function(){p.searchOpen=!0,document.querySelector("#input-search-faturas").focus()},p.closeSearch=function(){if(p.busca)return;p.searchOpen=!1},p.searchOpen=!1}a.$inject=["$state","$stateParams","mdwObserver","relatoriosDatasource","configuracoesService","contasService","cartoesDatasource","filtrosService","cadastrosDatasource","lancamentosService","usuariosService","mdwAccentFold","cartoesChartService","mdwColors"],angular.module("md").service("faturaService",a)}(),function(){"use strict";function a(a,t,o,e){var n=this;n.fatura=o,n.resumo=n.fatura.resumo,n.fatura.init().then((function(){n.fatura.carregar()})),n.selection=e({controller:n,templateUrl:"/partials/cartoes/acoesLoteTopmenu.html",getLancamentos:function(){return n.fatura.lancamentos.filter((a=>!a.breakPlastico&&!a._isSaldo))}});const r=n.fatura.addObserver(n.fatura.carregar);a.$on("$destroy",(()=>{r(),n.selection.clearSelection()})),a.$watchCollection("vm.fatura.lancamentos",(()=>{n.selection.updateSelection()}))}a.$inject=["$scope","mdwTopmenu","faturaService","selecaoLancamentosLote"],angular.module("md").controller("FaturaLancamentosController",a)}(),function(){"use strict";function a(a,t,o,e,n,r){var i=this;i.today=o(),i.conta=e,i.data=e.proximoVencimento,i.lembrete=0,i.automatico=!1,i.enviarLembrete=!0,i.toggleLembretes=function(a){if(i.displayLembretes)return i.displayLembretes=0;i.displayLembretes=angular.element(a.currentTarget)[0].offsetLeft-7,i.enviarLembrete||(i.enviarLembrete=!0,i.lembrete=0)},i.toggleAutomatico=function(){i.automatico=!i.automatico},i.confirmado=!0,i.agendarPagto=!0,a.$watch("vm.data",(function(a){o(a).isValid()&&(i.posicaoData=o(a).startOf("day").diff(o().startOf("day"),"days"))})),i.contas=n.contas.filter((function(a){return a.tipo.match(/CONTA CORRENTE|DINHEIRO|OUTROS/)||"INVESTIMENTO"==a.tipo&&2==a.tipoInvestimento})),i.contaT=""+(e.contada||i.contas[0]),r.carregarFatura(e.id,e.proximoVencimento).then((function(a){i.fatura=a,i.valor=a.valor,a.pagamentosAgendados&&(i.valor+=a.pagamentosAgendados),i.valor=i.valor<0?i.valor:0})),i.ok=function(){var a={data:o(i.data).format("YYYY-MM-DD"),valor:i.agendarPagto?i.valor:0,contaT:i.contaT,confirmado:i.confirmado,automatico:i.automatico,vencimento:e.proximoVencimento};return i.enviarLembrete&&(a.lembrete=i.lembrete||0),i.pagarFatura(a).then(t.hide)}}a.$inject=["$scope","$mdDialog","moment","conta","cadastrosDatasource","cartoesDatasource"],angular.module("md").controller("PagarFaturaController",a)}(),function(){"use strict";function a(a,t){var o=this;o.vencimentos={},o.loading=!0,a.carregarParcelasFuturas(o.cartao.id).then((function(a){var e;o.loading=!1;var n={};a.forEach((function(a){o.vencimentos[a.dataPrevista]||(o.vencimentos[a.dataPrevista]={cartoes:[],total:0,vencimento:a.dataPrevista});var r=t.get("plasticos",a.plastico,!0),i=r.id+a.dataPrevista;if(!n[i]){var c={id:"",tipo:"",nome:"",valor:0,ls:[]};c.id=r.id,c.nome=r.nome,c.tipo=r.tipo,o.vencimentos[a.dataPrevista].cartoes.push(c),n[i]=c}n[i].valor+=a.valor,n[i].ls.push(a),o.vencimentos[a.dataPrevista].total+=a.valor,(!e||e>a.dataPrevista)&&(e=a.dataPrevista)})),angular.forEach(o.vencimentos,(function(a,t){a.cartoes.sort((function(a,t){return"T"==a.tipo?-1:"T"==t.tipo?1:a.nome<t.nome?-1:1}))})),o.venc=e}))}a.$inject=["cartoesService","cadastrosDatasource"],angular.module("md").controller("ParcelasFuturasController",a)}(),function(){"use strict";angular.module("md").filter("tipoLimiteCartao",(function(){return function(a){return 1==a?"Total":2==a?"Mensal":"Indefinido"}}))}(),function(){function a(a,t,o,e,n,r){const i=this;function c(){return e.getConexao(i.connectionId).then((a=>i.connection=a))}function s(){i.accounts=i.connection.accounts.filter((a=>a.status)),i.inactiveAccounts=function(a){return a.accounts.filter((a=>!a.status))}(i.connection)}i.cup=n.updateCtrl.updatingMap.conn,i.$onInit=function(){a.$on("$destroy",e.addObserver((()=>{c().then(s)}))),c().then(s)},i.excluir=function(){return o.excluirConexao(i.connection).then((()=>{t.validarPlanoAtual(!0)}))},i.vincular=function(a){return o.vincularConta(i.connection,a)},i.desvincular=function(a){return o.desvincularConta(i.connection,a)},i.importarLancamentos=function(a){return r.iniciar(a.summary,a.conta,"auto")}}a.$inject=["$scope","usuariosService","conexoesService","conexoesApi","conexoesUpdate","importacaoService"],angular.module("md").component("mdwConexaoCard",{templateUrl:"/partials/conexoes/conexao-card.component.html",controller:a,controllerAs:"vm",bindings:{connectionId:"=connection"}})}(),function(){"use strict";a.$inject=["$http","$q","$timeout","mdwCache","mdwObserver","cadastrosDatasource","lancamentosDatasource"],angular.module("md").service("conexoesApi",a);function a(a,t,o,e,n,r,i){var c,s,l=this,u=e("/integracao/connectors"),d=n();l.addObserver=d.add,l.notify=v;let m={};function f(a){return p().then((function(o){for(var e=0;e<o.length;e++){if(o[e].id==a.id){o[e]=a;let t=!1;a.accounts.forEach((a=>{!t&&a.lastImportedCount>0&&(t=!0);const o=r.get("contas",a.conta,!0);o&&a.summary&&(o.saldoUltimoExtrato=a.summary.saldo,o.dataUltimoExtrato=a.summary.fim)})),t&&i.notify();break}}return s=t.when(c),d.notify(a),a}))}function p(){return s||(s=a.get("/integracao/connections").then((function(a){const t=a.data;return t.forEach((a=>h(a))),c=c?t.map((a=>{const t=c.find((t=>t.id===a.id));return!t||t.lastUpdatedAt<a.lastUpdatedAt?a:(t.accounts=a.accounts.map((a=>{const o=t.accounts.find((t=>t.id===a.id));return o?o.conta!=a.conta||o.lastVerifiedAt<a.lastVerifiedAt||o.status!=a.status?a:o:a})),t)})):t}))),s}function v(a){s=null,d.notify(a)}function g(a){return v(),a.data}function h(a){const t=Math.floor((new Date).getTime()/1e3),o=o=>{if(!a[o]||!a[o].expiresAt||!a[o].serverTsSeconds)return;const e=t-a[o].serverTsSeconds;a[o].expiresAt=moment(a[o].expiresAt).utc().add("seconds",e).format("YYYY-MM-DDTHH:mm:ss.SSS[Z]")};o("userInputCredentials"),o("userAction")}l.atualizarConexao=function(e,n){m[e]||(m[e]={timer:t.when(),promise:void 0});const r=m[e];return r.promise||(r.promise=r.timer.then((()=>a.put(`/integracao/connection/update/${e}`,{force:n}).then((function(a){const t=a.data,e=t.statusCheckWindow||5;return r.promise=null,r.timer=o(angular.noop,1e3*e),h(t),f(t)}))))),r.promise},l.atualizarCredenciaisConexao=function(t,o){return a.put(`/integracao/connection/credentials/${t}`,o).then((a=>{const t=a.data;return h(t),f(t)}))},l.carregarConectores=function(){return u.get()},l.getConexao=function(a){return p().then((function(t){for(var o=0;o<t.length;o++){var e=t[o];if(e.id==a)return e}}))},l.carregarCacheConexoes=function(){return c||[]},l.carregarConexoes=p,l.criarConexao=function(t,o){return a.post("/integracao/connection/"+t,o).then(g)},l.vincularConta=function(t,o){return a.put("/integracao/account/"+t+"/link",{conta:o}).then(g)},l.desvincularAccount=function(t){return a.put("/integracao/account/"+t+"/unlink").then(g)},l.excluirItem=function(t){return a.delete("/integracao/connection/"+t).then(g)},l.carregarLancamentos=function(t,o){return a.get("/integracao/account/"+t+"/transactions",{params:{start:o}}).then((function(a){return a.data}))},l.registrarIdsImportados=function(t,o){const e=[];if(0==o.length)return;(o=[...o]).sort(((a,t)=>a.data<t.data?1:a.data>t.data?-1:0));const n=function(a){for(var t=0;t<c.length;t++){const e=c[t].accounts;for(var o=0;o<e.length;o++)if(e[o].id==a)return c[t]}}(t).markImportedWindowDays,r=o[0].data,i=moment(r).subtract(n,"days").format("YYYY-MM-DD");for(const a of o){if(a.data<i)break;e.push(a.integrationId)}return a.post("/integracao/transactions/markImported",{account:t,ids:e,date:r}),r}}}(),function(){"use strict";function a(a,t,o,e,n,r,i){var c=this;function s(){i.carregarConexoes().then((function(a){c.loading=!1,c.connections=a;let t=!1;a.forEach((a=>{t||"OUTDATED"!==a.status||"INVALID_CREDENTIALS_MFA"==a.executionStatus||(t=!0)})),t&&i.carregarConectores().then((function(t){const o={};t.forEach((a=>o[a.id]=a)),a.forEach((a=>a.connector=o[a.connector.id]))}))}))}a.$on("$destroy",i.addObserver(s)),c.validadorPlano=n.validarPlanoAtual(),c.$onInit=function(){c.loading=!0,r.isEnabled()?(s(),o.nova&&e((function(){t.go(".nova")}),100)):t.go("visaogeral.paineis")}}a.$inject=["$scope","$state","$stateParams","$timeout","usuariosService","conexoesService","conexoesApi"],angular.module("md").controller("ConexoesController",a)}(),function(){"use strict";function a(a,t,o,e,n,r,i){var c=this;c.isEnabled=function(){return!0},c.canUpdateConnections=function(){const a=n.carregarCacheConexoes().length,t=r.planoGetConexoes();return a<=t},c.configurarConexao=function(a){const o=a?a.id:void 0,e=()=>t.show({id:"nova-conexao",templateUrl:"/partials/conexoes/configurarConexao.html",controller:"ConfigurarConexaoController",controllerAs:"vm",bindToController:!0,closeOnEscape:!1,locals:{idConexao:o}});return o?e():r.demoAvailable().then((function(a){return a.con?t.show({id:"ativar-demo-conexao",templateUrl:"/partials/conexoes/ativarDemoConexoes.html",controller:function(){this.ok=()=>r.experimentar("con")},controllerAs:"vm"}):e()}))},c.excluirConexao=function(a){return t.show({id:"excluir-conexao",templateUrl:"/partials/conexoes/excluirConexao.html",controller:"ExcluirConexaoController",controllerAs:"vm",bindToController:!0,locals:{item:a}}).then((function(){}))},c.novaConta=function(a,t){return e.novo({conexao:{connection:a,account:t}}).then((function(a){return n.carregarConexoes().then((function(){return a}))}))},c.vincularConta=function(a,o){return t.show({id:"vincular-conta",templateUrl:"/partials/conexoes/vincularConta.html",controller:"VincularContaConexaoController",controllerAs:"vm",bindToController:!0,locals:{item:a,account:o}})},c.vincularConexao=function(a){return t.show({id:"vincular-conta",templateUrl:"/partials/conexoes/vincularConexao.html",controller:"VincularConexaoContaController",controllerAs:"vm",bindToController:!0,locals:{conta:a}})},c.desvincularConta=function(a,o){return t.show({id:"vincular-conta",templateUrl:"/partials/conexoes/desvincularConta.html",controller:"DesvincularContaConexaoController",controllerAs:"vm",bindToController:!0,locals:{connection:a,account:o}})}}a.$inject=["$q","$mdDialog","$mdToast","contasService","conexoesApi","usuariosService","MD_IN_PRODUCTION"],angular.module("md").service("conexoesService",a)}(),function(){"use strict";function a(a,t,o){const e=this.updateCtrl={isUpdating:!1,pending:!1,updatingMap:{conta:{},conn:{}},importMap:{},pendingCount:0};function n(a){return["LOGIN_ERROR","WAITING_USER_INPUT"].includes(a.status)}function r(){t.canUpdateConnections()&&o.carregarConexoes().then((function(a){e.pendingCount=0,e.isUpdating=!1,e.importMap={},a.forEach((a=>{(function(a){if(n(a))return!0;if("UPDATED"!=a.status)return!1;for(var t=0;t<a.accounts.length;t++){var o=a.accounts[t];if(o.summary&&o.summary.lancamentos.length>0)return!0}return!1})(a)&&++e.pendingCount,a.accounts.forEach((function(a){const t=a.summary;t&&t.lancamentos.length>0&&(e.importMap[a.conta]=t)})),c(a)}))}))}o.addObserver((function(){r()})),this.startUpdate=r;const i={};function c(t){const r=t.id;i[r]&&a.cancel(i[r]);const s=function(a){if(n(a))return!1;if("UPDATING"===a.status||function(a){return"WAITING_USER_ACTION"===a.status}(a))return!0;const t=moment(a.nextUpdateAt).isBefore();if(!a.lastUpdatedAt&&t)return!0;for(var o=0;o<a.accounts.length;o++){var e=a.accounts[o];if(e.conta&&e.canLoadTransactions){if(t)return!0;if((!e.lastVerifiedAt||e.lastVerifiedAt<a.lastUpdatedAt)&&!e.summary)return"UPDATED"===a.status}}return!1}(t);!function(a,t){e.updatingMap.conn[a.id]=t,a.accounts.forEach((a=>{a.conta&&(e.updatingMap.conta[a.conta]=t)}))}(t,s),s?(e.isUpdating=!0,o.atualizarConexao(r)):function(t){const o=moment(t.nextUpdateAt).diff(moment(),"miliseconds");if(o<0)return;i[t.id]=a((()=>c(t)),o)}(t)}}a.$inject=["$timeout","conexoesService","conexoesApi"],angular.module("md").service("conexoesUpdate",a)}(),function(){"use strict";function a(a,t,o,e,n,r){var i=this;let c;function s(){let a;if(f(),i.forceUpdate)a=e.atualizarConexao(i.idConexao,!0);else{var t={credentials:i.form,mfa:i.mfaOnly};i.connector.credentials.forEach((a=>{"password"===a.type&&(a.passwordVisible=!1)})),a=i.idConexao?e.atualizarCredenciaisConexao(i.idConexao,t):e.criarConexao(i.connector.id,t).then((a=>(i.idConexao=a.id,a)))}return a.then((function(a){return"UPDATED"===a.status||"OUTDATED"===a.status?d():"UPDATING"===a.status?l():(p(),void u(a))}),(function(){p()}))}function l(){c||(c=e.addObserver((a=>{a.data&&a.data.id&&a.data.id!=i.idConexao||e.carregarConexoes().then((a=>{const t=a.find((a=>a.id==i.idConexao));if("UPDATING"!==t.status){if("UPDATED"===t.status||"OUTDATED"===t.status)return d();p(),u(t)}else i.connection&&"WAITING_USER_ACTION"==i.connection.status&&(i.connection=t,f())}))})))}function u(a){i.connection=a,i.connector=angular.copy(i.connector||a.connector);const t="INVALID_CREDENTIALS_MFA"==a.executionStatus;if(i.mfaOnly=t||"WAITING_USER_INPUT"==a.status,i.forceUpdate="UPDATED"==a.status||"OUTDATED"==a.status&&!t,i.forceUpdate)i.warnUpdate=moment(a.nextUpdateAt).diff()>0;else if(m(),1==i.fields.length&&"auto"==i.fields[0].type){const a=i.fields[0];i.form[a.name]=a.value,s()}}function d(){c&&c(),a.hide()}function m(){if(i.uploader={},i.fields=[],i.form||(i.form={}),i.mfaOnly)i.fields.push(i.connection.userInputCredentials);else if(i.connection&&i.connection.userAction){let a=angular.copy(i.connection.userAction.attributes);i.fields.push(a)}else i.connector.credentials.forEach((a=>{"password"===a.type&&(a.passwordVisible=!1),i.fields.push(a),a.fileFormat&&(i.uploader[a.name]=new r({url:"",autoUpload:!1,onAfterAddingFile(o){const e=new FileReader;e.onload=()=>{t((()=>i.form[a.name]=e.result))},e.readAsText(o._file)}}))}))}function f(){i.conectando=!0,i.circular=!0,i.timedout=!1;t((()=>{if(!i.conectando)return;i.progress=10,i.circular=!1,i.linear=!0;const a=o((()=>{i.progress+=10/90,i.progress>=100?(i.timedout=!0,o.cancel(a),i.linear=!1):i.conectando||o.cancel(a)}),100)}),1e4)}function p(){i.timedout||(i.conectando=!1)}i.today=moment().endOf("day").toDate(),i.dismiss=d,i.$onInit=function(){return i.idConexao?(a=i.idConexao,i.loading=!0,e.getConexao(a).then((function(a){return i.loading=!1,u(a),a}))).then((a=>function(a){if("WAITING_USER_INPUT"!=a.status)return;if(!a.userInputCredentials||!a.userInputCredentials.expiresAt)return;const t=-moment().diff(a.userInputCredentials.expiresAt,"seconds");t<=0&&i.resendToken()}(a))):(i.isNovaConexao=!0,i.loading=!0,void e.carregarConectores().then((function(a){i.loading=!1,i.connectors=angular.copy(a)})));var a},i.configurarConexao=s,i.validar=function(a,t){return!t||!!a&&new RegExp(t).test(a)},i.onSelectConnector=function(a){a.status&&n.dialogPlanoConexoes((()=>{i.connector=a,i.terms="pluggy"==a.engine&&!a.demo,i.form=void 0,m()}))},i.buttonBack=function(){i.connector=null,i.terms=!1},i.toggleVisibility=function(a){a.passwordVisible=!a.passwordVisible},i.handleTokenTimeout=function(){i.tokenTimedOut=!0,i.fields.forEach((a=>{i.form[a.name]=void 0}))},i.resendToken=function(){i.tokenTimedOut=!1,f(),e.atualizarConexao(i.idConexao,!0),l()},i.onChangeFormField=function(a){if(!a.control)return;const t=a;t.control.forEach((a=>{i.fields.forEach((o=>{o.name==a&&o.requiredIf&&o.requiredIf.field==t.name&&(o.$disabled=o.requiredIf.equals!=i.form[t.name],o.$disabled&&(i.form[o.name]=void 0))}))}))},i.hasEventListener=!1,i.executeOauthAction=function(a){window.open(a.oauthUrl,void 0,"popup=1, width=400, height=650");i.hasEventListener||(i.hasEventListener=!0,window.addEventListener("message",(function t(o){o.data&&"MEUDINHEIRO"===o.data.state&&(i.form[a.name]=o.data.code,s(),window.removeEventListener("message",t,!1))}),!1))}}a.$inject=["$mdDialog","$timeout","$interval","conexoesApi","usuariosService","FileUploader"],angular.module("md").controller("ConfigurarConexaoController",a)}(),function(){"use strict";function a(a,t){var o=this;o.desvincular=function(){return t.desvincularAccount(o.account.id).then((function(){return a.hide()}))}}a.$inject=["$mdDialog","conexoesApi"],angular.module("md").controller("DesvincularContaConexaoController",a)}(),function(){"use strict";function a(a,t){var o=this;o.excluir=function(){return t.excluirItem(o.item.id).then((function(){return a.hide()}))}}a.$inject=["$mdDialog","conexoesApi"],angular.module("md").controller("ExcluirConexaoController",a)}(),function(){"use strict";function a(a,t,o,e){var n=this;n.$onInit=function(){o.carregarConexoes().then((function(a){n.accounts=[],a.forEach((function(a){a.accounts.forEach((function(t){t.conta||t.type==n.conta.tipo&&n.accounts.push({id:t.id,connection:a})}))}))}))},n.novaConexao=function(){a.hide().then((function(){t.go("contas.conexoes",{nova:!0})}))},n.vincular=function(){return o.vincularConta(n.account.id,n.conta.id).then((function(){return a.hide().then((function(){return e.escolhaArquivo(n.conta.id)}))}))},n.escolherConta=function(a){n.account=a}}a.$inject=["$mdDialog","$state","conexoesApi","importacaoService"],angular.module("md").controller("VincularConexaoContaController",a)}(),function(){"use strict";function a(a,t,o,e,n,r){var i=this;function c(){var a=o(i.filtroConta||""),e=a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),n=a.length<4?"\\s+":"";i.contas=t.contas.filter((function(a){if(!a.status)return!1;if(a.connectionAccount&&i.item.id!=a.connection)return!1;if(i.account.type!=a.tipo){const t="CARTAOCREDITO"==i.account.type,o="INVESTIMENTO"==a.tipo&&2==a.tipoInvestimento||"OUTROS"==a.tipo;if(t||!o)return!1}return(!i.filtroMoeda||i.filtroMoeda==a.moeda)&&(!i.filtroConta||o(a.nome).match(new RegExp("(^"+e+")|("+n+e+")","i")))})),i.contas.sort((function(a,t){return a.nome>t.nome?1:-1}))}function s(a){return r.escolhaArquivo(a)}i.$onInit=function(){c()},i.filtrarContas=c,i.novaConta=function(){return a.hide().then((function(){return e.novaConta(i.item,i.account).then((function(a){return s(a.id)}))}))},i.escolherConta=function(a){i.conta=a},i.vincular=function(){return n.vincularConta(i.account.id,i.conta.id).then((function(){return a.hide().then((function(){return s(i.conta.id)}))}))}}a.$inject=["$mdDialog","cadastrosDatasource","mdwAccentFold","conexoesService","conexoesApi","importacaoService"],angular.module("md").controller("VincularContaConexaoController",a)}(),function(){"use strict";function a(a,o,e,n,r,i,c,s,l){var u=this;i.title="Configurações de utilização",u.svcMoedas=s,u.configMoeda=s.moedas.length>1,u.configs=[{id:"dataCompetencia",name:"Data de competência",content:"Utilizar o campo data de competência nos lançamentos.",help:"Período em que aconteceu o fato gerador da receita ou despesa, independentemente da data de recebimento ou pagamento"},{id:"residuo",name:"Resíduo de metas",content:"Considerar os valores residuais das metas de receitas e despesas nos resultados dos relatórios de caixa."},{id:"contatos",name:"Contatos",content:"Utilizar o cadastro de contatos, adicionando o campo aos lançamentos.",obr:"contatosO"},{id:"centros",name:"Centros",content:"Utilizar o cadastro de centros de custos e lucros, adicionando o campo aos lançamentos.",obr:"centrosO"},{id:"formas",name:"Formas de pagamento",content:"Utilizar o cadastro de formas de pagamento, adicionando o campo aos lançamentos.",obr:"formasO"},{id:"projetos",name:"Projetos",content:"Utilizar o cadastro de projetos, adicionando o campo aos lançamentos.",obr:"projetosO"},{id:"tags",name:"Tags",content:"Utilizar o cadastro de tags, adicionando o campo aos lançamentos."},{id:"ndocumento",name:"Número de documento",content:"Utilizar o campo número de documento nos lançamentos.",obr:"ndocumentoO"},{id:"observacoes",name:"Campo de observações",content:"Utilizar o campo observações nos lançamentos."},{id:"senhaDelecao",name:"Senha para exclusão de cadastros",content:"Exigir a senha de acesso para a exclusão de um item dos cadastros."},{id:"metasRD",name:"Metas de receitas e despesas",content:"Considerar na apuração do valor realizado apenas os lançamentos em cuja categoria há meta definida."},{id:"pendentesPresente",name:"Exibir os lançamentos pendentes no presente",content:"Ao desabilitar esta opção, os lançamentos pendentes serão considerados no dia do seu vencimento."}],u.config=r.utilizacao,u.toggleConfig=function(t){return"senhaDelecao"==t&&u.config[t]?function(a){return a.show({id:"senha-delecao",templateUrl:"/partials/configuracoes/senhaDelecao.html",controller:"senhaDelecaoController",controllerAs:"vm"})}(e).then((function(a){return r()})):r();function r(){return u.config[t]=!u.config[t],o.$broadcast("mdwUsuarioConfig"),n.updateConfig(u.config).then((function(){var o;-1!=["contatos","centros","formas","projetos","tags"].indexOf(t)&&(o=a("firstToUpper")(t)),o&&(l.identifyCurrentUser(),l.moduleEnablementChanged(o,u.config[t]))}))}},u.toggleMoeda=function(){return n.updateConfig(u.config).then((function(){c.showSimple("Moeda padrão atualizada")}))},u.toggleObr=function(a){return n.updateConfig(u.config)},u.configurarCores=function(){return e.show({id:"personalizar-cores",templateUrl:"/partials/configuracoes/cores.html",controller:t,controllerAs:"vm"})},u.onChangeParcelas=function(){n.updateConfig(u.config)}}function t(a,t,o,e){var n=this,r=["CE6060","179428","179428","D08989","97CE97","B371B3","73ACCE","555","eee"],i=e.utilizacao;n.padroes=r,n.index=0,n.cores=i.corSin,n.cores=n.cores.concat(i.cores,i.corDescr),n.padrao=function(a){n.cores[a]=r[a]},n.ok=function(){for(var e=[],r=[],c=0;c<7;c++)c<3?r.push(n.cores[c]):e.push(n.cores[c]);return i.corDescr[0]=n.cores[7],i.corDescr[1]=n.cores[8],i.cores=e,i.corSin=r,a.all([t(angular.noop,99999),o.updateConfig(i).then((function(){location.reload()}))])}}a.$inject=["$filter","$rootScope","$mdDialog","usuariosService","configuracoesService","mdwTopmenu","$mdToast","moedaService","mdwAnalytics"],t.$inject=["$q","$timeout","usuariosService","configuracoesService"],angular.module("md").controller("ConfiguracoesController",a)}(),function(){"use strict";function a(a,t,o,e){e||o.state({id:"configuracoes",title:"Configurações",templates:["configuracoes/configuracoes.html"]},{url:"/configuracoes",templateUrl:"partials/configuracoes/configuracoes.html",controller:"ConfiguracoesController",controllerAs:"vm"})}a.$inject=["$stateProvider","mdwStateDialogProvider","mdwBaseStateProvider","MD_INVEST_MOD"],angular.module("md").config(a)}(),function(){"use strict";function a(a,t){var o=this;o.desabilitar=function(){return o.senhaInvalida=!1,a.post("/apiweb/usuarios/validarSenha",{senha:o.senha}).then((function(a){if(a.data)return t.hide();o.senhaInvalida=!0}))},o.dismiss=function(){t.cancel()}}a.$inject=["$http","$mdDialog"],angular.module("md").controller("senhaDelecaoController",a)}(),function(){"use strict";angular.module("md").constant("SEXOS",[{id:"f",nome:"Feminino"},{id:"m",nome:"Masculino"}])}(),function(){"use strict";angular.module("md").constant("BR_UFS",[{id:"AC",nome:"Acre"},{id:"AL",nome:"Alagoas"},{id:"AM",nome:"Amazonas"},{id:"AP",nome:"Amapá"},{id:"BA",nome:"Bahia"},{id:"CE",nome:"Ceará"},{id:"DF",nome:"Distrito Federal"},{id:"ES",nome:"Espírito Santo"},{id:"GO",nome:"Goiás"},{id:"MA",nome:"Maranhão"},{id:"MT",nome:"Mato Grosso"},{id:"MS",nome:"Mato Grosso do Sul"},{id:"MG",nome:"Minas Gerais"},{id:"PA",nome:"Pará"},{id:"PB",nome:"Paraíba"},{id:"PR",nome:"Paraná"},{id:"PE",nome:"Pernambuco"},{id:"PI",nome:"Piauí"},{id:"RJ",nome:"Rio de Janeiro"},{id:"RN",nome:"Rio Grande do Norte"},{id:"RO",nome:"Rondônia"},{id:"RS",nome:"Rio Grande do Sul"},{id:"RR",nome:"Roraima"},{id:"SC",nome:"Santa Catarina"},{id:"SE",nome:"Sergipe"},{id:"SP",nome:"São Paulo"},{id:"TO",nome:"Tocantins"}])}(),function(){"use strict";t.$inject=["$mdDateLocaleProvider","moment"],o.$inject=["$provide"];var a="DD/MM/YYYY";function t(t,o){t.parseDate=function(t){var e=o(t,a,!0);return e.isValid()?e.toDate():new Date},t.formatDate=function(t){return o(t).format(a)}}function o(a){a.decorator("mFormatFilter",(function(){return function(a,t,o){return a&&moment(a).isValid()?o?moment.tz(a,o).format(t):moment(a).format(t):""}}))}angular.module("md").config(t).config(o)}(),function(){"use strict";function a(a){a.decorator("formDirective",["$delegate",function(a){var t=a[0].compile;return a[0].compile=function(o,e){var n=t.apply(a[0],arguments),r=n.pre;return n.pre=function(t,o,e,n){r.apply(a[0],arguments);var i=n[0];i.$mdwInvalid=i.$invalid&&i.$submitted;var c=t.$watchGroup(["form.$invalid","form.$submitted"],(function(a){i.$mdwInvalid=a[0]&&a[1]}));o.on("$destroy",(function(){c()}))},n},a}])}a.$inject=["$provide"],angular.module("md").config(a)}(),function(){"use strict";function a(a){return{getHeaders:function(){return{Accept:"application/json",Authorization:"Bearer "+a.mdconfig.mdauthtoken,mdPolicy:a.mdconfig.mdPolicy,mdSignature:a.mdconfig.mdSignature,mdApiKey:a.mdconfig.mdApiKey,mdUid:a.mdconfig.mdUid,MdVersionApp:a.mdwVersionNo}}}}function t(a){a.interceptors.push(["$q","$injector","$rootScope","mdwApiError","mdHeadersFactory",function(a,t,o,e,n){var r,i;let c={};function s(a){if(!o.mustUpdateMdw){var t=a.headers("mdwAppVersionNo"),e=a.headers("mdwFrontVersionNo");e&&(o.mustUpdateMdw=e>o.mdwFrontVersionNo&&"f"==e.substr(-1)),!o.mustUpdateMdw&&t&&(o.mustUpdateMdw=o.mdwAppVersionNo!=t&&"f"==t.substr(-1))}}return{request:function(t){if(0===t.url.search(/^\/?partials\/.*/))t.url=document.location.protocol+"//"+document.location.host+"/"+t.url.replace(/^\//,"")+"?v="+o.mdwTemplateHtmlVersion;else if(-1===t.url.search(/(\..*)$/)){var e=0===t.url.search(/\/api\/v\d/);0===t.url.search("/apiweb")||e||(t.url="/api/v1/"+t.url.replace(/^\//,"")),t.headers=n.getHeaders()}return i&&c[t.url]?(location.reload(),a.when()):t},response:function(a){a.headers("mdwVersionNo");s(a);const t=a.headers("mdwLancUsageOverflow");return t&&o.$broadcast("mdwLancUsageOverflowHeader",t),a},responseError:function(l){var u=t.get("$mdToast"),d=l.config;if(s(l),!1===d.handleErrors||angular.isArray(d.handleErrors)&&-1==d.handleErrors.indexOf(l.status))return a.reject(l);if(-1==l.status)navigator.onLine?(u.showSimple("Falha ao carregar recurso. Tente atualizar esta página"),l&&l.config&&console.error("Falha ao carregar recurso",l.config.url,l.config)):u.showSimple("Verifique sua conexão");else if(429==l.status){var m=t.get("$http"),f=t.get("$timeout");if(d._retries_429||(d._retries_429=0),d._retries_429<3)return d._retries_429++,f((function(){return m(d)}),1e3*d._retries_429)}else if(401==l.status){m=t.get("$http");if(2==l.data.errorCode)return r||(r=m.post("/apiweb/revalidatePolicy").then((function(a){o.mdconfig.mdPolicy=a.data.mdPolicy,o.mdconfig.mdSignature=a.data.mdSignature,r=null}))),r.then((function(){return d.headers.mdPolicy=o.mdconfig.mdPolicy,d.headers.mdSignature=o.mdconfig.mdSignature,m(d)}));if(4==l.data.errorCode||1==l.data.errorCode){var p=t.get("loginService");i||(i=p.refazerLogin().then((function(a){o.mdconfig.mdauthtoken=a,i=null,c={}})));const a=i.then((function(){return d.headers=n.getHeaders(),m(d)}));return c[d.url]=a,a}5==l.data.errorCode&&e.notify("Dados de acesso inválidos")}else 404==l.status?u.showSimple("Recurso não encontrado"):403==l.status?u.showSimple("Não autorizado"):l.data&&2==l.data.type?e.notify({message:l.data.error,url:l.data.url}):u.showSimple("Ocorreu um erro");return a.reject(l)}}}])}a.$inject=["$rootScope"],t.$inject=["$httpProvider"],angular.module("md").factory("mdHeadersFactory",a).config(t)}(),function(){"use strict";function a(a){a.resourceUrlWhitelist(["self","https://s3.amazonaws.com/img.meudinheiroweb.com.br/**"])}function t(a){var t=a.theme("default");a.theme("dm").primaryPalette("grey",{default:"900"}).accentPalette("blue-grey");var o=a.extendPalette("pink",{A400:"#444444",contrastDefaultColor:"light"});if(a.definePalette("mdPink",o),t.accentPalette("mdPink",{"hue-3":"A400"}),t.backgroundPalette("grey",{default:"100"}),"i"===window.mdtema){var e=a.extendPalette("light-blue",{500:"#0178d6",contrastDefaultColor:"light"});a.definePalette("mdLightBlue",e),t.primaryPalette("mdLightBlue",{default:"500"})}else if("j"===window.mdtema)t.primaryPalette("blue-grey",{default:"700"});else{var n=a.extendPalette("teal",{500:"#00a797",contrastDefaultColor:"light"});a.definePalette("mdTeal",n),t.primaryPalette("mdTeal",{default:"500"})}}a.$inject=["$sceDelegateProvider"],t.$inject=["$mdThemingProvider"],angular.module("md").config(t).config(a)}(),function(){"use strict";function a(a){a.changeLocale("pt-br")}a.$inject=["amMoment"],angular.module("md").run(a)}(),function(){"use strict";function a(a,t,o,e){a.when("/","/visaogeral"),a.otherwise("/visaogeral"),t.html5Mode(!0)}function t(a,t,o,e,n,r){t.onError({},(function(a){403==a.error().detail&&o.go("visaogeral.paineis")})),o.defaultErrorHandler((function(a){})),t.onBefore({},(function(t){var e=t.$to(),r=e.data||{};return r.permmd&&!n.hasPerm(r.permmd,r.permmdt||"v")||r.permmdadmin&&!n.isAdmin()?o.target("visaogeral.paineis"):a.loadingPromise.then((function(){var a=n.validarPlanoAtual(),t=e.name;return!(!a.valid&&a.target!=t&&!t.match(/^(contas?|assinatura|pagamentoFinalizado|login)(\.|$)/))||o.target(a.target)}))}));var i=!1;t.onStart({},(function(a){var t=a.$to(),o=t.data||{};t.data&&t.data.isDialog||("visaogeral.paineis"==t.name&&a.params().keepDialog&&!i?i=!0:e.cancelAll());o.enableMoeda?(r.show(),o.disableMoeda&&r.disable(o.moeda)):r.hide()}))}a.$inject=["$urlRouterProvider","$locationProvider","$stateProvider","MD_INVEST_MOD"],t.$inject=["$rootScope","$transitions","$state","$mdDialog","usuariosService","moedaService"],angular.module("md").config(a).run(t)}(),function(){"use strict";function a(a){a.decorator("$mdDialog",["$delegate","$q","$timeout",function(a,t,o){var e=[],n=[],r=[],i=a.show,c=a.hide,s=a.cancel,l=a.destroy,u=(a.build,!1);function d(a){a.isStacked=!0;var o=t.defer();a.showPromise=o.promise,a.onComplete=function(){o.resolve()},e.push(a)}function m(o){var r=e[e.length-1].id;if(!(e.length<1)&&r){var c=e[e.length-1];return d(o),c.showPromise.then((function(){var e=angular.element(document.getElementById(r)),s=e.css("display");return o=angular.extend({skipHide:!0,hasBackdrop:!1,onShowing:function(){e.css("display","none")}},o),i(o).then((function(r){return!1===r?(i(),t.reject()):o.stacked&&!0===o.stacked.closeAll?a.destroy(r):(n.push(t.when(i())),r);function i(){if(c.replace)return a.cancel();e.css("display",s)}}))}))}console.error("Dialog pai deve possuir um id")}return a.cancelAll=function(t){if(!u&&0!=e.length)return a.cancel().then((function(){return e.pop(),a.cancelAll()}))},a.cancel=function(a){if(!u)return 1==e.length?s.apply(this,Array.prototype.slice.apply(arguments)):(u=!0,c(!1).then((function(){u=!1})))},a.destroy=function(a){return l.apply(this,Array.prototype.slice.apply(arguments))},a.show=function a(o){var c=this,s=arguments;return t.all(n).then((function(){var l;if(n=[],o.multiple=!0,0==e.length)d(o),l=i.apply(c,Array.prototype.slice.apply(s));else{if(o.wait){var u=t.defer();return r.push([u,o]),u.promise}if(!(l=m(o)))return t.resolve()}return l.finally((function(t){if(e.length>0&&e[e.length-1].isStacked&&e.pop(),0==e.length&&r.length>0){var o=r.shift();a(o[1]).then((function(a){o[0].resolve(a)}),(function(a){o[0].reject(a)}))}return t}))}))},a}])}a.$inject=["$provide"],angular.module("md").config(a)}(),function(){"use strict";angular.module("md").directive("colorPicker",(function(){return a.$inject=["$scope","colorPickerService"],{templateUrl:"/partials/directives/colorPicker.html",require:"^ngModel",scope:{color:"=ngModel"},controller:a,controllerAs:"vm",restrict:"E"};function a(a,t){var o=this;function e(a){return a.replace("#","")}o.selectColor=function(t){a.color=t,o.color="#"+t},o.randomColor=t.randomColor,o.colors=t.colors,o.color="#"+(a.color||o.randomColor()),a.color=e(o.color),o.onChangeColor=function(){a.color=e(o.color)}}})).service("colorPickerService",(function(){var a=this;a.randomColor=function(){var t=a.colors.length-1,o=a.colors[0].length-1,e=Math.floor(Math.random()*t+1),n=Math.floor(Math.random()*o+1);return e<=t&&n<=o?a.colors[e][n]:a.colors[0][0]},a.colors=[["F6C5BE","FFE6C7","FEF1D1","B9E4D0","C6F3DE","C9DAF8","E4D7F5","FCDEE8"],["EFA093","FFD6A2","FCE8B3","89D3B2","A0EAC9","A4C2F4","D0BCF1","FBC8D9"],["E66550","FFBC6B","FCDA83","44B984","68DFA9","6D9EEB","B694E8","F7A7C0"],["CC3A21","EAA041","F2C960","149E60","3DC789","3C78D8","8E63CE","E07798"],["AC2B16","CF8933","D5AE49","0B804B","2A9C68","285BAC","653E9B","B65775"],["822111","A46A21","AA8831","076239","1A764D","1C4587","41236D","83334C"]]}))}(),function(){"use strict";function a(a,t){var o=[];this.notify=function(t){0==o.length?a.get("$mdDialog").show({id:"api-error-id",template:['<md-dialog id="api-error-id" >','<md-dialog-content class="md-dialog-content">','<p style="max-width:400px">{{vm.error}} <a ng-if="vm.url" class="link-light-blue" href="{{vm.url}}" target="_blank">(Saiba mais)</a></p>',"</md-dialog-content>","<md-dialog-actions>",'<md-button class="md-primary" ng-click="vm.dismiss()">Fechar</md-button>',"</md-dialog-actions>","</md-dialog>"].join(""),controller:["$mdDialog",function(a){this.dismiss=a.cancel}],controllerAs:"vm",bindToController:!0,locals:{error:angular.isObject(t)?t.message:t,url:angular.isObject(t)?t.url:null}}):o[o.length-1].notify(t)},this.addObserver=function(a){var e=t(),n=e.add(a);return o.push(e),function(){n(),o.pop()}}}a.$inject=["$injector","mdwObserver"],angular.module("md").service("mdwApiError",a)}(),function(){"use strict";function a(a,t,o){return{restrict:"A",link:function(a,t,e){t.bind("click",(function(){o.go()}))},scope:{}}}a.$inject=["$window","$state","$previousState"],angular.module("md").directive("mdwBackBtn",a)}(),function(){"use strict";angular.module("md").component("mdwBtnRegime",{bindings:{regime:"<",toggle:"&"},template:['<div ng-style="$ctrl.style" md-colors="{color:\'accent\'}">',"<span>Visão {{$ctrl.regime == 'ca' ? 'de caixa' : 'da competência'}}</span>",'<md-button class="md-icon-button md-accent" ng-click="$ctrl.toggleValue()">',"<md-icon>swap_horiz</md-icon>","<md-tooltip>Alternar para visão {{$ctrl.regime == 'co' ? 'de caixa' : 'da competência'}}</md-tooltip>","</md-button>","</div>"].join(""),controller:function(){var a=this;a.style={"font-weight":"600","text-align":"center","font-size":"14px"},a.toggleValue=function(){a.regime="ca"==a.regime?"co":"ca",a.toggle()}}})}(),function(){"use strict";t.$inject=["$window","$compile","$timeout"],angular.module("md").directive("mdwCalculator",t);var a={"+":"sum","-":"minus","*":"times","/":"divide","=":"result","%":"percent","+/-":"toggle",",":"comma",tt:"toggleType",copy:"copy",AC:"ac"};function t(t,o,e){return n.$inject=["$scope","$templateRequest","configuracoesService"],{template:'<md-icon class="mdw-calculator-trigger" md-svg-src="/icons/calculator.svg" ng-hide="vm.loading"></md-icon>',require:"mdwCalculator",restrict:"E",scope:{onupdate:"=",onCopy:"&?"},controller:n,link:function(n,r,i,c){var s,l=angular.element('<div style="display: none" class="mdw-calculator-overlay"></div>'),u=angular.element(r),d=!1;function m(a,t){d=a,c.resetDecimal(),a?(c.current=Math.abs(n.onupdate||0),f(),p(),l.css({display:"block"})):(p(!0),s.css({display:"none"}),l.css({display:"none"}))}function f(){if(d){var a=r[0].getBoundingClientRect();if(s.css({left:a.left+"px",top:a.top+"px",display:"block"}),s[0].clientHeight+a.top>window.innerHeight){var t=s[0].clientHeight+a.top-window.innerHeight;s.css({top:a.top-t+"px"})}if(s[0].clientWidth+a.left>window.innerWidth){t=s[0].clientWidth+a.left-window.innerWidth;s.css({left:a.left-t+"px"})}}}function p(a){["1","2","3","4","5","6","7","8","9","0",",",".","=","+","-","*","/","%"].forEach((function(t){a?Mousetrap.unbind(t):Mousetrap.bind(t,(function(a){e((function(){c.action(t,a)}),0)}))}));angular.forEach({backspace:"C",enter:"=",del:"AC",c:"copy"},(function(t,o){a?Mousetrap.unbind(o):Mousetrap.bind(o,(function(a){e((function(){c.action(t,a)}),0)}))})),a?Mousetrap.unbind("escape"):Mousetrap.bind("escape",(function(a){m(!1)}))}u.css({display:"none"}),c.pTemplate.then((function(a){u.css({display:"block"}),(s=a).css({display:"none"}),angular.element(document.body).append(l).append(s),o(s)(n)})),c.toggle=m,c.setActiveBtn=function(t){var o=angular.element(s[0].querySelector(".btn-"+a[t]));o.addClass("active"),e((function(){o.removeClass("active")}),300)},angular.element(r).on("click",(function(a){m(!0)})),l.on("click",(function(a){m(!1)})),angular.element(t).on("resize",f),n.$on("$destroy",(function(){m(!1),l.remove(),s.remove(),angular.element(t).off("resize",f)}))},controllerAs:"vm"};function n(a,t,o){var n=this;n.loading=!0;var r=o.getConfig("tipoCalc",{t:!0});n.calcFin=r.t,n.pTemplate=t("/partials/directives/mdwCalculator/calculator.html").then((function(a){return n.loading=!1,angular.element(a)}));var i,c,s=0,l=!1,u=1,d=1,m=!1,f=!1;function p(a){return a.toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]}n.resetDecimal=function(){u=1,d=1},n.toggleType=function(){n.setActiveBtn("tt"),n.calcFin=!n.calcFin,o.updateConfig("tipoCalc",{t:n.calcFin})},n.action=function(t,o){if(n.setActiveBtn(t),"click"==o.type&&o.target.blur(),n.calcFin){var r=parseFloat((100*n.current).toFixed(2));if(t.match(/[0-9]/)){if(r>1e11)return;l&&(r=0),1!=Math.sign(r)&&0!=Math.sign(r)||(r=parseFloat((10*r).toFixed(2))+parseInt(t)),-1!=Math.sign(r)&&-0!=Math.sign(r)||(r=parseFloat((10*r).toFixed(2))-parseInt(t)),l=!1,c="number"}else if("+/-"==t)r*=-1;else if("C"==t)r=p(r/10);else if("AC"==t)r=0,s=0,u=1,d=1,i=null,c=null;else if("="==t||"+"==t||"-"==t||"*"==t||"/"==t)s&&"number"==c?("+"==i?s+=r:"-"==i?s-=r:"*"==i?s*=r/100:"/"==i&&(s/=r/100),s=parseFloat(s.toFixed(2))):s=r,"="!=t&&(i=t,l=!0),("="==t||s)&&(r=s),c="op";else if("%"==t){if(r/=1e4,i){var v=s*r;"+"==i?s+=v:"-"==i?s-=v:"*"==i?s=v:"/"==i&&(s/=r),r=s}}else"copy"==t&&(a.onupdate=Math.abs(n.current),a.onCopy&&e((function(){a.onCopy()}),0),n.toggle(!1));n.current=p(r/100)}else{var g,h;r=parseFloat(n.current);if(t.match(/[0-9]/)){if(r>1e11)return;if(l&&(r=0,u=1),m){if(u>10)return;0!==t?1==Math.sign(r)||0==Math.sign(r)?f?(r=(parseFloat(r)+parseFloat(t/Math.pow(10,u))).toFixed(u),u+=1):(r=(parseFloat(r)+parseFloat(t/Math.pow(10,d))).toFixed(d),d+=1):-1!=Math.sign(r)&&-0!=Math.sign(r)||(f?(r=(parseFloat(r)-parseFloat(t/Math.pow(10,u))).toFixed(u),u+=1):(r=(parseFloat(r)-parseFloat(t/Math.pow(10,d))).toFixed(d),d+=1)):f?(r=r.toFixed(u),u+=1):(r=r.toFixed(d),d+=1),u>d&&(d=u)}else 1==Math.sign(r)||0==Math.sign(r)?(h=r-(g=Math.trunc(r)),r=10*g+parseInt(t)+h):-1!=Math.sign(r)&&-0!=Math.sign(r)||(r=parseFloat(10*r)-parseInt(t));l=!1,c="number"}else if("+/-"==t)r*=-1,m=!1;else if("C"==t)r=""==(r=(r=r.toString()).slice(0,-1))?0:parseFloat(r),u>1&&(u-=1),d>1&&(d-=1),1==d&&(m=!1);else if("AC"==t)r=0,s=0,u=1,d=1,i=null,c=null,m=!1;else if(","==t)m=!0;else if("="==t||"+"==t||"-"==t||"*"==t||"/"==t)m=!1,f=!0,s&&"number"==c?("+"==i?s+=r:"-"==i?s-=r:"*"==i?s*=r:"/"==i&&(s/=r),s=parseFloat(s.toFixed(d))):s=r,"="!=t&&(i=t,l=!0),("="==t||s)&&(r=s,"="==t&&(f=!1)),c="op";else if("%"==t){if(m=!1,r/=100,i){v=s*r;"+"==i?s+=v:"-"==i?s-=v:"*"==i?s=v:"/"==i&&(s/=r),r=s}}else"copy"==t&&(m=!1,a.onupdate=Math.abs(n.current),a.onCopy&&e((function(){a.onCopy()}),0),n.toggle(!1));n.current=r.toString()}}}}["1","2","3","4","5","6","7","8","9","0"].forEach((function(t){a[t]=t}))}(),function(){"use strict";t.$inject=["$compile","MAX_DATE_LANCS"],angular.module("md").directive("mdwCalendar",(function(){return a.$inject=["$scope","$transitions","mdwCalendarService"],{templateUrl:function(a,t){return"/partials/directives/mdwCalendar/mdwCalendar.html"},restrict:"E",scope:{options:"=",min:"=",max:"=",base:"=",orientation:"@?",navigation:"=?"},controller:a,controllerAs:"vm"};function a(a,t,o){var e=this;e.calendar=o.getInstance(a.options),e.orientation=a.orientation||"horizontal",e.nonav=!1===a.navigation,a.$watch("options",(function(a){a&&(e.calendar=o.getInstance(a),e.updateCalendarDirective&&e.updateCalendarDirective())}),!0),a.$watch("orientation",(function(a){e.orientation=a||"horizontal"})),a.$watch("min",(function(a){e.calendar.config.min=a,e.btn&&e.btn.updateBtn()})),a.$watch("max",(function(a){e.calendar.config.max=a,e.btn&&e.btn.updateBtn()})),a.$watch("base",(function(a){e.calendar.config.base=a,e.calendar.refresh()})),t.onSuccess({},(function(){e.calendar.refresh()}))}})).directive("mdwCalendarBtn",t);var a=0;function t(t,o){return e.$inject=["$scope","$rootScope","$timeout"],{template:"",restrict:"A",require:["mdwCalendarBtn","^mdwCalendar"],scope:{},controller:e,controllerAs:"vm",link:function(e,n,r,i){var c=i[0],s=i[1],l=angular.element(n),u=p(),d="pickerToUpdate-"+ ++a,m=angular.element('<input id="'+d+'" style="opacity:0; width: 0;height: 0;"  mdw-date-format date-time ng-model="vm.data" view="'+u.view+'" min-view="'+u.minView+'" max-view="'+u.maxView+'" position="absolute" date-change="vm.changeDate"auto-close="true">');s.calendar.config.max||(s.calendar.config.max=o);m.attr("max-date","maxDate"),e.maxDate=s.calendar.config.max,s.calendar.config.min&&(m.attr("min-date","minDate"),e.minDate=s.calendar.config.min);s.btn=c,c.data=s.calendar.getDate(),c.changeDate=function(a,t){},c.updateBtn=function(){e.$broadcast("pickerUpdate","pickerToUpdate",function(){var a={};s.calendar.config.min&&(a.minDate=moment(s.calendar.config.min));s.calendar.config.max&&(a.maxDate=moment(s.calendar.config.max));return a}())};var f=c.data.format("YYYY-MM-DD");function p(){var a={};return-1!=["m","t","s","y"].indexOf(s.calendar.currentInterval)?(a.view="month",a.maxView="year",a.minView="month"):(a.view="date",a.maxView="year",a.minView="date"),a}l.parent()[0].insertBefore(m[0],l[0]),t(m)(e),l.bind("click",(function(){m.focus()})),m.bind("blur",(function(){var a=c.data.format("YYYY-MM-DD");a!=f&&(s.calendar.initialize(a),s.calendar.update())})),(s.updateCalendarDirective=function(){s.calendar.addOnUpdateListener((function(){e.$broadcast("pickerUpdate",d,p()),c.data=s.calendar.getDate()}))})()}};function e(a,t,o){}}}(),function(){"use strict";var a="YYYY-MM-DD",t=[{id:"d",label:"diário"},{id:"w",label:"semanal"},{id:"m",label:"mensal"},{id:"t",label:"trimestral"},{id:"s",label:"semestral"},{id:"y",label:"anual"},{id:"p",label:"personalizar..."}];function o(a){switch(a){case"d":return"days";case"w":return"weeks";case"m":case"t":case"s":return"months";case"y":return"years"}}angular.module("md").factory("mdwCalendarService",["$state","$stateParams","$q","$timeout","mdwMoment",function(e,n,r,i,c){return{getInstance:function(a){return new m(a)},getDefaultParams:function(a,t){var o=s(a,n.inicio),e=l(a,o);return{inicio:t?o.format("YYYY-MM-DD"):o,fim:t?e.format("YYYY-MM-DD"):e,i:a}},isPresent:u,isPast:function(a,t){return c().isAfter(t,"days")}};function s(a,t){var o=c(t);c();switch(a){case"d":case"p":return o;case"w":return o.day(0);case"m":return o.date(1);case"t":var e=parseInt(o.month()/3);return o.month(3*e).date(1);case"s":return o.month(o.month()>5?6:0).date(1);case"y":return o.month(0).date(1)}}function l(a,t){switch(a){case"d":case"p":return c(t);case"w":return c(t).day(6);case"m":return c(t).add("months",1).date(1).subtract("days",1);case"t":return c(t).add("months",3).subtract("days",1);case"s":return c(t).add("months",6).subtract("days",1);case"y":return c(t).add("years",1).subtract("days",1)}}function u(a,t,o){var e=c(o);return(e.isAfter(c(a),"days")||e.isSame(c(a),"days"))&&(e.isBefore(c(t),"days")||e.isSame(c(t),"days"))}function d(a){switch(a=a.toLowerCase()){case"p":case"d":case"w":case"m":case"t":case"s":case"y":return a}return"m"}function m(r){var m,f,p,v,g=this,h=[];function C(){A(n.inicio,n.i)}function b(){return!(g.config.max&&m>g.config.max)&&(!(g.config.min&&m<g.config.min)&&(v&&(i.cancel(v),v=null),void(v=i((function(){v=null,e.go(e.current,{inicio:m.format(a),fim:f.format(a),i:g.currentInterval}),h.forEach((function(a){a.call(g)}))}),400))))}function A(a,t){g.currentInterval=d(t||g.currentInterval||r.interval),m=s(g.currentInterval,a||g.config.base),f=l(g.currentInterval,"p"==g.currentInterval&&n.fim||m)}function x(a){h.push(a)}g.config=r=angular.extend({defaultInterval:"m",baseText:"Ir para período atual",restrict:t.map((function(a){return a.id})),base:c(),min:null,max:null,onUpdate:function(){}},r||{}),angular.isArray(g.config.restrict)||(g.config.restrict=[g.config.restrict]),g.config.interval||(g.config.interval=g.config.restrict[0]||"d"),p=g.config.interval,g.config.interval=d(g.config.interval),-1==g.config.restrict.indexOf(g.config.interval)&&(g.config.interval=g.config.defaultInterval,-1==g.config.restrict.indexOf(g.config.interval)&&(g.config.interval=g.config.restrict[0])),x(g.config.onUpdate),g.addOnUpdateListener=x,g.initialize=A,g.update=b,g.refresh=C,g.isPresent=function(){return u(m,f,g.config.base)},g.display=function(){switch(g.currentInterval){case"d":return m.format("DD MMM YYYY");case"w":return m.format("DD MMM")+" - "+f.format("DD MMM");case"m":return m.format("MMMM YYYY");case"t":case"s":return m.format("MMM")+" - "+f.format("MMM")+" "+f.format("YYYY");case"y":return m.format("YYYY")}},g.displayCompact=function(){switch(g.currentInterval){case"d":return m.format("DD/MM/YY");case"w":return m.format("DD/MM")+" - "+f.format("DD/MM");case"m":return m.format("MMM YY");case"t":case"s":return m.format("MMM")+" - "+f.format("MMM")+" "+f.format("YYYY");case"y":return m.format("YYYY")}},g.navigate=function(a){if(0===a)return A(c(g.config.base),g.currentInterval),b();var t=o(g.currentInterval);a*="t"==g.currentInterval?3:"s"==g.currentInterval?6:1,m.add(a,t),f=l(g.currentInterval,m),b()},g.changeInterval=function(a){"p"==a?(g.currentInterval=a,g.custom.start=c(m),g.custom.end=c(f)):(A(u()?c(g.config.base):m,a),b())},g.reachedMin=function(){return!!g.config.min&&c(m).subtract(1,o(g.currentInterval)).isBefore(c(g.config.min),"days")},g.reachedMax=function(){return!!g.config.max&&c(f).add(1,o(g.currentInterval)).isAfter(c(g.config.max),"days")},g.intervals=t.filter((function(a){return g.config.restrict.indexOf(a.id)>-1})),g.getDate=function(){return c(m)},C(),g.custom={start:c(m),end:c(f),go:function(){m=c(g.custom.start),f=c(g.custom.end),p="p"!=r.interval?r.interval:p,b()},cancel:function(){g.currentInterval=p||r.interval,A(),b()},validate:function(){return g.custom.start&&g.custom.end&&(g.custom.end.isAfter(g.custom.start,"days")||g.custom.end.isSame(g.custom.start,"days"))}}}}])}(),function(){"use strict";function a(a,t){return{restrict:"A",require:"mdVirtualRepeatContainer",scope:{items:"=mdwCardVirtualRepeat",itemHeight:"=mdwItemHeight"},link:function(a,o,e,n){var r=angular.element(o),i=(angular.element(document.getElementById(e.mdwCardVirtualRepeat)),(parseInt(e.offsetTop,10)||0)+74),c=[];function s(){for(var o=r.parent(),e=0;o[0]!=document.body;)e+=parseInt(o.css("padding-top"),10)||0,e+=parseInt(o.css("padding-bottom"),10)||0,e+=parseInt(o.css("margin-top"),10)||0,e+=parseInt(o.css("margin-bottom"),10)||0,o=o.parent();var s=(c.length+1)*a.itemHeight,l=t.innerHeight-i-e;r.css("height",Math.min(l,s)+"px"),n.updateSize()}a.$watchCollection("items",(function(a){a&&(c=a,s())})),angular.element(t).bind("resize",s),a.$on("$destroy",(function(){angular.element(t).unbind("resize",s)}))}}}a.$inject=["$timeout","$window"],angular.module("md").directive("mdwCardVirtualRepeat",a)}(),function(){"use strict";angular.module("md").directive("mdwClipboard",(function(){return a.$inject=["$mdToast"],{restrict:"E",controller:a,controllerAs:"vm",bindToController:!0,link:function(a,t,o,e){if(!Clipboard)return void t.css("display","none");e.clip=new Clipboard(t.children()[0])},scope:{text:"="},template:'<md-button data-clipboard-text="{{vm.text}}" ng-show="vm.text" md-ink-ripple="false" class="md-icon-button"><md-icon>content_copy</md-icon></md-button>'};function a(a){var t=this;t.$postLink=function(){t.clip&&t.clip.on("success",(function(){a.showSimple("Texto copiado para área de transferência")}))},t.$onDestroy=function(){t.clip&&t.clip.destroy()}}}))}(),function(){"use strict";angular.module("md").component("mdwCountDownTimer",{bindings:{expiresAt:"<",onTimeout:"&"},template:"{{vm.format}}",controllerAs:"vm",controller:["$timeout",function(a){const t=this;function o(){if(t.stop)return;const e=-moment().diff(t.expiresAt,"seconds");if(e<=0)return t.format="00:00",void(t.onTimeout&&t.onTimeout());t.format=moment().startOf("day").add(e,"seconds").format("mm:ss"),a(o,1e3)}t.$onInit=function(){o()},t.$onDestroy=function(){t.stop=!0}}]})}(),function(){"use strict";angular.module("md").directive("mdwCurrency",(function(){return a.$inject=["$scope","$filter","cadastrosDatasource","moedaService"],{restrict:"A",controller:a,controllerAs:"vm",link:function(a,t,o){a.format=angular.isUndefined(o.format)||!0===o.format},scope:{valor:"=mdwCurrency",mask:"@mask",abs:"=?abs",fraction:"=fraction",style:"=?mdwStyle",conta:"=?",moeda:"=?",invert:"=?"},template:"<div ng-class='vm.classe' ng-style='vm.style'>{{vm.exibicao}}</div>"};function a(a,t,o,e){var n=this;function r(){n.mask||(a.mask?"auto"==a.mask?n.mask=t("moeda")(e.moeda)+" ":n.mask=a.mask+" ":n.mask="",i())}function i(){n.exibicao=null!==n.valor?t("currency")(n.valor,n.mask,n.fraction):"-"}n.mask="",n.abs=!0===a.abs,n.style=!1===a.style?{}:{"text-align":"right"},n.invert=!0===a.invert,n.fraction=a.fraction?a.fraction:2,n.$onInit=r,i(),a.$watch("valor",(function(t){var o=t;if(angular.isUndefined(o)||null===o||!1===o||!isFinite(o)||isNaN(o))n.valor=null;else{var e=Math.pow(10,-(n.fraction+1));Math.abs(o)<e&&(o=0),a.format&&!n.abs&&(n.classe=o>0?"positivo":o<0?"negativo":""),n.valor=n.abs?Math.abs(o):o,n.invert&&(n.valor*=-1)}i()})),a.$watch("conta",(function(a){if(!a)return r();var e=o.get("contas",a,!0);n.mask=t("moeda")(e.moeda)+" ",i()})),a.$watch("moeda",(function(a){if(!a)return r();n.mask=t("moeda")(a)+" ",i()}))}}))}(),function(){"use strict";angular.module("md").directive("mdwData",(function(){return a.$inject=["$scope","$attrs","mdwMoment","cadastrosDatasource"],{restrict:"A",controller:a,controllerAs:"vm",scope:{l:"=mdwData",format:"@",formatToday:"=?"},template:"<div class='data'  ng-class='vm.classe' >{{vm.data}}</div>"};function a(a,t,o,e){var n=this,r=o(),i=!angular.isDefined(a.formatToday)||a.formatToday;function c(c,s){if(c){var l=a.format||"DD/MM/YY",u="pendente"==a.l.status,d=void 0!==t.competenciaCartao,m="co"===a.l.regime,f=a.l.data,p=u&&!m?a.l.dataPrevista:a.l.data;if(d)"CARTAOCREDITO"==e.get("contas",a.l.conta,!0).tipo&&a.l.dataCompetencia&&(f=p=a.l.dataCompetencia);var v=n.isToday=i&&!u&&r.isSame(f,"day");n.data=v?"hoje":o(p).format(l),n.classe=v?"hoje":""}}a.$watch("l.data",c),a.$watch("l.dataPrevista",c)}}))}(),function(){"use strict";function a(a){return{restrict:"A",priority:3,require:"ngModel",link:function(t,o,e,n){angular.element(o).attr("autocomplete","off"),o.on("keydown",(function(t){if("Tab"==t.code){var o=n.$viewValue;if(o.match(/^\d{2}\/\d{2}$/))o+="/"+a().format("YYYY"),a(o,"DD/MM/YYYY").isValid()&&(n.$setViewValue(o),n.$render())}})),n.$parsers.unshift((function(a){if(n.$isEmpty(a))return a;var t=function(a){for(var t=String(a).replace(/[^0-9.]/g,""),o="",e=0;e<t.length;e++)o+=t[e],1!=e&&3!=e||(o+="/");return o.replace(/\/$/,"")}(a);return n.$viewValue!==t&&(n.$setViewValue(t),n.$render()),t})),n.$parsers.push((function(t){if(n.$isEmpty(t))return t;var o=a(t,"DD/MM/YYYY");return o.isValid()?o:void 0}))}}}a.$inject=["moment"],angular.module("md").directive("mdwDateFormat",a)}(),function(){"use strict";function a(a,t,o){return e.$inject=["$mdDialog"],{restrict:"E",transclude:!0,template:function(a,t){var o=['<div layout="row" layout-align="start center" class="mdw-dialog-header">'];return angular.isUndefined(t.back)&&1!=t.back||(o=o.concat(['<md-button class="md-icon-button" ng-click="vm.dismiss()">',"<md-icon>arrow_back</md-icon>","</md-button>"])),o.push("<div ng-transclude></div>"),angular.isUndefined(t.dismiss)&&1!=t.dismiss||(o=o.concat(["<span flex></span>",'<md-button class="md-icon-button" ng-click="vm.dismiss()">',"<md-icon>close</md-icon>","</md-button>"])),o.push("</div>"),o.join("")},controller:e,controllerAs:"vm",scope:{}};function e(a){this.dismiss=a.cancel}}function t(a,t,o){return e.$inject=["$scope","$sce","mdwApiError"],{restrict:"E",transclude:!0,require:"mdwDialogActions",template:function(a,t){return['<div ng-if="!error" flex layout="row" layout-align="end center" class="mdw-dialog-actions" ng-transclude></div>','<div ng-if="!!error" flex layout="row" layout-align="start center" >','<div flex ng-bind-html="error"></div>','<md-button class="md-icon-button" ng-click="vm.dismissError()">',"<md-icon>close</md-icon>","</md-button>","</div>"].join("")},controller:e,controllerAs:"vm",link:function(a,t,o,e){var n=angular.element(t);a.$watch("error",(function(a){a?n.addClass("error"):n.removeClass("error")}))},scope:{}};function e(a,t,o){a.$on("$destroy",o.addObserver((function(o){var e;angular.isObject(o.data)?(e=o.data.message,o.data.url&&(e+=' <a target="_blank" href="'+o.data.url+'" class="link-light-blue">(Saiba mais)</a>')):e=o.data;a.error=t.trustAsHtml(e)}))),this.dismissError=function(){a.error=null}}}function o(a){var t=!1;return function(){if(!t)return t=!0,a.show({replace:!0,id:"dialog-loading",controller:angular.noop,escapeToClose:!1,controllerAs:"vm",template:['<md-dialog style="background-color:transparent;box-shadow:none;overflow: hidden" id="dialog-loading">','<div layout="row" layout-sm="column" layout-align="center center" aria-label="wait">','<md-progress-circular md-mode="indeterminate" ></md-progress-circular>',"</div>","</md-dialog>"].join("")}).finally((function(){t=!1}))}}a.$inject=["$window","$state","$previousState"],t.$inject=["$window","$state","$previousState"],o.$inject=["$mdDialog"],angular.module("md").factory("mdwDialogLoading",o).directive("mdwDialogHeader",a).directive("mdwDialogActions",t).component("mdwDialogLoading",{template:'<div class="mdw-dialog-loading" style=" position: absolute; z-index: 999" layout="column" layout-fill layout-align="center center"><md-progress-circular md-mode="indeterminate" class="md-primary" md-diameter="96" ></md-progress-circular></div>'})}(),function(){"use strict";angular.module("md").directive("mdwIndeterminate",(function(){return{restrict:"A",link:function(a,t){t.prop("indeterminate",a.mdwIndeterminate),a.$watch("mdwIndeterminate",(a=>{t.prop("indeterminate",a)}))},scope:{mdwIndeterminate:"="}}}))}(),function(){"use strict";angular.module("md").directive("mdwLogin",(function(){return a.$inject=["$scope","usuariosService"],{template:"{{vm.email}}",scope:{idLogin:"=mdwLogin"},controller:a,controllerAs:"vm",restrict:"A"};function a(a,t){var o=this;o.idLogin=a.idLogin,t.getLogin(o.idLogin).then((function(a){o.email=a.email}))}}))}(),function(){"use strict";function a(a,t){var o=this;o.moeda=t.moeda,o.$onChanges=function(t){var e=t.conta&&t.conta.currentValue;if(e){var n=a.get("contas",e,!0);o.moeda=n.moeda}}}a.$inject=["cadastrosDatasource","moedaService"],angular.module("md").component("mdwMoeda",{bindings:{conta:"<"},template:"{{$ctrl.moeda | moeda}}",controller:a})}(),function(){"use strict";function a(a,t,o,e,n,r,i){var c,s=this,l={};s.moedas=[],s.moeda=null,s.disabled=!1,s.hidden=!0;var u=o("/cadastros/contas/moedas"),d=o("/api/v2/investimentos/rate");function m(){return e.carregar("contas").then((function(a){l={},s.moedas=[],a.forEach((function(a){if(a.status&&"CARTEIRA_INVEST"!=a.tipo){var t=a.moeda;l[t]||(l[t]=!0,s.moedas.push(t))}})),s.moedas.sort((function(a,t){return a==r.utilizacao.moeda?-1:t==r.utilizacao.moeda?1:a-t})),c=void 0,s.moeda=f()}))}function f(){var a=r.getConfig("moeda",{m:r.utilizacao.moeda}).m;return l[a]?a:s.moedas[0]}s.disponiveis=[],e.addObserver("contas",(function(){null,m()})),s.init=function(){return m()},s.loadRate=function(a){var o=r.utilizacao.moeda||1;return a==o?t.when(0):d.get({from:a,to:o}).then((function(a){return a.rate}))},s.carregarDisponiveis=function(){return u.get().then((function(a){s.disponiveis=a}))},s.getChartCurrencyFormat=function(a){return a=a||s.moeda,i("moeda")(a)+" #,##0.00"},s.isDefaultActivated=function(){return!s.moeda||r.utilizacao.moeda==s.moeda},s.disable=function(a){s.disabled=!0,s.moeda=a||r.utilizacao.moeda,s.disabledDefault=!a,s.show(!0)},s.hide=function(){s.moeda&&(c=s.moeda),s.moeda=void 0,s.hidden=!0},s.show=function(a){!s.moeda&&c&&(s.moeda=c),s.hidden=s.moedas.length<=1,a||(s.disabled&&(s.moeda=f()),s.disabled=!1)},s.updateConfig=function(){return r.updateConfig("moeda",{m:s.moeda})},s.getNumContas=function(){return e.carregar("contas").then((function(a){var t=0;return a.forEach((function(a){a.status&&"CARTEIRA_INVEST"!=a.tipo&&a.moeda!=r.utilizacao.moeda&&t++})),t}))},s.alterarMoedaPadrao=function(t){return a.post("usuarios/alterarMoeda",t,{handleErrors:!1}).then((function(a){var o=a.data;r.utilizacao.moeda=t.moeda,o&&o.forEach((function(a){e.get("contas",a,!0).moeda=t.moeda})),n.validarPlanoAtual(!0)}))},s.atualizarMoedasUtilizadas=function(){m()}}a.$inject=["$http","$q","mdwCache","cadastrosDatasource","usuariosService","configuracoesService","$filter"],angular.module("md").service("moedaService",a)}(),function(){"use strict";function a(a,t){var o=this;function e(){o.showRate&&(o.rate=0,a.loadRate(o.moeda).then((function(a){o.rate=a})))}o.moedas=[],o.iconStyle={},o.btnStyle={},o.showRate=void 0!==t.showRate,o.$onInit=function(){if(o.moedas=a.disponiveis.map((function(a){return a.id})),o.size){var t=parseInt(o.size),n=o.size+"px",r=t-24+40+"px";o.iconStyle={width:n,height:n,"font-size":n},o.btnStyle={width:r,height:r,"line-height":n}}e()},o.selectMoeda=function(a){o.moeda=a,o.onChange({moeda:a}),e()}}a.$inject=["moedaService","$attrs"],angular.module("md").component("mdwMoedaSelector",{bindings:{moeda:"<",onChange:"&",size:"@"},templateUrl:"/partials/directives/mdwMoeda/selector/mdwMoedaSelector.html",controller:a})}(),function(){"use strict";function a(a,t){var o=this;o.svc=a,o.selectMoeda=function(e){o.svc.moeda=e,a.updateConfig().then((function(){t.reload()}))}}a.$inject=["moedaService","$state"],angular.module("md").component("mdwMoedaToggler",{templateUrl:"/partials/directives/mdwMoeda/toggler/mdwMoedaToggler.html",controller:a})}(),function(){"use strict";function a(a){return function(t){return new function(t){var o=this;function e(){return o.pageSize?Math.ceil(t.getTotal()/o.pageSize):0}o.currentPage=t.page,o.pageSize=t.pageSize,o.fetch=function(a){return t.onFetch.call(o,a||o.currentPage)},o.nPages=e,o.iterate=function(n){var r,i=a.defer(),c=0;return e()>0&&(r=e()),function s(){if(c++,!angular.isUndefined(r)&&c>r)return i.resolve(),void t.onCompleteIterate.call(o);t.onIterate(c).then((function(){r=e(),a.when(n.call(o,c)).then(s)}))}(),i.promise},o.total=function(){return t.getTotal()}}(angular.extend({pageSize:10,page:1,getTotal:function(){},onFetch:function(a,t){},onIterate:function(a){},onCompleteIterate:function(){}},t))}}a.$inject=["$q"],angular.module("md").directive("mdwPaginator",(function(){return a.$inject=["$timeout","$q"],{templateUrl:"/partials/directives/mdwPaginator/paginator.html",require:"mdwPaginator",restrict:"E",scope:{paginator:"="},controller:a,link:function(){},controllerAs:"vm",bindToController:!0};function a(a,t){var o=this;o.loading={},o.getPages=function(){if(!o.paginator)return 0;for(var a=[],t=1;t<=o.paginator.nPages();t++)a.push(t);return a},o.go=function(a){o.paginator.currentPage!=a&&t.when(o.paginator.fetch(a),(function(){o.paginator.currentPage=a,o.loading[a]=!1}))}}})).factory("mdwPaginator",a)}(),function(){"use strict";angular.module("md").directive("mdwPercent",(function(){return a.$inject=["$scope","$filter"],{restrict:"A",require:"mdwPercent",controller:a,controllerAs:"vm",bindToController:!0,scope:{valor:"=mdwPercent",mdwClass:"@",abs:"=?abs"},template:"<span ng-class='vm.classe'>{{vm.print}}</span>",link:function(a,t,o,e){e.styleEnabled=angular.isDefined(o.applyStyle),e.dashZero=angular.isDefined(o.dashZero)}};function a(a,t){var o=this;o.abs=!0===a.abs,a.$watch("vm.valor",(function(a){o.classe=[],o.mdwClass&&o.classe.push(o.mdwClass);const e=o.dashZero&&Math.abs(a)<1e-5;o.print=angular.isUndefined(a)||null===a||!isFinite(a)||isNaN(a)||e?"-":function(a){o.abs&&(a=Math.abs(a));return t("number")(100*a,2)+"%"}(a),o.styleEnabled&&!o.abs&&o.classe.push(a>0?"positivo":a<0?"negativo":"")}))}}))}(),function(){"use strict";function a(a,t,o,e,n,r,i){this.openPrintDialog=function(c,s){var l,u=r.defer(),d=angular.element('<div class="mdw-print-backdrop"></div>'),m=angular.element('<div class="mdw-print-contents"></div>'),f=angular.element('<div class="mdw-print-actions"></div>'),p=angular.element('<div layout="row" layout-align="start center" class="contents"></div>'),v=angular.element('<button class="md-button"><md-icon>close</md-icon>Fechar</button>'),g=angular.element("<div flex></div>"),h=angular.element('<button class="md-button md-primary md-raised">Imprimir</button>'),C=document.getElementsByTagName("head")[0];s.landscape&&(m.addClass("landscape"),(l=document.createElement("style")).type="text/css",l.innerHTML="@page {size: landscape}",C.appendChild(l));p.append(v),p.append(g),p.append(h),f.append(p),d.append(m),d.append(f),angular.element(document.body).prepend(d),n((function(){i.handlePrint()})),v.bind("click",$),h.bind("click",(function(a){window.print()})),angular.element(window).bind("keyup",D);var b=c.$new(),A=t(s.controller,{$scope:b});if(A.$onInit&&A.$onInit(),b.vm=A,d.children().data("$ngControllerController",A),s.templateUrl){M('<div flex layout="column" layout-align="start center" ng-cloak><md-progress-circular style="margin-top: 50px;"  mode="indeterminate"></md-progress-circular><p>{{vm.carregando}}</p></div>');var x=o.get(s.templateUrl,{cache:e}).then((function(a){return a.data})),S=s.paginate&&s.paginate();S?S.iterate((function(a){b.vm.carregando="Carregando página "+a+" de "+S.nPages()})).then((function(){b.vm.carregando="Preparando exibição...",n((function(){x.then(M)}))})):x.then(M)}else M(s.template);return u.promise;function D(a){27==a.keyCode&&$()}function $(){l&&C.removeChild(l),angular.element(window).unbind("keyup",D),n((function(){i.handlePrint(),d.remove(),u.resolve()}))}function M(t){t&&m.html(t),a(d.contents())(b)}}}function t(a){return t.$inject=["mdwPrintService"],{require:"mdwPrintBtn",scope:{config:"=mdwPrintBtn"},controller:t,controllerAs:"vm",bindToController:!0,link:function(a,t,o,e){angular.element(t).bind("click",(function(){e.service.openPrintDialog(a,e.config)}))}};function t(a){this.service=a}}t.$inject=["mdwPrintService"],a.$inject=["$compile","$controller","$http","$templateCache","$timeout","$q","mdwDarkModeService"],angular.module("md").service("mdwPrintService",a).directive("mdwPrintBtn",t)}(),function(){"use strict";function a(a,t){var o={};if(a.dataConciliacao)o.termo="C",o.classe="Conciliado";else if(a.dataEfetiva)o.termo="C",o.classe="Confirmado";else{var e=t(),n=t(a.dataPrevista);n.isSame(e,"day")?(o.termo="A",o.classe="Hoje"):n.isBefore(e,"day")?(o.termo="P",o.classe="Pendente"):(o.termo="A",o.classe="Agendado")}return o}angular.module("md").directive("mdwStatusLancamentoAvatar",(function(){return t.$inject=["$scope","moment"],{restrict:"A",controller:t,scope:{lancamento:"=mdwStatusLancamentoAvatar"},template:"<span class='mdw-avatar lancamento-status' ng-class='classe' tooltip-placement='right'>{{termo}}</span>"};function t(t,o){var e=a(t.lancamento,o);t.termo=e.termo,t.classe=e.classe}})).directive("mdwStatusLancamentoBadge",(function(){return t.$inject=["$scope","moment"],{restrict:"A",controller:t,scope:{lancamento:"=mdwStatusLancamentoBadge"},template:"<span class='lancamento-status-badge' ng-class='classe' tooltip-placement='right'>{{termo}}</span>"};function t(t,o){var e=a(t.lancamento,o);t.classe=e.classe,t.termo=e.termo}}))}(),function(){"use strict";function a(a,t,o,e){return function(n,r,i){var c=angular.element(a),s=!1,l=o.current.name;i=angular.extend({ignoreStates:[]},i||{}),c.bind("beforeunload",d),n.$on("$destroy",m);var u=t.onBefore({},(function(a){var t=a.$to();if(!(r&&!r()||s)&&-1==i.ignoreStates.indexOf(t.name)&&t.name!=l)return s=!0,e.show({id:"confirm-naviagation",templateUrl:"/partials/directives/mdwUnloadChecker/confirmNavigation.html",controllerAs:"vm",controller:function(){this.dismiss=e.cancel,this.ok=function(){return m(),e.cancel(),!0}}}).catch((function(){return!1})).finally((function(){s=!1}))}));function d(a){if(!r||r()){var t="Sure you want to leave?";return void 0===a&&(a=c.event),a&&(a.returnValue=t),t}}function m(){c.unbind("beforeunload",d),u()}return m}}a.$inject=["$window","$transitions","$state","$mdDialog"],angular.module("md").factory("mdwUnloadChecker",a)}(),function(){"use strict";function a(a,t){return["$window",function(o){return{restrict:"A",require:[a,t],scope:{count:"="+a,itemHeight:"=",offset:"=?",bindHeight:"=?",bindMaxHeight:"=?"},link:function(a,t,e,n){var r=n[0],i=n[1],c=t[0].getBoundingClientRect().top;function s(){var a=r.count*r.itemHeight,o=window.innerHeight-c-r.offset-1,e=Math.min(o,a);t.css("height",e+"px"),r.bindHeight=e,r.bindMaxHeight=o,i&&i.updateSize()}a.$watch("vm.count",(function(a){angular.isUndefined(a)||s()})),a.$watch((function(){return Math.ceil(t[0].getBoundingClientRect().top||0)}),(function(a){c=a,s()})),angular.element(o).bind("resize",s),a.$on("$destroy",(function(){angular.element(o).unbind("resize",s)}))},controller:function(){var a=this;a.$onInit=function(){a.offset=a.offset||0}},controllerAs:"vm",bindToController:!0}}]}angular.module("md").directive("mdwVirtualRepeatHeight",a("mdwVirtualRepeatHeight","mdVirtualRepeatContainer")).directive("mdwListHeight",a("mdwListHeight"))}(),function(){"use strict";angular.module("md").directive("mdwWatchChange",(function(){return a.$inject=["$scope","$timeout"],{restrict:"A",scope:{obj:"=mdwWatchChange",changed:"=on"},controller:a};function a(a,t){a.changed=!1,t((function(){var t=angular.toJson(angular.copy(a.obj));a.$watch("obj",(function(o){a.changed=t!=angular.toJson(o)}),!0)}))}}))}(),function(){function a(a){return{template:'<div class="base" ng-class="vm.progressClass"><div class="progress" ng-style="vm.progress"><span ng-if="vm.razao >= 0 && vm.showPercent">{{vm.razao * 100 | number : 2}}%</span></div></div>',require:"mdwPgbar",scope:{razao:"=",cor:"="},bindToController:!0,controllerAs:"vm",controller:["$scope",function(a){var t=this;function o(){if(angular.isDefined(t.razao)&&t.razao>=0){var a=Math.min(100*Math.abs(t.razao),100);t.progressClass=100==a?"full":a<30?"b20":"",t.progress={width:0,backgroundColor:t.cor},t.progress.width=(a||0)+"%"}}o(),a.$watch("vm.razao",o),a.$watch("vm.cor",o)}],link:function(a,t,o,e){e.showPercent=!angular.isDefined(o.hidePercent)}}}function t(a){return{template:'<div class="base" ng-style="vm.style"><span ng-style="{color : vm.corText}">{{vm.showPercent ? (vm.razao * 100 | number : 2) + "%" : ""}}</span></div>',scope:{razao:"=",cor:"="},bindToController:!0,controllerAs:"vm",controller:["$scope",function(a){var t=this;function o(){t.razao||(t.razao=0),t.corText=t.razao>0?t.cor:"#ccc";var a,o,e=Math.min(Math.round(360*Math.abs(t.razao)),360);o=90+(360==(a=e)?180:a%180),t.style={backgroundImage:a<180?"linear-gradient("+o+"deg, transparent 50%, #f6f6f6 50%), linear-gradient(90deg, #f6f6f6 50%, "+t.cor+" 50%)":"linear-gradient(90deg, transparent 50%, "+t.cor+" 50%), linear-gradient("+o+"deg, #f6f6f6 50% , "+t.cor+" 50%)"}}a.$watch("vm.razao",o),a.$watch("vm.cor",o),o()}],link:function(a,t,o,e){e.showPercent=!angular.isDefined(o.hidePercent)}}}a.$inject=["$timeout"],t.$inject=["$timeout"],angular.module("md").directive("mdwPgbar",a).directive("mdwPgbarCircular",t)}(),function(){"use strict";function a(a,t,o){var e=this;e.documentos=[],e.checkboxes=[],e.selected=[],e.dismiss=a.cancel,e.errors=[];var n={};function r(){e.loading=!0,o.search(e.search).then((function(a){e.loading=!1,e.documentos=a}))}e.uploader={onErrorMessage:function(a){e.errors.push(a)},onSuccess:function(a){a&&a.forEach((function(a){n[a.id]=!0}))}},t.$on("$destroy",o.addObserver(r)),r(),e.anexar=function(){a.hide(e.selected)},t.$watch("vm.search",r),t.$watchCollection("vm.documentos",(function(a){a&&(e.checkboxes=[],e.selected=[],a.forEach((function(a){n[a.id]?(e.checkboxes.push(a.id),e.selected.push(a.id)):e.checkboxes.push(!1)})))})),e.onSelect=function(){e.selected=e.checkboxes.filter((function(a){return!1!==a})),n={},e.selected.forEach((function(a){n[a]=!0}))}}a.$inject=["$mdDialog","$scope","documentosDatasource"],angular.module("md").controller("AnexarDocumentoController",a)}(),function(){"use strict";function a(a,t,o,e,n,r){var i=this;o.title="Documentos",i.labelMes=moment().format("MMMM YYYY"),i.uploader={onErrorMessage:function(a){alert(a)}},i.service=e.vm,i.ds=n,i.onChangeConta=function(){if(null!==i.service.conta){0==i.service.conta&&(i.service.conta=null);var a=i.service.filtrarPorLancamentoMes?moment(i.service.dataLancamento).format("YYYY-MM"):i.service.mes;t.go("documentos.listar",{mes:a,mesLancamento:i.service.filtrarPorLancamentoMes,conta:i.service.conta})}},a.$watch("vm.service.conta",i.onChangeConta),i.onChangeMes=function(){var a=i.service.filtrarPorLancamentoMes?moment(i.service.dataLancamento).format("YYYY-MM"):i.service.mes;t.go("documentos.listar",{mes:a,mesLancamento:i.service.filtrarPorLancamentoMes,conta:i.service.conta})},i.onChangeFiltro=function(){"1"!==i.service.filtro&&("2"==i.service.filtro?conta=i.service.conta:i.service.filtrarPorLancamentoMes=0,t.go("documentos.listar",{mes:i.mes,mesLancamento:i.service.filtrarPorLancamentoMes,conta:i.service.conta}))},e.vm.init()}function t(a,t,o,e,n,r,i,c,s){var l=this;function u(){return i.carregarDocumentos(l.mes,l.mesLancamento,l.conta).then((function(a){l.service.mes=l.mes,l.loading=!1}))}function d(a){return n.show({id:"compartilhar-documento",templateUrl:"/partials/documentos/compartilhar.html",controllerAs:"vm",bindToController:!0,locals:{ids:a},controller:["$mdToast",function(t){var o=this;function e(){o.intervalOptions=[];const a=a=>{const t=[];for(let o=1;o<=a;o++)t.push(o);return t};1==o.intervalo&&(o.intervalOptions=a(59)),60==o.intervalo&&(o.intervalOptions=a(23)),1440==o.intervalo&&(o.intervalOptions=a(30))}o.intervalo=1440,o.duracao=10,o.onChangeIntervalo=e,o.$onInit=e,o.ok=function(){return i.compartilhar({ids:a,expiration:o.intervalo*o.duracao}).then((function(a){(o.acesso=a,Clipboard)&&new Clipboard(".link-shared-credential-btn").on("success",(function(){t.showSimple("Copiado para área de transferência")}))}))},o.enviarEmail=function(){return i.enviarEmailLink(o.acesso.id,{email:o.dados.email,senha:o.acesso.senha}).then((function(){n.hide()}))},o.dismiss=function(){n.hide()}}]})}function m(){var a=0;return angular.forEach(l.checkboxes,(function(t){t&&a++})),a}l.service=i.vm,l.ds=s,l.filtrarDocumentos=function(a){switch(l.service.filtro){case"1":return a.vinculos&&a.vinculos.some((function(a){return"l"==a.tipo}));case"2":return a.vinculos&&a.vinculos.some((function(a){return"c"==a.tipo}));case"3":return a.vinculos&&a.vinculos.some((function(a){return"o"==a.tipo}));case"4":return!a.vinculos||0==a.vinculos.length}return!0},l.compartilhar=function(a){return d([a.id])},l.compartilharSelecionados=function(){var a=[];return angular.forEach(l.checkboxes,(function(t,o){t&&a.push(o)})),d(a)},l.removerSelecionados=function(a){var t=[];return angular.forEach(l.checkboxes,(function(a,o){t.push(o)})),n.show(n.confirm().textContent("Confirma a exclusão de "+t.length+" documentos selecionados?").ok("Excluir").cancel("Cancelar")).then((function(){return i.excluirLote(t)}))},l.remover=function(a){return n.show(n.confirm().textContent("Confirma a exclusão do documento: "+o("nomeDocumento")(a)+" ?").ok("Excluir").cancel("Cancelar")).then((function(){return i.excluir(a)}))},l.countSelecionados=m,l.desmarcarTodos=function(){l.checkboxes={}},l.marcarTodos=function(){l.ds.documentos[l.mes].forEach((function(a){l.checkboxes[a.id]=!0}))},a.$watch("vm.checkboxes",(function(){m()>0?r.changeTemplateUrl("/partials/documentos/acoesLoteTopmenu.html",l):r.changeTemplateUrl()}),!0),a.$on("$destroy",s.addObserver((function(){l.service.init().then((function(a){a!=l.mes?t.go("documentos.listar",{mes:a,mesLancamento:l.service.filtrarPorLancamentoMes,conta:l.conta}):u()}))}))),function(){l.checkboxes={},l.loading=!0,l.service.mes=l.mes=e.mes,l.mesLancamento=e.mesLancamento,l.conta=e.conta,"1"==l.mesLancamento?(l.service.filtrarPorLancamentoMes=1,l.service.filtro="1",l.service.dataLancamento=moment(l.mes)):(l.service.filtrarPorLancamentoMes=0,l.service.dataLancamento=moment(l.mes));if(!l.mes)return l.service.init().then((function(a){t.go("documentos.listar",{mes:l.service.mes||a,mesLancamento:l.service.filtrarPorLancamentoMes,conta:l.conta})}));u()}()}a.$inject=["$scope","$state","mdwTopmenu","documentosService","documentosDatasource","usuariosService"],t.$inject=["$scope","$state","$filter","$stateParams","$mdDialog","mdwTopmenu","documentosService","cadastrosDatasource","documentosDatasource"],angular.module("md").controller("DocumentosListarController",t).controller("DocumentosController",a)}(),function(){"use strict";function a(a){a.define("documentos","/documentos/:id")}function t(a,t,o,e,n,r){var i=this,c=a("/documentos/meses"),s=a("/documentos/:id"),l=a("/documentos"),u=a("/documentos/utilizacao"),d=t();function m(a){c.reset(),s.reset(),l.reset(),u.reset(),d.notify(a)}r.addObserver(m),o("documentos",m),i.meses=[],i.documentos={},i.init=function(){return c.get("").then((function(a){i.contas=n.get("contas",null,!0).filter((function(a){return!!a.permissoes.visivel})),i.meses=a,i.meses.sort((function(a,t){return t>a?1:-1}))}))},i.load=function(a,t,o){return s.get({anoMes:a,mesLancamento:t,conta:o}).then((function(t){i.documentos[a]=t}))},i.search=function(a){return l.get({nome:a})},i.get=function(a){return s.get({id:a})},i.utilizacao=function(a){return u.get().then((function(a){return a.utilizacao}))},i.addObserver=d.add,i.carregarDocumentosContato=function(a){return e.get("/documentos/contato/"+a).then((function(a){return a.data}))},i.excluirLote=function(a){return e.post("/documentos/excluirLote",{ids:a}).then((function(){return m()}))}}a.$inject=["mdwResourceProvider"],t.$inject=["mdwCache","mdwObserver","mdwResourceObserver","$http","cadastrosDatasource","lancamentosDatasource"],angular.module("md").config(a).service("documentosDatasource",t)}(),function(){"use strict";t.$inject=["$filter"];var a=angular.module("md");function t(a){return function(t){return t.tamanho<1e3?t.tamanho+" bytes":t.tamanho>1e3&&t.tamanho<1e6?a("number")(t.tamanho/1024,2)+" Kb":a("number")(t.tamanho/1048576,2)+" Mb"}}a.filter("nomeDocumento",(function(){return function(a){if(!a.url)return"";var t=a.url.lastIndexOf("/")+1;return a.url.substr(t)}})),a.filter("tamanhoDocumento",t)}(),function(){"use strict";function a(a,t){t.state({id:"documentos",title:"Documentos",templates:["documentos/documentos.html"]},{url:"/documentos",abstract:!0,templateUrl:"partials/documentos/documentos.html",controller:"DocumentosController",controllerAs:"vm",data:{permmd:"outros.documentos"}}),a.state("documentos.listar",{url:"?mes&mesLancamento&conta",controller:"DocumentosListarController",controllerAs:"vm",templateUrl:"partials/documentos/listar.html"})}a.$inject=["$stateProvider","mdwBaseStateProvider"],angular.module("md").config(a)}(),function(){"use strict";function a(a,t,o,e,n,r){var i=e("documentos");return{create:function(a){return i.insert(a).then((function(a){return t.showSimple("Documento criado"),a}))},anexar:function(){return n.dialogPlano("anexos",(function(){return o.show({id:"anexar-documentos",controller:"AnexarDocumentoController",controllerAs:"vm",templateUrl:"/partials/documentos/anexar.html"})}))},s3Credentials:function(){return a.get("/apiweb/s3credentials").then((function(a){return a.data}))},excluir:function(a){return i.delete(a).then((function(a){t.showSimple("Documento excluído")}))},carregarDocumentos:function(a,t,o){return r.load(a,t,o)},compartilhar:function(o){return a.post("/api/v2/documentos/compartilhar",o).then((a=>(t.showSimple("Link gerado com sucesso"),a.data)))},excluirLote:function(a){return r.excluirLote(a)},enviarEmailLink:function(o,e){return a.post("/api/v2/documentos/emailLink/"+o,e).then((function(){t.showSimple("Email enviado com sucesso")}))},vm:new function(){var a=this;function t(){return r.utilizacao().then((function(t){a.totalDocs>0&&(a.razaoUtilizacao=t/a.totalDocs,a.cor=a.razaoUtilizacao>.7?"#f79483":a.razaoUtilizacao>1?"#f7ea83":"#7fce7a")}))}a.loading=!0,a.filtro=0,a.conta=null,a.init=function(){return t(),r.init().then((function(){return a.loading=!1,r.meses[0]}))},a.carregarUtilizacao=t,a.filtrarPorConta=!1,a.filtrarPorLancamentoMes=0,a.dataLancamento=moment(),a.totalDocs=n.usuario.plano.permissoes.anexos}}}a.$inject=["$http","$mdToast","$mdDialog","mdwResource","usuariosService","documentosDatasource"],angular.module("md").factory("documentosService",a)}(),function(){"use strict";angular.module("md").directive("mdwDocumentosFileUploader",(function(){return a.$inject=["FileUploader","documentosService","documentosDatasource","usuariosService"],{restrict:"E",controller:a,controllerAs:"vm",bindToController:!0,scope:{config:"="},template:function(a,t){return angular.isUndefined(t.fab)?['<div aria-label="menu" class="md-icon-button md-button md-ink-ripple" ng-if="vm.verificado && vm.canUpload">',"<md-tooltip >Carregar a partir do computador</md-tooltip>","<md-icon >file_upload</md-icon>",'<input type="file" class="fileInput" nv-file-select uploader="vm.uploader" multiple/>',"</div>",'<md-button aria-label="menu" class="md-icon-button" ng-if="vm.verificado && !vm.canUpload" ng-click="vm.errorBasico()">',"<md-tooltip >Carregar a partir do computador</md-tooltip>","<md-icon >file_upload</md-icon>","</md-button>"].join(""):['<div aria-label="menu" class="md-fab md-fab-bottom-right md-accent ui-view-container-fab md-button md-ink-ripple" >',"<md-icon >file_upload</md-icon>",'<input type="file" class="fileInput" nv-file-select uploader="vm.uploader" multiple/>',"</div>",'<md-button aria-label="menu" class="md-fab md-fab-bottom-right md-accent ui-view-container-fab" ng-if="vm.verificado && !vm.canUpload"  ng-click="vm.errorBasico()">',"<md-icon >file_upload</md-icon>","</md-button>"].join("")}};function a(a,t,o,e){var n=this;n.canUpload=e.planoGetAnexos()>0,n.verificado=!n.canUpload,n.verificado||o.utilizacao().then((function(a){n.canUpload=a<e.usuario.plano.permissoes.anexos,n.verificado=!0})),n.errorBasico=function(){return e.dialogPlanoAnexos()};var r,i=n.uploader=new a({url:"/",autoUpload:!1,withCredentials:!0}),c=[];function s(){n.config.uploading=!1,n.config.progress=0,n.config.onFail()}n.$onInit=function(){n.config=angular.extend({uploading:!1,progress:0,onFail:function(){},onSuccess:function(a){},onErrorMessage:function(a){}},n.config)},i.onAfterAddingFile=function(a){if(a.file.name.length>90)return n.config.onErrorMessage("O nome do arquivo deve ter menos de 90 caracteres: "+a.file.name),void i.removeFromQueue(a);if(a.file.size>104857600)return n.config.onErrorMessage("O tamanho do arquivo não deve ultrapassar 100Mb"),void i.removeFromQueue(a);a.mdCustomData={},n.config.uploading=!0,(r=r||t.s3Credentials()).then((function(t){var o=a.file.name;-1!=o.indexOf(",")&&(o=encodeURIComponent(o));var e=t.credentials;a.mdCustomData.url=t.url,a.mdCustomData.key=t.key+"/"+o,a.url=t.url,a.formData=[angular.extend({},e,{key:a.mdCustomData.key,"Content-Type":a.file.type})],a.upload()}),s)},i.onSuccessItem=function(a){t.create({url:a.mdCustomData.url+"/"+a.mdCustomData.key,tamanho:a.file.size}).then((function(a){c.push(a),c.length==i.queue.length&&n.config.onSuccess(c)}),s)},i.onProgressAll=function(a){n.config.progress=a},i.onCompleteAll=function(){n.config.progress=0,n.config.uploading=!1},i.onErrorItem=s}}))}(),function(){"use strict";var a=angular.module("md");a.component("mdwAttachButton",{template:'<md-button mdw-func-perm-v="outros.documentos" class="md-icon-button" ng-autodisable ng-class="{\'active\' : $ctrl.model.anexos.length > 0}" ng-click="$ctrl.anexarDocumentos()"><span class="badge count-badge">{{$ctrl.model.anexos.length}}</span><md-tooltip md-direction="top">Anexar documentos</md-tooltip><md-icon>attach_file</md-icon></md-button>',bindings:{model:"=ngModel"},controller:["documentosService",function(a){var t=this;t.$onInit=function(){},t.anexarDocumentos=function(){return a.anexar().then((function(a){a&&(t.model.anexos=t.model.anexos||[],a=a.filter((function(a){for(var o=!1,e=0;e<t.model.anexos.length;e++)if(t.model.anexos[e]==a){o=!0;break}return!o})),t.model.anexos=t.model.anexos.concat(a))}))}}]}),a.component("mdwAttachList",{template:'<div layout="row"><div class="badge-anexo" layout="row" layout-align="start end" ng-repeat="documento in $ctrl.anexos"><a  ng-href="{{documento.previewUrl}}" target="_blank">{{documento | nomeDocumento}}</a><md-icon ng-if="!$ctrl.viewOnly" ng-click="$ctrl.unlinkAnexo(documento)">cancel</md-icon></div></div>',bindings:{model:"=ngModel",viewOnly:"=?"},controller:["$scope","documentosDatasource",function(a,t){var o=this;o.viewOnly=!!angular.isDefined(o.viewOnly)&&o.viewOnly,a.$watchCollection("$ctrl.model.anexos",(function(a){a&&(o.anexos=[],a.forEach((function(a){t.get(a).then((function(a){o.anexos.push(a)}))})))})),o.unlinkAnexo=function(a){var t=o.model.anexos.indexOf(a.id);o.model.anexos.splice(t,1)}}]})}(),function(){"use strict";angular.module("md").directive("mdwBadgeAnexo",(function(){return a.$inject=["documentosDatasource"],{restrict:"E",scope:{idDoc:"=ngModel"},template:['<a ng-if="vm.documento"  ng-href="{{vm.documento.previewUrl}}" target="_blank">',"{{vm.documento | nomeDocumento}}","</a>"].join(""),bindToController:!0,controllerAs:"vm",controller:a};function a(a){var t=this;t.$onInit=function(){a.get(t.idDoc).then((function(a){t.documento=a}))}}}))}(),function(){"use strict";function a(a,t,o,e,n,r,i,c,s,l,u,d){var m,f=this,p={"CONTA CORRENTE":["Conta Corrente",0],DINHEIRO:["Dinheiro",1],INVESTIMENTO:["Investimentos",2],OUTROS:["Outros",3],ENCERRADA:["Encerradas (Inativas)",4]};function v(){var a={};f.groups=[];var t=e(f.searchConta||""),o=t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),n=t.length<4?"\\s+":"",r=new RegExp("(^"+o+")|("+n+o+")","i");m.forEach((function(t){if(!e(t.nome).match(r))return!1;var o=t.encerrada?"ENCERRADA":t.tipo,n=a[o];n||(n={label:p[o][0],order:p[o][1],contas:[]},a[o]=n,f.groups.push(n)),n.contas.push(t)})),f.groups.sort((function(a,t){return a.order-t.order})),f.groups.forEach((function(a){a.contas.sort((function(a,t){return a.nome<t.nome?-1:1}))}))}o.title="Extrato de contas",f.ds=r,f.extrato=i,f.filtrosService=n,f.pp=s.utilizacao.pendentesPresente,a.$on("$destroy",r.addObserver("contas",v)),f.isInvest=l,f.pu=u.updateCtrl,f.importarLancamentos=function(a){d.iniciar(a,f.extrato.filtros.conta,"auto")},f.filtrarConta=function(a,t){return function(o){if("CARTEIRA_INVEST"==o.tipo)return!1;var e=t?o.tipo!=a:o.tipo==a;return(o.status||o.encerrada)&&e&&!c.hasRest("contas",o.id,"v")}},f.searchConta="",f.filtrarContas=function(a){v()},f.clearSearch=function(){f.searchConta="",v()},f.onKeydown=function(a){a.stopPropagation()},f.onOpen=function(a){if(f.hasSearch){var o=document.getElementsByClassName(a)[0],e=o.querySelector("md-content._md"),n=o.querySelector("md-select-header>input");t((function(){e.scrollTop-=48,n.focus()}),100)}},f.$onInit=function(){m=f.ds.contas.filter((function(a){return!(!p[a.tipo]||c.hasRest("contas",a.id,"v")||!a.status&&!a.encerrada)})),f.hasSearch=m.length>7,v()}}a.$inject=["$scope","$timeout","mdwTopmenu","mdwAccentFold","filtrosService","cadastrosDatasource","extratoContaService","usuariosService","configuracoesService","MD_INVEST_MOD","conexoesUpdate","importacaoService"],angular.module("md").controller("ExtratoContaController",a)}(),function(){"use strict";function a(a,t,o,e,n,r){a.state("extratoContas",{url:"/extrato",template:"<ui-view/>"}).state("extratoContas.semcontas",{url:"",templateUrl:"partials/extratoConta/semcontas.html",controller:["mdwTopmenu",function(a){a.title="Extrato de contas"}]}),n.state({id:"extratoConta",title:"Extrato de contas",templates:["extratoConta/extrato.html","extratoConta/lancamentos.html","extratoConta/pendentes.html"]},{abstract:!0,url:"/extrato",templateUrl:"partials/extratoConta/extrato.html",controller:"ExtratoContaController",controllerAs:"vm"}),a.state("extratoConta.listar",{url:"/:conta?inicio&fim&i",views:{lancamentos:{templateUrl:"partials/extratoConta/lancamentos.html",controller:"ExtratoContaLancamentosController",controllerAs:"vm",resolve:{security:["usuariosService","$q","$stateParams",function(a,t,o){if(a.hasRest("lancamentos",o.conta,"v"))return t.reject(403)}]}},pendentes:{templateUrl:"partials/extratoConta/pendentes.html",controller:["extratoContaService",function(a){this.extrato=a}],controllerAs:"vm",resolve:{security:["usuariosService","$q","$stateParams",function(a,t,o){if(a.hasRest("lancamentos",o.conta,"v"))return t.reject(403)}]}}}}),o.addStates("extratoConta.listar")}a.$inject=["$stateProvider","mdwStateDialogProvider","lancamentosRoutesProvider","operacoesRoutesProvider","mdwBaseStateProvider","MD_INVEST_MOD"],angular.module("md").config(a).run(["$rootScope","$state","$injector","$transitions",function(a,t,o,e){e.onSuccess({to:"extratoContas"},(function(a,t){o.get("extratoContaService").go()}))}])}(),function(){"use strict";function a(a,t,o,e,n,r,i,c,s,l,u,d,m,f,p){var v,g=this,h=i(),C=f.getConfig("extrato",{conta:null,interval:"d",rd:!1,fs:0,ls:!1,dm:!1,fsl:15,zbr:!1,oalf:!1}),b=C.interval;g.exibirLancamentosZebrados=C.zbr,g.exibirOrdermAlfabetica=C.oalf,g.resumoDetalhado=C.rd,g.fullscreen=1==C.fs,g.linhasSaldo=C.ls,g.diaMensal=C.dm,g.filtroStatusLancamento=C.fsl,g.calendarioConfig={restrict:["d","w","m","p"],interval:b,onUpdate:function(){b!=this.currentInterval&&"p"!=this.currentInterval&&(g.calendarioConfig.interval=this.currentInterval,b=this.currentInterval,w())}},g.printConfig={controller:["extratoContaService",function(a){this.extrato=a}],templateUrl:"/partials/extratoConta/print.html",paginate:function(){return g.paginator}};var A,x={};function S(){if(!(v=angular.copy(e)).inicio||!v.fim){var a=d.getDefaultParams(g.calendarioConfig.interval,!0);v.inicio=a.inicio,v.fim=a.fim}var t=moment().format("YYYY-MM-DD");return g.diaMensal&&v.inicio<=t&&v.fim>=t&&(v.inicio=t),g.inicio=v.inicio,g.fim=v.fim,g.filterManager.ready((function(){var a;g.resumo={saldoAnterior:{projetado:0,confirmado:0},r:{projetado:0,confirmado:0},te:{projetado:0,confirmado:0},d:{projetado:0,confirmado:0},ts:{projetado:0,confirmado:0}},a=angular.extend($(),{inicio:g.inicio,fim:g.fim}),x.resultados=u.lancamentos.sum(a,{groupByTipo:!0}).then((function(a){a.sum.forEach((function(a){g.resumo[a.tipo].projetado=a.projetado,g.resumo[a.tipo].confirmado=a.confirmado}))})),function(){g.dataSaldoAnterior=r(g.inicio).subtract(1,"day").format("YYYY-MM-DD");var a={fim:g.dataSaldoAnterior,contas:D(),moeda:g.conta.moeda,finalidade:u.lancamentos.FIN_EXTRATO};x.saldos=u.lancamentos.sum(angular.extend({},a,{status:u.lancamentos.STATUS_PROJETADO})).then((function(a){g.resumo.saldoAnterior.projetado=a.sum.projetado,g.resumo.saldoAnterior.confirmado=a.sum.confirmado})),g.conta.dataUltimoExtrato&&(a.fim=r().format("YYYY-MM-DD"),u.lancamentos.sum(angular.extend({},a,{status:u.lancamentos.STATUS_CONCILIADO})).then((function(a){g.saldoConciliado=a.sum.confirmado})))}(),function(){var a=angular.extend($(),{inicio:g.inicio,fim:g.fim}),t={pageSize:200,onBeforeFetch:function(a){g.loading.lancamentos=!0},onFetch:function(a,t){A=t,M(a).then((function(){g.loading.lancamentos=!1,g.lancamentos=[];var t,o=moment().toDate(),e=function(a){g.lancamentos.push({_isSaldo:!0,saldo:a.saldo,data:"pendente"==a.status?o:t.data})};g.linhasSaldo?(a.forEach((function(a){t&&t.data!=a.data&&e(t),g.lancamentos.push(a),t=a})),t&&e(t)):g.lancamentos=a}))},onCompleteIterate:function(a){g.lancamentosImp=a,M(g.lancamentosImp)}};g.paginator=u.lancamentos.list(a,{sumPrevPages:!0},t),x.lancamentos=g.paginator.fetch(1)}()}))}function D(){return{faturas:!0,ids:[g.conta.id]}}function $(){var a=u.lancamentos.parseFiltros(g.filterManager);return angular.extend(a,{moeda:g.conta.moeda,finalidade:u.lancamentos.FIN_EXTRATO,status:l.encode(g.filtros.status),contas:D(),ordenarDescricaoMesmaData:g.exibirOrdermAlfabetica})}function M(a){return x.saldos.then((function(t){var o=g.resumo.saldoAnterior.projetado+(A.sumPrevPages||0);a.forEach((function(a){o+=a.valor,a.saldo=o}))}))}function w(){f.updateConfig("extrato",{interval:b,conta:v.conta,rd:g.resumoDetalhado,filtro:g.filterManager.getId(),fs:g.fullscreen?1:0,ls:g.linhasSaldo,dm:g.diaMensal,fsl:g.filtroStatusLancamento,zbr:g.exibirLancamentosZebrados,oalf:g.exibirOrdermAlfabetica})}g.loading={lancamentos:!0,saldoAnterior:!0,saldoPeriodo:!0,resultados:!0},g.conta=null,g.lancamentos=[],g.lancamentosBase=[],g.selected=[],g.saldoAnterior=0,g.saldoPendente=0,g.saldoFiltrado=0,g.detalharPendentes=!1,g.filterManager=l.getManagerLancamentos({funcionalidade:31,onUpdate:function(){g.filterManager.getId()!=C.filtro&&w(),S()},contas:!1,status:!1,confAuto:!0,exibirCpr:!0,exibirRn:!0}),g.filterManager.startWith(C.filtro),u.addObserver("extrato",(function(a){h.notify(a)})),g.go=function(){if(v)return o.go("extratoConta.listar",{conta:v.conta});var a=c.carregarCartoes(!0,!0);if(a.length>0){var t;C.conta||(C.conta=a[0].id);for(var e=0;e<a.length;e++)if(parseInt(a[e].id)==parseInt(C.conta)){t=a[e].id;break}for(e=0;!t||p.hasRest("contas",t,"v");)t=a[e++].id;o.go("extratoConta.listar",angular.extend({conta:t},d.getDefaultParams(g.calendarioConfig.interval,!0)))}else o.go("extratoContas.semcontas")},g.init=function(){return g.filtros=g.filtros||{status:l.decode(g.filtroStatusLancamento)},g.lancamentos=[],g.lancamentosBase=[],g.filtros.conta=e.conta,s.get("contas",e.conta).then((function(a){g.conta=a}))},g.alterarConta=function(a){a&&(g.filtros.conta=a);v.conta=g.filtros.conta,w(),o.go(o.current.name,v)},g.carregar=S,g.togglePendentes=function(a){g.detalharPendentes=a,prepararExibicao(),atualizarSaldos()},g.isFuture=function(){return r().isBefore(r(v.inicio),"days")},g.isPast=function(){return r().isAfter(r(v.fim),"days")},g.toggleFiltroStatus=function(a){g.filtros.status[a]=!g.filtros.status[a],g.filtroStatusLancamento=l.encode(g.filtros.status),w(),g.carregar()},g.toggleFullscreen=function(){g.fullscreen=!g.fullscreen,w()},g.addObserver=h.add,g.exportar=function(){return m.exportar({inicio:v.inicio,fim:v.fim,tipo:1,def:{conta:v.conta}}).then((function(){}))},g.toggleResumoDetalhado=function(){g.resumoDetalhado=!g.resumoDetalhado,w()},g.editarUltimoExtrato=function(){return c.editarUltimoExtrato(v.conta)},g.outrasConfiguracoes=function(){t.show({id:"personalizar-extrato",templateUrl:"partials/extratoConta/configuracoes.html",locals:{service:g,config:{linhasSaldo:g.linhasSaldo,diaMensal:g.diaMensal,ordemAlfabetica:g.exibirOrdermAlfabetica,zebrados:g.exibirLancamentosZebrados}},bindToController:!0,controllerAs:"vm",controller:function(){var a=this;a.ok=function(){a.service.linhasSaldo=a.config.linhasSaldo,a.service.diaMensal=a.config.diaMensal,a.service.exibirOrdermAlfabetica=a.config.ordemAlfabetica,a.service.exibirLancamentosZebrados=a.config.zebrados,t.hide()}}}).then((function(){w(),S()}))},g.edicaoSaldo=function(){return m.edicaoSaldo()},g.editarConta=function(a){var t=s.get("contas",a,!0);return c.editar(t)}}a.$inject=["$q","$mdDialog","$state","$stateParams","$interval","mdwMoment","mdwObserver","contasService","cadastrosDatasource","filtrosService","relatoriosDatasource","mdwCalendarService","lancamentosService","configuracoesService","usuariosService"],angular.module("md").service("extratoContaService",a)}(),function(){"use strict";function a(a,t,o,e){var n=this;n.extrato=o,n.modInvest=t,n.extrato.init().then((function(){n.extrato.carregar()})),n.selection=e({controller:n,templateUrl:"/partials/extratoConta/acoesLoteTopmenu.html",getLancamentos:function(){return n.extrato.lancamentos.filter((function(a){return!a._isSaldo}))}});var r=n.extrato.addObserver(n.extrato.carregar);a.$on("$destroy",(function(){r(),n.selection.clearSelection()})),a.$watchCollection("vm.extrato.lancamentos",(function(){n.selection.updateSelection()}))}a.$inject=["$scope","MD_INVEST_MOD","extratoContaService","selecaoLancamentosLote"],angular.module("md").controller("ExtratoContaLancamentosController",a)}(),function(){"use strict";angular.module("md").filter("abs",(function(){return function(a){return Math.abs(a)}}))}(),function(){"use strict";angular.module("md").filter("formatCpf",(function(){return function(a){return a&&(""+a).replace(/(\d\d\d)(\d\d\d)(\d\d\d)(\d\d)/,"$1.$2.$3-$4")}})),angular.module("md").filter("formatCnpj",(function(){return function(a){return a&&(""+a).replace(/(\d\d)(\d\d\d)(\d\d\d)(\d\d\d\d)(\d\d)/,"$1.$2.$3/$4-$5")}}))}(),function(){"use strict";angular.module("md").filter("formatTel",(function(){return function(a){return a?(""+a).replace(/(\d\d)(\d\d\d\d\d)(\d\d\d\d)/,"($1) $2-$3"):""}}))}(),function(){"use strict";function a(a,t){var o={};return a.disponiveis.forEach((function(a){o[a.id]=a})),function(a,e){a||(a=t.utilizacao.moeda||1);var n=o[a];return n?e?n.nome+" ("+n.simbolo+")":n.simbolo:""}}function t(a,t){return function(o,e){var n=t.get("contas",o,!0),r=n?n.moeda:1;return a("moeda")(r,e)}}a.$inject=["moedaService","configuracoesService"],t.$inject=["$filter","cadastrosDatasource"],angular.module("md").filter("moeda",a).filter("moedaConta",t)}(),function(){"use strict";function a(a){return function(t,o){return void 0===o&&(o=20),a("number")(t,o).replace(/,([0-9]*[1-9])?0+$/,",$1").replace(/,$/,"").replace(/\./g,"")}}a.$inject=["$filter"],angular.module("md").filter("mdwNumber",a)}(),function(){"use strict";angular.module("md").filter("simNao",(function(){return function(a){return a?"Sim":"Não"}}))}(),function(){"use strict";angular.module("md").filter("firstToUpper",(function(){return function(a){return a.substr(0,1).toUpperCase()+a.substr(1)}}))}(),function(){"use strict";angular.module("md").filter("tiposContato",(function(){return function(a){switch(a){case"f":return"Fornecedor";case"c":return"Cliente";case"a":return"Cliente e Fornecedor"}}}))}(),function(){"use strict";function a(a,t,o){var e=this;e.manager=t,console.log(e.manager.options),e.config={funcionalidade:t.funcionalidade,nome:"",filtro:e.manager.filtro},e.ok=function(){return(e.config.id?o.update(e.config):o.create(e.config)).then((function(t){return a.hide(t)}))},e.excluir=function(){return o.delete(e.config).then((function(t){return a.hide(t)}))},e.dismiss=a.cancel,e.acao="novo",e.changeAcao=function(){if("novo"==e.acao)return e.config.id=null,e.config.nome="",e.config.filtro=e.manager.filtro;for(var a=0;a<e.manager.filtros.length;a++)if(e.manager.filtros[a].id==e.acao){e.config.id=e.acao,e.config.filtro=e.manager.filtros[a].valor,e.config.nome=e.manager.filtros[a].nome;break}}}a.$inject=["$mdDialog","manager","filtrosService"],angular.module("md").controller("EditarFiltroController",a)}(),function(){"use strict";function a(a,t,o,e,n){var r=this;r.option=t,r.selected=e.f||[],r.inverter=e.i,r.query="",r.itemsOrg=o,r.toggle=function(a){if(a.checked)r.selected.push(a.id);else{var t=r.selected.indexOf(a.id);r.selected.splice(t,1)}},r.search=function(){var a=n(r.query).replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),t=new RegExp("(^"+a+")|("+(r.query.length<4?"\\s+":"")+a+")","i");r.items=o.filter((function(a){return n(a.name).match(t)}))},r.ok=function(){a.hide({f:r.selected,i:r.inverter})},angular.forEach(r.selected,(function(a){for(var t=0;t<o.length;t++)if(o[t].id==a){o[t].checked=!0;break}})),r.search()}a.$inject=["$mdDialog","option","items","filtro","mdwAccentFold"],angular.module("md").controller("FiltroFiltrarController",a)}(),function(){"use strict";function a(a){a.define("filtros","/apiweb/filtros/:id")}function t(a,t,o){var e=o(),n=a("/apiweb/filtros/:id");this.filtros=function(a){return n.get({funcionalidade:a})},t("filtros",(function(a){n.clear({funcionalidade:a.data.funcionalidade}),e.notify(a)})),this.addObserver=function(a){e.add(a)}}a.$inject=["mdwResourceProvider"],t.$inject=["mdwCache","mdwResourceObserver","mdwObserver"],angular.module("md").config(a).service("filtrosDatasource",t)}(),function(){"use strict";function a(a,t,o,e,n,r,i,c,s){var l=e("filtros");return{create:function(a){return l.insert(a).then((function(a){return t.showSimple("Filtro criado"),a}))},update:function(a){return l.update(a).then((function(a){return t.showSimple("Filtro atualizado"),a}))},delete:function(a){return l.delete(a).then((function(a){return t.showSimple("Filtro excluído"),a}))},getManagerLancamentos:function(a){return function(a){var t=a,e=new d({funcionalidade:a.funcionalidade,filter:h,onUpdate:a.onUpdate}),i=[new m("d","Despesas"),new m("r","Receitas"),new m("t","Transferências")],c=[new m("u","Únicos"),new m("p","Parcelados"),new m("f","Fixos")],s=[new m("a","Agendados"),new m("c","Confirmados"),new m("cc","Conciliados"),new m("p","Pendentes")],l=[new m("fa","Fatura aberta"),new m("ff","Fatura fechada")],u=[new m("s","Com confirmação automática"),new m("n","Sem confirmação automática")],f=[new m("s","Exibidos no contas a pagar/receber"),new m("n","Não exibidos no contas a pagar/receber")],p=[new m("s","Lançamentos reconhecidos"),new m("n","Lançamentos não reconhecidos")];a.semTransferencia&&i.pop();v(),a.tipo&&e.addOption("tipo","Tipo",(function(){return i}));a.repeticao&&e.addOption("repeticao","Repetição",(function(){return c}));a.status&&e.addOption("status","Status",(function(){return s.concat(a.status.cartao?l:[])}));g(),a.confAuto&&e.addOption("confAuto","Confirmação automática",(()=>u));a.exibirCpr&&e.addOption("exibirCpr","Contas a pagar/receber",(()=>f));a.exibirRn&&e.addOption("exibirRn","Reconhecidos/Não reconhecidos",(()=>p));return n.addObserverUtilizacao((function(){v(),g()})),e;function v(){a=angular.extend({},{tipo:!0,repeticao:!0,status:{cartao:!1},categorias:!0,contas:!0,centros:n.utilizacao.centros,contatos:n.utilizacao.contatos,formas:n.utilizacao.formas,projetos:n.utilizacao.projetos,tags:n.utilizacao.tags,plasticos:n.utilizacao.plasticos},t)}function g(){var t={};function n(n,i,c,s){if(!a[n])return t[n]&&t[n](),void e.removeOption(n);if(!t[n]){var l=[],u=function(){l=r[n];var a={};"plasticos"==n&&l.forEach((function(t){a[t.conta]=r.get("contas",t.conta,!0).nome})),s&&(l=o(n+"Rest")(l));var t=function(a){return new m(a.id,a.nome,a.status)},e=function(a,t){return a.status&&!t.status?-1:!a.status&&t.status?1:a.name<t.name?-1:1};"plasticos"==n?t=function(t){return new m(t.id,a[t.conta]+"/"+t.nome,t.status)}:"categorias"==n&&(t=function(a){return new m(a.id,a.nome,a.status,a.tipo.substr(0,1).toUpperCase())},e=function(a,t){return a.status&&!t.status?-1:!a.status&&t.status?1:a.mod<t.mod?-1:a.mod>t.mod?1:a.name<t.name?-1:1}),(l=l.map(t)).sort(e),c&&l.unshift(new m(0,c))};u(),t[n]=r.addObserver(n,u),e.addOption(n,i,(function(){return l}))}}n("categorias","Categorias"),n("contas","Contas",null,!0),n("centros","Centros","Sem centro",!0),n("contatos","Contatos","Sem contato"),n("formas","Formas de pagto.","Sem forma de pagto."),n("projetos","Projetos","Sem projeto",!0),n("plasticos","Cartão"),n("tags","Tags")}function h(a,t){if("tipo"==t)return e.pertence(t,a.tipo)>-1;if("repeticao"==t)return e.pertence(t,a.parcela?"fixa"==a.parcela?"f":"p":"u")>-1;if("status"==t){var o=e.pertence(t,a.conciliado?"cc":a.status.substr(0,1))>-1;if(o)return o;if(a.conta)if("CARTAOCREDITO"==r.get("contas",a.conta,!0).tipo)return e.pertence(t,a.fatura?"ff":"fa")>-1;return!1}var n=t;if("tags"!=n&&(n=t.replace(/s$/,"")),a[n]){var i=e.pertence(t,a[n])>-1;return!i&&"categoria"==n&&a.categoriaPai&&(i=e.pertence(t,a.categoriaPai)>-1),i}if(!a.detalhes)return e.pertence(t)>-1;for(var c=0;c<a.detalhes.length;c++){var s=a.detalhes[c];if(e.pertence(t,s[n])>-1)return!0;if("categoria"==n&&s.categoriaPai&&e.pertence(t,s.categoriaPai)>-1)return!0}return!1}}(a)},getManagerContatos:function(a){return function(a){var t=new d({funcionalidade:a.funcionalidade,filter:u,onUpdate:a.onUpdate}),o=[new m("f","Pessoa física"),new m("j","Pessoa jurídica")],e=[new m("c","Cliente"),new m("f","Fornecedor")],n=c.map((function(a){return new m(a.id,a.nome)})),i=s.map((function(a){return new m(a.id,a.nome)}));(a=angular.extend({tiposPessoa:!0,tiposContato:!0,sexo:!0,ufs:!0,categorias:!0},a)).tiposPessoa&&t.addOption("tipoPessoa","Tipo pessoa",(function(){return o}));a.tiposContato&&t.addOption("tipoContato","Tipo contato",(function(){return e}));a.sexo&&t.addOption("sexo","Sexo",(function(){return n}));a.ufs&&t.addOption("uf","UF",(function(){return i}));if(a.categorias){var l=r["contatos/categorias"].map((function(a){return new m(a.id,a.nome,a.status)}));t.addOption("categoria","Categoria",(function(){return l}))}return t;function u(a,o){return"categorias"==o||-1!=t.pertence(o,a[o])}}(a)},getManagerOperacoes:function(a){return},novo:function(t){return a.show({id:"editar-filtro",controller:"EditarFiltroController",controllerAs:"vm",templateUrl:"/partials/filtros/editarFiltro.html",locals:{manager:angular.copy(t)}})},encode:function(a){if(!a)return 15;let t=0;return angular.forEach(a,(function(a,o){a&&(t|=parseFloat(o))})),t},decode:function(a){return{1:u(a,1),2:u(a,2),4:u(a,4),8:u(a,8)}},checkBit:u};function u(a,t){return 0!=(a&t)}function d(t){var o,e=this,n={};t=angular.extend({funcionalidade:1,options:[],filter:function(){return!0},onUpdate:function(){}},t);var r=function(){return t.onUpdate.call(e)};e.filtrar=function(a){for(var o=0;o<e.options.length;o++){var n=e.options[o].id;if(e.filtro[n]){var r=e.filtro[n].i;if(e.filtro[n].f&&0!=e.filtro[n].f.length)if(!(!t.filter(a,n)!=!r))return!1}}return!0},e.funcionalidade=t.funcionalidade,e.options=t.options,e.filtro={},e.filtros=[],e.encode=function(){return btoa(angular.toJson(e.filtro))},e.setActiveFilter=function(a){try{angular.extend(e.filtro,angular.fromJson(atob(a)))}catch(a){}};var c=l();function s(){for(var a=Object.keys(e.filtro),t=0;t<a.length;t++){var n=a[t];if(e.filtro[n].f&&e.filtro[n].f.length>0)return}o=void 0}function l(){return i.filtros(e.funcionalidade).then((function(a){e.filtros=a.sort((function(a,t){return a.nome<t.nome?-1:1}))}))}function u(a,t){if(t||(t=0),angular.isArray(t)){for(var o=0;o<t.length;o++){var n=r(t[o]);if(-1!=n)return n}return-1}return r(t);function r(t){var o=e.filtro[a].f.indexOf(t);return-1==o&&(o=e.filtro[a].f.indexOf(String(t))),o}}function d(t,o,n){var i=this;this.id=t,this.name=o,this.getValues=n,this.select=function(){return a.show({controller:"FiltroFiltrarController",controllerAs:"vm",templateUrl:"/partials/filtros/filtrar.html",resolve:{items:function(){return angular.copy(n())}},locals:{option:i,filtro:angular.copy(e.filtro[t])}}).then((function(a){e.filtro[t].f=a.f,e.filtro[t].i=a.i,r()}))}}e.ready=function(a){return c.then(a)},i.addObserver(l),e.getId=function(){return o},e.startWith=function(a,t){a&&c.then((function(){o=a;for(var n=0;n<e.filtros.length;n++)if(parseInt(e.filtros[n].id)==parseInt(a)){e.aplicar(e.filtros[n],t);break}}))},e.getActiveName=function(){if(o)for(var a=0;a<e.filtros.length;a++)if(e.filtros[a].id==o)return e.filtros[a].nome},e.aplicar=function(a,t){o=a.id;var i=angular.copy(a.valor);e.filtro={},angular.forEach(i,(function(a,t){n[t]&&(e.filtro[t]=a)})),t||r()},e.getOption=function(a){return n[a]},e.clearAll=function(a){angular.forEach(e.filtro,(function(a,t){e.filtro[t].f=[]})),s(),a||r()},e.clearOption=function(a){e.filtro[a].f=[],s(),r()},e.clearValue=function(a,t){var o=u(a,t);-1!=o&&(e.filtro[a].f.splice(o,1),s(),r())},e.setFilter=function(a,t,o){e.filtro[a]&&(e.filtro[a].f=[t],e.filtro[a].i=o)},e.addValue=function(a,t){e.filtro[a]&&e.filtro[a].f.push(t)},e.addOption=function(a,t,o){var r=new d(a,t,o);n[a]||(e.options.push(r),n[a]=r,e.filtro[a]={f:[],i:!1})},e.removeOption=function(a){if(n[a]){var t=e.options.indexOf(n[a]);e.options.splice(t,1),delete n[a]}},e.pertence=u,e.getActive=function(a){var t=[];return a?(angular.forEach(e.filtro,(function(a,o){a.f&&0!=a.f.length&&t.push({tipo:o,filtros:a.f,inverse:!!a.i})})),t):(angular.forEach(e.filtro,(function(a,o){if(a.f&&0!=a.f.length){var e=[o,a.f.join(",")];a.i&&e.push("i"),t.push(e.join(":"))}})),t.join(";"))}}function m(a,t,o,e){this.id=a,this.name=t,this.status=!1!==o,this.mod=e}}a.$inject=["$mdDialog","$mdToast","$filter","mdwResource","configuracoesService","cadastrosDatasource","filtrosDatasource","SEXOS","BR_UFS"],angular.module("md").factory("filtrosService",a)}(),function(){"use strict";angular.module("md").directive("mdwFiltrosDisplay",(function(){return a.$inject=["$scope"],{restrict:"E",require:"mdwFiltrosDisplay",scope:{manager:"="},templateUrl:"/partials/filtros/displayFiltro.html",controller:a,controllerAs:"vm",link:function(a,t,o,e){var n=angular.element(t),r=n.css("display");function i(){n.css("display",e.items.length>0?r:"none")}a.$watchCollection("vm.items",i),i()}};function a(a){var t=this,o=a.manager;function e(){t.items=[],angular.forEach(o.filtro,(function(a,e){if(a.f&&0!=a.f.length){var n=a.f,r=o.getOption(e);t.option=r;var i={id:r.id,name:r.name,inv:a.i,chips:r.getValues().filter((function(a){return-1!=n.indexOf(a.id)||-1!=n.indexOf(String(a.id))}))};t.items.push(i)}}))}t.items=[],a.$watch("manager",e,!0),e()}}))}(),function(){"use strict";angular.module("md").factory("filtroStatusLancamentoService",(function(){return function(a){return new function(){var t=this;t.filtros={1:!0,8:!0,2:!0,4:!0},t.notify=function(){a&&a()},t.get=function(){var a=0;return angular.forEach(t.filtros,(function(t,o){t&&(a+=parseFloat(o))})),a},t.toggle=function(a,o){t.filtros[a]=o||!t.filtros[a]}}}})).directive("mdwFiltroStatusLancamento",(function(){return{restrict:"A",scope:{service:"=mdwFiltroStatusLancamento"},templateUrl:"/partials/filtros/filtroStatusLancamento.html",bindToController:!0,controller:function(){var a=this;function t(t){a.filtros[t]=!a.filtros[t],a.service.notify()}a.toggleFiltro=t,a.$onInit=function(){a.filtros=a.service.filtros}},controllerAs:"vm"}}))}(),function(){"use strict";function a(a){var t=this;const o="pendentes",e="confirmados",n="conciliados",r="agendados";function i(a,o){t.msgExibicao=a?"Exibindo apenas lançamentos "+o.join(" e "):"Não exibindo lançamentos "+o.join(" e ")}t.$onChanges=function(){t.show=!1,15==t.filtros&&!t.isCartao||3==t.filtros&&t.isCartao||(t.show=!0,t.msgExibicao="Selecione um dos status abaixo para visualizar os lançamentos",0!=t.filtros&&(t.isPr?function(){let c=a.decode(t.filtros),s=[];function l(a,t){c[a]&&s.push(t)}if(!t.prC)return l(1,o),l(8,r),void(s.length>0&&i(!0,s));t.prC&&(l(2,e),l(4,n),s.length>0&&i(!0,s))}():t.isCartao?function(){let o=[];a.checkBit(t.filtros,1)&&o.push(n),a.checkBit(t.filtros,2)&&o.push("não conciliados"),o.length>0&&i(!0,o)}():function(){let c=a.decode(t.filtros),s=[],l=[];function u(a,t){(c[a]?s:l).push(t)}u(1,o),u(2,e),u(4,n),u(8,r),1!=l.length?i(!0,s):i(!1,l)}()))}}a.$inject=["filtrosService"],angular.module("md").component("mdwFiltroStatusMsg",{templateUrl:"/partials/filtros/filtroStatusMsg.component.html",controller:a,bindings:{filtros:"<",isCartao:"<",isPr:"<",prC:"<"}})}(),function(){"use strict";t.$inject=["$timeout","$interval","$window"],angular.module("md").directive("mdwConciliacao",(function(){return t.$inject=["$scope","mdwDarkModeService"],{restrict:"E",require:"mdwConciliacao",controller:t,controllerAs:"vm",scope:{origins:"=ngModel",fn:"="},link:function(a,t,o,e){e.getHeight=function(){var a=-1;return angular.forEach(t[0].childNodes,(function(t){"mdw-canvas-conciliacao"!=t.localName&&t.scrollHeight>a&&(a=t.scrollHeight)})),a}}};function t(t,o){var n,r,i=this,c=i.drawer=new e(o.active);a=0,i.origin=null,i.$onInit=function(){n=t.origins=[],r=t.fn.onLink||angular.noop},i.reset=function(){angular.forEach(n,(function(a){a.clear()})),n=t.origins=[],i.origin=null,c.clear()},i.bindNodes=function(a,t){return!t.checked&&(!(a.data&&t.data&&(a.data.valor<0&&t.data.valor>0||a.data.valor>0&&t.data.valor<0))&&(a.checked=!0,t.checked=!0,i.setOrigin(a),i.link(t),!0))},i.setOrigin=function(a){i.origin=a,n.push(a)},i.toggle=function(a){a.checked?i.link(a):i.unlink(a)},i.link=function(a){i.origin.addChild(a),a.setParent(i.origin),c.link(i.origin),r(i.origin)},i.unlink=function(a){function t(a){var t=n.indexOf(a);n.splice(t,1),i.origin=n[n.length-1]}a.isOrigin?t(a):1==a.parent.children.length&&t(a.parent),a.clear(),c.unlink(a)},t.fn.reset=i.reset,t.fn.bindNodes=i.bindNodes,t.fn.unlinkNode=i.unlink}})).directive("mdwCanvasConciliacao",t).directive("mdwRadioConciliacao",(function(){return a.$inject=["$scope"],{restrict:"E",link:function(a,t,o,e){var n=e[1],r=n.node;n.parent=e[0],n.node.elem=t,n.node.isDestination=angular.isDefined(o.destination),n.node.isOrigin=angular.isDefined(o.origin),n.node.isOrigin&&a.$watch("vm.parent.origin.id",(function(a){r.id!=a&&(r.isLinked()||(r.checked=!1))}));n.click=function(){r.isOrigin?r.checked?n.parent.setOrigin(r):n.parent.unlink(r):n.parent.toggle(r)}},require:["^mdwConciliacao","mdwRadioConciliacao"],controller:a,controllerAs:"vm",scope:{data:"=ngModel"},template:['<input type="checkbox"','ng-model="vm.node.checked"','ng-change="vm.click()"','ng-disabled="vm.node.isDestination && !vm.parent.origin" >'].join(" ")};function a(a){var t=this.node=new o;this.$onInit=function(){t.data=a.data,a.data.$mdwNode=t}}}));var a=0;function t(a,t,o){return{restrict:"E",link:function(e,n,r,i){i[1];var c=i[0],s=document.getElementById("mdwCanvasConciliacao"),l=angular.element(s)[0].parentElement,u=null,d=null,m=t(f,1e3);function f(){e.width=l.offsetWidth,e.height=c.getHeight(),e.width==d&&e.height==u||(d=e.width,u=e.height,a((function(){e.$apply(),c.drawer.refresh()})))}angular.element(o).bind("resize",f),e.$on("$destroy",(function(){angular.element(o).unbind("resize",f),t.cancel(m)})),c.drawer.setCanvas(s)},require:["^mdwConciliacao","mdwCanvasConciliacao"],controller:function(){},controllerAs:"vm",scope:{},template:'<canvas width="{{width}}" height="{{height}}" id="mdwCanvasConciliacao" ></canvas>'}}function o(){var t=this;t.id=++a,t.checked=!1,t.elem=null,t.isDestination=!1,t.isOrigin=!1,t.children=[],t.parent=null,t.addChild=function(a){t.children.push(a)},t.setParent=function(a){t.parent=a},t.clear=function(){if(t.parent){var a=t.parent.children.indexOf(t);t.parent.children.splice(a,1),t.parent.checked=t.parent.children.length>0,t.parent=null}else angular.forEach(t.children,(function(a){a.checked=!1})),t.children=[],t.checked=!1},t.isLinked=function(){return!!t.parent||t.children.length>0},t.getX=function(){return t.elem[0].offsetLeft},t.getY=function(){return t.elem[0].offsetTop}}function e(a){var t,o,e=this,n=[];function r(){o.clearRect(0,0,t.width,t.height)}function i(){angular.forEach(n,(function(a){angular.forEach(a.children,(function(o){c.apply(this,[a.getX()-t.offsetLeft+25,a.getY()-5,o.getX()-t.offsetLeft-0,o.getY()-5])}))}))}function c(t,e,n,r){o.beginPath(),o.moveTo(t,e),o.lineTo(n,r),a&&(o.strokeStyle="#EEEEEE"),o.stroke()}e.setCanvas=function(a){o=(t=a).getContext("2d")},e.unlink=function(a){var t=n.indexOf(a);t>=0&&n.splice(t,1),r(),i()},e.link=function(a){-1==n.indexOf(a)&&n.push(a),r(),i()},e.refresh=function(){r(),i()},e.clear=r}}(),function(){"use strict";function a(a,t,o,e,n,r,i,c,s,l,u,d,m,f,p,v,g,h){if(n.extrato){var C=this,b=v.getConfig("conciliacao",{o:"d",s:!1,sd:!1});C.ordenacao=b.o,C.sobrescrever=b.s,C.sobrescreverDescr=b.sd,C.idConta=n.conta,C.extrato=n.extrato,C.formatoArquivo=n.ff,C.isAuto="auto"==n.ff,C.lancamentosConciliacao=n.extrato.lancamentos,C.lancamentosConciliacao&&(C.mapaConciliacao={},C.mapaConciliacaoNdoc={},C.lancamentosConciliacao.forEach((a=>{let t=`${a.data}_${a.valor}`;C.mapaConciliacao[t]||(C.mapaConciliacao[t]=[]),C.mapaConciliacao[t].push(a),a.ndocumento&&(t=`${t}_${a.ndocumento}`,C.mapaConciliacaoNdoc[t]||(C.mapaConciliacaoNdoc[t]=[]),C.mapaConciliacaoNdoc[t].push(a))})));var A=C.conta=d.get("contas",C.idConta,!0);C.isCartao="CARTAOCREDITO"==A.tipo,C.lancamentosPeriodo=[];var x=[],S=[],D=[],$=[];C.origens=[],C.canvasControl={reset:function(){},bindNodes:function(){},onLink:function(a){if(a.children.length>1)return;var t=a.children[0].data;if(!t.detalhes)return;var o=a.data;if(t.valor==o.valor)return;i.show({id:"editar-valores-grupo",templateUrl:"partials/importacao/editarValoresGrupo.html",bindToController:!0,locals:{l:t,le:o},controllerAs:"vm",controller:function(){var a=this;function o(a,t){return("d"==a||"td"==a?-1:1)*Math.abs(t)}a.detalhes=angular.copy(a.l.detalhes),a.detalhes.forEach((function(a){a.tipoL="t"!=a.tipo?a.tipo:a.valor>0?"to":"td"})),a.diff=function(){return Math.abs(a.le.valor)-Math.abs((t=a.detalhes,e=0,angular.forEach(t,(function(a){e+=o(a.tipoL,a.valor)})),parseFloat(e.toFixed(2))));var t,e},a.descTipo=function(a){return"d"==a?"despesa":"r"==a?"receita":"to"==a?"transf. origem":"td"==a?"transf. destino":void 0},a.ok=function(){var e=[];return a.detalhes.forEach((function(a){e.push({id:a.id,valor:o(a.tipoL,a.valor)})})),f.atualizarValoresGrupo(t.id,e).then((function(t){for(var o=0,n=0;n<e.length;n++)a.l.detalhes[n].valor=e[n].valor,o+=e[n].valor;a.l.valor=o,P(a.l,t),i.hide()}))}}}).catch((function(){C.canvasControl.unlinkNode(a)}))}};var M=l(e,Y,{ignoreStates:["conciliacao.lancamentosEditar"]});C.cancelar=function(){M(),o.go(n.ref)},C.busca={inicio:c(C.extrato.inicio).subtract(2,"days").toDate(),fim:c(C.extrato.fim).add(2,"days").toDate(),contas:[C.idConta]},s.changeTemplateUrl("/partials/importacao/conciliacaoTopmenu.html",C,!0);var w=a.onExit({from:"conciliacao"},(function(){s.changeTemplateUrl(null,null,!1),w()}));C.conciliar=function(){var a={inicio:C.extrato.inicio,fim:C.extrato.fim,saldo:C.extrato.saldo,lancamentos:C.lancamentosConciliacao};if(0==C.lancamentosPeriodo.length)return e({importar:!0,extrato:a});function e(a){M(),!1,C.iniciandoImportacao=!0,t((function(){a.importar&&a.extrato.lancamentos.length>0?o.go("importacao",{extrato:a.extrato,ref:n.ref,conta:C.idConta,ff:C.formatoArquivo}):o.go(n.ref)}))}i.show({id:"conciliacao-confirmar",templateUrl:"/partials/importacao/conciliacaoConfirmar.html",controllerAs:"vm",controller:["$mdDialog",function(t){var o=this;o.lancamentos=[],o.lancamentosNaoMarcados=[],o.importar=!0,o.sobrescrever=C.sobrescrever,o.service=u,o.sobrescreverDescr=C.sobrescreverDescr;for(var e=0;e<C.lancamentosConciliacao.length;e++){var n=C.lancamentosConciliacao[e],r=n.$mdwNode;if(r.checked&&0!=r.children.length){var i=[];angular.forEach(r.children,(function(a){i.push(a.data.id)})),o.lancamentos.push({ids:i,data:n.data,valor:n.valor,centro:n.centro,contato:n.contato,projeto:n.projeto,categoria:n.categoria,ndocumento:n.ndocumento,descricao:n.descricao,tags:n.tags});var c=function(a,t){return Math.abs(Math.abs(parseFloat(a))-Math.abs(parseFloat(t)))<.01};if(r.children.length>1){var s=0;if(angular.forEach(r.children,(function(a){s+=a.data.valor})),!c(n.valor,s))return void(o.error="O somatório de uma associação com múltiplos lançamentos deve ser igual")}else if(r.children[0].data.detalhes){if(!c(n.valor,r.children[0].data.valor))return void(o.error="Associações com lançamentos detalhados devem possuir exatamente o mesmo valor")}else if(n.valor>0&&r.children[0].data.valor<0||n.valor<0&&r.children[0].data.valor>0)return void(o.error="Não é possível associar lançamentos com sinais diferentes")}else o.lancamentosNaoMarcados.push(n)}o.toggleSobrescrever=function(){C.sobrescrever=o.sobrescrever,E()},o.toggleSobrescreverDescr=function(){C.sobrescreverDescr=o.sobrescreverDescr,E()},o.ok=function(){var e={sobrescrever:C.sobrescrever,sobrescreverDescr:C.sobrescreverDescr,inicio:C.extrato.inicio,fim:C.extrato.fim,saldo:C.extrato.saldo,conta:C.idConta,lancamentos:o.lancamentos};return C.isAuto&&(e.connectionAccount=A.connectionAccount,e.maxDate=h.registrarIdsImportados(A.connectionAccount,C.lancamentosConciliacao)),a.lancamentos=o.lancamentosNaoMarcados,f.conciliacao(e).then((function(){C.isAuto&&h.notify();var e=-1*moment().startOf("day").diff(C.extrato.inicio,"days"),n=moment(C.extrato.fim).diff(C.extrato.inicio,"days");return g.transactionEntryFileAdjusted(C.formatoArquivo,e,n),t.hide({extrato:a,importar:o.importar})}))}}]}).then(e)},C.ordernarData=j,C.modificarBusca=function(){R("Ao alterar a busca você perderá as associações já realizadas").then((function(){i.show({id:"modificar-busca",controller:["busca","mdwMoment","cadastrosDatasource",function(a,t,o){var e=this;e.contas=o.contas.filter((function(a){return"CONTA CORRENTE"==a.tipo||"DINHEIRO"==a.tipo||"OUTROS"==a.tipo})),a.inicio=t(a.inicio),a.fim=t(a.fim),e.busca=a,e.atualizar=function(){e.busca.inicio=t(e.busca.inicio).format("YYYY-MM-DD"),e.busca.fim=t(e.busca.fim).format("YYYY-MM-DD"),i.hide(e.busca)},e.dismiss=function(){i.cancel()}}],controllerAs:"vm",templateUrl:"/partials/importacao/modificarBuscaConciliacao.html",locals:{busca:angular.copy(C.busca)}}).then((function(a){C.busca=a,y()}))}))},C.modificarExtrato=function(){u.modificarExtrato({saldo:C.extrato.saldo,inicio:C.extrato.inicio,fim:C.extrato.fim}).then((function(a){C.extrato=a}))},C.detalharLancamento=function(a){f.detalhar(a,!1)},C.toggleSort=function(a){R("Ao alterar a ordenação você perderá as associações já realizadas").then((function(){C.canvasControl.reset(),C.ordenacao=a,E(),T(C.lancamentosPeriodo)}))},y()}function E(){var a={o:C.ordenacao,s:C.sobrescrever,sd:C.sobrescreverDescr};v.updateConfig("conciliacao",a)}function y(){C.canvasControl.reset(),C.loadingLancamentosPeriodo=!0,$=[],D=[],C.nomesContas=C.busca.contas.map((function(a){return d.get("contas",a,!0).nome})).join(", ");if(C.isCartao)p.carregarFatura(A.id,A.proximoVencimento).then((function(a){T(a.lancamentos)}));else{var a={};a.inicio=c(C.busca.inicio).format("YYYY-MM-DD"),a.fim=c(C.busca.fim).format("YYYY-MM-DD");var t="["+C.busca.contas.join(",")+"]",o=m.query({inicio:c(C.busca.inicio).format("YYYY-MM-DD"),fim:c(C.busca.fim).format("YYYY-MM-DD"),contas:t}),e=m.query({fim:c(C.busca.inicio).subtract(1,"d").format("YYYY-MM-DD"),confirmados:!1,contas:t});r.all([e,o]).then((function(a){T(a[0].concat(a[1]))}))}}function I(a,t){var o=j(a),e=j(t);return o<e?-1:o>e?1:a.valor-t.valor}function O(a,t){return t.valor>=a.valor?1:-1}function T(a){0!=x.length&&0!=S.length||(x=C.lancamentosConciliacao.slice(),(S=C.lancamentosConciliacao.slice()).sort(O)),0!=D.length&&0!=$.length||((D=a.slice()).sort(I),($=a.slice()).sort(O)),C.lancamentosPeriodo="d"==C.ordenacao?D:$,C.lancamentosConciliacao="d"==C.ordenacao?x:S,C.loadingLancamentosPeriodo=!1,t((function(){!function(a){C.lancamentosPeriodo=[];for(let o=0;o<a.length;o++){const e=a[o];C.lancamentosPeriodo.push(e);const n=C.isCartao?e.dataCompetencia:e.dataEfetiva||e.dataPrevista,r=`${n}_${e.valor}`,i=`${n}_${e.valor}_${e.ndocumento}`;t(e,C.mapaConciliacaoNdoc[i])||t(e,C.mapaConciliacao[r])}function t(a,t){if(!t)return!1;for(let o=0;o<t.length;o++){const e=t[o];if(!e.$mdwNode.checked)return C.canvasControl.bindNodes(e.$mdwNode,a.$mdwNode),!0}return!1}}(C.lancamentosPeriodo)}))}function P(a,t){for(var o=0;o<C.lancamentosPeriodo.length;o++){var e=C.lancamentosPeriodo[o];if(e.id==a.id)return e.valor=a.valor,void(e.id=t.id)}}function R(a){return Y()?i.show(i.confirm().textContent(a).ok("Continuar").cancel("Cancelar")):r.resolve()}function Y(){return C.origens.length>1||1==C.origens.length&&C.origens[0].children.length>0}function j(a){return C.isCartao?a.dataCompetencia:a.dataEfetiva||a.dataPrevista}}a.$inject=["$transitions","$timeout","$state","$scope","$stateParams","$q","$mdDialog","mdwMoment","mdwTopmenu","mdwUnloadChecker","importacaoService","cadastrosDatasource","lancamentosDatasource","lancamentosService","cartoesDatasource","configuracoesService","mdwAnalytics","conexoesApi"],angular.module("md").controller("ConciliacaoController",a)}(),function(){"use strict";function a(a){var t=this;t.ok=function(){return t.l.data=t.l.data.format("YYYY-MM-DD"),a.hide(t.l)},t.dataAnt=null,t.$onInit=function(){t.dataAnt=t.l.data}}a.$inject=["$mdDialog"],angular.module("md").controller("editarDataLancImport",a)}(),function(){"use strict";function a(a,t,o,e,n,r,i,c,s,l,u){var d=this;function m(t,o,e,l){var u=new n({url:t,headers:c.getHeaders(),autoUpload:!1,filters:[{name:"type",fn:function(a){return-1!=e.indexOf(m(a))}},{name:"size",fn:function(a){return a.size<=l}}]});return u.onAfterAddingFile=function(a){a.formData=[{tipo:o,inverter:d.inverter}],5==o&&(a.formData[0].dateFormat=d.dateFormat),a.upload()},u.onWhenAddingFileFailed=function(a,t){switch(t.name){case"type":return d.error=3,d.customError="Extensões de arquivos permitidas: "+e.join(",");case"size":return d.error=3,d.customError="Limite de tamanho para arquivos "+m(a)+": "+((o=l)>=(r=(n=1024)*n)?o/r+"Mb":o>=n?o/n+"Kb":o+" bytes")}var o,n,r},u.onProgressItem=function(){d.isUploading=!0},u.onSuccessItem=function(t,o,e,n){var c;d.isUploading=!1,r.formatoArquivo=d.tipoArquivo,d.idConciliacao?c=(i=s.get("contas",d.idConciliacao,!0)).id:i&&(c=i.id),o.lancamentos&&0!=o.lancamentos.length?(r.iniciar(o,c,d.tipoArquivo),a.hide()):d.semLancamentosPeriodo=!0},u.onErrorItem=function(a,t,o){d.isUploading=!1,d.errorFile=a,401==o||403==o?d.error=1:2==t.type?(d.erroSenha=-1!=t.error.search(/senha/i),d.error=d.erroSenha?2:3,d.customError=t.error,d.errorUrl=t.url):(d.error=3,d.customError=t.error,d.errorUrl=t.url)},u;function m(a){return a.name.substr(a.name.lastIndexOf(".")+1).toLowerCase()}}d.isUploading=!1,d.refresh=function(){window.location.reload()},d.service=r,d.dismiss=a.cancel,d.uploaderOfx=m("/apiweb/importarArquivo",1,["ofx","ofc"],524288),d.uploaderExcel=m("/apiweb/importarArquivo",2,["xls","xlsx"],2097152),d.uploaderQif=m("/apiweb/importarArquivo",5,["qif"],524288),d.uploaderCsv=m("/api/v2/lancamentos/importarArquivo/csv",6,["csv"],524288),d.uploaderPdf=m("/api/v2/lancamentos/importarArquivo/pdf",7,["pdf"],4194304),d.toggleRegras=function(){d.config.r=d.service.regras,e.updateConfig("importArq",d.config)},d.tipoArquivo="ofx",d.contaConciliacao=i,d.ds=s,d.idConciliacao=0,d.iniciarImportacaoAuto=function(){var o=null;d.dataImportacao&&(o=moment(d.dataImportacao).format("YYYY-MM-DD"));return d.semLancamentosPeriodo=!1,t.carregarLancamentos(i.connectionAccount,o).then((function(t){0==t.lancamentos.length?d.semLancamentosPeriodo=!0:(r.iniciar(t,i.id,"auto"),a.hide())}))},d.pu=o.updateCtrl,d.minDataAuto=moment().subtract(90,"days").startOf("day"),d.maxDataAuto=moment().endOf("day"),d.connectionEnabled=!1,i&&(d.dataImportacao=moment(moment.max(i.dataUltimoExtrato,d.minDataAuto)),d.connectionEnabled=!u&&!!d.contaConciliacao.connectionAccount,i.connection&&t.getConexao(i.connection).then((a=>{d.connection=a,d.warnLateConn=moment(a.lastUpdatedAt).format("YYYY-MM-DD")<moment().format("YYYY-MM-DD"),d.preventLateConn=moment(a.lastUpdatedAt).format("YYYY-MM-DD")<moment(d.dataImportacao).format("YYYY-MM-DD")})),d.isCartao="CARTAOCREDITO"==i.tipo),d.onChangeDataImportacao=function(){d.preventLateConn=moment(d.connection.lastUpdatedAt).format("YYYY-MM-DD")<moment(d.dataImportacao).format("YYYY-MM-DD")},d.metodoImportacao=d.connectionEnabled?1:2,d.filtrarConta=function(a){return function(t){return t.status&&t.tipo==a&&!l.hasRest("contas",t.id,"v")}},d.config=e.getConfig("importArq",{inverter:!1,r:!0}),d.inverter=d.config.inverter,d.service.regras=d.config.r,d.dateFormat="d/m/a",d.tentarNovamente=function(){d.isUploading=!0,d.errorFile.formData[0].senha=d.senhaArquivo,d.errorFile.upload(),d.error=null,d.errorFile=null,d.erroSenha=null},d.toggleInverter=function(){d.config.inverter=d.inverter,e.updateConfig("importArq",d.config)}}a.$inject=["$mdDialog","conexoesApi","conexoesUpdate","configuracoesService","FileUploader","importacaoService","contaConciliacao","mdHeadersFactory","cadastrosDatasource","usuariosService","MD_INVEST_MOD"],angular.module("md").controller("ImportacaoEscolhaArquivoController",a)}(),function(){"use strict";function a(a,t,o,e,n,r,i,c,s,l,u,d,m,f,p,v,g,h,C,b,A,x){if(i.extrato){var S=this;S.lancamentosImportacao=i.extrato.lancamentos,S.idContaConciliacao=i.conta,S.formatoArquivo=i.ff,S.isAuto="auto"==S.formatoArquivo,S.documentosDatasource=x,S.idContaConciliacao&&(S.contaConciliacao=p.get("contas",S.idContaConciliacao,!0),S.conciliacaoCartao="CARTAOCREDITO"==S.contaConciliacao.tipo);var D,$=S.painelEdicao=new function(){var a=this,n=null;function i(){return document.getElementById("lista-importacao")}function s(t,e){a.editingAll||(a.l&&(a.l.editando=!1),n=e,function(t){a.l=t,t.editando=!0;var e=u();a.isFuturo=u(t.data).isAfter(e,"days"),a.switchCriarRegra=!1,a.posicaoData=moment(a.l.data).startOf("day").diff(moment().startOf("day"),"days"),a.posicaoData>0&&(a.l.lembrete="0",a.l.enviarLembrete=!0);a.configOpInvest={conta:a.l.conta,dataOperacao:a.l.data,disableContas:!0,ignore:(n=[8,9,10],r=a.l.valor>0?[1,5,12]:[2,6,11,13],n.concat(r)),acaoEdicao:function(t){var e=Math.abs(t.quantidade||1),n=Math.abs(t.valor),r=-1*Math.abs(t.custos||0),i=-1*Math.abs(t.ir||0),c=-1*Math.abs(t.iof||0);1!=t.tipo&&5!=t.tipo||(e*=-1);var s=n*e+r+i+c;return a.l.valor!=s?(l.notify("O valor da operação deve ser igual ao do lançamento  importado"),o.reject()):(a.l.operacaoInvestimento=t,o.resolve(t))}};var n,r}(t),d())}function d(){if(n){var o=i().getBoundingClientRect(),e=n.currentTarget||n.target;if(e){var c=e.getBoundingClientRect().top-o.top,s=e.offsetHeight/2;a.caretDisabled=c<0||c>i().offsetHeight-2*s,a.caretTop=c+s,r((function(){t.$apply()}))}}}function m(){var t=a.l.valor;f.detalharEdicao(a.l).then((function(o){a.l.valor=o.lancamento.valor,a.l.data=u(o.lancamento.data).format("YYYY-MM-DD"),o.detalhes&&o.detalhes.length?(a.l.detalhes=o.detalhes,a.l.categoria=null,a.l.centro=null,a.l.contato=null,a.l.projeto=null):(a.l.detalhes=null,a.l.tipo=t<0?"d":"r",a.l.valor=t)}),(function(o){a.l.detalhes&&0!=a.l.detalhes.length||(a.l.detalhes=null,a.l.tipo=t<0?"d":"r",a.l.valor=t)}))}a.l=null,a.caretDisabled=!0,a.switchCriarRegra=!1,a.editingAll=!1,a.show=s,a.editAll=function(t){!1===t?(a.editingAll=!1,s(S.lancamentosImportacao[0])):(a.l&&(a.l.editando=!1),a.editingAll=!0,n=null,a.l={$descricaoOriginal:"Editar lançamentos marcados..."})},a.applyEditAll=function(){angular.forEach(S.lancamentosImportacao,(function(t){!t.$selectedMultiple||t.operacaoInvestimento||t.detalhes||(a.l.categoria&&t.tipo==a.l.tipo&&(t.categoria=a.l.categoria),a.l.centro&&(t.centro=a.l.centro),a.l.contato&&(t.contato=a.l.contato),a.l.projeto&&(t.projeto=a.l.projeto),a.l.forma&&(t.forma=a.l.forma),a.l.tags&&(t.tags=a.l.tags),(a.l.conta||S.contaConciliacao)&&(t.conta=a.l.conta||S.contaConciliacao.id,"CARTAOCREDITO"==p.get("contas",t.conta,!0).tipo&&(t.plastico=a.l.plastico||e("filter")(p.plasticos,{conta:t.conta,tipo:"T"})[0].id))),t.$selectedMultiple=!1})),a.l={$descricaoOriginal:"Editar lançamentos marcados..."}},a.criarRegra=function(){if(a.switchCriarRegra){var t={nome:a.l.$descricaoOriginal,descricao:a.l.descricao,tipoLancamento:a.l.tipo,categoria:a.l.categoria,centro:a.l.centro,contato:a.l.contato,forma:a.l.forma,projeto:a.l.projeto,plastico:a.l.plastico,tags:a.l.tags};"t"==a.l.tipo?a.l.valor<=0?(t.conta=a.l.conta,t.contaDestino=a.l.contaT):(t.conta=a.l.contaT,t.contaDestino=a.l.conta):t.conta=a.l.conta,v.nova(t).then(Y,(function(){a.switchCriarRegra=!1}))}},a.onChangeTipo=function(){if("g"==a.l.tipo)m();else{if(a.l.detalhes&&a.l.detalhes.length>0)return c.show({id:"desfazer-detalhes",templateUrl:"/partials/importacao/desfazerDetalhes.html",controller:function(){this.ok=function(){return c.hide()}},controllerAs:"vm"}).then((function(){a.l.detalhes=null}),(function(){a.l.tipo="g"}));a.l.categoria=null}},a.onChangeEstorno=function(){a.l.tipo="d"==a.l.tipo?"r":"d",a.l.categoria=null},a.detalharLancamento=m,a.opcoesParcelamento=function(){var t=a.l.valor<0?-1:1;f.parcelamentoEdicao(angular.extend({sempreValorParcela:!0},a.l)).then((function(o){"u"==o.agenda.repeticao?(a.l.agenda=null,a.l.valor=o.valor):(a.l.agenda=o.agenda,a.l.valor=o.valor),a.l.valor=Math.abs(a.l.valor)*t,a.edicaoCartao&&(a.vencimentos=U(a.l))}))},a.toggleConfirmar=function(){a.l.confirmado&&(a.l.conciliado=!1),a.l.confirmado=!a.l.confirmado},a.toggleConciliar=function(){a.l.conciliado||(a.l.confirmado=!0),a.l.conciliado=!a.l.conciliado,a.edicaoCartao&&(a.l.confirmado=a.l.conciliado)},a.filterCats=function(t){if(t.tipo!=a.l.tipo)return!1;var o=p.get("contas",a.l.conta,!0);return!("INVESTIMENTO"==o.tipo&&1==o.tipoInvestimento&&!t.tipoL)},a.filterPlasticos=function(a){return a.conta==S.idContaConciliacao||a.conta==S.painelEdicao.l.conta},a.toggleLembretes=function(t){if(a.l.displayLembretesLeft)return a.l.displayLembretesLeft=0;a.l.displayLembretesLeft=angular.element(t.currentTarget)[0].offsetLeft-36,a.l.displayLembretesTop=angular.element(t.currentTarget)[0].offsetTop-44,a.l.enviarLembrete||(a.l.enviarLembrete=!0,a.l.lembrete=0)},angular.element(i()).bind("scroll",d),function(){function o(t){if(!t||a.editingAll)return a.vencimentos=[],void(a.edicaoCartao=!1);p.get("contas",t).then((function(t){a.edicaoCartao="CARTAOCREDITO"==t.tipo,a.edicaoCartao&&(a.vencimentos=U(a.l))}))}a.vencimentos=[],a.edicaoCartao=!1,t.$watch("vm.painelEdicao.l.conta",o),t.$watch("vm.painelEdicao.l.data",(function(){S.idContaConciliacao&&o(S.idContaConciliacao)})),t.$watch("vm.painelEdicao.l.plastico",(function(){a.l.nomePlastico&&a.l.plastico&&(a.l.nomePlastico=null)}))}()},M=s(t,_),w=d.utilizacao,E=u(),y=S.lancamentosImportacao[0].data,I=S.lancamentosImportacao[0].data;m.changeTemplateUrl("/partials/importacao/importacaoTopmenu.html",S,!0);var O=a.onSuccess({to:function(a){return 0!==a.name.indexOf("importacao")}},(function(){m.changeTemplateUrl(null,null,!1),O()}));t.$on("$destroy",M),S.configuracoesService=d,S.importarMarcados=function(){return c.show({id:"importar-marcados",templateUrl:"/partials/importacao/importacaoConfirmar.html",bindToController:!0,controllerAs:"vm",controller:["$mdDialog","mdwMoment","conexoesApi",function(a,t,o){var e=this;e.foo=!0,e.lancamentosFuturo=!1,e.isAuto="auto"==e.formatoArquivo;for(var n=0;n<e.lancamentos.length;n++){var r=e.lancamentos[n];if(r.$isFuture&&(e.lancamentosFuturo=!0),!R(r)){e.error=1;break}}e.ok=function(){var n=[];const r=e.isAuto?e.contaConciliacao.connectionAccount:void 0;let i;return e.isAuto&&(i=o.registrarIdsImportados(r,e.lancamentosImportacao)),angular.forEach(e.lancamentos,(function(a){a=angular.copy(a);var o={},e=p.get("contas",a.conta,!0);!function(a){if(!a.agenda||"p"!=a.agenda.repeticao)return;const o=a.agenda.quantidade;for(var e=[],n=0;n<o;n++){var r=t(a.data).add(n*a.agenda.frequencia,a.agenda.intervalo).format("YYYY-MM-DD"),i=a.valor;e.push({data:r,valor:i})}a.parcelas=e}(a),angular.forEach(a,(function(t,n){"$"==n[0]||null===t||angular.isUndefined(t)||("data"!=n?"valor"!=n?"tipo"!=n||"t"!=t?o[n]=t:o.transferencia=!0:o.valorPrevisto=t:"CARTAOCREDITO"!=e.tipo||a.agenda&&-1==a.agenda.quantidade?o.dataPrevista=t:o.dataCompetencia=t)})),"CARTAOCREDITO"!=e.tipo&&(o.dataPrevista=a.data),o.confirmado&&(o.dataEfetiva=o.dataPrevista,o.valorEfetivo=o.valorPrevisto),o.parcelas&&(o.detalhes&&o.detalhes.forEach((function(a){a.valor=o.parcelas.reduce((t=>t+a.valor),0)})),o.valorPrevisto=o.parcelas.reduce(((a,t)=>a+t.valor),0)),o.transferencia&&(o.valorPrevisto>0?(o.contaDestino=o.conta,o.contaOrigem=o.contaT):(o.contaDestino=o.contaT,o.contaOrigem=o.conta)),o.estorno&&(o.descricao="Estorno "+o.descricao),n.push(o)})),n.length>0?f.importar(n,e.isAuto?{connectionAccount:r,maxDate:i}:void 0).then((function(){e.isAuto&&o.notify();var t=-1*moment().startOf("day").diff(y,"days"),n=moment(I).diff(y,"days");return C.transactionEntryFileAdded(e.formatoArquivo,t,n),a.hide()})):a.hide()}}],locals:{lancamentosImportacao:S.lancamentosImportacao,lancamentos:S.lancamentosImportacao.filter((function(a){return a.$selected})),formatoArquivo:S.formatoArquivo,contaConciliacao:S.contaConciliacao}}).then((function(){M(),n.go(i.ref)}))},S.totalMarcados=_,S.totalMarcadosEdicao=L,S.editarMultiplos=function(a){S.edicaoMultiplos=a,$.editAll(a)},S.editarRegra=function(a){v.editar(a).then(Y)},S.excluirRegra=function(a){v.excluir(a)},S.validar=R,S.toggleEdicao=function(){var a=L()!=S.lancamentosImportacao.length;angular.forEach(S.lancamentosImportacao,(function(t){t.$selectedMultiple=a}))},S.toggleImportacao=function(){var a=_()!=S.lancamentosImportacao.length;angular.forEach(S.lancamentosImportacao,(function(t){t.$selected=a}))},S.exibirDuplicidade=function(a){return g.get(a).then((function(a){f.detalhar(a,!1)}))},S.editarData=function(){var a=angular.copy(S.painelEdicao.l);return c.show({id:"editar-data-l-importacao",templateUrl:"/partials/importacao/editarData.html",controller:"editarDataLancImport",controllerAs:"vm",bindToController:!0,locals:{l:a}}).then((function(a){a&&(S.painelEdicao.l.data=a.data,S.painelEdicao.l.dataCompetencia&&(S.painelEdicao.l.dataCompetencia=a.data),T())}))},S.cancelar=function(){M(),n.go(i.ref)},S.anexarDocumentos=function(){A.anexar().then((function(a){a&&(S.painelEdicao.l.anexos=S.painelEdicao.l.anexos||[],a=a.filter((function(a){for(var t=!1,o=0;o<S.painelEdicao.l.anexos.length;o++)if(S.painelEdicao.l.anexos[o]==a){t=!0;break}return!t})),S.painelEdicao.l.anexos=S.painelEdicao.l.anexos.concat(a),S.painelEdicao.l.anexosObj=[],S.painelEdicao.l.anexos.forEach((function(a){x.get(a).then((function(a){S.painelEdicao.l.anexosObj.push(a)}))})))}))},S.unlinkAnexo=function(a){var t=S.painelEdicao.l.anexos.indexOf(a.id);S.painelEdicao.l.anexos.splice(t,1),S.painelEdicao.l.anexosObj=[],S.painelEdicao.l.anexos.forEach((function(a){x.get(a).then((function(a){S.painelEdicao.l.anexosObj.push(a)}))}))},S.$onInit=T}function T(){for(var a=0;a<p.categorias.length;a++)if(15==(D=p.categorias[a]).tipoL){D=D.id;break}S.lancamentosImportacao=S.lancamentosImportacao.sort(P),$.l=S.painelEdicao.l||S.lancamentosImportacao[0];var t=!1;angular.forEach(S.lancamentosImportacao,(function(a){a.nomePlastico&&(t=!0),a.$descricaoOriginal=a.descricao,a.data<y&&(y=a.data),a.data>I&&(I=a.data),a.dataCompetencia=a.dataCompetencia||a.data,a.$isFuture=u(a.data).isAfter(E),a.$selected=null==a.$selected?!a.$isFuture:a.$selected,a.confirmado=!a.$isFuture,b.regras&&j(a);S.idContaConciliacao&&(a.conta=S.idContaConciliacao,a.conciliado=a.confirmado,p.get("contas",a.conta,!0)),a.tipo?"t"==a.tipo&&(a.categoria=a.categoria||D):a.tipo=a.valor<0?"d":"r",U(a)})),t&&(S.lancamentosImportacao=S.lancamentosImportacao.sort((function(a,t){return a.nomePlastico<t.nomePlastico?-1:a.nomePlastico>t.nomePlastico?1:void 0}))),function(){S.idContaConciliacao||(S.idContaConciliacao=null);f.duplicidades(y,I,S.idContaConciliacao).then((function(a){S.lancamentosImportacao.forEach((function(t){if(a[t.data])for(var o=0;o<a[t.data].length;o++){var e=a[t.data][o];if(e.valor==t.valor){t.duplicidade=e.id,t.$selected=!1;break}}}))}))}(),$.show($.l)}function P(a,t){return moment(a.data).format("YYYYMMDD")-moment(t.data).format("YYYYMMDD")}function R(a){if(!(a.operacaoInvestimento||a.detalhes||a.conta&&a.categoria))return!1;if(!a.conta)return!1;if("t"==a.tipo&&!a.contaT)return!1;var t=S.configuracoesService.utilizacao;if(!a.detalhes){if("t"!=a.tipo){if(t.contatosO&&!a.contato)return!1;if(t.centrosO&&!a.centro)return!1;if(t.projetosO&&!a.projeto)return!1}if(t.formasO&&!a.forma)return!1}return!0}function Y(){angular.forEach(S.lancamentosImportacao,(function(a){j(a)}))}function j(a){if(a.descricao){a.descricao=""+a.descricao;var t=v.buscarRegrasLancamento(a.descricao.toLowerCase());if(0!=(t=t.filter((function(t){var o="d"==t.tipoLancamento||"t"==t.tipoLancamento;t="r"==t.tipoLancamento||"t"==t.tipoLancamento;return a.valor<0&&o||a.valor>0&&t}))).length){var o=t[0];a.tipo=o.tipoLancamento,a.categoria||(a.categoria=o.categoria),"t"==a.tipo?(o.categoria||a.categoria||(a.categoria=p.categorias.filter((function(a){return 15==a.tipoL}))[0].id),a.valor<0?(e(o.conta,o.plastico),a.contaT=o.contaDestino):(e(o.contaDestino,o.plastico),a.contaT=o.conta)):e(o.conta,o.plastico),w.contatos&&!a.contato&&(a.contato=o.contato),w.centros&&!a.centro&&(a.centro=o.centro),w.formas&&!a.forma&&(a.forma=o.forma),w.projetos&&!a.projeto&&(a.projeto=o.projeto),w.tags&&!a.tags&&(a.tags=o.tags),o.descricaoImportacao&&(a.descricao=o.descricao),a.$preenchidoRegra=o,a.plastico&&(a.nomePlastico=null)}}function e(t,o){if(S.idContaConciliacao?a.conta=S.idContaConciliacao:a.conta||(a.conta=t),o){var e=p.get("plasticos",o,!0);e&&e.conta==a.conta&&!a.plastico&&(a.plastico=o)}}}function _(){var a=0;return angular.forEach(S.lancamentosImportacao,(function(t){t.$selected&&a++})),a}function L(){var a=0;return angular.forEach(S.lancamentosImportacao,(function(t){t.$selectedMultiple&&a++})),a}function U(a){var t=p.get("contas",a.conta,!0);if("CARTAOCREDITO"==t.tipo){var o=[],n=u(t.proximoVencimento),r=u(a.data);for(a.agenda&&a.agenda.quantidade>1&&a.agenda.inicial>1&&r.add((a.agenda.inicial-1)*a.agenda.frequencia,a.agenda.intervalo);n.isBefore(r,"day");)n.add(1,"month");for(var i=0;i<5;i++)o.push(u(n).add(i,"months").format("YYYY-MM-DD"));S.vencimentos=o;var c=u(o[0]).subtract(t.fechamento,"days");return a.dataPrevista=S.vencimentos[r.isAfter(c,"day")?1:0],a.plastico=a.plastico||e("filter")(p.plasticos,{conta:a.conta,tipo:"T"})[0].id,o}}}a.$inject=["$transitions","$scope","$q","$filter","$state","$timeout","$stateParams","$mdDialog","mdwUnloadChecker","mdwApiError","mdwMoment","configuracoesService","mdwTopmenu","lancamentosService","cadastrosDatasource","regrasService","lancamentosDatasource","mdwDialogLoading","mdwAnalytics","importacaoService","documentosService","documentosDatasource"],angular.module("md").controller("ImportacaoController",a)}(),function(){"use strict";function a(a,t){a.state("conciliacao",{url:"/conciliacao?ref&conta&ff",templateUrl:"partials/importacao/conciliacao.html",controller:"ConciliacaoController",controllerAs:"vm",params:{extrato:null},onEnter:["$state","$stateParams",function(a,t){t.extrato||a.go(t.ref,{conta:t.conta})}]}).state("importacao",{url:"/importacao?ref&conta&ff",templateUrl:"partials/importacao/importacao.html",controller:"ImportacaoController",controllerAs:"vm",params:{extrato:null},onEnter:["$state","$stateParams",function(a,t){t.extrato||a.go(t.ref,{conta:t.conta})}]}).state("importacaov2",{url:"/importacaov2?ref&conta&ff",templateUrl:"partials/importacao/v2-importacao.html",controller:"ImportacaoV2Controller",controllerAs:"vm",params:{extrato:null},onEnter:["$state","$stateParams",function(a,t){t.extrato||a.go(t.ref,{conta:t.conta})}]}),t.addStates("conciliacao")}a.$inject=["$stateProvider","lancamentosRoutesProvider"],angular.module("md").config(a)}(),function(){"use strict";function a(a,t,o,e,n,r){var i=this;i.formatoArquivo=null,i.regras=!0,i.escolhaArquivo=function(a){return e.dialogPlano("importacao",(function(){return o.show({id:"escolher-tipo-arquivo",templateUrl:"/partials/importacao/escolhaTipoArquivo.html",controllerAs:"vm",controller:"ImportacaoEscolhaArquivoController",resolve:{contaConciliacao:["cadastrosDatasource",function(t){return a&&t.get("contas",a)}]}})}))},i.iniciar=function(t,o,e){var r=a.current.name;t=angular.copy(t),r.match(/extratoConta/)?r="extratoContas":r.match(/cartoes|fatura/)&&(r="cartoes");n.isEnabled()?a.go("importacaov2",{extrato:t,conta:o,ref:r,ff:e}):o?a.go("conciliacao",{extrato:t,conta:o,ref:r,ff:e}):a.go("importacao",{extrato:t,ref:r,ff:e})},i.modificarExtrato=function(a){return o.show({id:"modificar-extrato",controller:["$scope","extrato","mdwMoment",function(a,t,e){var n=this;t.inicio=e(t.inicio),t.fim=e(t.fim),n.sinal=t.saldo>0?1:-1,n.extrato=t,n.atualizar=function(){n.extrato.inicio=e(t.inicio).format("YYYY-MM-DD"),n.extrato.fim=e(t.fim).format("YYYY-MM-DD"),n.extrato.saldo=Math.abs(n.extrato.saldo)*n.sinal,o.hide(n.extrato)},n.dismiss=function(){o.cancel()},a.$watch("vm.sinal",(function(a){a&&(n.extrato.saldo*=a)}))}],controllerAs:"vm",templateUrl:"/partials/importacao/modificarExtrato.html",locals:{extrato:a}})}}a.$inject=["$state","$http","$mdDialog","usuariosService","conexoesService","MD_IN_PRODUCTION"],angular.module("md").service("importacaoService",a)}(),function(){"use strict";angular.module("md").directive("mdwImportacaoBtn",(function(){return a.$inject=["$scope","FileUploader","importacaoService"],{restrict:"E",link:function(a,t,o,e){},controller:a,transclude:!0,template:['<md-button aria-label="Importar lançamentos" class="md-fab md-raised md-mini">','<md-tooltip md-direction="left" md-autohide="false">Importar lançamentos</md-tooltip>',"<md-icon >file_upload</md-icon>",'<input type="file" accept=".ofx,.ofc,.xls,.xlsx" class="fileInput" nv-file-select uploader="uploader"/>',"</md-button>"].join("")};function a(a,t,o){var e=a.uploader=new t({url:"/api/v1/lancamentos/importar",autoUpload:!0});e.onCompleteItem=function(a,t,e,n){o.iniciar(t)},e.onAfterAddingFile=function(a){}}}))}(),function(){"use strict";function a(a){var o=this;function e(a,t){return("d"==a||"td"==a||"er"==a?-1:1)*Math.abs(t)}o.$onInit=function(){o.detalhes=[],o.l.lc.forEach((function(a){a.detalhes?a.detalhes.forEach((function(t){t.descricao=t.descricao+" - "+a.descricao,t.data=a.data,o.detalhes.push(t)})):o.detalhes.push(a)})),o.detalhes.forEach((function(a){var t,o,e;a.tipoL=(t=a.tipo,o=a.valor,e=a.estorno,"t"==t||"p"==t?o>0?"to":"td":e?o>0?"ed":"er":t)}))},o.excluirDetalhe=function(a){o.detalhes.splice(a,1)},o.incluirDetalhe=function(e){return a.show({id:"ajustar-conciliacao-incluir",templateUrl:"partials/importacao/v2-ajustar-conciliacao-incluir.html",bindToController:!0,controllerAs:"vm",locals:{conta:o.conta,ld:e},controller:t}).then((function(a){if(e){var t=o.detalhes.indexOf(e);o.detalhes[t]=a}else a.$editable=!0,o.detalhes.push(a)}))},o.diff=function(){return o.l.valor-(a=o.detalhes,t=0,angular.forEach(a,(function(a){t+=e(a.tipoL,a.valor)})),parseFloat(t.toFixed(2)));var a,t},o.descTipo=function(a){return"d"==a||"td"==a||"er"==a?"débito":"crédito"},o.ok=function(){return o.detalhes.forEach((function(a){a.valor=e(a.tipoL,a.valor),a.data=a.data||o.l.data})),a.hide(o.detalhes)}}function t(a,t,o){var e=this;e.configuracoesService=o,e.$onInit=function(){e.editando=!!e.ld,e.editando?e.ld=angular.copy(e.ld):e.ld={tipo:"d"},e.ld.tipoL=e.ld.tipoL||("t"!=e.ld.tipo?e.ld.tipo:e.ld.valor>0?"to":"td")},e.salvarDetalhes=function(){return a.hide(e.ld)},e.trocarTipo=function(){e.ld.tipo="to"==e.ld.tipoL||"td"==e.ld.tipoL?"t":e.ld.tipoL,e.ld.categoria=null},e.filterCats=function(a){return filtrarCategorias(e.ld,a,t.get("contas",e.l.conta,!0))},e.verificarMoedaTransf=function(){if("t"!=e.ld.tipo||!e.conta||!e.ld.contaT)return!1;var a=t.get("contas",e.conta,!0),o=t.get("contas",e.ld.contaT,!0);return a.moeda!=o.moeda}}a.$inject=["$mdDialog"],t.$inject=["$mdDialog","cadastrosDatasource","configuracoesService"],angular.module("md").controller("AjustarConciliacaoV2Controller",a)}(),function(){"use strict";t.$inject=["$scope","$state","$timeout","$filter","$q","$stateParams","$mdDialog","mdwUnloadChecker","mdwTopmenu","mdwMoment","mdwAccentFold","cadastrosDatasource","cartoesDatasource","importacaoService","mdwAnalytics","documentosService","documentosDatasource","lancamentosService","lancamentosDatasource","regrasService","relatoriosDatasource","configuracoesService"],o.$inject=["$mdDialog","$q","mdwMoment","configuracoesService","lancamentosService","cadastrosDatasource","conexoesApi"],angular.module("md").controller("ImportacaoV2Controller",t);var a=200;function t(t,e,n,r,i,c,s,l,u,d,m,f,p,v,g,h,C,b,A,x,S,D){var $,M,w,E=this,y=d();u.enabled=!1,E.pageSize=a,E.configUtilizacao=D.utilizacao,E.isAuto="auto"==c.ff,E.classicEnabled=!0,E.extrato=c.extrato,E.idConciliacao=c.conta,E.extrato.conta=E.idConciliacao;var I,O=!1;function T(a){"Shift"==a.key&&(O=!0)}function P(a){"Shift"==a.key&&(O=!1)}function R(t){E.pendentesCount=0,E.currentPage=t;var o=a*t;E.lancamentosPagina=E.extrato.lancamentos.slice(o,o+a),$=M=E.lancamentosPagina[0].data,E.lancamentosPagina.forEach((function(a,t){a.data<$&&($=a.data),a.data>M&&(M=a.data),function(a){if(a.e)return;var t=angular.copy(a);a.e=t,t.agenda={repeticao:"u",intervalo:"M",quantidade:2,frequencia:1,inicial:1},t.descricao=a.descricao,t.valor=a.valor,t.data=a.data,a.tipo?"t"==a.tipo&&(a.categoria=a.categoria||w):a.tipo=a.valor<0?"d":"r";t.tipo=a.tipo,t.$tipo=t.tipo,t.$sinalOrg=a.valor<0?-1:1,t.dataCompetencia=a.dataCompetencia||a.data,L(t),t.confirmado=!t.$isFuture,E.idConciliacao&&(t.conta=E.idConciliacao,t.conciliado=t.confirmado);(E.isAuto||v.regras)&&z(t);_(t)}(a),a._id=t+1,a.lc=[],U(a)})),E.lancamentos=E.lancamentosPagina,B(),E.loading={base:!0,rightp:!0},E.mapConciliacao={},E.idConciliacao&&(E.mapaConciliacao={},E.mapaConciliacaoNdoc={},E.lancamentosPagina.forEach((a=>{let t=`${a.data}_${a.valor}`;E.mapaConciliacao[t]||(E.mapaConciliacao[t]=[]),E.mapaConciliacao[t].push(a),a.ndocumento&&(t=`${t}_${a.ndocumento}`,E.mapaConciliacaoNdoc[t]||(E.mapaConciliacaoNdoc[t]=[]),E.mapaConciliacaoNdoc[t].push(a))}))),Y().then((function(){(function(){E.idConciliacao||(E.idConciliacao=null);return b.duplicidades($,M,E.idConciliacao).then((function(a){E.lancamentosPagina.forEach((function(t){if(a[t.data])for(var o=0;o<a[t.data].length;o++){var e=a[t.data][o];if(e.valor==t.valor){t.duplicidade=e.id,t.ignore=0==t.lc.length;break}}}))}))})().then((function(){E.loading.base=!1,n((function(){E.loading.rightp=!1}),10),E.selectLancamento(1),(E.lancamentosConciliacaoFiltro&&E.lancamentosConciliacaoFiltro.length>0||E.lancamentosConciliacaoOutros&&E.lancamentosConciliacaoOutros.length>0)&&(E.selectedTab=1)}))}))}function Y(a){if(!E.idConciliacao)return i.when();var t=function(a){E.loadingLancamentos=!1,a.sort(E.isConciliacaoCartao?function(a,t){var o=a.dataCompetencia,e=t.dataCompetencia;return o<e?-1:o>e?1:0}:function(a,t){var o=a.dataEfetiva||a.dataPrevista,e=t.dataEfetiva||t.dataPrevista;return o<e?-1:o>e?1:0}),function(a){E.lancamentosConciliacao=[];for(let o=0;o<a.length;o++){const e=a[o];E.lancamentosConciliacao.push(e);const n=E.isConciliacaoCartao?e.dataCompetencia:e.dataEfetiva||e.dataPrevista,r=`${n}_${e.valor}`,i=`${n}_${e.valor}_${e.ndocumento}`;t(e,E.mapaConciliacaoNdoc[i])||t(e,E.mapaConciliacao[r])}function t(a,t){if(!t)return!1;for(let o=0;o<t.length;o++){const e=t[o];if(!(e.lc&&e.lc.length>0))return e.lc=[a],E.mapConciliacao[a.id]={checked:!0,l:e},U(e),!0}return!1}}(a),E.lancamentosConciliacaoOutros=E.lancamentosConciliacao};if(E.isConciliacaoCartao){var o=f.get("contas",E.idConciliacao,!0);return E.dataFaturaConciliacao=o.proximoVencimento,p.carregarFatura(o.id,o.proximoVencimento).then((function(a){t(a.lancamentos)}))}E.conciliacao=a||{inicio:d(E.extrato.inicio).subtract(2,"days").toDate(),fim:d(E.extrato.fim).add(2,"days").toDate(),contas:[E.idConciliacao]},E.loadingLancamentos=!0;var e={finalidade:S.lancamentos.FIN_BUSCA,inicio:E.conciliacao.inicio,fim:E.conciliacao.fim,contas:{ids:E.conciliacao.contas}},n={pageSize:500,onCompleteIterate:t};return E.paginator=S.lancamentos.list(e,{},n),E.loadingLancamentos=!0,E.paginator.iterate(angular.noop)}function j(){if(!E.idConciliacao)return i.when();E.lancamentosConciliacaoFiltro=[],E.lancamentosConciliacaoOutros=[];for(var a=0;a<E.lancamentosConciliacao.length;a++){var t=E.lancamentosConciliacao[a],o=E.isConciliacaoCartao?t.dataCompetencia:t.dataEfetiva||t.dataPrevista;(E.carregarConciliados||"conciliado"!=t.status||E.selectedLanc.lc&&E.selectedLanc.lc.find((a=>a.id==t.id)))&&(E.mapConciliacao[t.id]&&E.mapConciliacao[t.id].checked&&E.mapConciliacao[t.id].l._id!=E.selectedLanc._id||(o==E.selectedLanc.data?E.lancamentosConciliacaoFiltro.push(t):E.lancamentosConciliacaoOutros.push(t)))}}function _(a){var t=f.get("contas",a.conta,!0);if("CARTAOCREDITO"==t.tipo){var o=[],e=d(t.proximoVencimento),n=d(a.data);for(a.agenda&&a.agenda.quantidade>1&&a.agenda.inicial>1&&n.add((a.agenda.inicial-1)*a.agenda.frequencia,a.agenda.intervalo);e.isBefore(n,"day");)e.add(1,"month");for(var i=0;i<5;i++)o.push(d(e).add(i,"months").format("YYYY-MM-DD"));var c=d(o[0]).subtract(t.fechamento,"days");return a.dataPrevista&&o.includes(a.dataPrevista)||(a.dataPrevista=o[n.isAfter(c,"day")?1:0]),a.plastico=a.plastico||r("filter")(f.plasticos,{conta:a.conta,tipo:"T"})[0].id,o}}function L(a){a.data=d(a.data).format("YYYY-MM-DD"),a.$isFuture=d(a.data).isAfter(y,"days"),a.$posicaoData=d(a.data).startOf("day").diff(moment().startOf("day"),"days"),a.$posicaoData>0&&void 0===a.lembrete&&(a.lembrete="0",a.enviarLembrete=!0)}function U(a){if(!1===a.valido&&E.pendentesCount--,a.lc.length>0)if(a.lc.length>1){var t=a.lc.reduce((function(a,t){return t.valor+a}),0);a.valido=Math.abs(t-a.valor)<.005}else a.lc[0].detalhes?a.valido=Math.abs(a.lc[0].valor-a.valor)<.005:a.valido=a.lc[0].valor/a.valor>0;else a.valido=function(){var t=a.e;if(!(t.detalhes||t.conta&&t.categoria))return!1;if(!t.conta)return!1;if("t"==t.tipo&&!t.contaT)return!1;var o=E.configUtilizacao;if(!t.detalhes){if("t"!=t.tipo){if(o.contatosO&&!t.contato)return!1;if(o.centrosO&&!t.centro)return!1;if(o.projetosO&&!t.projeto)return!1}const a="CARTAOCREDITO"==f.get("contas",t.conta,!0).tipo;if(o.formasO&&!t.forma&&!a)return!1}return!0}();a.valido||E.pendentesCount++}function F(a,t){E.lancamentosPagina.forEach((function(o){z(o.e,a,t),U(o)}))}function z(a,t,o){if(a.descricao){if(a.descricao=""+a.descricao,t){if(!x.matchRegraLancamento(t,a.descricao.toLowerCase()))return}else{var e=x.buscarRegrasLancamento(a.descricao.toLowerCase());if(0==(e=e.filter((function(t){var o="d"==t.tipoLancamento||"t"==t.tipoLancamento;t="r"==t.tipoLancamento||"t"==t.tipoLancamento;return a.valor<0&&o||a.valor>0&&t}))).length)return;t=e[0]}a.$tipo=t.tipoLancamento,a.tipo=a.$tipo;var n=a.$regra&&a.$regra.id===t.id;a.categoria&&!n||(a.categoria=t.categoria),"t"==a.tipo?(t.categoria||a.categoria||(a.categoria=f.categorias.filter((function(a){return 15==a.tipoL}))[0].id),a.valor<0?(r(t.conta,t.plastico),a.contaT=t.contaDestino):(r(t.contaDestino,t.plastico),a.contaT=t.conta)):r(t.conta,t.plastico),E.configUtilizacao.contatos&&(!a.contato||n||o)&&(a.contato=t.contato),E.configUtilizacao.centros&&(!a.centro||n||o)&&(a.centro=t.centro),E.configUtilizacao.formas&&(!a.forma||n||o)&&(a.forma=t.forma),E.configUtilizacao.projetos&&(!a.projeto||n||o)&&(a.projeto=t.projeto),E.configUtilizacao.tags&&(!a.tags||n||o)&&(a.tags=t.tags),t.descricaoImportacao&&(a.descricao=t.descricao),a.$regra=t,a.plastico&&(a.nomePlastico=null)}function r(t,e){if(E.idConciliacao?a.conta=E.idConciliacao:a.conta&&!o||(a.conta=t),e){var r=f.get("plasticos",e,!0);r&&r.conta==a.conta&&(!a.plastico||n||o)&&(a.plastico=e)}}}function k(){var a=E.selectedLanc.e,t=a.valor;return b.detalharEdicao(a).then((function(o){a.valor=o.lancamento.valor,a.data=d(o.lancamento.data).format("YYYY-MM-DD"),o.detalhes&&o.detalhes.length?(a.detalhes=o.detalhes,a.categoria=null,a.centro=null,a.contato=null,a.projeto=null):(a.detalhes=null,a.$tipo=t<0?"d":"r",a.valor=t)}),(function(o){a.detalhes&&0!=a.detalhes.length||(a.detalhes=null,a.$tipo=t<0?"d":"r",a.valor=t)}))}window.addEventListener("keydown",T),window.addEventListener("keyup",P),E.$onInit=function(){E.extraMods="conta,categoria,centro,contato,ndocumento",E.idConciliacao&&(E.extraMods="categoria,centro,contato,ndocumento");for(var o=0;o<f.categorias.length;o++)if(15==(w=f.categorias[o]).tipoL){w=w.id;break}I=l(t,(function(){return!0})),E.isConciliacaoCartao=E.idConciliacao&&"CARTAOCREDITO"==f.get("contas",E.idConciliacao,!0).tipo,t.$watchCollection("vm.selectedLanc.e",(function(a){if(E.edicaoCartao=!1,E.vencimentos=[],a&&a.conta){const t=f.get("contas",a.conta,!0);E.edicaoCartao="CARTAOCREDITO"==t.tipo}a&&E.selectedLanc._id&&(L(E.selectedLanc.e),U(E.selectedLanc),E.edicaoCartao&&(E.vencimentos=_(E.selectedLanc.e)))}));var e=t.$watch("form",(function(a){a.$submitted=!0,e()}));E.pages=Math.ceil(E.extrato.lancamentos.length/a),E.extrato.lancamentos.sort((function(a,t){var o=a.data,e=t.data;return o<e?-1:o>e?1:0})),R(0)},t.$on("$destroy",(function(){window.removeEventListener("keydown",T),window.removeEventListener("keyup",P),u.enabled=!0})),E.cancelar=function(){confirm("Deseja sair da importação?")&&(I(),e.go(c.ref))},E.versaoClassica=function(){return s.show({templateUrl:"/partials/importacao/v2-mudar-classica.html",controllerAs:"vm",controller:["$mdDialog",function(a){this.ok=function(){return a.hide()}}]}).then((function(){I(),E.idConciliacao?e.go("conciliacao",{extrato:E.extrato,conta:E.idConciliacao,ref:c.ref,ff:c.ff}):e.go("importacao",{extrato:E.extrato,ref:c.ref,ff:c.ff})}))},E.importarPagina=function(){return s.show({id:"importar-marcados",templateUrl:"/partials/importacao/v2-importacao-confirmar.html",bindToController:!0,controllerAs:"vm",controller:o,locals:{extrato:E.extrato,lancamentos:E.lancamentosPagina,isAuto:E.isAuto,tipoArquivo:c.ff}}).then((function(){E.nextPage()}))},E.nextPage=function(){if(E.currentPage+1==E.pages){var a=-1*moment().startOf("day").diff($,"days"),t=moment(M).diff($,"days");g.transactionEntryFileAdded(c.ff,a,t),I(),e.go(c.ref)}else R(E.currentPage+1)},E.exibirDuplicidade=function(a){return A.get(a).then((function(a){b.detalhar(a,!1)}))},E.onChangeCarregarConciliados=function(){j()},E.modificarBuscaConciliacao=function(){return s.show({id:"modificar-busca",controller:["busca","mdwMoment","cadastrosDatasource",function(a,t,o){var e=this;e.contas=o.contas.filter((function(a){return a.status&&("CONTA CORRENTE"==a.tipo||"DINHEIRO"==a.tipo||"OUTROS"==a.tipo)})),a.inicio=t(a.inicio),a.fim=t(a.fim),e.busca=a,e.atualizar=function(){e.busca.inicio=t(e.busca.inicio).format("YYYY-MM-DD"),e.busca.fim=t(e.busca.fim).format("YYYY-MM-DD"),s.hide(e.busca)},e.dismiss=function(){s.cancel()}}],controllerAs:"vm",templateUrl:"/partials/importacao/modificarBuscaConciliacao.html",locals:{busca:angular.copy(E.conciliacao)}}).then((function(a){Y(a)}))},E.onCheckConc=function(a){if(E.mapConciliacao[a.id].checked)E.mapConciliacao[a.id].l=E.selectedLanc,E.selectedLanc.lc||(E.selectedLanc.lc=[]),E.selectedLanc.lc.push(a);else{E.mapConciliacao[a.id]=void 0;const t=[a.id];a.detalhes&&a.detalhes.forEach((a=>t.push(a.id)));const o=[];E.selectedLanc.lc.forEach((a=>{a.id&&t.includes(a.id)||o.push(a)})),E.selectedLanc.lc=o,E.selectedLanc.lc.find((a=>!!a.id))||(E.selectedLanc.lc=[])}U(E.selectedLanc),G()},E.excluirLancamento=function(a){a.ignore||(a.ignore=!0,!1===a.valido&&E.pendentesCount--)},E.restaurarLancamento=function(a){a.ignore&&(a.ignore=!1,!1===a.valido&&E.pendentesCount++)},E.excluirMarcados=function(){E.lancamentos.forEach((function(a){E.selection[a._id]&&E.excluirLancamento(a)})),B()},E.restaurarMarcados=function(){E.lancamentos.forEach((function(a){E.selection[a._id]&&E.restaurarLancamento(a)}))},E.verificarMoedaTransf=function(){const a=E.selectedLanc.e;if("t"!=a.tipo||!a.conta||!a.contaT)return!1;var t=f.get("contas",a.conta,!0),o=f.get("contas",a.contaT,!0);return t.moeda!=o.moeda},E.editarMarcados=function(){var a=E.selectedLanc.e;E.lancamentos.forEach((function(t){if(E.selection[t._id]){var o=t.e;if(a.categoriaD&&"d"==o.tipo&&(o.categoria=a.categoriaD),a.categoriaR&&"r"==o.tipo&&(o.categoria=a.categoriaR),a.centro&&(o.centro=a.centro),a.contato&&(o.contato=a.contato),a.projeto&&(o.projeto=a.projeto),a.forma&&(o.forma=a.forma),a.tags&&(o.tags=a.tags),a.conta)o.conta=a.conta,"CARTAOCREDITO"==f.get("contas",o.conta,!0).tipo&&(o.plastico=a.plastico||r("filter")(f.plasticos,{conta:o.conta,tipo:"T"})[0].id);else if(a.plastico){const t=f.get("plasticos",a.plastico,!0);t&&t.conta==E.idConciliacao&&(o.plastico=a.plastico)}U(t)}})),E.selectedLanc.e={},B()},E.ajustarValoresGrupo=function(a){return s.show({id:"ajustar-conciliacao",templateUrl:"partials/importacao/v2-ajustar-conciliacao.html",bindToController:!0,locals:{l:angular.copy(a),conta:E.idConciliacao},controllerAs:"vm",controller:"AjustarConciliacaoV2Controller"}).then((function(t){a.lc=t,U(a)}))},E.dialogOpcoesParcelamento=function(){var a=E.selectedLanc.e,t=a.valor<0?-1:1;b.parcelamentoEdicao(angular.extend({sempreValorParcela:!0},a)).then((function(o){"u"==o.agenda.repeticao?(a.agenda=null,a.valor=o.valor):(a.agenda=o.agenda,a.valor=o.valor),a.valor=Math.abs(a.valor)*t}))},E.toggleConfirmar=function(){var a=E.selectedLanc.e;a.confirmado&&(a.conciliado=!1),a.confirmado=!a.confirmado},E.toggleConciliar=function(){var a=E.selectedLanc.e;a.conciliado||(a.confirmado=!0),a.conciliado=!a.conciliado},E.onChangeRepeticao=function(){var a=E.selectedLanc.e;"u"==a.agenda.repeticao&&(a.agenda={repeticao:"u",intervalo:"M",quantidade:1,frequencia:1,inicial:1})},E.onChangeValor=function(){E.selectedLanc.e.valor=Math.abs(E.selectedLanc.e.valor)*E.selectedLanc.e.$sinalOrg},E.onChangeTipo=function(){var a=E.selectedLanc.e,t=a.$tipo;if(a.estorno="e"==t,a.estorno&&(t=E.selectedLanc.valor<0?"r":"d"),a.tipo=t,"g"==t)k().then((function(){a.tipo=a.$tipo}));else if("e"==t)a.categoria=null;else{if(a.detalhes&&a.detalhes.length>0)return s.show({id:"desfazer-detalhes",templateUrl:"/partials/importacao/desfazerDetalhes.html",controller:function(){this.ok=function(){return s.hide()}},controllerAs:"vm"}).then((function(){a.detalhes=null}),(function(){a.tipo=a.$tipo="g"}));a.categoria=null}},E.detalharLancamento=k,E.anexarDocumentos=function(){var a=E.selectedLanc.e;return h.anexar().then((function(t){t&&(a.anexos=a.anexos||[],t=t.filter((function(t){for(var o=!1,e=0;e<a.anexos.length;e++)if(a.anexos[e]==t){o=!0;break}return!o})),a.anexos=a.anexos.concat(t),a.anexosObj=[],a.anexos.forEach((function(t){C.get(t).then((function(t){a.anexosObj.push(t)}))})))}))},E.editarRegra=function(a){return x.editar(a).then((a=>F(a,!0)))},E.excluirRegra=function(a){return x.excluir(a).then((function(){E.lancamentosPagina.forEach((function(t){t.e.$regra&&t.e.$regra.id==a.id&&delete t.e.$regra}))}))},E.criarRegra=function(){var a=E.selectedLanc.e,t={nome:a.descricao,descricao:a.descricao,tipoLancamento:a.tipo,categoria:a.categoria,centro:a.centro,contato:a.contato,forma:a.forma,projeto:a.projeto,plastico:a.plastico,tags:a.tags,isImportacaoV2:!0};"t"==a.tipo?a.valor<=0?(t.conta=a.conta,t.contaDestino=a.contaT):(t.conta=a.contaT,t.contaDestino=a.conta):t.conta=a.conta,x.nova(t).then((a=>F(a,!0)))},E.filterPlasticos=function(a){return a.conta==E.idConciliacao||a.conta==E.selectedLanc.e.conta},E.toggleLembretes=function(a){var t=E.selectedLanc.e;if(t.$displayLembretesLeft)return t.$displayLembretesLeft=0;t.$displayLembretesLeft=angular.element(a.currentTarget)[0].offsetLeft-13,t.$displayLembretesTop=angular.element(a.currentTarget)[0].offsetTop-44,t.enviarLembrete||(t.enviarLembrete=!0,t.lembrete=0)},E.filtro="",E.apenasPendentes=!1,E.onChangeApenasPendentes=function(){B(),E.filtrar(),E.lancamentos.length>0&&E.selectLancamento(E.lancamentos[0]._id)},E.limparFiltro=function(){E.filtro="",E.filtrar()},E.filtrar=function(){if(q=0,E.countNoFilter=0,E.apenasPendentes||E.filtro.length>0){var a=m(E.filtro||""),t=a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),o=a.length<4?"\\s+":"";E.lancamentos=[],E.lancamentosPagina.forEach((function(a){E.apenasPendentes&&!E.selection[a._id]&&(a.valido||a.ignore)||(!E.filtro||m(a.descricao).match(new RegExp("(^"+t+")|("+o+t+")","i"))?(E.lancamentos.push(a),E.selection[a._id]&&q++):E.countNoFilter++)}))}else E.lancamentos=E.lancamentosPagina,q=E.selectionCount;G()};var N,q,V=0;function B(){E.selectionCount=0,q=0,E.selection={},E.selectAll=!1,E.selectAllIndet=!1,E.selectedLanc=null,N=null,E.loteEnabled=!1}function G(){var a=0;E.lancamentos.forEach((function(t){0==t.lc.length&&a++})),E.disableSelectAll=0==a,E.selectAllIndet=!E.disableSelectAll&&q>0&&q<a,E.selectAll=!E.disableSelectAll&&q==a}function H(a){E.selectedLanc={e:{}},a&&(E.loteEnabled=!1,E.selectedLanc=E.lancamentosPagina[a-1],j())}E.selectedTab=0,E.selectLancamento=function(a){E.selectedLanc&&E.selectedLanc._id==a||(B(),H(a),function(){if(V==E.selectedTab){var a=E.selectedLanc.lc.length>0?1:0;E.selectedTab!=a&&(E.selectedTab=a,V=E.selectedTab)}}())},E.onChangeSelection=function(a,t){var o=E.lancamentos,e=E.lancamentosPagina[a-1];if(E.selectedLanc&&E.selectedLanc.lc&&E.selectedLanc.lc.length>0&&(E.selection[E.selectedLanc._id]=!1),O&&N){var n,r=!1,i=!!E.selection[a];s=i?1:-1;e.lc.length>0&&(s=0),E.selectionCount+=s,q+=s;for(var c=0;c<o.length;c++){e=o[c];if(!r){if(e._id!=a&&e._id!=N)continue;r=!0,n=e._id==a?N:a}if(0==e.lc.length&&(E.selection[e._id]!=i&&(E.selectionCount+=s,q+=s),E.selection[e._id]=i),e._id==n)break}}else{var s=E.selection[a]?1:-1;e.lc.length>0&&(s=0),E.selectionCount+=s,q+=s}E.selectionCount<0&&(E.selectionCount=0),N=a;var l=E.selectionCount>0;l||(N=null),E.loteEnabled=l,G(),H(),E.filtrar()},E.changeAll=function(){E.selectAll=E.selectAllIndet||!E.selectAll;var a=E.selectAll,t=E.lancamentos,o=0,e=0;t.forEach((function(t){if(t.lc.length>0)return!a&&E.selection[t._id]&&o--,void(E.selection[t._id]=!1);e++,a&&!E.selection[t._id]?o++:!a&&E.selection[t._id]&&o--,E.selection[t._id]=a,E.selection[t._id]&&t._id})),q=a?e:0,E.selectionCount+=o,E.selectionCount<0&&(E.selectionCount=0),E.loteEnabled=E.selectionCount>0,E.selectAllIndet=!1,H()}}function o(a,t,o,e,n,r,i){var c=this,s=e.getConfig("conciliacao",{o:"d",s:!1,sd:!1});function l(){s.s=c.sobrescrever,s.sd=c.sobrescreverDescr,e.updateConfig("conciliacao",s)}c.sobrescrever=s.s,c.sobrescreverDescr=s.sd,c.$onInit=function(){c.resumo={invalido:0,ignorar:0,conciliar:0,importar:0},c.lancamentos.forEach((function(a){var t="importar";a.ignore?t="ignorar":a.valido?a.lc.length>0&&(t="conciliar"):t="invalido",c.resumo[t]++}))},c.dismiss=a.cancel,c.toggleSobrescrever=function(){l()},c.toggleSobrescreverDescr=function(){l()},c.ok=function(){if(c.resumo.invalido>0&&!c.ignorarPendentes)return;var e=[],s=[];let l,u,d;if(c.lancamentos.forEach((function(a){a.valido&&!a.ignore&&(c.extrato.conta&&a.lc.length>0?s.push(function(a){let t={data:a.data,valor:a.valor,centro:a.centro,contato:a.contato,projeto:a.projeto,categoria:a.categoria,ndocumento:a.ndocumento,descricao:a.descricao,tags:a.tags};a.lc.length>1?t.agrupar=a.lc.map((function(a){return{id:a.id,valor:a.valor,valorT:a.valorT,descricao:a.descricao,categoria:a.categoria,contato:a.contato,centro:a.centro,projeto:a.projeto,contaT:a.contaT,tags:a.tags}})):t.ids=a.lc.map((function(a){return a.id}));return t}(a)):e.push(function(a){var t=angular.copy(a.e),e={},n=r.get("contas",t.conta,!0);(function(a){if(!a.agenda||"p"!=a.agenda.repeticao)return;const t=a.agenda.quantidade;for(var e=[],n=0;n<t;n++){var r=o(a.data).add(n*a.agenda.frequencia,a.agenda.intervalo).format("YYYY-MM-DD"),i=a.valor;e.push({data:r,valor:i})}a.parcelas=e})(t),angular.forEach(t,(function(a,o){"$"==o[0]||null===a||angular.isUndefined(a)||("data"!=o?"valor"!=o?"tipo"!=o||"t"!=a?e[o]=a:e.transferencia=!0:e.valorPrevisto=a:"CARTAOCREDITO"!=n.tipo||t.agenda&&-1==t.agenda.quantidade?e.dataPrevista=a:e.dataCompetencia=a)}));"CARTAOCREDITO"!=n.tipo&&(e.dataPrevista=t.data);e.confirmado&&(e.dataEfetiva=e.dataPrevista,e.valorEfetivo=e.valorPrevisto);e.parcelas&&(e.detalhes&&e.detalhes.forEach((function(a){a.valor=e.parcelas.reduce((t=>t+a.valor),0)})),e.valorPrevisto=e.parcelas.reduce(((a,t)=>a+t.valor),0));e.transferencia&&(e.valorPrevisto>0?(e.contaDestino=e.conta,e.contaOrigem=e.contaT):(e.contaDestino=e.contaT,e.contaOrigem=e.conta),e.valorPrevistoT=e.valorT,e.confirmado&&(e.valorEfetivoT=e.valorT));e.estorno&&(e.descricao="Estorno "+e.descricao);e.agenda&&("u"==e.agenda.repeticao?delete e.agenda:"f"==e.agenda.repeticao&&(e.agenda.quantidade=-1));return e}(a)))})),c.extrato.conta){var m={sobrescrever:c.sobrescrever,sobrescreverDescr:c.sobrescreverDescr,inicio:c.extrato.inicio,fim:c.extrato.fim,saldo:c.extrato.saldo,conta:c.extrato.conta,lancamentos:s};c.isAuto&&(l=r.get("contas",c.extrato.conta,!0).connectionAccount,m.connectionAccount=l,d=i.registrarIdsImportados(l,c.lancamentos.map((a=>a.e))),m.maxDate=d),u=n.conciliacao(m)}else u=t.when();return u.then((function(){return n.importar(e,c.isAuto?{connectionAccount:l,maxDate:d}:void 0).then((function(){return c.isAuto&&i.notify(),a.hide()}))}))}}}(),function(){"use strict";function a(a){var t={};return function(a){return t[a]||(t[a]=new o(a)),t[a]};function o(t){var o=this,e="analise_"+t;o.config=a.getConfig(e,{c:0,cf:null,m:1,e:0,g:0,p:6}),o.updateConfig=function(t){o.config=t,a.updateConfig(e,t)}}}function t(a,t,o,e,n,r,i,c,s,l){var u=this;u.service=s(l),u.maxDate=moment().endOf("month"),u.minDate=moment(n),u.meses=[2,3,4,5,6,7,8,9,10,11,12,13],u.calendarioConfig={restrict:["m"]},u.mensal="mensal"==l;var d=u.service.config;if(u.contas=i.contas.filter((function(a){return a.status&&("CONTA CORRENTE"==a.tipo||"INVESTIMENTO"==a.tipo)})),u.contas.sort((function(a,t){return a.nome<t.nome?-1:1})),u.moeda=d.m,u.contasFiltradas=d.cf,u.conta=d.c,u.estrategia=d.e,u.grupo=d.g,u.periodo=d.p,t.params&&t.params.p)try{var m=angular.fromJson(atob(t.params.p));u.estrategia=m.e||d.e,u.grupo=m.g||d.g,u.conta=m.c||d.c,u.moeda=m.m||d.m,u.periodo=m.p||d.p,u.contasFiltradas=m.cf||d.cf}catch(a){}t.params&&t.params.inicio?u.inicio=moment(t.params.inicio):u.inicio=moment().subtract(u.periodo-1,"months"),u.printConfig={controller:"AnaliseCarteira"+l+"Controller",templateUrl:"/partials/investimentos/analise/"+l+"/print.html",landscape:!0},u.estrategias=[],u.grupos=[],u.$onInit=function(){r.carregarEstrategias().then((function(a){a.forEach((function(a){if(a.status){var t=angular.copy(a);t.grupos.sort((function(a,t){return a.nome<t.nome?-1:1})),u.estrategias.push(t)}})),p()}))};var f=e.onBefore({to:function(a){return 0===a.name.indexOf("analise_"+l)}},(function(a){var t=a.params();if(t.p)try{var o=angular.fromJson(atob(t.p));u.estrategia=o.e||d.e,u.grupo=o.g||d.g,u.conta=o.c||d.c,u.moeda=o.m||d.m,u.periodo=o.p||d.p,u.contasFiltradas=o.cf||d.cf}catch(a){}else u.contasFiltradas=d.cf,u.conta=d.c,u.estrategia=d.e,u.grupo=d.g,u.moeda=d.m,u.periodo=d.p}));function p(){if(u.grupos=[],0==u.estrategia)angular.forEach(c,(function(a,t){u.grupos.push({id:t,nome:a})}));else for(var a=0;a<u.estrategias.length;a++)if(u.estrategias[a].id==u.estrategia){u.grupos=u.estrategias[a].grupos;break}}function v(){var a=u.mensal?angular.copy(t.params):{inicio:moment(u.inicio).format("YYYY-MM-DD")},o={c:u.conta,m:u.moeda,p:u.periodo};u.estrategia&&(o.e=u.estrategia),u.grupo&&(o.g=u.grupo),u.contasFiltradas&&(o.cf=u.contasFiltradas),a.p=btoa(angular.toJson(o)),t.go(".",a)}function g(){d.c=u.conta,d.cf=u.contasFiltradas,d.e=u.estrategia,d.g=u.grupo,d.m=u.moeda,d.p=u.periodo,u.service.updateConfig(d)}function h(a){var t=angular.toJson(u.contasFiltradas);return o.show({id:"edicao-filtro-carteira-resultado",templateUrl:"/partials/investimentos/carteira/filtro.html",controller:"EditarFiltroCarteiraController",bindToController:!0,locals:{contasFiltradas:u.contasFiltradas,contas:u.contas},controllerAs:"vm"}).then((function(a){u.contasFiltradas=a&&a.length>0?a:null,u.contasFiltradas?t!=angular.toJson(u.contasFiltradas)&&(g(),v()):u.conta=0}),(function(){void 0!==a&&(u.conta=a)}))}a.$on("$destroy",(function(){f()})),u.onChangeEstrategia=function(){u.grupo=0,p(),g(),v()},u.onChangeGrupo=function(){g(),v()},a.$watch("vm.conta",(function(a,t){-1!=t&&-1==a&&h(t)})),u.onChangeConta=function(){-1!=u.conta&&(u.contasFiltradas=null,g(),v())},u.onChangeMoeda=function(a){u.moeda=a,g(),v()},u.carregarEvolucao=function(){d.p!=u.periodo&&g(),v()},u.filtrarContas=h}t.$inject=["$scope","$state","$mdDialog","$transitions","DATA_INICIO_RENTABILIDADE","estrategiasDatasource","cadastrosDatasource","mdwNomeGrupoInvest","AnaliseCarteiraService","tipoAnalise"],a.$inject=["configuracoesService"],angular.module("md").factory("AnaliseCarteiraService",a).controller("AnaliseCarteiraController",t)}(),function(){"use strict";function a(a,t,o){t&&["mensal","evolucao"].forEach((function(t){a.state("analise_"+t,{abstract:!0,url:"/analise/"+t,controller:"AnaliseCarteiraController",controllerAs:"vm",templateUrl:"partials/investimentos/analise/analise.html",resolve:{tipoAnalise:function(){return t}}}).state("analise_"+t+".dados",{url:"?inicio&p",controller:"AnaliseCarteira"+t+"Controller",controllerAs:"vm",templateUrl:"partials/investimentos/analise/"+t+"/"+t+".html"})}))}a.$inject=["$stateProvider","MD_INVEST_MOD","operacoesRoutesProvider"],angular.module("md").config(a)}(),function(){"use strict";function a(a,t,o,e,n,r,i,c){var s=this;s.service=n("evolucao"),s.$onInit=function(){if(t.p)try{var a=angular.fromJson(atob(t.p));s.estrategia=+a.e,s.grupo=+a.g,s.conta=+a.c,s.moeda=+a.m,s.contasFiltradas=a.cf,s.periodo=+a.p,s.conta>0&&(s.contasFiltradas=[s.conta])}catch(a){}else{var n=s.service.config;s.moeda=n.m,s.contasFiltradas=n.cf,s.conta=n.c,s.estrategia=n.e,s.grupo=n.g,s.periodo=n.p,s.conta>0&&(s.contasFiltradas=[s.conta])}l=t.inicio?moment(t.inicio).startOf("month"):moment().startOf("month").subtract(s.periodo-1,"months");u=moment(l).add(s.periodo-1,"months").endOf("month"),function(){var a=m();a.inicio=moment(a.inicio).subtract(1,"day").format("YYYY-MM-DD"),a.grupo&&!s.estrategia&&(a.estrategia=0);o.carregarRentabilidadeCarteira(a).then((function(a){s.loading.rentabilidade=!1,s.rent=a,c.prepareChartOptions(s.rent.chart.options),c.prepareChartOptions(s.rent.chartMes.options)}))}(),r=m(),r.tipo="evolucao",e.getAnaliseCarteira(r).then((function(a){s.loading.carteira=!1,s.carteira=a})),function(){var a=m();e.getIndicadoresCarteira(a).then((function(a){s.loading.indicadores=!1,s.indicadores=a}))}(),function(){var a=m();a.converter=s.moeda;var t=i(a);t.getVisaoTotal(s.moeda).then((function(a){s.loading.proventos=!1,s.chartProventoTotal=a.chart,c.prepareChartOptions(s.chartProventoTotal.options)})),t.getVisaoMensal(s.moeda).then((function(a){s.chartProventoMensal=a.chart,c.prepareChartOptions(s.chartProventoMensal.options)}))}();var r},r.title="Evolução da Carteira";var l,u,d=c.onChange((function(){s.rent&&(c.prepareChartOptions(s.rent.chart.options),c.prepareChartOptions(s.rent.chartMes.options));s.chartProventoTotal&&c.prepareChartOptions(s.chartProventoTotal.options);s.chartProventoMensal&&c.prepareChartOptions(s.chartProventoMensal.options)}));function m(){var a={inicio:l.format("YYYY-MM-DD"),fim:u.format("YYYY-MM-DD")};return s.estrategia&&(a.estrategia=s.estrategia),s.grupo&&(a.grupo=s.grupo),s.contasFiltradas&&(a.contas=s.contasFiltradas.join(",")),s.moeda&&(a.moeda=s.moeda),a}a.$on("$destroy",(function(){d()})),s.loading={rentabilidade:!0,carteira:!0,proventos:!0,indicadores:!0}}a.$inject=["$scope","$stateParams","rentabilidadeService","investimentosDatasource","AnaliseCarteiraService","mdwTopmenu","analiseCarteiraProventos","mdwDarkModeService"],angular.module("md").controller("AnaliseCarteiraevolucaoController",a)}(),function(){"use strict";function a(a,t,o,e,n,r,i,c,s,l){var u=this;u.service=i("mensal"),u.$onInit=function(){if(t.p)try{var a=angular.fromJson(atob(t.p));u.estrategia=+a.e,u.grupo=+a.g,u.conta=+a.c,u.moeda=+a.m,u.contasFiltradas=a.cf,u.conta>0&&(u.contasFiltradas=[u.conta])}catch(a){}else{var i=u.service.config;u.moeda=i.m,u.contasFiltradas=i.cf,u.conta=i.c,u.estrategia=i.e,u.grupo=i.g,u.conta>0&&(u.contasFiltradas=[u.conta])}t.inicio?(d=moment(t.inicio).startOf("month"),m=moment(d).endOf("month")):(d=moment().startOf("month"),m=moment().subtract(1,"day"));(function(){var a=p();a.inicio=moment(d).subtract(1,"day").format("YYYY-MM-DD"),a.grupo&&!u.estrategia&&(a.estrategia=0);n.carregarRentabilidadeCarteira(a).then((function(a){u.loading.rentabilidade=!1,u.rent=a,l.prepareChartOptions(u.rent.chart.options),l.prepareChartOptions(u.rent.chartMes.options)}))})(),function(){var a=p();a.tipo="mensal";var t=o("moeda")(u.moeda)+" ";return r.getAnaliseCarteira(a).then((function(a){u.loading.carteira=!1,u.carteira=a;var r={type:"PieChart",data:{cols:[{id:"grupo",label:"Grupo",type:"string"},{id:"saldo",label:"Saldo total atualizado",type:"number"},{role:"style",type:"string"}],rows:[]},options:l.prepareChartOptions({backgroundColor:"transparent",pieHole:.4,sliceVisibilityThreshold:.01,legend:{position:"labeled"},chartArea:{width:"80%",height:"80%"},tooltip:{trigger:"selection"}})},i=[];a.grupos.sort(n),a.grupos.forEach((function(a,c){if(a.ativos.sort(n),!(a.saldoFim<0)){var s=[{v:a.grupo},{v:a.saldoFim,f:o("currency")(a.saldoFim,t)}];r.data.rows.push({c:s}),i.push(e.getColorAtIndex(c))}})),r.options.colors=i,u.carteira.chart=r}));function n(a,t){return a.saldoFim>t.saldoFim?-1:1}}(),c=p(),r.getIndicadoresCarteira(c).then((function(a){u.loading.indicadores=!1,u.indicadores=a})),function(){var a=p();a.converter=u.moeda,s(a).getVisaoTotal(u.moeda).then((function(a){u.loading.proventos=!1,u.chartProventoTotal=a.chart,l.prepareChartOptions(u.chartProventoTotal.options)}))}();var c};var d,m,f=l.onChange((function(){u.rent&&(l.prepareChartOptions(u.rent.chart.options),l.prepareChartOptions(u.rent.chartMes.options));u.carteira&&l.prepareChartOptions(u.carteira.chart.options);u.chartProventoTotal&&l.prepareChartOptions(u.chartProventoTotal.options)}));function p(){var a={inicio:d.format("YYYY-MM-DD"),fim:m.format("YYYY-MM-DD"),dateFmt:"DD"};return u.estrategia&&(a.estrategia=u.estrategia),u.grupo&&(a.grupo=u.grupo),u.contasFiltradas&&(a.contas=u.contasFiltradas.join(",")),u.moeda&&(a.moeda=u.moeda),a}a.$on("$destroy",(function(){f()})),c.title="Análise Mensal da Carteira",u.loading={rentabilidade:!0,carteira:!0,indicadores:!0,proventos:!0}}a.$inject=["$scope","$stateParams","$filter","mdwColors","rentabilidadeService","investimentosDatasource","AnaliseCarteiraService","mdwTopmenu","analiseCarteiraProventos","mdwDarkModeService"],angular.module("md").controller("AnaliseCarteiramensalController",a)}(),function(){"use strict";angular.module("md").factory("analiseCarteiraProventos",["$q","$filter","ativosService","mdwDarkModeService","moedaService","investimentosDatasource",function(a,t,o,e,n,r){var i,c={};function s(){return{type:"ColumnChart",data:{cols:[],rows:[]},options:e.prepareChartOptions({hAxis:{gridlines:{color:"transparent",units:{months:{format:["MMM yy"]},days:{format:["dd MMM","dd"]}}},minorGridlines:{color:"transparent",units:{days:{format:[""]},hours:{format:[""]}}}},isStacked:!0,legend:{position:"none"},focusTarget:"category",chartArea:{width:"80%",height:"60%"},tooltip:{isHtml:!1,trigger:"both"}}),formatters:{date:[{columnNum:0,pattern:"MMMM 'de' yyyy"}]}}}function l(a){return c[a]?c[a].nome:"Não identificado"}return function(e){var u={},d=r.carregarProventos(e);return i||(i=o.carregarGrupos().then((function(a){return a[1].forEach((function(a){c[a.id]=a})),c}))),u.getTotais=function(){return d.then((function(a){var t={},o=[],e={},n={},r={};return a.total.forEach((function(a){t[a.moeda]||(t[a.moeda]=!0,o.push(a.moeda),e[a.moeda]={valor:0,yield:0},n[a.moeda]=0,r[a.moeda]=0),e[a.moeda].valor+=a.valor,a.yield&&(r[a.moeda]+=a.cotacao,n[a.moeda]+=a.unitario)})),o.forEach((function(a){e[a].yield=n[a]/r[a]})),e}))},u.getAtivos=function(){return i},u.getProventos=function(){return d},u.getVisaoTotal=function(o,e){return a.all([d,i]).then((function(a){var r=a[0],i=t("moeda")(o)+" ",c=s();c.data.rows=[],c.options.vAxis||(c.options.vAxis={}),c.options.vAxis.format=e?"percent":n.getChartCurrencyFormat(o),c.options.tooltip.isHtml=!1,c.data.cols=[{label:"Ativo",type:"string"},{label:e?"Yield":"Proventos",type:"number"},{role:"style",type:"string"}],c.options.series={};var u=e?function(a,t){return a.yield<t.yield?1:-1}:function(a,t){return a.valor<t.valor?1:-1};r.total.sort(u);var d=e?"yield":"valor";return r.total.forEach((function(a){if(a.moeda==o){var n=e?t("number")(100*a[d],2)+"%":t("currency")(a[d],i);c.data.rows.push({c:[{v:l(a.ativo)},{v:a[d],f:n},{v:r.ativos[a.ativo].color}]})}})),{chart:c}}))},u.getVisaoMensal=function(o){return a.all([d,i]).then((function(a){var e=a[0],r=s();r.options.vAxis||(r.options.vAxis={}),r.options.vAxis.format=n.getChartCurrencyFormat(o);var i=t("moeda")(o)+" ";r.options.tooltip.isHtml=!0,r.data.cols=[{label:"Ativo",type:"date"},{type:"string",role:"tooltip",p:{html:!0}}],r.options.series={},angular.forEach(e.ativos,(function(a,t){r.data.cols.push({label:l(a.id),type:"number"}),r.data.cols.push({type:"string",role:"style"})}));var c={};e.mensal.forEach((function(a){var n=moment(a.data);c[a.data]||(c[a.data]={data:n.toDate(),valor:0});var s=[{v:n.toDate()}],u={v:""};s.push(u);var d=['<div class="mdw-chart-tooltip-prov"><table>'];d.push("");for(var m=0,f=a.valor.length-1;f>=0;f--){var p=a.valor[f];if(p&&p.moeda==o){c[a.data].valor+=p.v;var v=t("currency")(p.v,i),g=e.ativos[p.id].color;d.push("<tr>"),d.push('<td><span class="tag" style="background-color: '+g+'"></span></td>'),d.push("<td>"),d.push(l(p.id)),d.push("</td>"),d.push("<td>"),d.push(v),d.push("</td>"),d.push("</tr>"),m+=p.v}}d[1]="<tr><td></td><td><strong>"+moment(a.data).format("MMMM [de] YYYY ")+"</strong></td><td><strong>"+t("currency")(m,i)+"</strong></td></tr>",d.push("</table></div>"),u.v=d.join(""),a.valor.forEach((function(a){if(a){if(a.moeda!=o)return;var n=t("currency")(a.v,i),r=e.ativos[a.id].color;s.push({v:a.v||null,f:n}),s.push({v:r})}else s.push({v:null,f:""}),s.push({v:null})})),r.data.rows.push({c:s})}));var u=[];return angular.forEach(c,(function(a){u.push(a)})),{chart:r,totaisMes:u}}))},u}}])}(),function(){"use strict";o.$inject=["$http","mdwObserver","mdwResourceObserver","mdwCache","operacoesDatasource"],t.$inject=["mdwResourceProvider"],angular.module("md").config(t).service("ativosDatasource",o);var a={acoes:1,opcoes:2,fundos:3,commodities:4,moedas:5,mercadofuturo:8,criptomoedas:24,titulosbancarios:6,titulospublicos:7,fundosbovespa:10,debentures:23,stocks:29,etfus:30,etfrf:32};function t(a){a.define("ativos","/investimentos/ativos/:id")}function o(t,o,e,n,r){var i=this,c=o("ativosDatasource"),s=n("/api/v1/investimentos/ativos/:id"),l=n("/investimentos/minemonicos"),u=n("/api/v2/investimentos/ativos"),d=n("/api/v2/investimentos/ativos/:id/cotacoes"),m=n("/investimentos/ativos/consultar"),f=n("/api/v2/investimentos/ativos/cotacoesMercado"),p=n("/investimentos/ativos/posicao/:id/:conta");function v(a){p.reset(),u.reset(),s.reset(),l.reset(),c.notify(a)}function g(t,o){return t&&(isNaN(t)&&(t=a[t]),o.tipo=t),m.get(o,{handleErrors:[401]})}i.addObserver=c.add,i.get=function(a,t){return g(t,{c:a})},i.query=g,i.getId=function(a){return s.get({id:a})},i.carregarMnemonicos=function(){return l.get()},i.carregarAtivosUsuario=function(){return u.get()},i.carregarCotacoesAtivoUsuario=function(a){return d.get({id:a})},i.salvarCotacoesAtivoUsuario=function(a,o){return t.post("/api/v2/investimentos/ativos/"+a+"/cotacoes",{cotacoes:o}).then((function(){d.reset(),v()}))},i.carregarPosicaoAtivoConta=function(a,t){return p.get({id:a,conta:t})},i.resetMnemonicos=function(){l.reset()},i.alterarTicker=function(a){return t.post("/api/v2/investimentos/ativos/alterarTicker",a).then((function(){u.reset(),s.reset(),c.notify()}))},i.buscarDescricoes=function(a,o){return t.post("/api/v2/investimentos/ativos/buscaDescricao",{termos:a,mercado:o}).then((function(a){return a.data}))},i.carregarCotacoes=function(a){return f.get(a)},e("ativos",v),r.addObserver(v)}}(),function(){"use strict";function a(a,t,o,e){a.state("ativos",{url:"/ativos",controller:"GerenciarAtivosController",controllerAs:"vm",templateUrl:"partials/investimentos/ativos/ativos.html"}).state("detalharativo",{abstract:!0,url:"/ativos/:idAtivo",controller:"DetalharAtivoController",controllerAs:"vm",templateUrl:"partials/investimentos/ativos/detalhar/detalhar.html"}).state("detalharativo.listar",{url:"",controller:"DetalharAtivoControllerResumo",controllerAs:"vm",templateUrl:"partials/investimentos/ativos/detalhar/resumo/detalhar.resumo.html"}).state("detalharativo.historico",{url:"/historico",controller:"DetalharAtivoControllerHistorico",controllerAs:"vm",templateUrl:"partials/investimentos/ativos/detalhar/operacoes/detalhar.lista.html"}).state("detalharativo.eventos",{url:"/eventos",controller:"DetalharAtivoControllerEventos",controllerAs:"vm",templateUrl:"partials/investimentos/ativos/detalhar/eventos/detalhar.eventos.html"}),a.state("ativos.novo",t.getState({url:"/novo",action:"ativosService.editarAtivo"})).state("ativos.editar",t.getState({url:"/editar/:id",action:"ativosService.editarAtivo"})).state("ativos.excluir",t.getState({url:"/excluir/:id",action:"ativosService.excluirAtivo"})),["listar","historico","eventos"].forEach((function(n){a.state("detalharativo."+n+".editar",t.getState({url:"/editar/:id",action:"ativosService.editarAtivo"})).state("detalharativo."+n+".editarTicker",t.getState({url:"/editarTicker/:id",action:"ativosService.editarTicker"})).state("detalharativo."+n+".excluir",t.getState({url:"/excluir/:id",action:"ativosService.excluirAtivo"})).state("detalharativo."+n+".estrategias",t.getState({url:"/estrategias/:id",action:"ativosService.editarEstrategias"})),o.addStates("detalharativo."+n),e.addStates("detalharativo."+n)}))}a.$inject=["$stateProvider","mdwStateDialogProvider","operacoesRoutesProvider","lancamentosRoutesProvider"],angular.module("md").config(a)}(),function(){"use strict";o.$inject=["ativosDatasource","$mdDialog","$mdToast","mdwResource","mdwDialogLoading","contasInvestService","carteiraService"];var a=[[1,"Ações"],[13,"FIIs"],[14,"Fiagro"],[15,"Fi-Infra"],[16,"FIP"],[12,"ETFs"],[32,"ETFs Renda Fixa"],[31,"BDRs"],[29,"Stocks"],[30,"ETFs US"],[2,"Opções"],[8,"Mercado Futuro"],[7,"Tesouro Direto"],[6,"Títulos Privados"],[3,"Fundos de investimentos"],[23,"Debêntures"],[25,"Fundos de previdência"],[5,"Moedas"],[24,"Criptomoedas"],[17,"Imóveis"],[11,"Outros ativos"],[26,"Direitos de Subscrição"],[27,"Recibos de Subscrição"],[28,"Contratos de Termo"],[1002,"Poupança"],[1005,"Título de capitalização"]],t={};function o(t,o,e,n,r,i,c){var s=n("ativos");return{create:function(a){return s.insert(a).then((function(a){return e.showSimple("Ativo criado."),a}))},update:function(a){return s.update(a).then((function(a){return e.showSimple("Ativo atualizado."),a}))},delete:function(a){return s.delete(a).then((function(a){return e.showSimple("Ativo excluido."),a}))},criarAtivo:function(a){return l(a||{})},editarAtivo:l,editarTicker:function(a){return r(),o.show({id:"editar-ativo",templateUrl:"/partials/investimentos/ativos/editarTicker.html",controller:"EditarTickerAtivoController",controllerAs:"vm",bindToController:!0,resolve:{ativo:function(){return t.getId(a.id)}}})},excluirAtivo:function(a){var e={},n={};a.id?(r(),n.ativo=function(){return t.getId(a.id)}):e.ativo=a;return o.show({id:"excluir-ativo",templateUrl:"/partials/investimentos/ativos/excluirAtivo.html",controller:"ExcluirAtivoController",controllerAs:"vm",resolve:n,locals:e})},carregarGrupos:function(o,e){var n={};function r(a,t){return n[a]?n[a]:n[a]={nome:t,ativos:[]}}var i=a.map((function(a){return r(a[0],a[1])})),s=t.carregarAtivosUsuario().then((function(a){var t=a,e=[];return o&&(o=o.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")),t.forEach((function(a){if(o){var t=new RegExp("(^"+o+")|(\\s+"+o+")","i");if(!(a.descricao&&a.descricao.match(t)||a.nome&&a.nome.match(t)||a.codigo&&a.codigo.match(t)))return}e.push(a);var n=angular.copy(a),i=n.tipoCarteira,c=r(i);c.ativos||(c.ativos=[]),c.ativos.push(n),n.tipo=i})),[i=i.filter((function(a){return a.ativos.length>0})),e]}));return e?s.then((function(a){return function(a){return c.carregarCarteira().then((function(t){var o={};function e(a){a.grupos.forEach((function(a){a.ativos.forEach((function(a){o[a.id]=!0}))}))}t.c&&t.c[0]&&e(t.c[0]),t.v&&t.v[0]&&e(t.v[0]);var n=[],r=[];return a[0].forEach((function(a){if(a.ativos){var t=[];a.ativos.forEach((function(a){o[a.id]&&t.push(a)})),t.length>0&&n.push(angular.extend({},a,{ativos:t}))}})),a[1].forEach((function(a){o[a.id]&&r.push(a)})),[n,r]}))}(a)})):s},editarCotacoes:function(a){return o.show({id:"cotacoes-ativo",templateUrl:"/partials/investimentos/ativos/editar_cotacoes.html",controller:"EditarCotacoesAtivo",controllerAs:"vm",bindToController:!0,locals:{ativo:a},resolve:{cotacoes:function(){return t.carregarCotacoesAtivoUsuario(a.id)}}})},editarEstrategias:function(a){return o.show({id:"estrategias-ativo",templateUrl:"/partials/investimentos/ativos/detalhar/editar_estrategias.html",controller:"EditarEstrategiasAtivoController",controllerAs:"vm",bindToController:!0,resolve:{ativo:function(){return t.getId(a.id)}}}).then((()=>{e.showSimple("Estratégia atualizada")}))}};function l(a){if("C"===a.id[0])return i.editar({id:a.id.substr(1)});var e={},n={};return a.id?(r(),n.ativo=function(){return t.getId(a.id)}):e.ativo=a,o.show({id:"editar-ativo",templateUrl:"/partials/investimentos/ativos/editarAtivo.html",controller:"EditarAtivoController",controllerAs:"vm",resolve:n,locals:e})}}a.forEach((function(a){t[a[0]]=a[1]})),angular.module("md").constant("GRUPOS_ATIVOS",t).factory("ativosService",o)}(),function(){"use strict";angular.module("md").directive("mdwBuscarAtivo",t()),angular.module("md").directive("mdwBuscarAtivoUsuario",t(!0));var a=0;function t(t){return function(){e.$inject=["$scope","ativosDatasource"];var o={model:"=ngModel",ativo:"=?",placeholder:"@?",searchText:"=?search",ngDisabled:"=?",ngRequired:"=?"};return t?o.tipo="=?":(o.tipo="@?",o.mdwTipo="=?"),o.tipos="=?",{require:["^ngModel","?^form"],restrict:"E",scope:o,template:function(o,e){var n=""===e.mdAutofocus||e.mdAutofocus||"false",r=e.mdMinLength||(t?0:2),i=e.mdNoCache||(t?"true":"false"),c=e.nome||"busca-ativo-"+ ++a;return["<md-autocomplete",'md-input-name="'+c+'"','md-delay="200"','ng-required="ngRequired"','md-require-match="ngRequired"','ng-disabled="ngDisabled"','md-selected-item="vm.ativo"','md-autoselect="true"','md-search-text="searchText"','md-items="ativo in vm.query(searchText)"','md-item-text="ativo.nome"','md-no-cache="'+i+'"','md-min-length="'+r+'"','md-autofocus="'+n+'"','md-floating-label="{{vm.placeholder}}" >',"<md-item-template>",'<div title="{{ativo._descombo}}">','<span md-highlight-text="searchText" md-highlight-flags="i">',"{{ativo._descombo}}","</span>","</div>","</md-item-template>","<div ng-if=\"form && form['"+c+"'] && (form['"+c+"'].$touched || form.$submitted)\" ng-messages=\"form['"+c+"'].$error\">",'<div ng-message="required">Campo obrigatório</div>','<div ng-message="md-require-match">Código informado inválido. É necessário escolher um ativo da lista</div>',"</div>","</md-autocomplete>"].join(" ")},link:function(a,t,o,e){a.form=e[1],!a.ngRequired&&angular.isDefined(o.required)&&(a.ngRequired=o.required||""==o.required)},controllerAs:"vm",controller:e};function e(a,o){a.ngDisabled=a.ngDisabled||!1,a.ngRequired=a.ngRequired||!1;function e(t,o){o&&t!=o&&(a.model=null,a.ativo=null,a.searchText=null)}a.searchText=a.ativo?a.ativo.nome:a.model,this.placeholder=a.placeholder||"Código do ativo",a.$watch("model",(function(t){t?a.searchText=a.ativo?a.ativo.nome:a.model:(a.searchText="",a.ativo={})})),a.$watch("vm.ativo",(function(t,o){t&&(a.ativo=t,a.model=t.codigo)})),a.$watch("tipo",e),a.$watch("mdwTipo",e),this.query=function(e){var n=a.tipo||a.mdwTipo;28==n&&(n=1);if(!t)return n?o.query(n,{b:e,limit:7}).then((function(a){var t=a.length>0&&-1!=[1,12,13,29,30].indexOf(a[0].tipo);return a.forEach((function(a){a._descombo=a.nome,t&&(a._descombo+=" - "+a.descricao)})),a})):[];var r=e&&new RegExp("(^"+e+")|(\\s+"+e+")","i");return o.carregarAtivosUsuario().then((function(t){return t.forEach((function(a){a._descombo=a.nome})),(t=t.filter((function(t){return a.tipos&&(a.tipos=a.tipos.map((function(a){return parseInt(a)}))),(!n||t.tipo==n)&&(!a.tipos||-1!=a.tipos.indexOf(t.tipo))&&(!e||t.codigo&&t.codigo.match(r)||t.descricao&&t.descricao.match(r)||t.nome&&t.nome.match(r))}))).sort((function(a,t){return a.nome<t.nome?-1:1})),t}))}}}}}(),function(){"use strict";function a(a,t,o,e,n,r,i,c,s,l){var u=this;a.$state=i,e.setTitle([{label:"Ativos",href:"ativos"},"Detalhar"]),u.tipos=n.getTiposIds(),u.codigoAtivo=""+i.params.idAtivo,u.service=s(u.codigoAtivo);var d=l.config;function m(){return u.loading=!0,r.carregarGrupos(u.busca,u.status,!0).then((function(a){u.loading=!1,u.grupos=a[0],u.grupos.forEach((function(a){a.ativos.sort((function(a,t){return a.nome<t.nome?-1:1}))}))}))}u.status=1==d.s,u.activeTab=-1!=i.current.name.indexOf("historico")?1:-1!=i.current.name.indexOf("eventos")?2:0,a.$on("$destroy",c.addObserver(m)),a.$on("$mdMenuClose",(function(){u.busca=null,m()})),u.carregarAtivos=m,u.$onInit=function(){return u.contaSugestao=null,u.service.carregarHistorico().then((function(){1===u.service.resumo.contas.length&&(u.contaSugestao=u.service.resumo.contas[0].conta)})),r.carregarGrupos().then((function(a){u.ativos=a[1],u.ativo=u.ativos.find((function(a){return""+a.id==u.codigoAtivo}))})),m()},u.proxAtivo=function(a){for(var t,o,e,n=!1,r=0;r<u.grupos.length;r++){for(var c=u.grupos[r],s=0;s<c.ativos.length;s++){var l=c.ativos[s];if(e||(e=l),n){o=l;break}if(l.id==u.ativo.id)if(-1==a){if(t){o=t;break}}else n=!0;t=l}if(o)break}o||(o=-1==a?t:e),i.go(i.current.name,{idAtivo:o.id})},u.atualizarAtivos=function(){return d.s=u.status?1:0,l.updateConfig(d),m()},u.editarAtivo=function(){i.go(i.current.name+".editar",{id:u.codigoAtivo})},u.editarTicker=function(){i.go(i.current.name+".editarTicker",{id:u.codigoAtivo})},u.excluirAtivo=function(){i.go(i.current.name+".excluir",{id:u.codigoAtivo})},u.alterarAtivo=function(a){i.go(i.current.name,{idAtivo:a})},u.editarEstrategia=function(){i.go(i.current.name+".estrategias",{id:u.codigoAtivo})}}a.$inject=["$scope","$mdDialog","$mdToast","mdwTopmenu","tiposAtivosEstrategiasService","ativosService","$state","ativosDatasource","detalharAtivoService","detalharAtivoServiceConfig"],angular.module("md").controller("DetalharAtivoController",a)}(),function(){"use strict";angular.module("md").service("detalharAtivoServiceConfig",["configuracoesService",function(a){this.config=a.getConfig("detAtivos",{s:0,pz:0}),this.updateConfig=function(t){return a.updateConfig("detAtivos",t)}}]).factory("detalharAtivoService",["$state","investimentosDatasource","mdwObserver","ativosDatasource","rentabilidadeService","rentabilidadeDatasource","eventosDatasource",function(a,t,o,e,n,r,i){var c={},s=o();return function(a){return c[a]?c[a]:c[a]=new l(a)};function l(o){var c,l=this;function u(){return e.carregarAtivosUsuario().then((function(a){if(!c)for(var t=0;t<a.length;t++)if(a[t].id==o){c=a[t];break}return c}))}l.loading={historico:!1,rentabilidade:!0,eventos:!0},l.operacoes=[],l.addObserver=s.add,r.addObserver((function(){c=null,s.notify()})),l.carregarHistorico=function(){return l.loading.historico=!0,t.historicoAtivo(o).then((function(t){l.loading.historico=!1,l.resumo=t.resumo,l.operacoes=[];for(var o=t.operacoes.length-1;o>=0;o--)l.operacoes.push(t.operacoes[o]);0==l.operacoes.length&&a.go("ativos")}))},l.carregarEventos=function(){return l.loading.eventos=!0,i.carregarEventos(o).then((function(a){l.loading.eventos=!1,l.eventos=a.eventos,l.eventosImportados={},a.importados.forEach((function(a){l.eventosImportados[a[0]]=a[1]}))}))},l.carregarRentabilidade=function(){return l.loading.rentabilidade=!0,u().then((function(a){const t=a.cotacoesAutomaticas;return n.carregarRentabilidadeAtivo(a.id,!!t&&{tipo:a.tipo,ticker:a.codigo}).then((function(a){return l.loading.rentabilidade=!1,a}))}))},l.getAtivo=u}}])}(),function(){"use strict";function a(a,t){const o=this;function e(){o.idsGrupos=[],o.listMap=[],o.listMapTipos=[];for(let a=0;a<o.estrategias.length;a++){o.idsGrupos[a]||(o.idsGrupos[a]=[]);const t=o.estrategias[a].grupos;o.listMap.push(n(t,a))}}function n(a,t){const e={},n={},s={},l={};let u=!1;for(const t of a)e[t.id]=r(t),s[t.id]=c(t),n[t.id]=i(t),u||(u=null!=e[t.id]);for(const r of a)if(u)void 0===e[r.id]?l[r.id]=n[r.id]:(o.idsGrupos[t].push(r.id),l[r.id]=e[r.id]);else{if(void 0!==s[r.id]){o.idsGrupos[t].push(r.id),l[r.id]=s[r.id];continue}l[r.id]=n[r.id]}return l}function r(a){let t;for(const e of a.ativos)if(e[0]==o.ativo.id){t={nome:a.nome,tipo:!1,nomeAtivo:o.ativo.nome,idAtivo:o.ativo.id,alocacao:e[1]||0};break}return t}function i(a){return{nome:a.nome,tipo:!1,nomeAtivo:o.ativo.nome,idAtivo:o.ativo.id,alocacao:0}}function c(a){let t;for(const e of a.tipos)if(e[0]==o.ativo.tipo){t={nome:a.nome,tipo:!0,nomeAtivo:o.ativo.nome,idAtivo:o.ativo.id,alocacao:1};break}return t}function s(a){const t=o.idsGrupos[a];let e=0;for(const n of t)e+=o.listMap[a][n].alocacao;o.listMap[a].invalidAloc=e>1,function(){o.invalidAloc=!1;for(const a of o.listMap)a.invalidAloc&&(o.invalidAloc=!0)}()}o.calcAlocacaoGrupo=s,o.salvar=function(){if(o.invalidAloc)return;const e=[];for(let a=0;a<o.estrategias.length;a++){const t=o.estrategias[a].grupos,n={id:o.estrategias[a].id,grupos:[]};for(let e=0;e<t.length;e++){const r=t[e];if(!o.listMap[a][r.id])continue;const i=o.listMap[a][r.id].alocacao;n.grupos.push({id:r.id,alocacao:i})}e.push(n)}return t.adiconarAlocacoAtivo(e,o.ativo.id).then((t=>a.hide()))},o.preparaEdicao=e,o.changeCombo=function(a,t){1!=a.length||o.listMap[t][a[0]].alocacao||(o.listMap[t][a[0]].alocacao=1);for(const e of a)o.listMap[t][e].alocacao||(o.listMap[t][e].alocacao=0);(function(a){angular.forEach(o.listMap[a],((t,e)=>{"invalidAloc"!=e&&(o.idsGrupos[a].includes(parseInt(e))||0==o.listMap[a][parseInt(e)].alocacao||(o.listMap[a][parseInt(e)].alocacao=0))}))})(t),s(t)},o.$onInit=function(){!function(){const a=t.carregarEstrategias();a.then((a=>{o.estrategias=a.filter((a=>a.status)),e()})),a.finally((()=>{o.logged=!0}))}()}}a.$inject=["$mdDialog","estrategiasDatasource"],angular.module("md").controller("EditarEstrategiasAtivoController",a)}(),function(){"use strict";function a(a,t,o,e,n){var r=this;function i(){r.service.carregarEventos().then((function(){r.selection=e.getSelectionManager(r.service.eventos)}))}r.service=o(t.idAtivo),a.$on("$destroy",n.addObserver(i)),i(),r.importar=function(){var a=r.selection.getSelected();return e.confirmarImportacaoEventos(a).then((function(){r.selection.toggleAll(!1)}))}}a.$inject=["$scope","$stateParams","detalharAtivoService","eventosCorporativosService","eventosDatasource"],angular.module("md").controller("DetalharAtivoControllerEventos",a)}(),function(){"use strict";function a(a,t,o,e,n,r){var i=this;function c(){i.inconsistencias={},i.service.carregarHistorico().then((function(){i.col={pc:!1,pv:!1,iof:!1,irrf:!1,custos:!1,liq:!1,res:!1,qtd:!1,premio:!1,custosCripto:!1},i.service.getAtivo().then((function(a){if(a){i.ativo=a,i.col.qtd=-1!=[1,2,3,4,5,7,8,11,12,13,24,25,23,26,27,28,29,30].indexOf(a.tipo);for(var t={},o=0;o<i.service.operacoes.length;o++){var e=i.service.operacoes[o],n=`${e.tipo}${e.dataOperacao}${e.valor}`;t[n]||(t[n]=0),t[n]++,i.col.qtd&&!i.col.pc&&e.quantidadeAtualCompra&&(i.col.pc=!0),i.col.qtd&&!i.col.pv&&e.quantidadeAtualVenda&&(i.col.pv=!0),!i.col.iof&&e.iof&&(i.col.iof=!0),!i.col.premio&&e.premioOpcao&&(i.col.premio=!0),!i.col.custosCripto&&e.custosCripto&&(i.col.custosCripto=!0),!i.col.irrf&&e.ir&&(i.col.irrf=!0),!i.col.custos&&e.custos&&(i.col.custos=!0),!i.col.res&&e.resultadoComCustos&&(i.col.res=!0),i.col.liq||e.valorTotal==e.valorNominal||(i.col.liq=!0)}i.service.operacoes.forEach((function(a){if(a.inconsistente){var o=`${a.tipo}${a.dataOperacao}${a.valor}`;t[o]<=1||(i.inconsistencias[a.id]=!0)}}))}}))}))}t.Math=o.Math,i.service=n(e.idAtivo),i.opService=r,t.$on("$destroy",i.service.addObserver(c)),i.$onInit=c,i.abrirNota=function(t){var o={};o.b=btoa(angular.toJson({nota:t})),a.go("notas.historico",o)},i.handleInconsistentOp=function(a){return r.openInconsistentOpDialog(a)}}a.$inject=["$state","$scope","$window","$stateParams","detalharAtivoService","operacoesService"],angular.module("md").controller("DetalharAtivoControllerHistorico",a)}(),function(){"use strict";function a(a,t,o,e,n,r,i,c){var s=this;s.service=e(t.idAtivo),s.moedaCotacao=1;var l=s.service.addObserver(f),u=r.onChange((function(){s.rent&&r.prepareChartOptions(s.rent.chart.options)}));a.$on("$destroy",(function(){l(),u()}));var d=c.config;function m(a){var t=o("mdwNumber");return s.ativo&&-1!=[3,7,25,24,11].indexOf(s.ativo.tipo)?t(a,7==s.ativo.tipo?2:8):t(a)}function f(){s.detalhes={posicao:[],financeiro:[]},s.service.getAtivo().then((function(a){s.ativo=a;var t=-1==[3,24,25].indexOf(a.tipo)?6:8;s.service.carregarHistorico().then((function(){var o={posicao:[{id:"quantidade",label:"Quantidade",format:m},{id:"precoMedio",label:"Preço médio compra",abs:!0,currency:!0,fraction:t},{id:"valorInvestido",label:"Valor investido",abs:!0,currency:!0},{id:"valorAtual",label:"Valor atual",abs:!0,currency:!0},{id:"quantidadeVenda",label:"Quantidade vendida",format:m},{id:"precoMedioVenda",label:"Preço médio venda",abs:!0,currency:!0,fraction:t},{id:"valorVendido",label:"Valor vendido",abs:!0,currency:!0},{id:"valorAtualVenda",label:"Valor atual de compra",abs:!0,currency:!0},{id:"resultado",label:"Resultado",currency:!0},{id:"variacao",label:"Variação",percent:!0},{id:"irProjetado",label:"IR Potencial",currency:!0}],financeiro:[{id:"lucroPrejuizoNormal",label:"Resultado apurado",currency:!0},{id:"lucroPrejuizoDaytrade",label:"Resultado day trade",currency:!0},{id:"lucroPrejuizoExercicio",label:"Resultado exercício opções",currency:!0},{id:"ajustesMf",label:"Total Ajustes",currency:!0},{id:"dividendos",label:"Dividendos",currency:!0},{id:"jscp",label:"JSCP",currency:!0},{id:"bonificacoes",label:"Bonificações",currency:!0},{id:"proventos",label:17==a.tipo||11==a.tipo?"Aluguel":"Proventos",currency:!0},{id:"premios",label:"Prêmios",currency:!0},{id:"participacao",label:"Participação",currency:!0},{id:"amortizacoes",label:"Amortizações",currency:!0},{id:"cupom",label:"Cupom de juros",currency:!0},{id:"comecotas",label:"IR Come Cotas",currency:!0},{id:"custodia",label:17==a.tipo?"Despesas com imóvel":11==a.tipo?"Despesas gerais":"Custódia",currency:!0},{id:"totalResumoFin",label:"Resultado total líquido",currency:!0,strong:!0},{id:"irrf",label:"IRRF",currency:!0},{id:"iof",label:"IOF",currency:!0},{id:"custos",label:"Custos operacionais",currency:!0}]},e={};o.posicao.forEach((function(a){e[a.id]=a})),o.financeiro.forEach((function(a){e[a.id]=a})),s.posicaoZerada=!1,s.service.resumo.contas.forEach((function(a){if(a._exibir={posicao:!0,financeiro:!0},a._exibir.posicao=a.posicao.quantidade||a.posicao.valorInvestido||a.posicao.quantidadeVenda||!1,!a._exibir.posicao){var t=0;angular.forEach(a.financeiro,(function(a){t+=Math.abs(a)})),a._exibir.financeiro=t>.001}a._exibir.posicao||(s.posicaoZerada=!0)})),s.posicaoZerada||(s.esconderContasZeradas=!1),v(o,e,"posicao"),v(o,e,"financeiro")}))})),p()}function p(){s.service.carregarRentabilidade().then((function(a){s.rent=a,s.rent.chart&&r.prepareChartOptions(s.rent.chart.options)}))}function v(a,t,o){s.multiContas=s.service.resumo.contas.length>1;var e=null,n=0;function r(a,e,n){var r=t[e];r&&a[o]&&!angular.isUndefined(s.service.resumo[o][e])&&(r.v||(r.v=[],s.detalhes[o].push(r)),r.v.push({v:a[o][e]||0,m:n}))}s.service.resumo.contas.forEach((function(t){var c=i.get("contas",t.conta,!0);24!=s.ativo.tipo&&(s.moedaCotacao=c.moeda),e&&e==c.moeda||(n++,e=c.moeda),a[o].forEach((function(a){r(t,a.id,c.moeda)}))})),s.colunaTotal=s.multiContas&&1==n,s.colunaTotal&&a[o].forEach((function(a){r(s.service.resumo,a.id,e||1)}))}s.esconderContasZeradas=1==d.pz,s.$onInit=f,s.periodoRentabilidade=n.periodo,s.onChangePeriodoRent=function(){n.changePeriodo(s.periodoRentabilidade),p()},s.configurarBenchmarks=function(){return n.configurarBenchmarks().then((()=>{p()}))},s.atualizarPosicaoZerada=function(){d.pz=s.esconderContasZeradas?1:0,c.updateConfig(d)}}a.$inject=["$scope","$stateParams","$filter","detalharAtivoService","rentabilidadeService","mdwDarkModeService","cadastrosDatasource","detalharAtivoServiceConfig"],angular.module("md").controller("DetalharAtivoControllerResumo",a)}(),function(){"use strict";function a(a,t,o,e){var n=this;n.sugerirPercentualIndexador=function(){0==n.ativo.indexador?n.ativo.percentualIndexador=0:n.ativo.percentualIndexador=1},n.ok=function(){var a=angular.copy(n.ativo);if(a.data=moment(a.data).format("YYYY-MM-DD"),2==n.tipoRentabilidade)a.indexador=null,a.percentualIndexador=null,a.taxaPrefixada=null;else{var t=n.ativo.depreciar?-1:1;a.percentualIndexador&&(a.percentualIndexador=Math.abs(a.percentualIndexador)*t),a.taxaPrefixada&&(a.taxaPrefixada=Math.abs(a.taxaPrefixada)*t)}return n.edicao?o.update(a).then((function(a){e.hide(a)})):(a.id=null,o.create(a).then((function(a){e.hide(a)})))},n.$onInit=function(){n.ativo=angular.extend({data:moment(),tipo:11,indexador:0,percentualIndexador:0},t||{}),n.tipoRentabilidade=!n.ativo.id||11!=n.ativo.tipo&&17!=n.ativo.tipo||n.ativo.indexador||n.ativo.taxaPrefixada?1:2,n.maxConfDate=moment(),n.ativo.data=a(n.ativo.data),n.edicao=!!n.ativo.id,n.ativo.fundoPrevidencia=25==n.ativo.tipo,n.ativo.depreciar=n.ativo.percentualIndexador<0||n.ativo.taxaPrefixada<0}}a.$inject=["mdwMoment","ativo","ativosService","$mdDialog"],angular.module("md").controller("EditarAtivoController",a)}(),function(){"use strict";function a(a,t){var o=this;function e(){o.dados={data:moment(),valor:0},o.ultIndex=null,o.cotacoes.sort((function(a,t){return a.data<t.data?1:-1}))}o.maxConfDate=moment(),o.$onInit=function(){o.cotacoes=angular.copy(o.cotacoes),e()},o.editar=function(a){var t=o.cotacoes[a];o.dados=angular.copy(t),o.dados.data=moment(o.dados.data),o.ultIndex=a},o.excluir=function(){o.cotacoes.splice(o.ultIndex,1),e()},o.atualizar=function(){var a=o.cotacoes[o.ultIndex];a.data=moment(o.dados.data).format("YYYY-MM-DD"),a.valor=o.dados.valor,e()},o.incluir=function(){var a={data:moment(o.dados.data).format("YYYY-MM-DD"),valor:o.dados.valor};o.cotacoes.push(a),e()},o.ok=function(){return t.salvarCotacoesAtivoUsuario(o.ativo.id,o.cotacoes).then((function(){return a.hide()}))}}a.$inject=["$mdDialog","ativosDatasource"],angular.module("md").controller("EditarCotacoesAtivo",a)}(),function(){"use strict";function a(a,t){var o=this;o.maxConfDate=moment(),o.ok=function(){return a.alterarTicker(o.dados).then((function(a){t.hide(a)}))},o.$onInit=function(){o.dados={org:o.ativo.id,data:moment(o.ativo.data)}}}a.$inject=["ativosDatasource","$mdDialog"],angular.module("md").controller("EditarTickerAtivoController",a)}(),function(){"use strict";function a(a,t,o,e){this.ativo=t,this.ok=function(){return o.delete(t).then((function(t){e.hide(t),-1!=a.current.name.indexOf("detalharativo")&&a.go("ativos")}))}}a.$inject=["$state","ativo","ativosService","$mdDialog"],angular.module("md").controller("ExcluirAtivoController",a)}(),function(){"use strict";function a(a,t,o,e,n,r){t.title="Ativos";var i=this;i.ativos=[],i.hasAtivos=null,i.filtrar=s;var c=n.getConfig("investAtivos",{s:0});function s(){return i.loading=!0,o.carregarGrupos(i.busca,i.status).then((function(a){null===i.hasAtivos&&(i.hasAtivos=a[1].length>0),i.loading=!1,i.grupos=a[0],i.ativos=a[1],r.carregarEstrategias().then((a=>{const t={},o={};i.mapGrupos={},a.forEach((a=>{a.status&&a.grupos.forEach((e=>{var n={label:e.nome,tooltip:a.nome,estrategiaId:a.id};e.ativos.length>0&&e.ativos.forEach((a=>{const o=a[0];t[o]||(t[o]=[]),t[o].push(n)})),e.tipos.length>0&&e.tipos.forEach((a=>{o[a]||(o[a]=[]),o[a].push(n)}))}))})),i.ativos.forEach((a=>{t[a.id]||(t[a.id]=[]),o[a.tipo]||(o[a.tipo]=[]);const e=t[a.id].concat(o[a.tipo]);var n;i.mapGrupos[a.id]=(n=e).filter(((a,t)=>n.indexOf(a)===t)),i.mapGrupos[a.id].sort(((a,t)=>a.label<t.label?-1:a.label>t.label?1:0))}))})),null===i.hasAtivos&&(i.hasAtivos=i.ativos.length>0)}))}i.status=1==c.s,a.$on("$destroy",e.addObserver(s)),i.$onInit=function(){s()},i.changeStatus=function(){return n.updateConfig("investAtivos",{s:i.status}),s()}}a.$inject=["$scope","mdwTopmenu","ativosService","ativosDatasource","configuracoesService","estrategiasDatasource"],angular.module("md").controller("GerenciarAtivosController",a)}(),function(){"use strict";angular.module("md").filter("tipoAtivo",(function(){return function(a){switch(a=parseInt(a)){case 1:return"Ação / BDR";case 2:return"Opção";case 3:return"Fundo";case 4:return"Commodity";case 5:return"Moeda";case 7:return"Tesouro direto";case 6:return"Título bancário";case 8:return"Mercado Futuro";case 18:return"CDB";case 19:return"RDB";case 20:return"LCA";case 21:return"LCI";case 22:return"LC";case 33:return"LIG";case 34:return"CRA";case 35:return"CRI";case 23:return"Debênture";case 12:return"ETF";case 32:return"ETF Renda Fixa";case 13:return"FII";case 14:return"Fiagro";case 15:return"Fi-infra";case 16:return"FIP";case 17:return"Imóvel";case 24:return"Criptomoeda";case 25:return"Fundo de previdência";case 29:return"Stock/REIT (US)";case 30:return"ETF (US)";case 11:return"Outros ativos"}}}))}(),function(){"use strict";t.$inject=["$scope","$state","$stateParams","$mdDialog","carteiraService","mdwTopmenu","configuracoesService","cadastrosDatasource","mdwDarkModeService"],angular.module("md").controller("InvestimentosCarteiraController",t);const a=["p","q","pm","c","vi","va","r","v","h","hm"];function t(t,o,e,n,r,i,c,s,l){i.title="Carteira de investimentos";var u=this;u.carteiraService=r,u.changeVisao=function(a){u.visao=a,h(),o.go("carteira",{v:a})},u.onChagenEstrategia=function(){h(),b()},u.onChangeConta=function(){(u.conta||0===u.conta)&&(u.contasFiltradas=null,h(),v(u.conta,u.contasFiltradas))},u.updateConfig=h,u.order=function(a){u.sort.g==a?u.sort.d=-1*u.sort.d:(u.sort.g=a,u.sort.d=1);h(),b()},u.toggleGrupo=function(a){u.g[a]=1==u.g[a]?0:1,h()},u.onChangePizza=function(){u.pizza=1==u.pizza?0:1,C(),h()},u.onChangeMoeda=function(a){u.moeda=a,h(),p()},u.filtrarContas=g,u.filtrarContasSelect=function(){if(u.contasFiltradas)return;g()},u.exportar=function(){var a={};a.g=u.g,a.e=u.visaoCarteira,a.moeda=u.moeda,a.format="xls",a.caminho="Meu_Dinheiro_Carteira_Investimentos_"+moment().format("YYYYMMDDHHmmSS"),u.conta&&(a.conta=u.conta);u.contasFiltradas&&(a.contas=u.contasFiltradas.join(","));return u.carteiraService.exportar(a)},u.printConfig={controller:"InvestimentosCarteiraController",templateUrl:"/partials/investimentos/carteira/print.html",landscape:!0};var d=r.addObserver((function(){u.carregouContas=!1,p()})),m=l.onChange((function(){if(!u.carteira)return;l.prepareChartOptions(u.carteira._chart.options),u.carteira.grupos.forEach((function(a){l.prepareChartOptions(a._chart.options)}))}));t.$on("$destroy",(function(){d(),m()}));var f=c.getConfig("investimentos",{visao:0,conta:0,contasFiltradas:null,m:1,vga:"d",ord:"+n",pc:1,pv:1,ds:1,rs:1,tc:1,mf:1,pi:0,vis:1,cols:a});function p(){u.loading=!0,v().then((function(){if(u.loading=!1,u.conta||u.contasFiltradas)if(u.contasFiltradas)u.carregouContas&&(u.contasFiltradas=u.contasFiltradas.filter((function(a){for(var t=0;t<u.contas.length;t++)if(u.contas[t].id==a)return!0;return!1}))),u.contasFiltradas.length||(u.contasFiltradas=null),v(u.conta,u.contasFiltradas);else if(u.contas){for(var a=0;a<u.contas.length;a++)if(u.contas[a].id==u.conta)return void v(u.conta,u.contasFiltradas);u.conta=0}else v(u.conta,u.contasFiltradas)}))}function v(a,t){u.loadingConta=!0;var o={};return o.moeda=u.moeda,a&&(o.conta=a),t&&(o.contas=t.join(",")),r.carregarCarteira(o).then((function(a){u.loadingConta=!1,u.carteiras=a.c,u.carteirav=a.v[0],u.carteirads=a.ds[0],u.carteirars=a.rs[0],u.carteiratc=a.tc[0],u.carteiramf=a.mf[0],u.hasPosicao=u.carteiras[0].grupos.length>0||u.carteirav||u.carteirads||u.carteirars||u.carteiratc||u.carteiramf,u.carregouContas||(!function(a){for(var t,o=0;o<u.carteiras.length;o++)if(0===u.carteiras[o].id){t=u.carteiras[o];break}u.carteiraDefault=t;var e={};u.contas=[],angular.forEach(a,(function(a){a[0]&&a[0].grupos.forEach((function(a){a.ativos.forEach((function(a){var t=a.conta;e[t]||(e[t]=s.get("contas",t,!0),u.contas.push(e[t]))}))}))})),u.contas.sort((function(a,t){return a.nome<t.nome?-1:1}))}(a),u.carregouContas=!0),b()}))}function g(){var a=u.contasFiltradas,t=u.conta;n.show({id:"edicao-filtro-carteira-resultado",templateUrl:"/partials/investimentos/carteira/filtro.html",controller:"EditarFiltroCarteiraController",bindToController:!0,locals:{contasFiltradas:u.contasFiltradas,contas:u.contas},controllerAs:"vm"}).then((function(o){if(JSON.stringify(o)!==JSON.stringify(a)){if(!o.length)return u.conta=t||0,u.contasFiltradas=null,h(),void v(u.conta,u.contasFiltradas);u.conta=!1,u.contasFiltradas=o,h(),v(u.conta,u.contasFiltradas)}else u.conta=t}),(function(){u.conta=t,u.filtro=a}))}function h(){f.visao=u.visaoCarteira,f.vga=u.visao,f.conta=u.conta,f.contasFiltradas=u.contasFiltradas,f.pi=u.pizza,f.m=u.moeda,f.vis=u.visibility?1:0,f.ord=(u.sort.d<0?"-":"+")+u.sort.g,f.cols=a.filter((a=>u.colsMap[a])),angular.extend(f,u.g),c.updateConfig("investimentos",f)}function C(){"g"==u.visao&&A(u.carteira.grupos),u.carteira._chart=r.getChartsValorInvestido(u.carteira.grupos,u.pizza),l.prepareChartOptions(u.carteira._chart.options),u.carteira._chart.options.vAxis||(u.carteira._chart.options.vAxis={}),u.carteira._chart.options.vAxis.textPosition=u.visibility?"out":"none"}function b(){var a;u.carteira=null;for(var t=0;t<u.carteiras.length;t++){if(u.carteiras[t].id==u.visaoCarteira){u.carteira=u.carteiras[t];break}0===u.carteiras[t].id&&(a=u.carteiras[t])}u.carteira||(u.carteira=a,u.visaoCarteira=0),u.charts=[],u.carteira=angular.copy(u.carteira),C();var o=u.carteira.grupos.length>0&&angular.isDefined(u.carteira.grupos[0].alocacao);u.tipoGrafico=o,u.totalAtivos=0,u.carteira.grupos.forEach((a=>{const t=r.mesclarAtivosGrupo(a);A(t),a._ativos=t,a._chart=r.getChartsValorInvestido(t),l.prepareChartOptions(a._chart.options),A(a.ativos),u.totalAtivos+=a.ativos.length})),u._carteiras=[u.carteira]}function A(a){var t,o;t=u.sort.d,o={n:"nome",vi:"valorInvestido",va:"valorAtual",r:"resultado",v:"variacao",h:"variacaoAnt",hm:"variacaoAntMoeda"}[u.sort.g],a.sort((function(a,e){return a[o]<e[o]?-1*t:t}))}u.cols=f.cols,u.sort={g:f.ord.substr(1),d:"-"===f.ord[0]?-1:1},u.g={pc:f.pc,pv:f.pv,ds:f.ds,rs:f.rs,tc:f.tc,mf:f.mf},u.$onInit=function(){return u.visaoCarteira=f.visao,u.conta=f.conta,u.contasFiltradas=f.contasFiltradas,u.contas=f.contas,u.visao=f.vga,u.moeda=f.m,u.visibility=f.vis,u.carregouContas=!1,u.pizza=f.pi,u.conta||u.contasFiltradas||(u.conta=0),e.v&&(u.visao="g"==e.v?"g":"d"),u.colsMap={},a.forEach((a=>u.colsMap[a]=!1)),u.cols.forEach((a=>u.colsMap[a]=!0)),p()},u.toggleVisibility=function(){u.visibility=u.visibility?0:1,h(),u.carteira&&u.carteira._chart&&(u.carteira._chart.options.vAxis||(u.carteira._chart.options.vAxis={}),u.carteira._chart.options.vAxis.textPosition=u.visibility?"out":"none")},u.configurarColunas=function(){return n.show({id:"carteira-configurar-colunas",templateUrl:"/partials/investimentos/carteira/configurarColunas.dialog.html",controller:"ConfigurarColunasCarteiraController",bindToController:!0,locals:{cols:angular.copy(u.colsMap),isDet:"d"==u.visao},controllerAs:"vm"}).then((a=>{u.colsMap=a,h()}))}}}(),function(){"use strict";function a(a,t,o,e,n,r){r&&(a.state("carteira",{url:"/carteira?v",templateUrl:"partials/investimentos/carteira/carteira.html",controllerAs:"vm",controller:"InvestimentosCarteiraController"}),t.addStates("carteira"),o.addStates("carteira"))}a.$inject=["$stateProvider","operacoesRoutesProvider","lancamentosRoutesProvider","mdwStateDialogProvider","mdwBaseStateProvider","MD_INVEST_MOD"],angular.module("md").config(a)}(),function(){"use strict";angular.module("md").service("carteiraService",["$filter","mdwObserver","investimentosDatasource",function(a,t,o){var e=this,n=t();e.addObserver=n.add,o.addObserver(n.notify),e.mesclarAtivosGrupo=function(a){var t=[],o={};return a.ativos.forEach((function(a){var t=a.id+(a.quantidade<0?"v":"c");o[t]||(o[t]=[]),o[t].push(a)})),angular.forEach(o,(function(a){if(a.length<=1)t.push(a[0]);else{var o=a.pop(),e=angular.extend({},o);a.forEach((function(a){e.participacao+=a.participacao,e.participacaog+=a.participacaog,e.quantidade+=a.quantidade,e.resultado+=a.resultado,e.valorAtual+=a.valorAtual,e.valorInvestido+=a.valorInvestido})),e.variacao=e.valorAtual/e.valorInvestido-1,e.precoMedio=e.valorInvestido/e.quantidade,t.push(e)}})),t},e.carregarCarteira=function(a){return o.getCarteira(a)},e.getChartsValorInvestido=function(t,o,e){var n=t.length>0&&angular.isDefined(t[0].alocacao)&&null!==t[0].alocacao&&angular.isUndefined(t[0].tipoCarteira)&&!o,r=n,i=r?function(a){var t=[{label:"Grupo",type:"string"},{id:"saldo",label:"Saldo total atualizado",type:"number"},{role:"style",type:"string"}];a&&(t.push({id:"saldo",label:"Participação ideal",type:"number"}),t.push({role:"style",type:"string"}));return{type:"ColumnChart",data:{cols:t,rows:[]},options:{vAxis:{format:"short"},legend:{position:"none"},chartArea:{width:"80%",height:"60%"}}}}(n):{type:"PieChart",data:{cols:[{id:"grupo",label:"Grupo",type:"string"},{id:"saldo",label:"Saldo total atualizado",type:"number"},{role:"style",type:"string"}],rows:[]},options:{backgroundColor:"transparent",pieHole:.4,sliceVisibilityThreshold:.01,legend:{position:"labeled"},chartArea:{width:"90%",height:"90%"},tooltip:{trigger:"selection"}}},c=[],s=(e?a("moeda")(e):"R$")+" ";return t.forEach((function(t){var o={v:t.valorAtual,f:a("currency")(t.valorAtual,s)},e=[{v:t.nome},o,{v:t.cor}];if(n){o.f+=" ("+a("number")(100*t.participacao,2)+"%)";var r=t.valorAtual/t.participacao*t.alocacao;e.push({v:r,f:a("currency")(r,s)+" ("+a("number")(100*t.alocacao,2)+"%)"}),e.push({v:"color: "+t.cor+"; fill-opacity: 0.3;stroke-width:2"})}c.push(t.cor),i.data.rows.push({c:e})})),r||(i.options.colors=c),i},e.sortVa=function(a){a.sort((function(a,t){return a.valorAtual<t.valorAtual?1:-1}))},e.exportar=function(a){return o.getCarteira(a).then((function(t){!function(a,t,o){if(null!=o&&navigator.msSaveBlob)return navigator.msSaveBlob(new Blob([o],{type:t}),a);var e=angular.element("<a style='display: none;'/>"),n=window.URL.createObjectURL(new Blob([o],{type:t}));e.attr("href",n),e.attr("download",a),angular.element(document.body).append(e),e[0].click(),window.URL.revokeObjectURL(n),e.remove()}(a.caminho.replace(/\.\w*$/,"")+".xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",function(a){for(var t=new ArrayBuffer(a.length),o=new Uint8Array(t),e=0;e!=a.length;++e)o[e]=255&a.charCodeAt(e);return t}(atob(t)))}))}}])}(),function(){"use strict";function a(a){var t=this;t.ok=function(){return a.hide(t.cols)}}a.$inject=["$mdDialog"],angular.module("md").controller("ConfigurarColunasCarteiraController",a)}(),function(){"use strict";function a(a){var t=this,o=t.contasFiltradas&&t.contasFiltradas.length>0;t.$onInit=function(){t.mapDados={},t.contas.sort((function(a,t){return a.nome<t.nome?-1:1})),t.contasFiltradas&&t.contasFiltradas.forEach((function(a){t.mapDados[a]=!0}))},t.filtrar=function(){var e=[];angular.forEach(t.mapDados,(function(a,t){a&&e.push(t)})),e.length||o?a.hide(e):a.cancel()}}a.$inject=["$mdDialog"],angular.module("md").controller("EditarFiltroCarteiraController",a)}(),function(){"use strict";function a(a,t,o,e,n,r){var i=this;e.title="Configurações",i.configs=[{label:"Geral",items:[{id:"modInvest",name:"Login módulo de investimentos",content:"Acessar o Módulo de Investimentos automaticamente ao realizar o login no Meu Dinheiro."},{id:"investAutoEvt",name:"Importação automática de eventos",content:"Importar eventos corporativos e gerar operações automaticamente."}]},{label:"Imposto de renda",items:[{id:"investLiquidacao",name:"Apuração do valor a pagar",content:"Apurar o imposto de renda a pagar pela data de liquidação."},{id:"investVencIr",name:"Apuração do limite de isenção",content:"Apurar o limite de isenção de ações pela data de liquidação."},{id:"investDaytrade",name:"Limite de isenção (Day Trade)",content:"Considerar as vendas day trade no limite de isenção de R$20.000,00 de ações."}]}],i.config=o.utilizacao,i.toggleConfig=function(o){var e=o.id;if("investAutoEvt"==e){if(!i.config[e])return r.habilitarAutoImportacao(c)}else if(e.match(/investLiquidacao|investVencIr|investDaytrade/))return function(a){return n.show({id:"alterar-configuracao",templateUrl:"partials/investimentos/configuracoes/confirmarAlteracao.html",controller:function(){this.ok=function(){return n.hide()}},controllerAs:"vm",bindToController:!0,locals:{config:a}})}(o).then(c);return c();function c(){return i.config[e]=!i.config[e],a.$broadcast("mdwUsuarioConfig"),t.updateConfig(i.config)}}}a.$inject=["$rootScope","usuariosService","configuracoesService","mdwTopmenu","$mdDialog","eventosCorporativosService"],angular.module("md").controller("ConfiguracoesInvestimentosController",a)}(),function(){"use strict";function a(a,t,o,e){e&&a.state("configuracoes",{url:"/configuracoes",controller:"ConfiguracoesInvestimentosController",controllerAs:"vm",templateUrl:"partials/investimentos/configuracoes/configuracoes.html"})}a.$inject=["$stateProvider","mdwStateDialogProvider","mdwBaseStateProvider","MD_INVEST_MOD"],angular.module("md").config(a)}(),function(){"use strict";angular.module("md").constant("mdwNomeGrupoInvest",{1:"Ações",2:"Opções",3:"Fundos de investimento",6:"Títulos Privados",5:"Moedas",7:"Tesouro Direto",8:"Mercado Futuro",11:"Outros",12:"ETFs",32:"ETFs Renda Fixa",13:"FIIs",14:"Fiagros",15:"Fi-Infras",16:"FIPs",17:"Imóveis",29:"Stocks",30:"ETFs US",31:"BDRs",24:"Criptomoedas",25:"Fundos de previdência",1002:"Poupança"})}(),function(){"use strict";function a(a,t,o,e,n,r,i,c){var s=this;function l(){s.possuiInativa=!1,s.possuiAtiva=!1;var a={0:{label:"Contas da Carteira de Investimentos",contas:[]},1:{label:"Outras contas patrimoniais",contas:[]}};s.grupos=[];var t=r.contas;s.cntContas=0;for(var o=0;o<t.length;o++)if(t[o].status){s.possuiAtiva=!0;break}s.possuiAtiva||(s.exibirApenasAtivas=!1),t.forEach((function(t){if("CARTEIRA_INVEST"!=t.tipo&&("OUTROS"!=t.tipo||t.exibirBP)&&(t.status||(s.possuiInativa=!0,!s.exibirApenasAtivas))){var o="CONTA CORRENTE"==t.tipo||"INVESTIMENTO"==t.tipo?0:1;s.grupos[o]||(s.grupos[o]=a[o]),s.grupos[o].contas.push(t),s.cntContas++}})),s.grupos.forEach((function(a){a.contas.sort((function(a,t){return a.status&&!t.status?-1:!a.status&&t.status?1:a.nome.toLowerCase()<t.nome.toLowerCase()?-1:1}))})),u()}function u(){var a=new RegExp(c(s.busca),"i");s.grupos.forEach((function(t){t.contasOriginal||(t.contasOriginal=t.contas),null==s.busca||""==s.busca?t.contas=t.contasOriginal:t.contas=t.contasOriginal.filter((function(t){return!t.nome||null!=t.nome.match(a)}))}))}e.title="Contas",a.$on("$destroy",r.addObserver("contas",l)),s.validadorPlano=i.validarPlanoAtual(),s.exibirApenasAtivas=!0,s.setContas=l,s.filtrar=u,l(),s.bancoSelector={onChange:function(a,t){var o=angular.copy(t);o.banco=a.id,n.update(o).then((function(a){t.banco=a.banco}))}},s.toggleStatus=function(a){if(a.status)return n.inativar(a);a.status=!a.status;var t=angular.copy(a);a.banco&&(t.banco=a.banco.id),n.update(t)}}a.$inject=["$scope","$mdDialog","$filter","mdwTopmenu","contasService","cadastrosDatasource","usuariosService","mdwAccentFold"],angular.module("md").controller("ContasInvestController",a)}(),function(){"use strict";function a(a,t,o,e){e&&(o.state({id:"contas",title:"Contas",templates:["investimentos/contas/contas.html"]},{url:"/contas",templateUrl:"partials/investimentos/contas/contas.html",controller:"ContasInvestController",controllerAs:"vm",data:{permmd:"cadastros.contas"}}),a.state("contas.novo",t.getState({url:"/novo",action:"contasInvestService.novo",data:{permmdt:"g"}})).state("contas.editar",t.getState({url:"/editar/:id",action:"contasInvestService.editar",data:{permmdt:"g"}})).state("contas.excluir",t.getState({url:"/excluir/:id",action:"contasService.excluir",data:{permmdt:"e"}})).state("contas.restricoes",t.getState({url:"/restricoes/:id",action:"contasService.restricoes",data:{permmdt:"g",permmdadmin:!0}})))}a.$inject=["$stateProvider","mdwStateDialogProvider","mdwBaseStateProvider","MD_INVEST_MOD"],angular.module("md").config(a)}(),function(){"use strict";function a(a,t,o,e){return{novo:function(a){return e.dialogPlanoNcontas((function(){return e.dialogPlanoInvestimentos((function(){return n(a)}))}))},editar:n};function n(e){void 0===e&&(e={});var n=!!e&&!!e.id;return a.show({id:"edicao-conta-invest",templateUrl:"/partials/investimentos/contas/editarConta.html",controller:"EditarContaInvestController",controllerAs:"vm",bindToController:!0,locals:{tipo:angular.isDefined(e.tipo)?+e.tipo:void 0},resolve:{conta:function(){return n?o.get("contas",e.id).then((function(a){return t.getOperacoesPosicaoInicial(a.id).then((function(t){return a.operacoes=t||[],a}))})):{}}}})}}a.$inject=["$mdDialog","operacoesService","cadastrosDatasource","usuariosService"],angular.module("md").factory("contasInvestService",a)}(),function(){"use strict";function a(a,t,o,e,n,r,i,c){var s=this;s.ok=function(e,i){if(e.$submitted=!0,e.$invalid)return;var c=angular.copy(s.conta);2==s.tipoConta?c.tipo="CONTA CORRENTE":1==s.tipoConta?(c.tipo="INVESTIMENTO",c.tipoInvestimento=1):3==s.tipoConta?(c.tipo="INVESTIMENTO",c.tipoInvestimento=2):4==s.tipoConta&&(2==s.tipoOutros?c.tipo="OUTROS":c.tipo="INVESTIMENTO");c.percentualIndexador&&(c.percentualIndexador=Math.abs(c.percentualIndexador));c.taxaPrefixada&&(c.taxaPrefixada=Math.abs(c.taxaPrefixada));if(4==s.tipoConta&&1==s.tipoOutros&&(6==c.tipoInvestimento||11==c.tipoInvestimento)){var l=c.depreciar?-1:1;c.percentualIndexador&&(c.percentualIndexador*=l),c.taxaPrefixada&&(c.taxaPrefixada*=l)}c.saldoInicial=Math.abs(s.conta.saldoInicial)*s.sinal,s.banco&&s.banco.id?c.banco=s.banco.id:c.banco=u?0:void 0;c.operacoes=s.operacoes;var d=u?n.update(c):n.create(c);return s.salvando=!0,d.then((function(e){return s.conta.saldoInicial=c.saldoInicial,s.conta.banco=s.banco,o.hide(e).then((function(){s.edicao||a((function(){r.definirRestricoesConta(e).finally((function(){i&&a((function(){t.go("contas.novo")}),100)}))}),100)}))})).finally((function(){s.salvando=!1}))},s.sugerirPercentualIndexador=function(){s.op&&s.op.ativo?s.op.ativo.percentualIndexador=0==s.op.ativo.indexador?0:1:s.conta.percentualIndexador=0==s.conta.indexador?0:1},s.tipoRentabilidade=1,s.today=moment().endOf("day"),s.service=e,s.restricaoMoeda=!1,s.moedas=c.disponiveis,s.conta=angular.extend({nome:"",saldoInicial:0,dataSaldoInicial:moment(),indexador:0,liquidez:1,tipo:"INVESTIMENTOS",considerarCarteiraInvestimentos:1,depreciar:s.conta.taxaPrefixada<0||s.conta.percentualIndexador<0,moeda:i.utilizacao.moeda},s.conta),s.conta.id?"CONTA CORRENTE"==s.conta.tipo?s.tipoConta=2:"OUTROS"==s.conta.tipo?(s.tipoConta=4,s.tipoOutros=2):1==s.conta.tipoInvestimento?s.tipoConta=1:2==s.conta.tipoInvestimento?s.tipoConta=3:(s.tipoConta=4,s.tipoOutros=1):(s.tipoConta=2,s.tipoOutros=2);const l=[6,7,8,9,10,11,12,13,14,15];s.hasIndexador=function(a){return l.includes(a)},s.cadastroPI=s.conta.operacoes&&s.conta.operacoes.length>0,s.conta.dataSaldoInicial=moment(s.conta.dataSaldoInicial),s.banco=s.conta.banco,s.selectorBanco={onChange:function(a){s.banco=a,s.conta.banco=a}};var u=s.edicao=!!s.conta&&!!s.conta.id;function d(a){s.sinalPosicao=!a||a.quantidade>0?1:-1,a||(s.editando=-1),s.tipoRentabilidade=1,!a||!a.ativo||11!=a.ativo.tipo&&17!=a.ativo.tipo||a.ativo.indexado||(s.tipoRentabilidade=2),s.op=angular.merge({valor:0,ativo:{indexador:0,taxaPrefixada:0,depreciar:!1},dataOperacao:moment(s.conta.dataSaldoInicial).format("YYYY-MM-DD")},a||{}),a&&(s.op.quantidade=Math.abs(s.op.quantidade)),m()&&(s.op.valor=s.op.valor*s.op.quantidade,s.op.ativo.valor*=s.op.valor)}function m(){return s.op.tipoInvestimento&&-1!=[18,19,20,21,22,33,34,35].indexOf(s.op.tipoInvestimento)}function f(){1==s.conta.moeda?s.tiposAtivo=[1,2,12,32,13,14,15,16,3,5,24,7,18,19,20,21,33,34,35,23,17,11]:2==s.conta.moeda?s.tiposAtivo=[29,30,24,17,11]:s.tiposAtivo=[17,11]}s.sinal=u?s.conta.saldoInicial>=0?1:-1:1,f(),s.onChangeTipoConta=function(){s.cadastroPI=s.cadastroPI&&3!=s.tipoConta},s.onChangeMoeda=function(){f(),s.conta.id||s.conta.moeda==i.utilizacao.moeda?s.restricaoMoeda=!1:c.getNumContas().then((function(a){var t=r.planoGetMoedas();s.restricaoMoeda=a>=t,s.totalMoedas=t}))},s.adicionar=function(){var a=angular.copy(s.op);-1!=[11,17,18,19,20,21,22,33,34,35].indexOf(s.op.tipoInvestimento)&&a._codigoAtivo!=a.codigoAtivo&&(a.codigoAtivo=a._codigoAtivo,a.ativo.codigo=a._codigoAtivo,a.ativo.nome=a._codigoAtivo);if(-1!=[11,17].indexOf(s.op.tipoInvestimento)){var t=a.ativo.depreciar?-1:1;a.ativo.percentualIndexador&&(a.ativo.percentualIndexador=Math.abs(a.ativo.percentualIndexador)*t),a.ativo.taxaPrefixada&&(a.ativo.taxaPrefixada=Math.abs(a.ativo.taxaPrefixada)*t)}a.ativo.tipo=a.tipoInvestimento,m()?(a.quantidade=a.valor,a.valor=1):-1!=[3,7,11].indexOf(s.op.tipoInvestimento)?(a.quantidade||(a.quantidade=1),a.valor=a.valor/a.quantidade):17==s.op.tipoInvestimento?a.quantidade=1:-1!=[1,2,12].indexOf(s.op.tipoInvestimento)&&(a.quantidade*=s.sinalPosicao);a.dataOperacao=moment(a.dataOperacao).format("YYYY-MM-DD"),s.editando>=0?s.operacoes[s.editando]=a:s.operacoes.push(a);d()},s.getLabelQuantidade=function(){return s.op&&s.op.tipoInvestimento&&-1!=[3].indexOf(s.op.tipoInvestimento)?"Qtd. cotas":"Quantidade"},s.getLabelValor=function(){return s.op&&s.op.tipoInvestimento?-1!=[1,2,5,12,13,23,24].indexOf(s.op.tipoInvestimento)?"Preço médio unitário":-1!=[3,6,11,17,18,19,20,21,22,7,33,34,35].indexOf(s.op.tipoInvestimento)?"Valor investido":"Valor":"Valor"},s.editar=function(a){s.editando=a,d(s.operacoes[a])},s.excluir=function(){s.operacoes.splice(s.editando,1),d()},s.total=function(){return s.operacoes.reduce((function(a,t){return t.valor*t.quantidade+a}),0)},s.operacoes=s.conta.operacoes||[]}a.$inject=["$timeout","$state","$mdDialog","contasInvestService","contasService","usuariosService","configuracoesService","moedaService"],angular.module("md").controller("EditarContaInvestController",a)}(),function(){"use strict";o.$inject=["$mdDialog","carteiraService","configuracoesService","tiposAtivosEstrategiasService","estrategiasService","ativosDatasource","usuariosService","FileUploader","mdHeadersFactory"],angular.module("md").controller("EditarEstrategiaController",o);var a=1e7;function t(t){return Math.round((t+Number.EPSILON)*a*(1e4*a)/1e14)/1e4}function o(a,o,e,n,r,i,c,s,l){const u=this;let d=u.estrategia,m=!!d&&!!d.id;u.edicao=m&&!u.clone,u.disable=!c.planoHasInvestimentos("avancado")||d&&d.sistema,u.alocacaoTotal=0,u.tipos=n.getMapTipos();var f={};u.tipos.forEach((function(a){f[a.id]=a})),u.setTipos=function(a,t){a.tipos.forEach((function(a){if(f[a]&&angular.isDefined(f[a].grupo)&&t!=f[a].grupo){var o=f[a].grupo,e=u.grupos[o].tipos.indexOf(a);u.grupos[o].tipos.splice(e,1)}})),b()},u.setAtivos=function(a,t){a._ativos.push(angular.copy(t)),function(a){for(const t of a._ativos)void 0!==u.mapAlocAtivoGrupo[t.id]&&0!==S(t.id,!0)||(u.mapAlocAtivoGrupo[t.id]={},u.mapAlocAtivoGrupo[t.id][a._id]=1);x()}(a),S(t.id)},u.adicionarGrupo=function(){u.grupos.push({nome:"",ativos:[],_toDisableCombo:!1,_ativos:[],_id:angular.copy(u.idGp++),tipos:[]}),A()},u.removerGrupo=function(a){const t=u.grupos[a]._id;angular.forEach(u.mapAlocAtivoGrupo,((a,o)=>{u.mapAlocAtivoGrupo[o][t]&&(u.mapAlocAtivoGrupo[o][t]=0,S(o))})),u.grupos.splice(a,1),b(),A(),x()},u.ok=function(){if(u.formInvalid)return;u.estrategia.grupos=angular.copy(u.grupos);for(let a=0;a<u.estrategia.grupos.length;a++){const t=u.estrategia.grupos[a];let o=[],e=[];1!=t.comp&&3!=t.comp||t.tipos.forEach((function(a){e.push([a])})),2!=t.comp&&3!=t.comp||t._ativos.forEach((function(a){const e=u.mapAlocAtivoGrupo[a.id][t._id]||0;u.definirAlocAtivo&&0==e||o.push(u.definirAlocAtivo?[a.id,e]:[a.id,1])})),t.tipos=e,t.ativos=o,delete t._ativos,delete t._id,u.definirPerc||delete t.alocacao}var t=m&&!u.clone?r.update(u.estrategia):r.create(u.estrategia);return u.salvando=!0,t.then((function(t){return a.hide(t)})).finally((function(){u.salvando=!1}))},u.calcAlocGrupos=A,u.calcAlocacaoAtivoGrupo=S,u.changeSelectCombo=function(a){1==a.comp&&(a._ativos=[],angular.forEach(u.mapAlocAtivoGrupo,((t,o)=>{u.mapAlocAtivoGrupo[o][a._id]=0,S(o)})))},u.removerAtivo=function(a,t){a._ativos.splice(a._ativos.indexOf(t),1),u.mapAlocAtivoGrupo[t.id][a._id]=0,S(t.id)},u.toggleAtivoGrupos=function(a){const t=u.grupos.indexOf(a);a._ativos.forEach((o=>{const e=o.id;if(u.mapAlocAtivoGrupo[e]||(u.mapAlocAtivoGrupo[e]={},u.mapAlocAtivoGrupo[e][a._id]=1),!angular.isDefined(p[e]))return void(p[e]=t);if(p[e]==t)return;const n=u.grupos[p[e]];p[e]=t;let r=-1;if(!n)return;for(let a=0;a<n._ativos.length;a++)if(n._ativos[a].id==o.id){r=a;break}if(-1==r)return;let i=[];n._ativos.forEach((function(a,t){t!=r&&i.push(a)})),n._ativos=i}))},u.moveUp=function(a){const t=u.grupos[a-1];u.grupos[a-1]=u.grupos[a],u.grupos[a]=t},u.moveDown=function(a){const t=u.grupos[a+1];u.grupos[a+1]=u.grupos[a],u.grupos[a]=t},u.nVinculados=[],u.ativos=[];var p={};u.idGp=0,u.mapAlocAtivoGrupo={},u.invalidInput={};const v={},g=e.getConfig("ativosEstrategias",{s:1});function h(){u.nVinculados=[],u.ativos=[],p={},u.estrategia=angular.extend({nome:"",descricao:"",grupos:[]},d||{}),u.definirPerc=!1,u.estrategia.grupos.forEach((function(a,t){a.ativos.forEach((function(a){p[a[0]]||(p[a[0]]=[]),p[a[0]].push(t)}))})),u.grupos=[],u.alocacaoTotal=0,m?(d.grupos.forEach((a=>{const o={id:a.id,_id:a.id,nome:a.nome,tipos:[],ativos:[],_ativos:[],_toDisableCombo:!1,comp:(a.tipos.length?1:0)+(a.ativos.length?2:0)};angular.isDefined(a.alocacao)&&(u.definirPerc=!0,u.alocacaoTotal+=a.alocacao,o.alocacao=a.alocacao),u.alocacaoTotal=t(u.alocacaoTotal),0==o.comp&&(o.comp=1),a.tipos.forEach((a=>{o.tipos.push(a[0])})),a.ativos.forEach((t=>{u.mapAlocAtivoGrupo[t[0]]||(u.mapAlocAtivoGrupo[t[0]]={}),t[1]>0&&t[1]<1&&!u.definirAlocAtivo&&(u.definirAlocAtivo=!0),u.mapAlocAtivoGrupo[t[0]][a.id]=t[1]||0,o.ativos.push(t[0])})),u.grupos.push(o)})),b()):(u.grupos.push({nome:"Grupo 1",tipos:[1],ativos:[],_id:angular.copy(u.idGp++),_toDisableCombo:!1,_ativos:[],comp:1}),u.grupos.push({nome:"Grupo 2",tipos:[7],ativos:[],_id:angular.copy(u.idGp++),_toDisableCombo:!1,_ativos:[],comp:1})),i.carregarAtivosUsuario().then((function(a){a.sort((function(a,t){return a.nome<t.nome?-1:1})),a.forEach((function(a){if(void 0===p[a.id])return;if(p[a.id].forEach((t=>{u.grupos[t]._ativos.push(a)})),1!==p[a.id].length)return;const t=u.grupos[p[a.id][0]].id,o=u.mapAlocAtivoGrupo[a.id][t];u.mapAlocAtivoGrupo[a.id][t]=o&&0!==o?o:1,u.definirAlocAtivo=!(!u.definirAlocAtivo&&1==u.mapAlocAtivoGrupo[a.id][t])})),u.ativos=a,x()}))}function C(){if(!u.loadingMapAtivosCarteira&&!u.mapAtivosCarteira)return u.loadingMapAtivosCarteira=!0,o.carregarCarteira().then((function(a){u.loadingMapAtivosCarteira=!1;var t={};function o(a){a.grupos.forEach((function(a){a.ativos.forEach((function(a){t[a.id]=!0}))}))}a.c&&a.c[0]&&o(a.c[0]),a.v&&a.v[0]&&o(a.v[0]),u.mapAtivosCarteira=t}))}function b(){u.tipos.forEach((function(a){delete a.grupo})),u.grupos.forEach((function(a,t){a.tipos.forEach((function(a){f[a]&&(f[a].grupo=t)}))})),u.nVinculados=[]}function A(){if(u.definirPerc){for(var a=0,t=0;t<u.grupos.length-1;t++){var o=u.grupos[t];o.alocacao&&(a+=o.alocacao)}var e=Math.max(1-a,0);u.grupos[u.grupos.length-1].alocacao=e,u.alocacaoTotal=a+e}}function x(){u.toDisableAlocAtivo=!1;const a=[];for(const t of u.grupos){t._toDisableCombo=!1;for(const o of t._ativos){if(!u.mapAlocAtivoGrupo[o.id][t._id])continue;const e=a.includes(o.id),n=u.mapAlocAtivoGrupo[o.id][t._id]>0,r=1!=u.mapAlocAtivoGrupo[o.id][t._id];(e||r&&n)&&(u.toDisableAlocAtivo=!0),r&&n&&(t._toDisableCombo=!0),a.push(o.id)}}}function S(a,t){let o=0;if(angular.forEach(u.mapAlocAtivoGrupo[a],(a=>{o+=a||0})),u.invalidInput[a]={aloc:o>1},v[a]=o>1,u.formInvalid=!1,angular.forEach(v,(a=>{a&&(u.formInvalid=!0)})),t)return o;x()}u.status=1==g.s,u.changeStatus=function(){return e.updateConfig("ativosEstrategias",{s:u.status}),C()},u.$onInit=function(){h(),u.status&&C()},u.queryAtivos=function(a){const t=a=>!u.status||!u.mapAtivosCarteira||u.mapAtivosCarteira[a.id];if(!a)return u.ativos.filter(t);const o=new RegExp(`(^${a})|(\\s+${a})`,"i");return u.ativos.filter((a=>a.codigo&&a.codigo.match(o)||a.descricao&&a.descricao.match(o)||a.nome&&a.nome.match(o))).filter(t)}}}(),function(){"use strict";function a(a,t,o,e,n){var r=this;function i(){r.loading=!0,r.grupos=[{label:"Estratégias personalizadas",estrategias:[]},{label:"Estratégias de sistema",estrategias:[]}],o.carregarEstrategias().then((function(a){r.loading=!1,a.sort((function(a,t){return a.status&&!t.status?-1:!a.status&&t.status?1:a.nome<t.nome?-1:1})),a.forEach((function(a){var t=a.sistema?1:0;r.grupos[t].estrategias.push(a)}))})),e.carregarAtivosUsuario().then((function(a){r.ativos={},a.forEach((function(a){r.ativos[a.id]=a.nome}))}))}r.estrategias=[],r.nomeInvest=n,t.title="Estratégias de alocação",a.$on("$destroy",o.addObserver(i)),r.$onInit=function(){i()},r.toggleStatus=function(a){o.alterarStatus(a.id,!a.status).then((function(){a.status=!a.status}))}}a.$inject=["$scope","mdwTopmenu","estrategiasDatasource","ativosDatasource","mdwNomeGrupoInvest"],angular.module("md").controller("EstrategiasController",a)}(),function(){"use strict";function a(a,t,o,e,n,r,i,c,s,l){var u=this,d=e("/api/v2/investimentos/estrategias/:id"),m=s("estrategias");function f(a){d.reset(),m.notify(a)}u.addObserver=m.add,u.carregarEstrategia=function(a){return d.get({id:a})},u.carregarEstrategias=function(){return d.get()},u.alterarStatus=function(a,t){return l.put("/api/v2/investimentos/estrategias/"+a+"/status",{status:t}).then((function(a){return f(),a.data}))},u.insertEstrategia=function(a){return l.post("/api/v2/investimentos/estrategias",a).then((function(a){return f(),a.data}))},u.updateEstrategia=function(a){return l.put("/api/v2/investimentos/estrategias/"+a.id,a).then((function(a){return f(),a.data}))},u.deleteEstrategia=function(a){return l.delete("/api/v2/investimentos/estrategias/"+a.id).then((function(){f()}))},u.adiconarAlocacoAtivo=function(a,t){return l.put("/api/v2/investimentos/estrategias/alocacaoativo/"+t,{estrategias:a}).then((a=>(f(),a.data)))}}a.$inject=["$window","$q","$timeout","mdwCache","mdwResourceObserver","operacoesDatasource","lancamentosDatasource","cadastrosDatasource","mdwObserver","$http"],angular.module("md").service("estrategiasDatasource",a)}(),function(){"use strict";function a(a,t,o){o.state({id:"estrategias",title:"Estratégias de alocação",templates:["investimentos/estrategias/estrategias.html"]},{url:"/estrategias",templateUrl:"partials/investimentos/estrategias/estrategias.html",controller:"EstrategiasController",controllerAs:"vm",data:{permmd:"investimentos"}}),a.state("estrategias.nova",t.getState({url:"/nova",action:"estrategiasService.novo"})).state("estrategias.editar",t.getState({url:"/editar/:id",action:"estrategiasService.editar"})).state("estrategias.clonar",t.getState({url:"/clonar/:id",action:"estrategiasService.clonar"})).state("estrategias.excluir",t.getState({url:"/excluir/:id",action:"estrategiasService.excluir"}))}a.$inject=["$stateProvider","mdwStateDialogProvider","mdwBaseStateProvider"],angular.module("md").config(a)}(),function(){function a(a,t,o,e,n){return{create:function(a){return o.insertEstrategia(a).then((function(a){return t.showSimple("Estratégia criada"),a}))},update:function(a){return o.updateEstrategia(a).then((function(a){return t.showSimple("Estratégia atualizada"),a}))},delete:r,novo:i,editar:i,excluir:function(t){return a.show({id:"excluir-estrategia",templateUrl:"/partials/investimentos/estrategias/excluir.html",controller:["estrategia",function(t){this.ok=function(){return r(t).then((function(){return a.hide()}))}}],controllerAs:"vm",bindToController:!0,resolve:{estrategia:function(){return o.carregarEstrategia(t.id)}}})},clonar:function(a){return i(a,!0)}};function r(a){return o.deleteEstrategia(a).then((function(){t.showSimple("Estratégia excluída")}))}function i(t,r){return t&&t.id?(n(),o.carregarEstrategia(t.id).then((function(a){return a.sistema?c(a):i(a)}))):i(t);function i(a){return e.dialogPlanoInvestimentos((function(){return c(a)}),"avancado")}function c(t){return a.show({id:"edicao-estrategia",templateUrl:"/partials/investimentos/estrategias/editar.html",controller:"EditarEstrategiaController",controllerAs:"vm",bindToController:!0,locals:{estrategia:t,clone:r},escapeToClose:!1})}}}a.$inject=["$mdDialog","$mdToast","estrategiasDatasource","usuariosService","mdwDialogLoading"],angular.module("md").factory("estrategiasService",a)}(),function(){"use strict";function a(a,t){const o=this;o.$onInit=function(){t.carregarAtivosUsuario().then((a=>{a.sort(((a,t)=>a.nome<t.nome?-1:1)),o.ativos=a}))},o.onSelectItem=function(a){a&&void 0!==a&&(o.searchText=null,o.onSetItem({ativo:a}))},o.queryAtivos=function(){const a=a=>!o.status||!o.mapAtivosCarteira||o.mapAtivosCarteira[a.id];function t(a){for(const t of o.ativosFiltro)if(t.id==a)return!0;return!1}if(!o.searchText)return o.ativos.filter((a=>!t(a.id))).filter(a);const e=new RegExp(`(^${o.searchText})|(\\s+${o.searchText})`,"i");return o.ativos.filter((a=>a.codigo&&a.codigo.match(e)||a.descricao&&a.descricao.match(e)||a.nome&&a.nome.match(e))).filter((a=>!t(a.id))).filter(a)}}a.$inject=["$element","ativosDatasource"],angular.module("md").component("mdwSelectAtivoEstrategias",{controller:a,templateUrl:"/partials/investimentos/estrategias/selectAtivo.component.html",controllerAs:"vm",bindings:{ativosFiltro:"<",onSetItem:"&",ngDisabled:"=",status:"=apenasAtivosCarteira",mapAtivosCarteira:"="}})}(),function(){"use strict";angular.module("md").service("tiposAtivosEstrategiasService",(function(){const a=[{id:1,label:"Ações"},{id:2,label:"Opções"},{id:13,label:"FIIs"},{id:14,label:"Fiagro"},{id:15,label:"Fi-Infra"},{id:16,label:"FIP"},{id:12,label:"ETFs"},{id:32,label:"ETF Renda Fixa"},{id:31,label:"BDRs"},{id:29,label:"Stocks/REITs"},{id:30,label:"ETFs US"},{id:3,label:"Fundos de investimento"},{id:6,label:"Títulos privados"},{id:23,label:"Debêntures"},{id:5,label:"Moedas"},{id:7,label:"Tesouro Direto"},{id:11,label:"Outros"},{id:17,label:"Imóveis"},{id:24,label:"Criptomoedas"},{id:25,label:"Fundos de previdência"},{id:1002,label:"Poupança"}];this.getMapTipos=function(){return a},this.getTiposIds=function(){return a.map((a=>a.id))}}))}(),function(){"use strict";function a(a,t,o){var e=this,n=o("eventos"),r=t("/api/v2/investimentos/eventos/:ativo");function i(a){r.reset(),n.notify(a)}e.addObserver=n.add,e.carregarEventos=function(a){return r.get({ativo:a})},e.importarEventos=function(t){return a.post("/api/v2/investimentos/eventos/importar",{eventos:t}).then((function(a){return i(),a.data}))}}a.$inject=["$http","mdwCache","mdwObserver"],angular.module("md").service("eventosDatasource",a)}(),function(){"use strict";angular.module("md").filter("valorEventoCorporativo",["$filter",function(a){return function(t,o){return 1==t.tipo||2==t.tipo||6==t.tipo||8==t.tipo?a("currency")(t.valor,"R$ ",10):3==t.tipo||7==t.tipo?a("number")(t.valor)+"%"+(t.valorBon&&!o?" ("+a("currency")(t.valorBon,"R$ ")+")":""):4==t.tipo?a("number")(1/t.valor,0)+" para 1":5==t.tipo?"1 para "+a("number")(1+t.valor/100):t.valor}}])}(),function(){"use strict";function a(a,o,e,n,r,i){var c=this;function s(t,e){return a.show({id:"importar-eventos",templateUrl:"/partials/investimentos/eventos/importar.html",controllerAs:"vm",bindToController:!0,escapeToClose:!1,wait:!0,locals:{eventos:angular.copy(t),desabilitarSelecao:e},controller:"ImportarEventosCorporativosController"}).then((function(){o.showSimple("Eventos importados")}))}c.confirmarImportacaoEventos=function(a){return s(a,!0)},c.importarEventos=function(a){return r.importarEventos(a)},c.carregarEventosPendentes=function(){if(n.canEdit("investimentos"))return r.carregarEventos().then((function(a){if(a.length>0)return s(a)}))},c.getSelectionManager=function(a){return new t(a)},c.habilitarAutoImportacao=function(){return a.show({id:"habilitar-auto-importacao",templateUrl:"partials/investimentos/eventos/habilitar-auto-importacao.html",controller:function(){this.ok=function(){var t=e.utilizacao;return t.investAutoEvt=!0,n.updateConfig(t).then((function(){return i.$broadcast("mdwUsuarioConfig"),a.hide()}))}},controllerAs:"vm",bindToController:!0})}}function t(a){var t=this;t.selected=0,t.sel={},t.toggleAll=function(o){o=angular.isDefined(o)?o:t.selected!=a.length,t.selected=o?a.length:0;for(var e=0;e<a.length;e++)t.sel[e]=o},t.toggle=function(a){t.sel[a]?t.selected--:t.selected++},t.getSelected=function(o){var e=[];return a.forEach((function(a,n){o?(a.ignorar=!t.sel[n],e.push(a)):t.sel[n]&&e.push(a)})),e}}a.$inject=["$mdDialog","$mdToast","configuracoesService","usuariosService","eventosDatasource","$rootScope"],angular.module("md").service("eventosCorporativosService",a)}(),function(){"use strict";function a(a,t,o,e,n,r){var i,c=this;c.isPj="FISICA"!=r.usuario.conta.tipoPessoa,c.autoEvt=n.utilizacao.investAutoEvt,c.selection=o.getSelectionManager(c.eventos),c.desabilitarSelecao&&c.selection.toggleAll(!0),c.hasBonificacao=!1,c.hasChanges=!1,c.completarDados=[];for(var s=0;s<c.eventos.length;s++)if(3==c.eventos[s].tipo){c.hasBonificacao=!0;break}function l(){c.selection.toggleAll(!0);var a=c.selection.getSelected(!0),t=moment().endOf("year").format("YYYY-MM-DD");return a.forEach((function(a){a.dataPagto||(a.dataPagto=t),3!=a.tipo||a.valorBon||(a.valorBon=0)})),c.ok()}function u(a){if(0!=a.length){var t=a.pop();return e.update(t).then((function(){return u(a)}))}}c.$onInit=function(){if(c.autoEvt&&!c.desabilitarSelecao)return l()},c.auto=function(){return o.habilitarAutoImportacao().then(l)},c.ok=function(){if(!a.form||!a.form.$invalid){var e=c.selection.getSelected(!0);return e.forEach((function(a){a.dataPagto&&(a.dataPagto=moment(a.dataPagto).format("YYYY-MM-DD"))})),c.loading=!0,o.importarEventos(e).then((function(a){if(c.loading=!1,c.operacoesImportadas=a,0==a.length)return t.hide();i=[];for(var o=0;o<a.length;o++)i.push(a[o].ir||0),-1!=[8,9,10].indexOf(a[o].tipo)&&(c.viewQtd=!0)}),(function(){c.loading=!1}))}},c.fechar=function(){return t.hide()},c.buttonText=function(){return 0==c.selection.selected?"Ignorar "+c.eventos.length+" evento"+(c.eventos.length?"s":""):"Importar "+c.selection.selected+" evento"+(c.selection.selected>1?"s":"")},c.checkChanges=function(a){c.hasChanges=!1;for(a=0;a<c.operacoesImportadas.length;a++){if((c.operacoesImportadas[a].ir||0)!=i[a]){c.hasChanges=!0;break}}},c.atualizarOperacoes=function(){for(var a=[],t=0;t<c.operacoesImportadas.length;t++){(c.operacoesImportadas[t].ir||0)!=i[t]&&a.push(c.operacoesImportadas[t])}return u(a).then(c.fechar)},c.calcularLiquido=function(a){return(a.valorNominal<0?-1:1)*(Math.abs(a.valorNominal)-Math.abs(a.ir||0))}}a.$inject=["$scope","$mdDialog","eventosCorporativosService","operacoesService","configuracoesService","usuariosService"],angular.module("md").controller("ImportarEventosCorporativosController",a)}(),function(){"use strict";function a(a,t,o,e,n,r,i,c){var s=this;const l=e.nota||[];s.nota=l[0]||{};s.nota.isUs;r.changeTemplateUrl("/partials/investimentos/importacaoNota/importacaoNotaTopmenu.html",s,!0);const u=o.onSuccess({to:a=>0!==a.name.indexOf("importacaoNotaBtc")},(function(){r.changeTemplateUrl(null,null,!1),u()}));function d(){e.fromState&&e.fromState.name?n.go(e.fromState.name,e.fromState.params):n.go("carteira")}s.sair=d,s.$onInit=function(){s.canEdit=!1,s.conta=i.get("contas",s.nota.conta,!0),s.operacoes=s.nota.operacoes},s.importar=function(){return c.importar(s.nota).then((o=>{a.cancel();const e=o.data.length>1?"s":"",n=o.data.length>1?"ões":"ão";t.showSimple(`${o.data.length} operaç${n} importada${e}`),d()}))}}a.$inject=["$mdDialog","$mdToast","$transitions","$stateParams","$state","mdwTopmenu","cadastrosDatasource","importacaoNotaService"],angular.module("md").controller("ImportacaoNotaBtcController",a)}(),function(){"use strict";function a(a,t,o,e,n,r,i,c,s,l,u,d){var m=this;m.refresh=function(){window.location.reload()},m.ds=l,m.url="/api/v1/investimentos/";var f,p=d.getConfig("investNota",{s:!0});function v(){var a={s:m.dados.salvar};m.dados.conta&&(a.c=m.dados.conta),d.updateConfig("investNota",a)}function g(){if(0!=m.lista.length){var a=m.lista.pop();m.current++,h(a)}}function h(a){m.isUploading=!0,m.senhaArquivo&&(a.formData[0].senha=m.senhaArquivo),a.upload(),f=t(angular.noop,1e3)}m.dados={conta:p.c,salvar:p.s},m.importarCustom=function(t){v(),i.hide().then((function(){r.iniciar([{conta:m.dados.conta,custom:!0,_error:t}],{name:a.current.name,params:angular.copy(o)})}))},m.importar=function(){m.uploader.url=m.url+m.dados.conta+"/notas/"+m.dados.corretora},m.novaConta=function(){return e.novo().then((function(a){m.dados.conta=a.id}))},m.uploader=new c({url:"/api/v1/investimentos/importarNota",headers:n.getHeaders()}),m.uploader.onAfterAddingFile=function(a){a.formData=[{conta:m.dados.conta,salvar:m.dados.salvar,mult:!0}]},m.uploader.onAfterAddingAll=function(a){m.uploadBegan=!0,m.total=a.length,m.current=0,m.lista=a,m.isMultiple=m.total>1,g()},m.notas=[],m.uploader.onSuccessItem=function(a,t,o,e){m.notas=m.notas.concat(t),f.then(g)},m.ignorarArquivo=function(){m.error=null,m.errorFile=null,m.erroSenha=null,f.then(g)},m.tentarNovamente=function(){h(m.errorFile),m.error=null,m.errorFile=null,m.erroSenha=null},m.uploader.onErrorItem=function(a,t,o){m.errorFile=a,m.isUploading=!1,401==o||403==o?m.error=1:2==t.type?(m.erroSenha=-1!=t.error.search(/senha/i),m.error=m.erroSenha?2:3,m.customError=t.error):(m.error=3,m.customError="Ocorreu uma falha ao tentar importar o arquivo. Por favor, atualize a página e tente novamente.")},m.uploader.onCompleteAll=function(){m.lista.length>0||m.errorFile||(m.isUploading=!1,v(),m.notas.sort((function(a,t){return a.data>t.data?1:a.data<t.data?-1:0})),i.hide().then((function(){r.iniciar(m.notas,{name:a.current.name,params:angular.copy(o)})})))},m.filtrarConta=function(a){return function(t){var o=t.status&&t.tipo==a&&!u.hasRest("contas",t.id,"v");return o?!(1!=t.moeda&&2!=t.moeda||"INVESTIMENTO"==t.tipo&&1!=t.tipoInvestimento):o}}}a.$inject=["$state","$timeout","$stateParams","contasService","mdHeadersFactory","importacaoNotaService","$mdDialog","FileUploader","moment","cadastrosDatasource","usuariosService","configuracoesService"],angular.module("md").controller("EscolherContaController",a)}(),function(){"use strict";e.$inject=["$transitions","$timeout","$mdToast","$stateParams","$mdDialog","cadastrosDatasource","carteiraService","importacaoNotaService","$state","ativosDatasource","mdwTopmenu"],angular.module("md").controller("ImportacaoNotaController",e);var a=1e7;function t(a){return Math.round(o(a+Number.EPSILON,100))/100}function o(t,o){return t*a*(o*a)/1e14}function e(a,e,n,r,i,c,s,l,u,d,m){var f=this,p=r.nota||[];m.changeTemplateUrl("/partials/investimentos/importacaoNota/importacaoNotaTopmenu.html",f,!0);var v=a.onSuccess({to:function(a){return 0!==a.name.indexOf("importacaoNota")}},(function(){m.changeTemplateUrl(null,null,!1),v()}));function g(){var a=p[f.cur]||{};f.descontarIRRFDTNota&&delete f.descontarIRRFDTNota,f.nota=angular.extend({valorLiquidoOperacoes:0,taxa:0,ir:0,irdt:0,irACompensar:0,valorTotal:0,outrosCustos:0,emolumentos:0,taxaLiquidacao:0,taxaRegistro:0,mf:a.mf,isUs:a.isUs},a),f.valorTotal=f.nota.valorTotal,f.distribuirCustos=a.mf?2:4,h(),f.custom=a.custom||!a.operacoes||0==a.operacoes.length,f.custom&&(a.operacoes=[]),f.conta=c.get("contas",f.nota.conta,!0);var t=function(){1!=f.conta.moeda?(f.nota.isUs=!0,C(a)):i.show({id:"importacao-nota-confirmar-mercado",templateUrl:"/partials/investimentos/importacaoNota/confirmarTipoMercado.dialog.html",escapeToClose:!1,controller:["$mdDialog",function(a){var t=this;t.mercado=1,t.ok=function(){a.hide({isMf:2==t.mercado})}}],controllerAs:"vm"}).then((function(a){f.nota.mf=a.isMf})).then((function(){f.nota.mf||(y(),I()),C(a)}))};a._error?i.show(i.alert().clickOutsideToClose(!1).textContent("O arquivo importado está fora do padrão homologado.").ok("Digitar dados da nota")).then(t):a.custom||0!=a.operacoes.length?a.custom?t():C(a):i.show(i.alert().clickOutsideToClose(!1).textContent("Não conseguimos extrair as operações da nota importada.").ok("Digitar dados")).then(t)}function h(){f.nota.taxa&&(f.nota.isUs||(f.nota.outrosCustos=f.nota.taxa-(f.nota.emolumentos||0)-(f.nota.taxaLiquidacao||0)-(f.nota.taxaRegistro||0),f.descontarIRRFNota&&(f.nota.outrosCustos-=f.nota.ir||0),f.descontarIRRFDTNota&&(f.nota.outrosCustos-=f.nota.irdt||0),f.nota.outrosCustos<=0&&(f.nota.outrosCustos=0)))}function C(a){f.ativos=[];var t={};if(f.nota.operacoes=[],0==a.operacoes.length)return S();var o=!1;a.operacoes.forEach((function(e){var n=e.descricao;f.nota.mf||f.nota.isUs||(n=n.replace(/([A-Z0-9]{4}\d{1,2})F/i,"$1")),6==e.tipo&&(o=!0),28==e.tipoInvestimento&&(n+="T"+e.vencTermo),t[n]||(t[n]={descricao:e.descricao,agrupar:!0,dt:!1,operacoes:[],tipo:e.tipoInvestimento,grupo:{}},28==e.tipoInvestimento&&(t[n].prazoTermo=e.vencTermo));var r=e.tipo+(e.daytrade?"d":"");t[n].grupo[r]||(t[n].grupo[r]={descricao:e.descricao,valor:0,ajuste:0,taxaOperacional:0,quantidade:0,tipo:e.tipo,daytrade:e.daytrade}),t[n].grupo[r].valor=(t[n].grupo[r].valor*t[n].grupo[r].quantidade+e.valor*e.quantidade)/(t[n].grupo[r].quantidade+e.quantidade),t[n].grupo[r].quantidade+=e.quantidade,(a.mf||1!=a.moeda)&&(t[n].grupo[r].ajuste+=e.ajuste,t[n].grupo[r].taxaOperacional+=e.taxaOperacional),t[n].operacoes.push(e)})),a.mf||(o&&y(),I()),angular.forEach(t,(function(a){b(a),f.ativos.push(a),26==a.tipo&&E(a)})),function(){if(f.nota.mf)return void f.ativos.forEach((function(a){a.tipo=8,a.codigo=a.descricao,a.ativo={codigo:a.codigo,nome:a.codigo}}));f.loadingAtivos=!0;var a=[];f.ativos.forEach((function(t){a.push(t.descricao)})),d.buscarDescricoes(a,f.nota.isUs?2:1).then((function(a){f.loadingAtivos=!1,f.ativos.forEach((function(t){if(a[t.descricao]){var o=a[t.descricao];t.ativo=o,t.ativo.nome=o.codigo,t.codigo=o.codigo,28!=t.tipo&&(t.tipo=o.tipo)}}))}))}(),A()}function b(a){var t=[],o=0,e=0,n=0,r=!1,i=!1;angular.forEach(a.grupo,(function(a,c){o++,t.push(a),"5d"==c?e+=a.quantidade:"6d"==c&&(n+=a.quantidade),5==a.tipo?r=!0:6==a.tipo&&(i=!0)})),r&&i?(a.dt=o>1,a.agrupar=e==n):(t.forEach((function(a){a.daytrade=!1})),a.operacoes.forEach((function(a){a.daytrade=!1})),a.dt=!1,a.agrupar=!0),a.warnDt=!a.agrupar,a.agrupar=a.agrupar&&t.length!=a.operacoes.length,a.canGroup=a.agrupar,a.grupo=t}function A(){f.nota.operacoes=[],f.ativos.forEach((function(a){f.nota.operacoes=f.nota.operacoes.concat(a.agrupar?a.grupo:a.operacoes)})),x()}function x(){var a=f.nota.operacoes.filter((function(a){return a.quantidade&&a.valor&&49!=a.tipo}));if(!a.length)return;f.nota.valorLiquidoOperacoes=0,f.nota.valorNominalOperacoes=0,f.nota.valorNominalOperacoesTermo=0,f.nota.valorLiquidoOperacoesTermo=0;var e=0;f.ativos.forEach((function(a){a.operacoes.forEach((function(n){var r=5!=n.tipo?1:-1,i=t(o(n.valor||0,n.quantidade||0));e+=n.taxaOperacional||0,f.nota.mf&&(i=n.ajuste,r=1),28==a.tipo?(f.nota.valorLiquidoOperacoesTermo+=i*r,f.nota.valorNominalOperacoesTermo+=i):(f.nota.valorLiquidoOperacoes+=i*r,f.nota.valorNominalOperacoes+=i)}))})),function(){var a=0,o=f.nota.emolumentos+f.nota.taxaLiquidacao+f.nota.taxaRegistro,e=0;f.nota.mf&&f.nota.operacoes.forEach((function(a){49!=a.tipo&&(e+=a.quantidade)}));var n=f.nota.valorNominalOperacoes+f.nota.valorNominalOperacoesTermo,r=[];f.nota.operacoes.forEach((function(i){var c;49!=i.tipo&&(r.push(i),i._rnd||(i._rnd={emolumentos:0,taxaLiquidacao:0,outrosCustos:0}),c=f.nota.mf?i.quantidade/e:(i.valor||0)*(i.quantidade||0)/n,i.emolumentos=Math.abs(o*c),i._rnd.emolumentos=t(i.emolumentos),a+=i._rnd.emolumentos)})),r.length>0&&(r[0]._rnd.emolumentos+=o-a)}();var n,r,i,c,s=0,l=0;const u=a.filter((a=>!a.zerarCustosOperacionais));1===f.distribuirCustos?s=f.nota.outrosCustos/u.length:2===f.distribuirCustos?f.nota.mf&&(c=0,a.forEach((function(a){c+=Math.abs(a.quantidade||0)}))):4===f.distribuirCustos&&(n={},r=0,u.forEach((function(a){var t=a.tipo+a.descricao;n[t]||(n[t]=0,r++),n[t]++})),i=f.nota.outrosCustos/r);const d=a.reduce(((a,e)=>a+(e.zerarCustosOperacionais?0:t(o(e.valor||0,e.quantidade||0)))),0);let m;for(let o=0;o<a.length;o++){const e=a[o];if(3!==f.distribuirCustos){if(e.zerarCustosOperacionais){e.outrosCustos=0,e._rnd.outrosCustos=0;continue}void 0===m&&(m=o)}if(1===f.distribuirCustos)e.outrosCustos=s,e._rnd.outrosCustos=t(s),l+=e._rnd.outrosCustos;else if(2===f.distribuirCustos){var p=e.quantidade||0,v=(e.valor||0)*p,g=f.nota.mf?Math.abs(p)/c:v/d;e.outrosCustos=f.nota.outrosCustos*g,e._rnd.outrosCustos=t(e.outrosCustos),l+=e._rnd.outrosCustos}else if(4===f.distribuirCustos){var h=e.tipo+e.descricao;e.outrosCustos=i/n[h],e._rnd.outrosCustos=t(e.outrosCustos),l+=e._rnd.outrosCustos}else e._rnd.outrosCustos=t(e.outrosCustos),s+=e.outrosCustos}3===f.distribuirCustos?f.nota.outrosCustos=s:void 0!==m&&(a[m]._rnd.outrosCustos+=f.nota.outrosCustos-l),f.nota.taxaOperacional=e,f.nota.valorTotal=f.nota.valorLiquidoOperacoes-Math.abs(f.nota.emolumentos||0)-Math.abs(f.nota.outrosCustos||0)-Math.abs(f.nota.taxaLiquidacao||0)-Math.abs(f.nota.taxaRegistro||0)-Math.abs(f.nota.taxaOperacional||0),f.descontarIRRFNota&&(f.nota.valorTotal-=Math.abs(f.nota.ir)),f.descontarIRRFDTNota&&(f.nota.valorTotal-=Math.abs(f.nota.irdt))}function S(){var a={tipo:f.nota.mf?8:1,agrupar:!1,operacoes:[],grupos:[]};f.ativos.push(a),D(a)}function D(a){var t={tipo:5,quantidade:0,valor:0};a.operacoes.push(t),f.nota.operacoes.push(t),$(a),E(a)}function $(a){for(var t=!1,o=!1,e=0;e<a.operacoes.length&&(t||5!=a.operacoes[e].tipo?o||6!=a.operacoes[e].tipo||(o=!0):t=!0,!t||!o);e++);a.dt=t&&o&&!a.execOpc,a.dt||a.operacoes.forEach((function(a){a.daytrade=!1}))}function M(){r.fromState&&r.fromState.name?u.go(r.fromState.name,r.fromState.params):u.go("carteira")}function w(a){return i.show(i.alert().title("Falha ao importar nota").textContent(a).ok("Fechar")),!1}function E(a){if(a.compraSubs=!1,a.vendaSubs=!1,26==a.tipo){for(var t,o=a.operacoes.length>0,e=0;e<a.operacoes.length;e++){if(t&&t!=a.operacoes[e].tipo){o=!1;break}t=a.operacoes[e].tipo}a.canHaveSubs=o,o&&(a.compraSubs=5==a.operacoes[0].tipo,a.vendaSubs=5!=a.operacoes[0].tipo,a.tipoSubs||(a.tipoSubs=1))}a.vendaSubs&&angular.isUndefined(f.subscricoes)&&s.carregarCarteira().then((function(a){f.subscricoes=[],a.ds[0]&&(f.subscricoes=[],a.ds[0].grupos.forEach((function(a){a.ativos.forEach((function(a){a.conta==f.nota.conta&&f.subscricoes.push(a)}))})))}))}function y(){s.carregarCarteira().then((function(a){f.termos={},a.tc[0]&&a.tc[0].grupos[0].ativos.forEach((function(a){var t=a.cotacao.codigo;f.termos[t]||(f.termos[t]=[]),f.termos[t].push({id:a.id,vencimento:a.cotacao.vencimento,quantidade:a.quantidade})}))}))}function I(){function a(a){a.forEach((function(a){for(var t=0;t<a.ativos.length;t++){var o=a.ativos[t];if(2!=o.tipo)return;o.conta==f.nota.conta&&f.opcoes.push({id:o.id,nome:o.nome,vencimento:o.cotacao.vencimento,quantidade:o.quantidade})}}))}s.carregarCarteira().then((function(t){f.opcoes=[],a(t.c[0].grupos),t.v[0]&&a(t.v[0].grupos),f.opcoes.sort(((a,t)=>a.nome<t.nome?-1:a.nome>t.nome?1:0))}))}f.importar=function(){var a=angular.copy(f.nota),t=angular.copy(f.ativos);a.taxa=0,a.operacoes=[];for(var o=0;o<t.length;o++){var e=f.ativos[o],r=e.agrupar?e.grupo:e.operacoes,c=0,s=0;if(e.execOpc&&!e.exercicio)return w("É necessário informar a opção que será exercida");if(e.compraSubs&&!e.valorSubscricao)return w("É necessário informar o valor da subscrição dos direitos que foram comprados");if(e.compraSubs&&!e.dataSubscricao)return w("É necessário informar a data da subscrição dos direitos que foram comprados");if(28==e.tipo&&!e.prazoTermo)return w("É necessário informar o prazo em dias para o vencimento do Termo");if(r.forEach((function(t){var o=angular.copy(t);e.execOpc&&(o.exercicio=e.exercicio),e.compraSubs&&(o.tipoSubs=e.tipoSubs,o.valorSubscricao=e.valorSubscricao,o.dataSubscricao=moment(e.dataSubscricao).format("YYYY-MM-DD")),28==e.tipo&&(o.prazoTermo=e.prazoTermo),(o.quantidade&&o.valor||49==o.tipo&&o.ajuste)&&(o.descricao=e.descricao,o.tipoAtivo=e.tipo,61==o.tipo||62==o.tipo?(o.tipoVenda=61==o.tipo?2:3,o.tipo=6):63==o.tipo&&(o.tipoCompra=3,o.tipo=5),e.vendaSubs?o.ativo=e.id:o.ativo=e.ativo?e.ativo.codigo:e.codigo,49!=t.tipo&&(o.custos=o._rnd.emolumentos+o._rnd.outrosCustos+(o.taxaOperacional||0),a.taxa+=o.custos),a.operacoes.push(o),o.daytrade?5==o.tipo?c+=o.quantidade:5!=o.tipo&&(s+=o.quantidade):!0)})),c!=s)return w("As quantidades de compras e vendas de "+(e.codigo||e.descricao)+" marcadas como Day Trade devem ser iguais")}if(!function(){if(0==a.operacoes.length)return w("A nota deve possuir pelo menos uma operação registrada");if(!a.data)return w("A data do pregão não foi informada");if(!a.dataLiquidacao)return w("A data de liquidação não foi informada");if(a.ir&&angular.isUndefined(f.descontarIRRFNota))return w("Favor marcar se o IRRF deve ser descontado do líquido da nota ou não");if(a.irdt&&angular.isUndefined(f.descontarIRRFDTNota))return w("Favor marcar se o IRRF Day Trade deve ser descontado do líquido da nota ou não");for(var t=!1,o=!1,e=0;e<a.operacoes.length;e++){if(!a.operacoes[e].ativo)return w("O código de um ou mais ativos não foi identificado");if(!a.operacoes[e].quantidade)return w("Todas as operações informadas devem possuir quantidade maior que zero");!t&&a.operacoes[e].daytrade&&(t=!0),o||a.operacoes[e].daytrade||5==a.operacoes[e].tipo||(o=!0)}if(a.irdt&&!t)return w("Valor de IRRF Day Trade inválido. Nenhuma operação marcada como Day Trade");if(a.ir&&!o)return w("Valor de IRRF inválido. Nenhuma operação de venda normal registrada");if(null!=a.data&&""!=a.data&&null!=a.dataLiquidacao&&""!=a.dataLiquidacao){if(!(moment(a.dataLiquidacao).format("YYYY-MM-DD")>=moment(a.data).format("YYYY-MM-DD")))return w("A data de liquidação deve ser igual ou posterior a data do pregão")}if(null!=a.data&&""!=a.data&&null!=f.conta.dataSaldoInicial&&""!=f.conta.dataSaldoInicial){if(!moment(a.data).isAfter(f.conta.dataSaldoInicial)&&moment(a.data).format("L")!=moment(f.conta.dataSaldoInicial).format("L"))return w("A data do saldo inicial da conta "+f.conta.nome+" é "+moment(f.conta.dataSaldoInicial).format("DD/MM/YYYY")+". Para importar notas com data anterior a esta, acesse o menu Cadastro/Contas, edite esta conta e altere a Data do Saldo Inicial.")}return!0}())return;a.data=moment(a.data).format("YYYY-MM-DD"),a.dataLiquidacao=moment(a.dataLiquidacao).format("YYYY-MM-DD"),f.descontarIRRFNota||(a.irACompensar=a.ir,a.ir=0);f.descontarIRRFDTNota||(a.irACompensarDt=a.irdt,a.irdt=0);return i.show({id:"loading-nota",escapeToClose:!1,controllerAs:"vm",template:['<md-dialog flex-gt-sm="50" flex-gt-md="30" id="loading-nota">',"<mdw-dialog-header>Importando nota</mdw-dialog-header>",'<md-dialog-content class="mdw-dialog-content" layout="column">','<p style="margin-bottom:30px;line-height:20px;">O processo de importação pode demorar alguns minutos dependendo da quantidade de dados que processaremos para atualizar a posição de sua carteira. Por favor, aguarde.</p>','<div layout="row" layout-align="center"><md-progress-circular class="md-warn" md-mode="indeterminate" ></md-progress-circular></div>',"</md-dialog-content>","</md-dialog>"].join("")}),l.importar(a).then((function(){i.cancel(),n.showSimple("Nota importada"),f.cur++,f.cur<f.cnt?g():M()}),(function(){i.cancel()}))},f.proxima=function(){f.cur++,g()},f.atualizarOperacoes=A,f.excluirOperacao=function(a,t){var o=a.operacoes.indexOf(t);a.operacoes.splice(o,1),o=f.nota.operacoes.indexOf(t),f.nota.operacoes.splice(o,1),0==a.operacoes.length&&(o=f.ativos.indexOf(a),f.ativos.splice(o,1));$(a),E(a),x()},f.clonarOperacao=function(a,t){var o=angular.copy(t);a.operacoes.push(o),f.nota.operacoes.push(o),$(a),E(a)},f.sair=M,f.recalcularTotais=x,f.adicionarAtivo=S,f.adicionarOperacao=D,f.toggleAgruparAtivo=function(a){a.agrupar=!a.agrupar,A()},f.alterarTipoOperacao=function(a,t){49==t.tipo&&(t.quantidade=1);$(a),E(a),x()},f.onChangeTipoAtivo=E,f.alterarAtivo=function(a){delete a.codigo,delete a.ativo,delete a.id},f.agruparOperacoesAtivo=function(a){a.grupo={},a.operacoes.forEach((function(t){var o=t.tipo+(t.daytrade?"d":"");a.grupo[o]||(a.grupo[o]={descricao:t.descricao,valor:0,ajuste:0,taxaOperacional:0,quantidade:0,tipo:t.tipo,daytrade:t.daytrade}),a.grupo[o].valor=(a.grupo[o].valor*a.grupo[o].quantidade+t.valor*t.quantidade)/(a.grupo[o].quantidade+t.quantidade),a.grupo[o].quantidade+=t.quantidade,(f.nota.mf||1!=f.nota.moeda)&&(a.grupo[o].ajuste+=t.ajuste,a.grupo[o].taxaOperacional+=t.taxaOperacional)})),b(a),A()},f.$onInit=function(){f.cur=0,f.cnt=p.length,f.calcularEml=!0,g()},f.recalcularOutrosCustos=function(){h(),x()},f.verificarDifLiquido=function(){return!f.nota.custom&&Math.abs(Math.abs(f.valorTotal)-Math.abs(f.nota.valorTotal))>=.01},f.toggleDTAtivo=function(a){(a.agrupar?a.grupo:a.operacoes).forEach((function(t){t.daytrade=a.daytrade})),x()},f.atualizarAtivo=function(a,t){a.ativo.codigo=t,console.log("vm.atualizarAtivo",a)},f.onChangeDirSubs=function(a){for(var t=0;t<f.subscricoes.length;t++)if(f.subscricoes[t].id==a.id)return void(a.codigo=f.subscricoes[t].cotacao.codigo)},f.onChangeExecOpt=function(a){a.execOpt&&(a.tipo=1),$(a)}}}(),function(){"use strict";function a(a){a.state("importacaoNota",{templateUrl:"partials/investimentos/importacaoNota/notaCorretagem.html",controller:"ImportacaoNotaController",controllerAs:"vm",params:{nota:{},fromState:{}}}).state("importacaoNotaBtc",{templateUrl:"partials/investimentos/importacaoNota/btc/notaBtc.html",controller:"ImportacaoNotaBtcController",controllerAs:"vm",params:{nota:{},fromState:{}}})}a.$inject=["$stateProvider"],angular.module("md").config(a)}(),function(){"use strict";function a(a,t,o,e){return{iniciar:function(t,o){if(t&&t[0].btc)return a.go("importacaoNotaBtc",{nota:t,fromState:o});a.go("importacaoNota",{nota:t,fromState:o})},importar:function(a){if(a&&a.btc)return t.post("/investimentos/salvarNotaBtc",a).then((a=>(e.notify(),o.resetMnemonicos(),a)));return t.post("/investimentos/salvarNota",a).then((function(a){return e.notify(),o.resetMnemonicos(),a}))}}}a.$inject=["$state","$http","ativosDatasource","operacoesDatasource"],angular.module("md").factory("importacaoNotaService",a)}(),function(){"use strict";function a(a,t,o,e,n){var r=this,i=n("investimentos"),c=t("/api/v2/investimentos/historicoAtivo/:ativo"),s=t("/api/v2/investimentos/carteira"),l=t("/api/v2/investimentos/carteira/analise"),u=t("/api/v2/investimentos/carteira/indicadores"),d=t("/api/v2/investimentos/proventos"),m=t("/api/v2/investimentos/resultados/v2"),f=t("/api/v2/investimentos/posicaoAtivo"),p=t("/api/v2/investimentos/gcap"),v=t("/api/v2/investimentos/cotacao");o.addObserver((function(a){s.reset(),l.reset(),u.reset(),c.reset(),d.reset(),m.reset(),p.reset(),f.reset(),i.notify(a)})),e.addObserver((function(a){s.reset(),i.notify(a)})),r.addObserver=i.add,r.historicoAtivo=function(a){return c.get({ativo:a})},r.getCarteira=function(a){return s.get(a)},r.getAnaliseCarteira=function(a){return l.get(a)},r.getIndicadoresCarteira=function(a){return u.get(a)},r.getCotacao=function(a,t){return v.get({ativo:a,data:t})},r.carregarProventos=function(a){return d.get(a)},r.carregarResultados=function(a){return m.get(a)},r.carregarGcap=function(a){return p.get(a)},r.carregarPosicaoAtivoConta=function(a){return f.get(a)}}a.$inject=["$http","mdwCache","rentabilidadeDatasource","estrategiasDatasource","mdwObserver"],angular.module("md").service("investimentosDatasource",a)}(),function(){"use strict";function a(a,t,o,e,n,r,i,c,s,l,u,d,m,f,p){var v=this;v.resumo=null;var g=n.TAXAS;v.atualizarValor=function(a,t){return r.show({template:'<md-dialog class="mdw-dialog" flex="15"><mdw-dialog-header dismiss>Atualizar valor</mdw-dialog-header><form class="mdw-form"><md-dialog-content class="mdw-dialog-content" layout="column"><md-input-container><label>Valor</label><input ng-model="vm.valor" ui-money-mask="2" ></md-input-container> </md-dialog-content><mdw-dialog-actions layout="row" layout-align="start center"><md-button type="submit" class="md-primary md-raised"  ng-click="vm.atualizar()">Salvar</md-button></mdw-dialog-actions></form></md-dialog>',bindToController:!0,locals:{valor:a[t]},controller:["$mdDialog",function(a){var t=this;t.atualizar=function(){a.hide({valor:t.valor})}}],controllerAs:"vm"}).then((function(o){a[t]=o.valor}))},v.calcularBase=b,v.totalIr=A,v.gerarDarf=function(){e.form&&(e.form.$submitted=!0);return u.dialogPlanoInvestimentos((function(){var t=A();if(t<10&&!v.resumo.conta){var o=m.contas.filter((function(a){return"CONTA CORRENTE"==a.tipo}))[0];if(o||(o=m.contas.filter((function(a){return"INVESTIMENTO"==a.tipo&&1==a.tipoInvestimento}))[0]),!o)return alert("Você deve possuir ao menos uma Conta Corrente ou Carteira de Ativos registrada"),!1;v.resumo.conta=o.id}v.resumo.totalIr=t;var i=angular.copy(v.resumo);i.config=v.config;var c={tipo:29,valor:t,conta:v.resumo.conta,dataOperacao:v.resumo.ultimoDiaMesApuracao,dataLiquidacao:v.resumo.vencimento,distribuicao:v.resumo.distribuicao,apuracao:i};if(!(t>9.99)||c.conta)return s.create(c).then((function(){c.valor>9.99?r.show({templateUrl:"partials/investimentos/ir/msglancamento.html",bindToController:!0,locals:{data:a.max(a(v.resumo.vencimento),a()).format("YYYY-MM-DD")},controllerAs:"vm",controller:function(){this.ok=r.cancel}}).finally((function(){return n.print(e,v.resumo).then(x)})):x()}));d.notify("Necessário informar uma conta para débito")}),"ir")},v.sair=x;var h=["normal","daytrade","fii"];function C(t){v.salvando=!0,function(t){var o=function(){return v.resumo=null,l.carregarApuracao(c.idApuracao,t).then((function(t){if(t){if(v.visualizacao&&(v.title+=" - "+a(t.ultimoDiaMesApuracao).format("MMMM [de] YYYY")),v.resumo=t,v.config=t.config,v.possuiAlteracoes=!1,v.ativos=[],v.visualizacao)f.carregarAtivosUsuario().then((function(a){var t={};a.forEach((function(a){1==a.tipo&&(t[a.id]=a)})),v.config.ativos&&v.config.ativos.length>0&&v.config.ativos.forEach((function(a){t[a]&&v.ativos.push(t[a])}))}));else{var o={};t.operacoes.forEach((function(a){var t=a.ativo;o[t.id]||(o[t.id]=!0,1==t.tipo&&v.ativos.push({id:t.id,nome:t.nome,considerar:!0}))}))}v.tipos.forEach((function(a){if(v.resumo[a].operacoes&&0!=v.resumo[a].operacoes.length){var t={},o=[];v.resumo[a].operacoes.forEach((function(a){var e=a.ativo&&a.ativo.tipoCarteira||a.tipoInvestimento;t[e]||(t[e]={tipo:e,label:p[e]||"",operacoes:[],valorNominal:0,custos:0,resultadoComCustos:0,ir:0},o.push(t[e]));var n=t[e];n.operacoes.push(a),n.valorNominal+=a.valorNominal,n.custos+=a.custos,n.resultadoComCustos+=a.resultadoComCustos,n.ir+=a.ir})),v.resumo[a].operacoesTipo=o}}))}}))};return c.idApuracao?o():u.dialogPlanoInvestimentos(o,"ir")}(t).finally((function(){v.salvando=!1}))}function b(a){var t=v.resumo[a].tributavel-Math.abs(v.resumo[a].perdas);return"normal"==a&&v.resumo.normal.btc&&(t-=v.resumo.normal.btc),t<0&&(t=0),v.resumo[a].ir=n.truncate(t*g[a]),v.resumo[a].base=t}function A(a){var t=n.totalIr(v.resumo,a);return t>=0?t:0}function x(){return i.go("ir")}v.tipos=h,this.$onInit=function(){!function(){v.visualizacao=!!c.idApuracao,t.changeTemplateUrl("/partials/investimentos/ir/apuracaoIrTopmenu.html",v,!0);var a=o.onExit({from:function(a){return"apurarir"==a.name||"visualizarapuracao"==a.name}},(function(){t.changeTemplateUrl(null,null,!1),a()}));v.title="Apuração de Imposto de Renda",C(),v.printConfig={controller:["usuariosService",function(a){var t=this;t.resumo=v.resumo,t.calcularBase=b,t.totalIr=A,t.visualizacao=v.visualizacao,t.tipos=h}],templateUrl:"/partials/investimentos/ir/content_print.html"}}()},v.verificarAlteracoes=function(){v.possuiAlteracoes=!1;for(var a=0;a<v.ativos.length;a++)if(!v.ativos[a].considerar){v.possuiAlteracoes=!0;break}},v.atualizarApuracao=function(){return C(v.ativos.filter((function(a){return!a.considerar})).map((function(a){return a.id})))},v.filterContas=function(a){return"CONTA CORRENTE"==a.tipo}}a.$inject=["moment","mdwTopmenu","$transitions","$scope","darfService","$mdDialog","$state","$stateParams","operacoesService","apuracaoIrDatasource","usuariosService","mdwApiError","cadastrosDatasource","ativosDatasource","mdwNomeGrupoInvest"],angular.module("md").controller("ApuracaoController",a)}(),function(){"use strict";function a(a,t,o,e){var n=this,r=t("investimentos/apurarircontas"),i=t("investimentos/carregarApuracoesIr"),c=o();function s(){return i.get()}n.addObserver=c.add,n.carregarApuracoes=s,n.carregarApuracao=function(a,t){return a?s().then((function(t){for(var o=0;o<t.length;o++)if(t[o].id==a)return t[o]})):function(a){var t={};a&&(t.ignorar=a.join(","));return r.get(t)}(t)},e.addObserver((function(a){r.reset(),i.reset(),c.notify(a)}))}a.$inject=["$http","mdwCache","mdwObserver","operacoesDatasource"],angular.module("md").service("apuracaoIrDatasource",a)}(),function(){"use strict";t.$inject=["mdwPrintService"],angular.module("md").service("darfService",t);var a={normal:.15,daytrade:.2,fii:.2};function t(t){var o=this;function e(t,e){function n(a){return(t[a].irRetidoNaFonte||0)+(t[a].irrfAcumulado||0)+(t[a].irrfCompensar||0)}angular.isUndefined(t.normal.ir)&&function(t){["normal","daytrade","fii"].forEach((function(e){var n=t[e].tributavel-Math.abs(t[e].perdas);"normal"==e&&t.normal.btc&&(n-=t.normal.btc),n<0&&(n=0),t[e].ir=o.truncate(n*a[e]),t[e].base=n}))}(t);var r=Math.max(0,t.normal.ir+t.daytrade.ir-n("normal")-n("daytrade"))+Math.max(0,t.fii.ir-n("fii"))-(t.irRetidoNaFonte||0)-(t.irrfAcumulado||0)-(t.irrfCompensar||0);return e||(r+=(t.multa||0)+(t.jurosEncargos||0)+(t.irsAnteriores||0)),r}o.TAXAS=a,o.print=function(a,o){return t.openPrintDialog(a,{controller:["usuariosService",function(a){var t=this;t.darf=o,t.total=function(){return e(o)},t.nome=a.usuario.conta.nome,t.telefone=a.usuario.conta.telefone1,t.tipoPessoa=a.usuario.conta.tipoPessoa,t.cpfCnpj=a.usuario.conta.cpfCnpj}],templateUrl:"/partials/investimentos/ir/darf_print.html"})},o.totalIr=e,o.truncate=function(a){return a?parseFloat(a.toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]):0}}}(),function(){"use strict";function a(a,t,o){var e=this,n=a("/api/v2/investimentos/decir/:ano/posicao"),r=a("/api/v2/investimentos/decir/:ano/transito"),i=a("/api/v2/investimentos/decir/:ano/proventos"),c=a("/api/v2/investimentos/decir/:ano/dividendos-us"),s=a("/api/v2/investimentos/decir/:ano/apuracoes"),l=t();e.addObserver=l.add,e.carregarPosicao=function(a){return n.get(a)},e.carregarTransito=function(a){return r.get(a)},e.carregarProventos=function(a){return i.get(a)},e.carregarApuracoes=function(a){return s.get({ano:a})},e.carregarDividendosUs=function(a){return c.get(a)},o.addObserver((function(a){n.reset(),r.reset(),i.reset(),l.notify(a)}))}a.$inject=["mdwCache","mdwObserver","operacoesDatasource"],angular.module("md").service("declaracaoIrDatasource",a)}(),function(){"use strict";t.$inject=["$scope","$q","$filter","$mdDialog","mdwTopmenu","configuracoesService","declaracaoIrDatasource","GRUPOS_ATIVOS","ativosService","cadastrosDatasource","relatoriosDatasource","irDecPrintService","usuariosService"],angular.module("md").controller("IrDecController",t).service("irDecPrintService",(function(){}));var a="irdec";function t(t,o,e,n,r,i,c,s,l,u,d,m,f){var p=this;r.title="IR / Declaração anual",p.grupos=angular.extend({contas:"Contas"},s),m.grupos=p.grupos;var v=i.getConfig(a,{c:0,cf:null,dp:2});function g(){p.hasPerm&&(p.loading={p1:!0,p2:!0,p3:!0,p4:!0},m.ano=p.ano,m.conta=p.conta,m.contasFiltradas=p.contasFiltradas,o.all([c.carregarPosicao(A()).then((function(a){m.posicao=p.posicao=a,m.posicao.c&&m.posicao.c.forEach((function(a){a.ativos.forEach((function(t){7==a.tipo?t.contas.forEach((a=>{a.clip=h(t,a)+"\nConta: "+e("nomeCadastro")(a.conta,"contas")})):t.clip=h(t)}))}))})),c.carregarTransito(A()).then((function(a){m.transito=p.transito=a})),C()]).then((function(){p.loading.p1=!1})),b(),function(){let a=A();c.carregarDividendosUs(a).then((function(a){m.dividendosUs=p.dividendosUs=a}))}(),c.carregarApuracoes(p.ano).then((function(a){m.apuracoes=p.apuracoes=a,p.loading.p3=!1})))}function h(a,t){var o="";if((t=t||a).quantidade&&-1==[17,18,19,20,21,22,33,34,35].indexOf(p.ativos[a.ativo].tipo)){var n=t.quantidade;if(24==p.ativos[a.ativo].tipo&&(n=e("number")(n,12)),o=p.ativos[a.ativo].nome+" ("+n+")",p.ativos[a.ativo].empresa?o+="\n"+p.ativos[a.ativo].empresa:p.ativos[a.ativo].descricao&&p.ativos[a.ativo].nome!=p.ativos[a.ativo].descricao&&(o+="\n"+p.ativos[a.ativo].descricao),p.ativos[a.ativo].cnpj&&(o+="\nCNPJ: "+e("formatCnpj")(p.ativos[a.ativo].cnpj)),t.valorInvestidoUS)o+="\nValor de aquisição: "+e("currency")(t.valorInvestidoUS,"US$"),o+="\nDólar médio: "+e("currency")(t.valorInvestido/t.valorInvestidoUS,"R$",4)+"\nTotal: "+e("currency")(a.valorInvestido);else o+="\nValor de aquisição: "+e("currency")(t.valorInvestido)}else o=p.ativos[a.ativo].nome+"\nSaldo: "+e("currency")(t.valorAtual);return o}function C(){var a=[];return p.contasFiltradas?a=p.contasFiltradas.map((function(a){return+a})):p.conta&&a.push(p.conta),d.lancamentos.sum({finalidade:d.lancamentos.FIN_EXTRATO,fim:moment(p.ano+"-12-31").format("YYYY-MM-DD"),moeda:-1,contas:{ids:u.contas.filter((function(t){return!(a.length>0&&-1==a.indexOf(t.id))&&(t.exibirBP&&(-1!=["CONTA CORRENTE","DINHEIRO","OUTROS"].indexOf(t.tipo)||"INVESTIMENTO"==t.tipo&&-1!=[1,2].indexOf(t.tipoInvestimento)))})).map((function(a){return a.id})),status:d.lancamentos.STATUS_CONFIRMADO|d.lancamentos.STATUS_CONCILIADO}},{groupBy:"conta",converter:1}).then((function(a){p.total=0,p.saldos=a.sum.filter((function(a){return Math.abs(a.projetado)>.01})),p.saldos.sort((function(a,t){return p.contasMap[a.conta].nome<p.contasMap[t.conta].nome?-1:1})),m.saldos=p.saldos}))}function b(){let a=A();a.dataOperacao=1==p.dataProvento,p.loading.p2=!0,c.carregarProventos(a).then((function(a){m.proventos=p.proventos=a,angular.forEach(a,(function(a){a.ativos.forEach((function(a){a.clip=p.ativos[a.ativo].nome,p.ativos[a.ativo].empresa&&(a.clip+=" - "+p.ativos[a.ativo].empresa),p.ativos[a.ativo].cnpj&&(a.clip+="\nCNPJ: "+e("formatCnpj")(p.ativos[a.ativo].cnpj)),a.clip+="\nValor recebido: "+e("currency")(a.valor)}))})),p.loading.p2=!1}))}function A(){var a={ano:p.ano},t=[];return p.contasFiltradas?t=p.contasFiltradas:p.conta&&t.push(p.conta),t.length>0&&(a.contas=t.join(",")),a}function x(a){var t=angular.toJson(p.contasFiltradas);return n.show({id:"edicao-filtro-carteira-resultado",templateUrl:"/partials/investimentos/carteira/filtro.html",controller:"EditarFiltroCarteiraController",bindToController:!0,locals:{contasFiltradas:p.contasFiltradas,contas:p.contas},controllerAs:"vm"}).then((function(a){p.contasFiltradas=a&&a.length>0?a:null,p.contasFiltradas?t!=angular.toJson(p.contasFiltradas)&&(S(),g()):p.conta=0}),(function(){void 0!==a&&(p.conta=a)}))}function S(){v.c=p.conta,v.cf=p.contasFiltradas,v.dp=p.dataProvento,i.updateConfig(a,v)}p.dataProvento=v.dp,p.conta=v.c,p.contasFiltradas=v.cf,p.contas=u.contas.filter((function(a){return a.status&&("CONTA CORRENTE"==a.tipo||"INVESTIMENTO"==a.tipo)})),p.contas.sort((function(a,t){return a.nome<t.nome?-1:1})),t.$watch("vm.conta",(function(a,t){-1!=t&&-1==a&&x(t)})),p.carregar=g,p.printConfig={controller:["irDecPrintService",function(a){var t=this;t.print=!0,t.service=a,t.ativos=t.service.ativos,t.contasMap=t.service.contas,t.grupos=t.service.grupos,t.posicao=t.service.posicao,t.saldos=t.service.saldos,t.transito=t.service.transito,t.proventos=t.service.proventos,t.dividendosUs=t.service.dividendosUs,t.apuracoes=t.service.apuracoes,t.hasPerm=t.service.hasPerm,t.contasFiltradas=t.service.contasFiltradas,t.conta=t.service.conta,t.ano=t.service.ano}],templateUrl:"/partials/investimentos/ir/declaracao/print.html",landscape:!0},p.$onInit=function(){p.ano=moment().year()-1,m.ano=p.ano,p.anos=[];for(var a=2019;a<=p.ano+1;a++)p.anos.push(a);p.ativos={},p.contasMap={},p.hasPerm=f.planoHasInvestimentos("ir"),m.hasPerm=p.hasPerm,o.all([l.carregarGrupos().then((function(a){a[1].forEach((function(a){p.ativos[a.id]=a})),m.ativos=p.ativos})),u.contas.forEach((function(a){p.contasMap[a.id]=a,m.contas=p.contasMap}))]).then((function(){p.hasPerm&&g()}))},p.onChangeDataProvento=function(){b(),S()},p.onChangeConta=function(){-1!=p.conta&&(p.contasFiltradas=null,S(),g())},p.filtrarContas=x}}(),function(){"use strict";function a(a,t,o,e){var n,r,i=this;function c(a){return a?parseFloat(a.toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]):0}i.ativos=[],i.gcap=null,i.total=0,i.resultado=0,i.hasPerm=t.planoHasInvestimentos("ir"),i.reset=function(){n=null,i.ativos=[],i.total=0,i.resultado=0},i.carregarGcap=function(t,o){return n||(n=a.carregarGcap({inicio:t,origem:o}).then((function(a){i.gcap=a,a.forEach((function(a){0==a.percentual?a.origem=2:1==a.percentual?a.origem=1:a.origem=3,i.calcularResultados(a),i.calcularResumo()}))})))},i.calcularResultados=function(a){a.valorAquisicaoBrl=0,a.valorAquisicaoUsd=0;var t=a.valorAlienacao-a.custos;1==a.origem?(a.valorAquisicaoBrl=a.valorAquisicao,a.resultado=c(t*a.cotacaoAlienacao)-c(a.valorAquisicao*a.cotacaoAquisicao)):2==a.origem?(a.valorAquisicaoUsd=a.valorAquisicao,a.resultado=c((t-a.valorAquisicao)*a.cotacaoAlienacao)):(a.valorAquisicaoBrl=a.valorAquisicao*a.percentual,a.valorAquisicaoUsd=a.valorAquisicao*(1-a.percentual),a.resultado=Math.max(0,c((c(t*a.cotacaoAlienacao)-c(a.valorAquisicao*a.cotacaoAquisicao))*a.percentual))+Math.max(0,c(c((t-a.valorAquisicao)*a.cotacaoAlienacao)*(1-a.percentual))))},i.calcularResumo=function(){var a={},t={};i.ativos=[],i.total=0,i.resultado=0,i.gcap.forEach((function(o){var e=o.ativo.id,n=30==o.ativo.tipo?29:o.ativo.tipo;t[n]||(t[n]={nome:29==n?"Stocks e ETFs":24==n?"Criptomoedas":"Outros ativos",valor:0,resultado:0,ativos:[]},i.ativos.push(t[n])),a[e]||(a[e]={nome:o.ativo.nome,valor:0,resultado:0},t[n].ativos.push(a[e]));var r=o.cotacaoAlienacao*o.valorAlienacao;a[e].valor+=r,a[e].resultado+=o.resultado,t[n].valor+=r,t[n].resultado+=o.resultado,i.total+=r,i.resultado+=o.resultado})),i.ativos.sort((function(a,t){return a.nome<t.nome?-1:1}))},i.salvarPercentual=function(a){var t=1;return 2==a.origem?t=0:3==a.origem&&(t=a.percentual),r&&e.cancel(r),r=e((function(){return o.post("/api/v2/investimentos/gcap",{operacao:a.operacao,percentual:t})}),1500)}}function t(a){this.calendarioConfig={restrict:["m"],interval:"m"},this.printConfig={controller:"GcapMesControllerPrint",templateUrl:"/partials/investimentos/ir/gcap/print.html"}}function o(a,t,o){var e=this;e.service=o;var n="gcap.mes.e"==a.current.name?"e":"n";e.exterior="e"==n,e.print=!0,e.moeda=e.exterior?2:1,e.$onInit=function(){e.service.hasPerm&&(e.inicio=t.inicio||moment().format("YYYY-MM-DD"))}}function e(a,t,o){var e=this;e.service=o;var n="gcap.mes.e"==a.current.name?"e":"n";e.exterior="e"==n,e.moeda=e.exterior?2:1,e.$onInit=function(){e.service.hasPerm&&(e.loading=!0,e.inicio=t.inicio||moment().format("YYYY-MM-DD"),e.service.reset(),e.service.carregarGcap(e.inicio,n).then((function(a){e.loading=!1})))},e.onChangePercentual=function(a){e.service.calcularResultados(a),e.service.calcularResumo(),e.service.salvarPercentual(a)}}function n(a,t,o){var e=this,n="gcap.mes.e"==a.current.name?"e":"n";e.service=o,e.$onInit=function(){e.service.hasPerm&&(e.loading=!0,e.inicio=t.inicio||moment().format("YYYY-MM-DD"),e.mesCorrente=moment(e.inicio).format("YYYY-MM")==moment().format("YYYY-MM"),e.ontem=moment().subtract(1,"day").format(),e.service.carregarGcap(e.inicio,n).then((function(a){e.loading=!1})))}}t.$inject=["mdwTopmenu"],e.$inject=["$state","$stateParams","GcapControllerService"],o.$inject=["$state","$stateParams","GcapControllerService"],n.$inject=["$state","$stateParams","GcapControllerService"],a.$inject=["investimentosDatasource","usuariosService","$http","$timeout"],angular.module("md").controller("GcapController",t).controller("GcapMesController",e).controller("GcapMesControllerPrint",o).controller("GcapMesResumoController",n).service("GcapControllerService",a)}(),function(){"use strict";function a(a,t,o,e,n,r){r&&(a.state("gcap",{abstract:!0,url:"/gcap",controller:["$scope","mdwTopmenu",function(a,t){t.title="IR / GCAP",t.preservStateParams=!0,t.setTabs(a,[{label:"Exterior",state:"gcap.mes.e"},{label:"Nacional",state:"gcap.mes.n"}])}],controllerAs:"vm",template:"<div layout='row' flex ui-view></div>"}).state("gcap.mes",{abstract:!0,url:"",controller:"GcapController",controllerAs:"vm",templateUrl:"partials/investimentos/ir/gcap/gcap.html"}),["e","n"].forEach((function(t){a.state("gcap.mes."+t,{url:"/"+t+"?inicio&i&fim",params:{teste:"teste"},views:{resumo:{controller:"GcapMesResumoController",controllerAs:"vm",templateUrl:"partials/investimentos/ir/gcap/resumo.html"},dados:{controller:"GcapMesController",controllerAs:"vm",templateUrl:"partials/investimentos/ir/gcap/dados.html"}}})})))}a.$inject=["$stateProvider","operacoesRoutesProvider","lancamentosRoutesProvider","mdwStateDialogProvider","mdwBaseStateProvider","MD_INVEST_MOD"],angular.module("md").config(a)}(),function(){"use strict";function a(a,t,o,e,n,r,i){var c=this;function s(){return t.all([n.carregarApuracao().then((function(a){if(c.apuracao=a,a){var t=r.totalIr(a);c.isCurrentMonth=a.ultimoDiaMesApuracao.substr(0,7)==moment().format("YYYY-MM"),c.totalApuracao=t>=0?t:0}})),n.carregarApuracoes().then((function(a){c.apuracoes=a}))]).finally((function(){c.loading=!1}))}e.title="IR / Apuração mensal",c.loading=!0,c.imprimirDarf=function(t){return r.print(a,t)},a.$on("$destroy",n.addObserver(s)),c.$onInit=function(){s()},c.detalharApuracao=function(){i.dialogPlanoInvestimentos((function(){o.go("apurarir")}),"ir")}}a.$inject=["$scope","$q","$state","mdwTopmenu","apuracaoIrDatasource","darfService","usuariosService"],angular.module("md").controller("IrController",a)}(),function(){"use strict";function a(a,t,o,e,n,r){r&&a.state("ir",{url:"/ir",controller:"IrController",controllerAs:"vm",templateUrl:"partials/investimentos/ir/apuracoes.html"}).state("ir.operacoesIrExcluir",e.getState({url:"/excluirop/:id",action:"operacoesService.excluir"})).state("apurarir",{url:"/ir/apurarir",controller:"ApuracaoController",controllerAs:"vm",templateUrl:"partials/investimentos/ir/content.html"}).state("visualizarapuracao",{url:"/ir/apuracao/:idApuracao",controller:"ApuracaoController",controllerAs:"vm",templateUrl:"partials/investimentos/ir/content.html"}).state("declaracao",{url:"/declaracao",controller:"IrDecController",controllerAs:"vm",templateUrl:"partials/investimentos/ir/declaracao/declaracao.html"})}a.$inject=["$stateProvider","operacoesRoutesProvider","lancamentosRoutesProvider","mdwStateDialogProvider","mdwBaseStateProvider","MD_INVEST_MOD"],angular.module("md").config(a)}(),function(){"use strict";function a(a,t,o,e,n,r,i,c,s){var l=this;function u(){var a;if(t.b)try{a=angular.fromJson(atob(t.b))}catch(a){}l.service.buscar(a)}r.title="Notas de corretagem",l.service=i,o.$on("$destroy",l.service.addObserver(u)),l.$onInit=u,l.anexarArquivo=function(a){return c.anexar().then((function(t){if(t)return n.showSimple("Anexando arquivo"),s.atualizarNota(a.nota,{documento:t[0]}).then((function(){n.showSimple("Arquivo anexado")}))}))},l.operacoesNota=function(t){var o={};o.b=btoa(angular.toJson({nota:t.nota})),a.go("operacoes.historico",o)},l.editarNota=function(a){return e.show({templateUrl:"/partials/investimentos/notas/editar.html",bindToController:!0,locals:{op:a},controller:["$mdDialog","$mdToast","operacoesDatasource",function(a,t,o){var e=this;e.num=e.op.notaId,e.atualizar=function(){return o.atualizarNota(e.op.nota,{identificador:e.num}).then((function(){return t.showSimple("Nº da nota atualizado"),a.hide()}))}}],controllerAs:"vm"})}}a.$inject=["$state","$stateParams","$scope","$mdDialog","$mdToast","mdwTopmenu","notasService","documentosService","operacoesDatasource"],angular.module("md").controller("NotasHistoricoController",a)}(),function(){"use strict";function a(a,t,o){t&&(a.state("notas",{abstract:!0,url:"/notas",controller:["notasService","operacoesService",function(a,t){this.service=a,this.upload=function(){return t.importarNota()}}],controllerAs:"vm",templateUrl:"partials/investimentos/notas/notas.html"}).state("notas.historico",{url:"?inicio&fim&i&b",controller:"NotasHistoricoController",controllerAs:"vm",templateUrl:"partials/investimentos/notas/historico.html"}),o.addStates("notas.historico"))}a.$inject=["$stateProvider","MD_INVEST_MOD","operacoesRoutesProvider"],angular.module("md").config(a)}(),function(){"use strict";function a(a,t,o,e,n,r,i,c,s){var l=this,u=r(),d=s.getConfig("notas",{o:"inclusao"}),m=0;function f(){var e=o,n=angular.copy(l.busca);n.inicio&&(n.inicio=t(n.inicio).format("YYYY-MM-DD")),n.fim&&(n.fim=t(n.fim).format("YYYY-MM-DD")),e.b=btoa(angular.toJson(n)),a.go("notas.historico",e)}function p(){return angular.equals({},l.busca)||angular.equals({ativo:null},l.busca)}l.addObserver=u.add,i.addObserver(u.notify),l.loading=!0,l.buscaAvancada=f,l.resetBusca=function(){a.go("notas.historico",{b:void 0})},l.buscaValida=function(){return!p()},l.formVazio=p,l.detalharOperacao=function(a){e.show({templateUrl:"partials/investimentos/operacoes/historico/detalhar.html",bindToController:!0,locals:{o:a},controllerAs:"vm",controller:function(){this.dismiss=e.cancel}})},l.changeOrder=function(){d.o=l.busca.order,s.updateConfig("notas",d),f()},l.contasBusca=c.contas.filter((function(a){return-1!=["CONTA CORRENTE","INVESTIMENTO"].indexOf(a.tipo)})),l.tiposAtivosBusca={1:"Ação",2:"Opção",12:"ETF",13:"FII"},l.paginator=n({pageSize:50,onFetch:function(a){var t=function(){var a=angular.copy(l.busca||{});a.conta&&(a.conta=a.conta.join(","));a.tipo&&(a.tipo=a.tipo.join(","));a.tipoAtivo&&(a.tipoAtivo=a.tipoAtivo.join(","));return a}();return l.loadingPage=!0,i.carregarNotas(angular.extend({page:a,pageSize:l.paginator.pageSize},t)).then((function(a){l.loading=!1,l.loadingPage=!1,l.operacoes=a.operacoes,m=a.count}))},getTotal:function(){return m}}),l.buscar=function(a){return l.busca=a||{},l.busca.order||(l.busca.order=d.o),l.paginator.fetch()}}a.$inject=["$state","mdwMoment","$stateParams","$mdDialog","mdwPaginator","mdwObserver","operacoesDatasource","cadastrosDatasource","configuracoesService"],angular.module("md").service("notasService",a)}(),function(){"use strict";angular.module("md").component("mdwChipsOperacao",{template:['<span ng-repeat="chip in vm.chips track by $index" class="mdw-chip">',"<md-tooltip>{{chip.label}}</md-tooltip>",'<md-icon ng-if="chip.icon">{{chip.icon}}</md-icon>',"{{chip.text}}","</span>"].join(""),controllerAs:"vm",bindings:{o:"=ngModel",ignore:"@",watchModel:"="},controller:["$scope","cadastrosDatasource","$mdDialog",function(a,t,o){var e=this;function n(){e.chips=[],e.chips.push({text:t.get("contas",e.o.conta,!0).nome,label:"conta"}),e.o.nota&&e.chips.push({text:"Nota #"+e.o.nota,label:"Importação de nota de corretagem"})}e.$onInit=function(){n(),a.$watch("vm.o",n,!!e.watchModel)}}]})}(),function(){"use strict";o.$inject=["$mdDialog","mdwApiError","moment","operacoesService"],angular.module("md").controller("OperacaoDaytrade",o);var a=function(a,t){var o=parseFloat(a)-parseFloat(t);return Math.abs(o)<.01?0:o};function t(a){return{tipo:a||5,valor:0,ajuste:0,custos:0,ir:0,quantidade:0}}function o(o,e,n,r){var i=this;console.log(i.tdt),i.tdt=angular.extend({operacoes:[t(),t(6)],dataOperacao:n()},i.tdt||{}),i.maxConfDate=n(),i.tdt.id&&(i.tdt.dataOperacao=n(i.tdt.dataOperacao),i.tdt.dataLiquidacao=n(i.tdt.dataLiquidacao)),i.addOp=function(){i.tdt.operacoes.push(t())},i.remOp=function(a){i.tdt.operacoes.splice(a,1)},i.ok=function(){var t=0;if(i.tdt.operacoes.forEach((function(a){var o=6==a.tipo?-1:1;t+=Math.abs(a.quantidade)*o})),a(t,0))return e.notify(a(t,0)>0?"A posição resultante não pode ficar positiva. Favor lançar a diferença como uma compra normal":"A posição resultante não pode ficar negativa.");return r.salvarOperacaoDaytrade(i.tdt).then(o.hide)},i.filterContas=function(a){return 1==a.moeda&&("CONTA CORRENTE"==a.tipo||"INVESTIMENTO"==a.tipo&&1==a.tipoInvestimento)}}}(),function(){"use strict";function a(a){function t(t,o,e,n,r,i,c){var s=this;s.tipoCustoCripto=3,s.nameMap={12:"ETF",32:"ETF Renda Fixa",13:"FII",14:"Fiagro",15:"Fi-infra",16:"FIP"},s.dados={data:n(),custos:0,custosDestino:0,contaDestino:s.operacao.conta},24==a&&(s.dados.contaCustos=s.operacao.conta),"3"==s.operacao.tativo&&(s.dados.dataDestino=n()),s.$onInit=function(){s.loading=!0,c.carregarPosicaoAtivoConta({ativo:s.operacao.ativo.id,tipo:a,conta:s.operacao.conta}).then((function(t){s.loading=!1,s.precoMedio=0,t&&t.quantidade&&t.precoMedioComCustos?(s.hasPosicao=!0,s.dados.precoMedio=t.precoMedioComCustos,s.precoMedio=s.dados.precoMedio,s.dados.quantidade=t.quantidade):(s.dados.precoMedio=null,s.dados.quantidade=null,s.hasPosicao=!1),24==a&&s.calcularQuantidadesCripto()}))},t.$watchGroup(["vm.dados.quantidade","vm.dados.precoMedio"],(function(){s.valorPortado=s.dados.quantidade*s.dados.precoMedio})),s.maxConfDate=n(),s.filterContas=function(a){return"CONTA CORRENTE"==a.tipo||"INVESTIMENTO"==a.tipo&&1==a.tipoInvestimento},s.ok=function(){var t={data:s.dados.data,quantidade:s.dados.quantidade,dataDestino:s.dados.dataDestino,quantidadeDestino:s.dados.quantidadeDestino,origem:s.operacao.ativo.id,destino:s.dados.destino,anexos:s.operacao.anexos,novaQuantidade:s.dados.novaQuantidade,conta:s.operacao.conta,contaDestino:s.dados.contaDestino||s.operacao.conta,contaCustos:s.dados.contaCustos};return 3==a&&(t.precoMedio=s.dados.precoMedio),24==a&&(s.dados.custosCripto&&s.custosEmOutraCripto&&(t.custosAtivo=s.outraCripto.codigo,t.custosCripto=s.dados.custosCripto),s.informarGanho&&(t.precoMedio=s.precoMedio)),r.converterAcao(t).then((function(){o.hide(),e.showSimple("Ativo convertido com sucesso")}))},s.calcularQuantidadesCripto=function(){s.qtdOrigem=s.dados.quantidade||0,s.qtdDestino=s.dados.novaQuantidade||0}}t.$inject=["$scope","$mdDialog","$mdToast","moment","operacoesService","ativosDatasource","investimentosDatasource"],angular.module("md").controller("OperacaoInvestimentoController_101_"+a,t)}a(1),a(2),a(10),a(3),a(24),a(27),a(28),a(29)}(),function(){"use strict";var a=angular.module("md");[1,2,5,6,7,10,11,23,24,29,30].forEach((function(t){function o(a,o,e,n){var r=this;r.dados={data:e(),custos:0},r.maxConfDate=e(),r.ok=function(){return n.transferirCustodia({ativo:r.operacao.ativo.id,resgateTotal:r.operacao.resgateTotal,anexos:r.operacao.anexos,data:r.dados.data,quantidade:r.dados.quantidade,custos:r.dados.custos,origem:r.operacao.conta,destino:r.dados.conta}).then((function(){a.hide(),o.showSimple("Custódia transferida")}))},r.filtroContas=function(a){return!("CONTA CORRENTE"!=a.tipo&&("INVESTIMENTO"!=a.tipo||1!=a.tipoInvestimento))&&(11==t||24==t||(29==t||30==t?2==a.moeda:1==a.moeda))}}o.$inject=["$mdDialog","$mdToast","moment","operacoesService"],a.controller("OperacaoInvestimentoController_102_"+t,o)}))}(),function(){"use strict";var a=angular.module("md");function t(t,o){function e(a,o,e){var n,r=this;function i(a,o){a&&o&&a==o||3==t&&n&&(r.operacao.quantidade=r.operacao.valor/n,7==t&&(r.operacao.quantidade=parseFloat(r.operacao.quantidade.toFixed(2))))}r.operacao=angular.extend({dataOperacao:a(),quantidade:0,daytrade:!1,valor:0},r.operacao||{}),r.edicao=!!r.operacao.id,r.posicao=!!r.operacao.ativo,r.edicao?(r.operacao.dataOperacao=a(r.operacao.dataOperacao),r.operacao.valor=r.operacao.valorNominal):r.operacao.quantidade=0,r.maxConfDate=a(),r.ok=function(){if(r.operacao.quantidade&&!(r.operacao.quantidade<=0)){var a=angular.copy(r.operacao);return a.dataLiquidacao=r.operacao.dataOperacao,a.valor=r.operacao.valor/r.operacao.quantidade,r.acao(a)}mdwApiError.notify("Quantidade deve ser maior que 0.")},r.filterContas=function(a){return"CONTA CORRENTE"==a.tipo||"INVESTIMENTO"==a.tipo&&1==a.tipoInvestimento},3==t&&o.$watch("vm.operacao.valor",i),r.carregarCotacaoDia=function(){3==t&&r.operacao.codigoAtivo&&r.operacao.dataOperacao&&(n=void 0,e.getCotacao(r.operacao.codigoAtivo,a(r.operacao.dataOperacao).format("YYYY-MM-DD")).then((function(a){n=a.cotacao,i()})))}}e.$inject=["moment","$scope","investimentosDatasource"],a.controller("OperacaoInvestimentoController_30_"+t,e),o=o||{}}t(3),t(10)}(),function(){"use strict";function a(a,t,o){var e=this;e.data=t(),e.maxConfDate=t(),e.edicao=!!e.operacao.id,e.posicao=!!e.operacao.ativo,e.operacao.ativo&&(e.data=t(e.operacao.ativo.vencimento)),e.edicao?e.hasPosicao=!0:a.$watch("vm.operacao.conta",(function(){e.operacao.ativo&&e.operacao.conta&&(e.loading=!0,o.carregarPosicaoAtivoConta(e.operacao.ativo.id,e.operacao.conta).then((function(a){e.loading=!1,a.quantidade?(e.hasPosicao=!0,e.operacao.tipo=31,e.operacao.quantidade=a.quantidade,a.quantidade<0&&(e.operacao.tipo=43)):e.hasPosicao=!1})))})),e.ok=function(){var a=t(e.data).format("YYYY-MM-DD");return e.operacao.dataOperacao=a,e.operacao.dataLiquidacao=a,e.operacao.valor=0,e.operacao.daytrade=!1,e.acao(e.operacao)}}a.$inject=["$scope","moment","ativosDatasource"],angular.module("md").controller("OperacaoInvestimentoController_31_2",a).controller("OperacaoInvestimentoController_31_26",a).controller("OperacaoInvestimentoController_43_2",a)}(),function(){"use strict";var a=angular.module("md");function t(t,o,e){function n(a,t,e){var n=this;function r(){n.liquidoOperacao=Math.abs(n.operacao.valor)-Math.abs(n.operacao.ir||0)-Math.abs(n.operacao.custos||0),n.liquidoOperacao=n.liquidoOperacao<=0?0:n.liquidoOperacao}n.isPj="FISICA"!=e.usuario.conta.tipoPessoa,n.operacao=angular.extend({dataOperacao:t(),dataLiquidacao:t(),quantidade:1},n.operacao||{}),n.edicao=!!n.operacao.id,n.posicao=!!n.operacao.ativo,n.edicao&&(n.operacao.dataOperacao=t(n.operacao.dataOperacao),n.operacao.dataLiquidacao=t(n.operacao.dataLiquidacao)),n.maxConfDate=t(),a.$watch("vm.operacao.valor",r),a.$watch("vm.operacao.ir",r),n.ok=function(){var a=angular.copy(n.operacao);return o||(a.dataLiquidacao=a.dataOperacao),n.acao(a)},n.filterContas=function(a){return"CONTA CORRENTE"==a.tipo||"INVESTIMENTO"==a.tipo&&1==a.tipoInvestimento}}n.$inject=["$scope","moment","usuariosService"],e||(e=32),a.controller("OperacaoInvestimentoController_"+e+"_"+t,n)}t(10,!0),t(17,!1),t(11,!1),t(23,!1,45)}(),function(){"use strict";var a=angular.module("md");function t(t,o,e){function n(a,t){var o=this;function n(){o.liquidoOperacao=Math.abs(o.operacao.valor)-Math.abs(o.operacao.ir||0)-Math.abs(o.operacao.custos||0)}o.operacao=angular.extend({valor:0,ir:0,custos:0,quantidade:1,dataOperacao:t(),dataLiquidacao:t()},o.operacao||{}),o.edicao=!!o.operacao.id,o.posicao=!!o.operacao.ativo,o.edicao&&(o.operacao.dataOperacao=t(o.operacao.dataOperacao),o.operacao.dataLiquidacao=t(o.operacao.dataLiquidacao)),o.maxConfDate=t(),a.$watch("vm.operacao.valor",n),a.$watch("vm.operacao.ir",n),a.$watch("vm.operacao.custos",n),o.ok=function(){return e||(o.operacao.dataLiquidacao=o.operacao.dataOperacao),o.acao(o.operacao)},o.filterContas=function(a){return"CONTA CORRENTE"==a.tipo||"INVESTIMENTO"==a.tipo&&1==a.tipoInvestimento}}n.$inject=["$scope","moment"],a.controller("OperacaoInvestimentoController_"+o+"_"+t,n)}t(1,33,!0),t(10,33,!0),t(23,46,!1),t(1,53,!0),t(10,53,!0)}(),function(){"use strict";function a(a,t,o){var e=this;function n(){e.liquidoOperacao=Math.abs(e.operacao.valor)-Math.abs(e.operacao.ir||0)-Math.abs(e.operacao.iof||0),e.liquidoOperacao=e.liquidoOperacao<=0?0:e.liquidoOperacao*e.sinal}e.$onInit=function(){e.operacao=angular.extend({dataOperacao:t(),dataLiquidacao:t(),quantidade:0},e.operacao||{}),e.sinal=e.operacao.valor<0?-1:1,e.edicao=!!e.operacao.id,e.posicao=!!e.operacao.ativo,e.edicao&&(e.operacao.dataOperacao=t(e.operacao.dataOperacao),e.operacao.dataLiquidacao=t(e.operacao.dataLiquidacao)),e.maxConfDate=t(),n()},e.calcularLiquido=n,e.ok=function(){var a=angular.copy(e.operacao);return e.operacao.dataLiquidacao||(a.dataLiquidacao=a.dataOperacao),a.valor=Math.abs(a.valor)*e.sinal,e.acao(a)},e.filterContas=function(a){return"CONTA CORRENTE"==a.tipo||"INVESTIMENTO"==a.tipo&&1==a.tipoInvestimento}}a.$inject=["ativosService","moment","mdwApiError"],angular.module("md").controller("OperacaoInvestimentoController_34_1",a).controller("OperacaoInvestimentoController_34_3",a).controller("OperacaoInvestimentoController_34_10",a).controller("OperacaoInvestimentoController_34_11",a).controller("OperacaoInvestimentoController_34_23",a).controller("OperacaoInvestimentoController_34_29",a)}(),function(){"use strict";function a(a,t,o,e){var n=this;function r(){n.liquidoOperacao=Math.abs(n.operacao.valor)-Math.abs(n.operacao.ir||0)}n.operacao=angular.extend({dataOperacao:o(),quantidade:0,ir:0},n.operacao||{}),n.edicao=!!n.operacao.id,n.posicao=!!n.operacao.ativo,n.edicao&&(n.operacao.dataOperacao=o(n.operacao.dataOperacao),n.operacao.valor=n.operacao.valorNominal),n.maxConfDate=o(),n.$onInit=function(){t.carregarPosicaoAtivoConta(n.operacao.ativo.id,n.operacao.conta).then((function(a){a&&a.quantidade&&(n.operacao.quantidade=Math.abs(a.quantidade))}))},a.$watch("vm.operacao.valor",r),a.$watch("vm.operacao.quantidade",r),a.$watch("vm.operacao.ir",r),r(),n.ok=function(){var a=angular.copy(n.operacao);return a.valor=n.operacao.valor/n.operacao.quantidade,n.acao(a)},n.filterContas=function(a){return"CONTA CORRENTE"==a.tipo||"INVESTIMENTO"==a.tipo&&1==a.tipoInvestimento}}a.$inject=["$scope","ativosDatasource","moment","mdwApiError"],angular.module("md").controller("OperacaoInvestimentoController_35_10",a)}(),function(){"use strict";function a(a,t){var o=this;o.operacao=angular.extend({dataOperacao:t(),quantidade:0,ir:0},o.operacao||{}),o.operacao.valor=o.operacao.ativo.valor,o.edicao=!!o.operacao.id,o.posicao=!!o.operacao.ativo,o.nameMap={12:"ETFs",32:"ETF Renda Fixa",13:"FII",14:"Fiagro",15:"Fi-infra",16:"FIP"},o.edicao&&(o.operacao.dataOperacao=t(o.operacao.dataOperacao),o.operacao.dataSubscricao=t(o.operacao.ativo.data),o.operacao.valorSubscricao=o.operacao.ativo.valor),o.maxConfDate=t(),o.ok=function(){var a=angular.copy(o.operacao);return o.acao(a)},o.filterContas=function(a){return"CONTA CORRENTE"==a.tipo||"INVESTIMENTO"==a.tipo&&1==a.tipoInvestimento}}a.$inject=["$scope","moment"],angular.module("md").controller("OperacaoInvestimentoController_47_1",a).controller("OperacaoInvestimentoController_47_10",a).controller("OperacaoInvestimentoController_47_26",a)}(),function(){"use strict";function a(a,t,o,e,n,r){var i=this;function c(){i.liquidoOperacao=Math.abs(i.operacao.valor)*Math.abs(i.operacao.quantidade||0)}i.operacao.dataOperacao=t.min(i.operacao.ativo.data,t()),i.operacao.dataLiquidacao=t(i.operacao.ativo.data).add(1,"day"),i.operacao.valor=i.operacao.ativo.valor,i.edicao=!!i.operacao.id,i.posicao=!!i.operacao.ativo,i.edicao&&(i.operacao.dataOperacao=t(i.operacao.dataOperacao),i.operacao.dataLiquidacao=t(i.operacao.dataLiquidacao),i.operacao.valor=i.operacao.valorNominal),i.$onInit=function(){r.carregarPosicaoAtivoConta(i.operacao.ativo.id,i.operacao.conta).then((function(a){a&&a.quantidade&&(i.operacao.quantidade=a.quantidade)}))},a.$watch("vm.operacao.valor",c),a.$watch("vm.operacao.quantidade",c),i.ok=function(){var a=angular.copy(i.operacao);return o.exercerSubscricao({data:t(a.dataOperacao).format("YYYY-MM-DD"),dataLiquidacao:t(a.dataLiquidacao).format("YYYY-MM-DD"),quantidade:a.quantidade,conta:a.conta,valor:a.valor,ativo:a.ativo.id}).then((function(){e.hide(),n.showSimple("Recibo de subcrição gerado")}))},i.filterContas=function(a){return"CONTA CORRENTE"==a.tipo||"INVESTIMENTO"==a.tipo&&1==a.tipoInvestimento}}a.$inject=["$scope","moment","operacoesService","$mdDialog","$mdToast","ativosDatasource"],angular.module("md").controller("OperacaoInvestimentoController_48_26",a)}(),function(){"use strict";var a=angular.module("md");function t(t,o){r.$inject=["moment","$scope","$filter","mdwResource","ativosService","investimentosDatasource","cadastrosDatasource","configuracoesService"];var e=(o=o||{}).converterValorUnitario;a.controller("OperacaoInvestimentoController_5_"+t,r);var n="ed_opi_"+t;function r(a,r,i,c,s,l,u,d){var m,f=this,p=c("ativos"),v=d.getConfig(n,{ivi:1,m:1});function g(a,o){if(!a||!o||a!=o){if(24==t)return b();var n=e?1:f.operacao.quantidade||0;28==t&&(n=0),f.liquidoOperacao=Math.abs(f.operacao.valor*n)+Math.abs(f.operacao.custos)+Math.abs(f.operacao.ir)+Math.abs(f.operacao.iof)}}function h(a,o){if(!a||!o||a!=o){if(24==t)return b();g(),3!=t&&7!=t||!m||(f.operacao.quantidade=f.operacao.valor/m,7==t&&(f.operacao.quantidade=parseFloat(f.operacao.quantidade.toFixed(2))))}}function C(){(3==t||7==t)&&f.operacao.codigoAtivo&&f.operacao.dataOperacao&&(m=void 0,l.getCotacao(f.operacao.codigoAtivo,a(f.operacao.dataOperacao).format("YYYY-MM-DD")).then((function(a){m=a.cotacao,h()})))}function b(){if(f.posicaoCustoCripto=!0,24==t){if(f.informarVI){if(!f.operacao.valor)return;f.quantidadeBruta=f.operacao.valorInvestido/f.operacao.valor}else{if(!f.quantidadeBruta)return;f.operacao.valorInvestido=f.operacao.valor*f.quantidadeBruta}if(f.operacao.quantidade=f.quantidadeBruta,f.edicaoCustos){if(3==f.tipoCustoCripto&&f.outraCripto&&f.outraCripto.codigo)return l.carregarPosicaoAtivoConta({conta:f.operacao.conta,codigoAtivo:f.outraCripto.codigo,tipo:24,data:a(f.operacao.dataOperacao).format("YYYY-MM-DD")}).then((function(a){f.operacao.custos=0,f.posicaoCustoCripto=a&&a.precoMedioComCustos,f.posicaoCustoCripto&&(f.operacao.custos=a.precoMedioComCustos*f.operacao.custosCripto),f.valorInvestidoCustos=f.operacao.valorInvestido+f.operacao.custos}));1==f.tipoCustoCripto?f.operacao.quantidade=(f.operacao.valorInvestido-f.operacao.custos)/f.operacao.valor:2==f.tipoCustoCripto&&(f.operacao.custos=Math.abs(f.operacao.valor*f.operacao.custosQtd),f.operacao.quantidade-=f.operacao.custosQtd),f.valorInvestidoCustos=f.operacao.valorInvestido+f.operacao.custos}else f.valorInvestidoCustos=f.operacao.valorInvestido+Math.abs(f.operacao.custosCripto||0)}}f.mask=v.m,f.criarAtivo=function(){return s.criarAtivo({codigo:f.codigoAtivo}).then((function(a){f.operacao.ativo=a,f.operacao.codigoAtivo=a.codigo}))},f.operacao=angular.extend({valor:o.valorUnitario||0,custos:0,custosQtd:0,quantidade:o.quantidade||void 0,ir:0,iof:0,dataOperacao:a(),tipoCompra:1,ajusteMF:0},f.operacao||{}),f.quantidadeBruta=o.quantidade||void 0,f.tipoCustoCripto=2,f.nameMap={12:"ETF",32:"ETF Renda Fixa",13:"FII",14:"Fiagro",15:"Fi-infra",16:"FIP"},f.posicao=!!f.operacao&&!!f.operacao.ativo,f.edicao=!!f.operacao&&!!f.operacao.id,f.edicaoCustos=24==t,f.informarVI=v.ivi,f.edicao&&(f.operacao.dataOperacao=a(f.operacao.dataOperacao),e&&(f.operacao.valor=Math.abs(f.operacao.valorNominal)),6==t&&(f.operacao.quantidade=(f.operacao.quantidade||0)*f.operacao.valor,f.operacao.valor=1),26==t&&(f.operacao.dataSubscricao=a(f.operacao.ativo.data),f.operacao.valorSubscricao=f.operacao.ativo.valor),24==t&&(f.quantidadeBruta=f.operacao.quantidade+f.operacao.custosQtd,f.operacao.valorInvestido=f.operacao.valor*f.quantidadeBruta,f.edicaoCustos=!f.operacao.custosCripto)),f.tipoRentabilidade=1,o.criarAtivo&&(f.sugerirPercentualIndexador=function(){f.ativo.percentualIndexador=0==f.ativo.indexador?0:1},f.ativo=angular.extend({taxaPrefixada:0,indexador:0,percentualIndexador:0},f.operacao.ativo||{}),f.operacao.ativo&&(f.tipo=f.operacao.ativo.tipo),f.codigoAtivo=f.ativo.codigo,f.tipoRentabilidade=!f.ativo.id||11!=f.ativo.tipo&&17!=f.ativo.tipo||f.ativo.indexador||f.ativo.taxaPrefixada?1:2),f.maxConfDate=a().endOf("day"),f.calcularLiquido=g,24==t?r.$watch("vm.quantidadeBruta",g):r.$watch("vm.operacao.quantidade",g),r.$watch("vm.operacao.valor",h),r.$watch("vm.operacao.custos",g),r.$watch("vm.operacao.custosQtd",g),r.$watch("vm.operacao.ir",g),r.$watch("vm.operacao.iof",g),24==t&&r.$watch("vm.outraCripto.codigo",b),f.edicao||(r.$watch("vm.operacao.codigoAtivo",C),r.$watch("vm.operacao.dataOperacao",(function(){var o=-1!=[1,2,7,10,29,30].indexOf(t)?2:7==t?1:0,e=a(f.operacao.dataOperacao),n=0;for(;n<o;){var r=e.add(1,"day").weekday();6!=r&&0!=r&&n++}f.operacao.dataLiquidacao=e,24==t&&b()}))),f.carregarCotacaoDia=C,f.ok=function(){var r=f.ativo&&f.ativo.codigo||f.codigoAtivo,i=angular.copy(f.operacao);if(function(){if(f.informarVI==v.ivi&&f.mask==v.m)return;v.ivi=f.informarVI,v.m=f.mask,d.updateConfig(n,v)}(),26==t&&(i.tipoInvestimento=f.tipoSubs,i.subscricao=!0),e&&(i.valor=i.valor/(i.quantidade||1)),24==t&&(3==f.tipoCustoCripto&&(i.custosAtivo=f.outraCripto.codigo),f.informarVI||(1==f.tipoCustoCripto?i.quantidade=(i.valorInvestido-i.custos)/i.valor:2==f.tipoCustoCripto&&(i.quantidade=f.quantidadeBruta-i.custosQtd))),17==t&&(i.dataLiquidacao=f.operacao.dataOperacao),o.criarAtivo){var c=function(t){f.criandoOperacao=!0,f.ativo=t;var o=angular.extend(f.ativo?{codigoAtivo:f.ativo.codigo,taxaPrefixada:f.ativo.taxaPrefixada,indexador:f.ativo.indexador,percentualIndexador:f.ativo.percentualIndexador,vencimento:f.ativo.vencimento?a(f.ativo.vencimento).format("YYYY-MM-DD"):void 0}:{},i);return t&&t.codigo&&(o.codigoAtivo=t.codigo),f.acao(o)};if(!f.ativo.id){f.operacao.codigoAtivo=r,i.codigoAtivo=r;var s=u.get("contas",f.operacao.conta,!0),l=angular.extend({codigo:r,descricao:r,data:i.dataOperacao,valor:i.valor,tipo:f.tipo||o.criarAtivo,moeda:s.moeda},f.ativo);if(1==f.tipoRentabilidade){var m=l.depreciar?-1:1;l.percentualIndexador&&(l.percentualIndexador=Math.abs(l.percentualIndexador)*m),l.taxaPrefixada&&(l.taxaPrefixada=Math.abs(l.taxaPrefixada)*m)}return p.insert(l).then(c)}return c(f.ativo)}return f.acao(i)},f.toggleMask=function(){f.mask=f.mask?0:1}}}t(1),t(28),t(2),t(3,{converterValorUnitario:!0}),t(23),t(5),t(8),t(24),t(6,{valorUnitario:1,criarAtivo:!0}),t(7,{converterValorUnitario:!0}),t(10),t(26),t(17,{quantidade:1,converterValorUnitario:!0,criarAtivo:17}),t(11,{criarAtivo:11,converterValorUnitario:!0,valorAtivo:!0}),t(29),t(30)}(),function(){"use strict";function a(a,t,o,e,n,r){var i=this;i.operacao.dataOperacao=t.min(i.operacao.ativo.vencimento,t()),i.operacao.dataLiquidacao=t(i.operacao.dataOperacao).add(2,"day"),i.edicao=!!i.operacao.id,i.posicao=!!i.operacao.ativo,i.call=i.operacao.ativo.codigo.substr(4,1)<="L",i.edicao&&(i.operacao.dataOperacao=t(i.operacao.dataOperacao),i.operacao.dataLiquidacao=t(i.operacao.dataLiquidacao),i.operacao.valor=i.operacao.valorNominal),i.$onInit=function(){r.carregarPosicaoAtivoConta(i.operacao.ativo.id,i.operacao.conta).then((function(a){a&&a.quantidade&&(i.operacao.quantidade=Math.abs(a.quantidade),i.exercCompra=i.call&&a.quantidade>0||!i.call&&a.quantidade<0)}))},i.calcularLiquido=function(){var a=Math.abs(i.operacao.valor||0)*Math.abs(i.operacao.quantidade||0);i.exercCompra&&(a*=-1);var t=0;return i.encerrar&&(t=Math.abs(i.operacao.valorEncerramento||0)*Math.abs(i.operacao.quantidadeEncerramento||0),i.exercCompra||(t*=-1)),a+t-(Math.abs(i.operacao.custos||0)+Math.abs(i.operacao.ir||0)+Math.abs(i.operacao.custosEncerramento||0)+Math.abs(i.operacao.irEncerramento||0))},i.ok=function(){var a=i.operacao,r={data:t(a.dataOperacao).format("YYYY-MM-DD"),dataLiquidacao:t(a.dataLiquidacao).format("YYYY-MM-DD"),quantidade:a.quantidade,conta:a.conta,valor:a.valor,ativo:a.ativo.id,custos:a.custos,ir:a.ir,ativoPrincipal:i.operacao.ativoPrincipalCodigo};return i.encerrar&&(r.quantidadeEnc=i.operacao.quantidadeEncerramento,r.valorEnc=i.operacao.valorEncerramento,r.custosEnc=i.operacao.custosEncerramento,r.irEnc=i.operacao.irEncerramento),o.exercerOpcao(r).then((function(){e.hide(),n.showSimple("Exercício registrado")}))},i.filterContas=function(a){return"CONTA CORRENTE"==a.tipo||"INVESTIMENTO"==a.tipo&&1==a.tipoInvestimento}}a.$inject=["$scope","moment","operacoesService","$mdDialog","$mdToast","ativosDatasource"],angular.module("md").controller("OperacaoInvestimentoController_50_2",a)}(),function(){"use strict";var a=angular.module("md");function t(t,o){c.$inject=["moment","$scope","investimentosDatasource","configuracoesService"],a.controller("OperacaoInvestimentoController_6_"+t,c);const e=t;var n,r=(o=o||{}).converterValorUnitario||!1,i="ed_opi_v_"+t;function c(a,c,s,l){const u=this;function d(){s.carregarPosicaoAtivoConta({codigoAtivo:u.operacao.ativo.codigo,tipo:e,conta:u.operacao.conta}).then((a=>{u.exibirPosicaoAtual=a.quantidade>0,u.quantidade=a.quantidade}))}u.$onInit=function(){u.exibirPosicaoAtual=!1,3==e&&(u.operacao.ativo&&u.operacao.ativo.id?d():c.$watch("vm.operacao.codigoAtivo",(a=>{a&&d()})))},u.preencherQuantidade=function(){u.operacao.quantidade=u.quantidade||0};var m=l.getConfig(i,{m:1});function f(a,o){if(!a||!o||a!=o){if(24==t)return g();var e=r?1:u.operacao.quantidade;u.liquidoOperacao=Math.abs(u.operacao.valor*e)-Math.abs(u.operacao.custos)-Math.abs(u.operacao.ir)-Math.abs(u.operacao.iof)}}function p(){3==t&&u.operacao.codigoAtivo&&u.operacao.dataLiquidacao&&(n=void 0,s.getCotacao(u.operacao.codigoAtivo,a(u.operacao.dataLiquidacao).format("YYYY-MM-DD")).then((function(a){n=a.cotacao,v()})))}function v(a,o){if(!a||!o||a!=o){if(24==t)return g();f(),3==t&&n&&(u.operacao.quantidade=u.operacao.valor/n)}}function g(){if(u.posicaoCustoCripto=!0,24==t&&u.operacao.valor)if(u.edicaoCustos){if(3==u.tipoCustoCripto&&u.outraCripto&&u.outraCripto.codigo)return s.carregarPosicaoAtivoConta({conta:u.operacao.conta,codigoAtivo:u.outraCripto.codigo,tipo:24,data:a(u.operacao.dataOperacao).format("YYYY-MM-DD")}).then((function(a){u.operacao.custos=0,u.posicaoCustoCripto=a&&a.precoMedioComCustos,u.posicaoCustoCripto&&(u.operacao.custos=a.precoMedioComCustos*u.operacao.custosCripto)}));2==u.tipoCustoCripto&&(u.operacao.custos=Math.abs(u.operacao.valor*u.operacao.custosQtd)),u.liquidoOperacao=Math.abs(u.operacao.valor*u.operacao.quantidade)-Math.abs(u.operacao.custos)}else u.liquidoOperacao=Math.abs(u.operacao.valor*u.operacao.quantidade)-Math.abs(u.operacao.custosCripto||0)}u.mask=m.m,u.maxConfDate=a().endOf("day"),u.tipoCustoCripto=1,u.operacao=angular.extend({valor:o.valorUnitario||0,custos:0,custosQtd:0,ir:0,iof:0,quantidade:0,daytrade:!1,dataOperacao:a(),tipoVenda:1,ajusteMF:0},u.operacao||{}),u.posicao=!!u.operacao.ativo,u.edicao=!!u.operacao.id,u.nameMap={12:"ETF",32:"ETF Renda Fixa",13:"FII",14:"Fiagro",15:"Fi-infra",16:"FIP"},17==t&&(u.operacao.quantidade=1),u.edicaoCustos=24==t,u.edicao?(u.operacao.dataOperacao=a(u.operacao.dataOperacao),r&&(u.operacao.valor=Math.abs(u.operacao.valorNominal)),6==t&&(u.operacao.quantidade=u.operacao.quantidade*u.operacao.valor,u.operacao.valor=1),24==t&&(u.edicaoCustos=!u.operacao.custosCripto)):o.valorUnitario&&(u.operacao.quantidade=0),u.calcularLiquido=f,c.$watch("vm.operacao.valor",v),c.$watch("vm.operacao.quantidade",f),c.$watch("vm.operacao.custos",f),c.$watch("vm.operacao.custosQtd",f),c.$watch("vm.operacao.ir",f),c.$watch("vm.operacao.iof",f),24==t&&c.$watch("vm.outraCripto.codigo",g),u.edicao||(c.$watch("vm.operacao.codigoAtivo",p),c.$watch("vm.operacao.dataOperacao",(function(){var o=-1!=[1,2,10,29,30].indexOf(t)?2:7==t?1:0,e=a(u.operacao.dataOperacao),n=0;for(;n<o;){var r=e.add(1,"day").weekday();6!=r&&0!=r&&n++}u.operacao.dataLiquidacao=e,24==t&&g()}))),u.carregarCotacaoDia=p,u.ok=function(){var a=angular.copy(u.operacao);return r&&(a.valor=a.valor/(a.quantidade||1)),24==t&&3==u.tipoCustoCripto&&(a.custosAtivo=u.outraCripto.codigo),function(){if(u.mask==m.m)return;m.m=u.mask,l.updateConfig(i,m)}(),u.acao(a)},u.filterContas=function(a){return"CONTA CORRENTE"==a.tipo||"INVESTIMENTO"==a.tipo&&1==a.tipoInvestimento},u.toggleMask=function(){u.mask=u.mask?0:1}}}t(1),t(29),t(30),t(2),t(3,{converterValorUnitario:!0}),t(23),t(5),t(8),t(24),t(6,{valorUnitario:1}),t(7,{converterValorUnitario:!0}),t(10),t(17),t(11,{converterValorUnitario:!0}),t(26),t(27),t(28)}(),function(){"use strict";var a=angular.module("md");function t(t,o){n.$inject=["moment","$scope","mdwResource","ativosService","cadastrosDatasource"];var e=(o=o||{}).converterValorUnitario;function n(a,n,r,i,c){var s=this,l=r("ativos");s.criarAtivo=function(){return i.criarAtivo({codigo:s.codigoAtivo}).then((function(a){s.operacao.ativo=a,s.operacao.codigoAtivo=a.codigo}))},s.operacao=angular.extend({valor:o.valorUnitario||0,custos:0,custosQtd:0,quantidade:o.quantidade||void 0,ir:0,iof:0,dataOperacao:a()},s.operacao||{}),s.posicao=!!s.operacao&&!!s.operacao.ativo,s.edicao=!!s.operacao&&!!s.operacao.id,s.sinalPosicao=1,s.edicao&&(s.sinalPosicao=s.operacao.quantidade>0?1:-1,s.operacao.dataOperacao=a(s.operacao.dataOperacao),e&&(s.operacao.valor=Math.abs(s.operacao.valorNominal)),6==t&&(s.operacao.quantidade=(s.operacao.quantidade||0)*s.operacao.valor,s.operacao.valor=1)),s.tipoRentabilidade=1,o.criarAtivo&&(s.sugerirPercentualIndexador=function(){s.ativo.percentualIndexador=0==s.ativo.indexador?0:1},s.ativo=angular.extend({valor:0,data:a(),taxaPrefixada:0,indexador:0,percentualIndexador:0},s.operacao.ativo||{}),s.operacao.ativo&&(s.tipo=s.operacao.ativo.tipo),s.codigoAtivo=s.ativo.codigo,s.tipoRentabilidade=!s.ativo.id||11!=s.ativo.tipo&&17!=s.ativo.tipo||s.ativo.indexador||s.ativo.taxaPrefixada?1:2),s.maxConfDate=a(),s.ok=function(){var t=s.ativo&&s.ativo.codigo||s.codigoAtivo,n=angular.copy(s.operacao);if(e&&(n.valor=n.valor/(n.quantidade||1)),o.criarAtivo){var r=function(t){s.criandoOperacao=!0,s.ativo=t;var o=angular.extend(s.ativo?{codigoAtivo:s.ativo.codigo,taxaPrefixada:s.ativo.taxaPrefixada,indexador:s.ativo.indexador,percentualIndexador:s.ativo.percentualIndexador,vencimento:s.ativo.vencimento?a(s.ativo.vencimento).format("YYYY-MM-DD"):void 0}:{},n);return t&&t.codigo&&(o.codigoAtivo=t.codigo),s.acao(o)};if(!s.ativo.id){s.operacao.codigoAtivo=t,n.codigoAtivo=t;var i=c.get("contas",s.operacao.conta,!0),u=angular.extend({codigo:t,descricao:t,data:n.dataOperacao,valor:n.valor,tipo:s.tipo||o.criarAtivo,moeda:i.moeda},s.ativo);return l.insert(u).then(r)}return r(s.ativo)}return s.acao(n)},s.filterContas=function(a){return"CONTA CORRENTE"==a.tipo||"INVESTIMENTO"==a.tipo&&1==a.tipoInvestimento}}a.controller("OperacaoInvestimentoController_7_"+t,n)}t(1),t(2),t(3,{converterValorUnitario:!0}),t(5),t(23),t(24),t(6,{valorUnitario:1,criarAtivo:!0}),t(7,{converterValorUnitario:!0}),t(10),t(17,{quantidade:1,converterValorUnitario:!0,criarAtivo:17}),t(11,{criarAtivo:11,converterValorUnitario:!0,valorAtivo:!0})}(),function(){"use strict";var a=angular.module("md");function t(t,o,e){r.$inject=["moment","$scope","investimentosDatasource"],a.controller("OperacaoInvestimentoController_"+t+"_"+(e||1),r);const n=o&&o.bonificacao&&24==e;function r(a,t,r){var i=this;function c(){i.loading=!0,r.getCotacao(i.operacao.codigoAtivo,a(i.operacao.dataOperacao).format("YYYY-MM-DD")).then((a=>{i.operacao.valor=a.cotacao||0,i.naoExisteCotacao=void 0===a.cotacao,i.loading=!1}))}function s(){i.liquidoOperacao=Math.abs(i.operacao.valor)-Math.abs(i.operacao.ir||0)-Math.abs(i.operacao.custos||0),i.liquidoOperacao=i.liquidoOperacao<=0?0:i.liquidoOperacao*i.sinal}i.$onInit=function(){n&&(i.utilizarCotacaoDia=!0,c())},i.nameMap={12:"ETF",32:"ETF Renda Fixa",13:"FII",14:"Fiagro",15:"Fi-infra",16:"FIP"},i.operacao=angular.extend({valor:0,custos:0,ir:0,iof:0,quantidade:0,dataOperacao:a()},i.operacao||{}),i.sinal=i.operacao.valor<0?-1:1,i.posicao=!!i.operacao.ativo,i.edicao=!!i.operacao.id,i.calcularLiquido=s,o.bonificacao&&!i.edicao&&(i.operacao.quantidade=24!=e?0:void 0),i.quantidade=i.operacao.quantidade,i.edicao?(i.operacao.dataOperacao=a(i.operacao.dataOperacao),i.operacao.dataLiquidacao&&(i.operacao.dataLiquidacao=a(i.operacao.dataLiquidacao)),8==e&&(i.sinalMF=i.operacao.valor>0?1:-1,i.operacao.valor=Math.abs(i.operacao.valor))):o.liq&&(i.operacao.dataLiquidacao=a()),i.changeDataCheck=function(){i.utilizarCotacaoDia&&c()},t.$watch("vm.operacao.valor",s),t.$watch("vm.operacao.ir",s),t.$watch("vm.operacao.custos",s),i.maxConfDate=a(),i.ok=function(){var a=angular.copy(i.operacao);return o.liq||(a.dataLiquidacao=a.dataOperacao),a.valor=8==e?Math.abs(a.valor)*i.sinalMF:Math.abs(a.valor)*i.sinal,n&&(i.operacao.dataLiquidacao=a.dataOperacao),i.acao(a)},i.filterContas=function(a){return"CONTA CORRENTE"==a.tipo||"INVESTIMENTO"==a.tipo&&1==a.tipoInvestimento}}o=o||{}}t(8),t(8,{},28),t(9),t(9,{},28),t(8,{},10),t(9,{},10),t(8,{},2),t(9,{},2),t(8,{},29),t(9,{},29),t(8,{},30),t(9,{},30),t(10,{bonificacao:!0,liq:!0}),t(10,{bonificacao:!0,liq:!0},10),t(10,{bonificacao:!0,liq:!0},28),t(10,{bonificacao:!0,liq:!0},2),t(10,{bonificacao:!0},24),t(11,{liq:!0}),t(11,{liq:!0},28),t(22,{liq:!0}),t(22,{liq:!0},28),t(51,{liq:!0},29),t(51,{liq:!0},30),t(36,{},7),t(36,{},6),t(36,{},11),t(36,{},23),t(37,{},7),t(37,{},11),t(37,{},17),t(44,{},1),t(44,{},10),t(49,{},8)}(),function(){"use strict";angular.module("md").directive("mdwAcoesOperacao",(function(){return{restrict:"E",require:["ngModel"],scope:{operacao:"=ngModel"},templateUrl:"/partials/investimentos/operacoes/edicao/acoes.html",controllerAs:"vm",controller:["$scope","$timeout","$state","usuariosService","operacoesService",function(a,t,o,e,n){var r=this;r.openMenu=function(i,c){var s=a.operacao;if(!s)return;r.acoes=[];var l=!1;e.canEdit("investimentos.investimentos")&&(l=!0,-1!=[8,9,39,40,41,42,48,50,52].indexOf(s.tipo)||s.transacaoExercicio||s.premioOpcao||r.acoes.push({label:"Editar",icon:"mode_edit",action:function(){o.go(".operacoesEditar",s)}}));e.canDelete("investimentos.investimentos")&&(l=!0,-1==[16,38].indexOf(s.tipo)&&r.acoes.push({label:"Excluir",icon:"delete",action:function(){o.go(".operacoesExcluir",s)}}));r.acoes.push({label:"Ver detalhes",icon:"info",divider:l,action:function(){n.detalharOperacao(s)}}),r.acoes.length>0&&t((function(){i(c)}))}}]}})).directive("mdwAcoesAtivo",(function(){return{restrict:"E",require:["ngModel","mdwAcoesAtivo"],scope:{ativo:"=ngModel",parent:"@",conta:"=?",label:"@?",eventos:"=?"},templateUrl:"/partials/investimentos/operacoes/edicao/acoesCarteira.html",controllerAs:"vm",controller:["$scope","$state","operacoesService","ativosService","usuariosService",function(a,t,o,e,n){var r=this;r.uiSref=a.parent,r.eventos=!1!==a.eventos,a.isIcon=!a.label,a.isLabel=!!a.label,a.btnClass=a.isIcon?"md-icon-button":"md-stroked",function(i){if(!i)return;if(!n.canEdit("investimentos.investimentos"))return;function c(o){t.go(".operacoesNova",{tipo:o.tipo,tativo:i.tipo,conta:a.conta||i.conta,ativo:i.id})}if(r.acoes=[],i.tipo>1e3){var s=i.id.substr(1);return r.acoes.push({label:"Aplicação",action:function(){return o.criarLancamento({contaD:s,id:1,nome:"Aplicação",tipo:"t",tipoL:11})}}),r.acoes.push({label:"Resgate",action:function(){return o.criarLancamento({conta:s,id:2,nome:"Resgate",tipo:"t",tipoL:12})}}),r.acoes.push({label:"Rendimento",action:function(){return o.criarLancamento({conta:s,id:3,nome:"Rendimento",tipo:"r",tipoL:1})}}),r.acoes.push({label:"Perda",action:function(){return o.criarLancamento({conta:s,id:25,nome:"Perda",tipo:"d",tipoL:7})}}),void(1002!=i.tipo&&(r.acoes.push({label:"IR",action:function(){return o.criarLancamento({conta:s,id:16,nome:"IR",tipo:"d",tipoL:5})}}),r.acoes.push({label:"IOF",action:function(){return o.criarLancamento({conta:s,id:17,nome:"IOF",tipo:"d",tipoL:4})}})))}if(28!=i.tipo){var l=!1,u=!1;11!=i.tipo&&17!=i.tipo||i.indexado||(l=!0,r.acoes.push({label:"Atualizar cotação",action:function(){return e.editarCotacoes(i)}})),17!=i.tipo&&26!=i.tipo&&27!=i.tipo?r.acoes.push({divider:l,tipo:5,label:-1!=[3,6,18,19,20,21,22,25,33,34,35].indexOf(i.tipo)?"Aplicação":"Compra",action:c}):u=l,27!=i.tipo&&r.acoes.push({divider:u,tipo:6,label:-1!=[3,6,18,19,20,21,22,25,33,34,35].indexOf(i.tipo)?"Resgate":"Venda",action:c})}28==i.tipo&&(r.acoes.push({tipo:101,label:"Vencimento de contrato",action:c}),r.acoes.push({tipo:6,label:"Liquidação",action:c}));let d=[13,14,15,16];function m(){return d.includes(i.tipo)}if(-1!=[1,2,12,13,14,15,16,8].indexOf(i.tipo)){var f=1==i.tipo||m();f&&r.acoes.push({divider:!0,tipo:47,label:"Direitos de Subscrição",action:c}),8==i.tipo&&r.acoes.push({divider:!0,tipo:49,label:"Ajuste Diário",action:c}),r.acoes.push({divider:8!=i.tipo&&!f,label:"Day Trade",action:function(){t.go(".operacoesNovaDt",{tativo:i.tipo,conta:a.conta||i.conta,ativo:i.id})}})}23==i.tipo&&(r.acoes.push({divider:!0,tipo:36,label:"Cupom de Juros",action:c}),r.acoes.push({tipo:45,label:"Prêmio",action:c}),r.acoes.push({tipo:46,label:"Participação nos lucros",action:c}),r.acoes.push({divider:!0,tipo:34,label:"Amortização",action:c}));1!=i.tipo&&28!=i.tipo||(r.acoes.push({divider:!0,tipo:11,label:"Dividendos",action:c}),r.acoes.push({tipo:22,label:"Juros sobre capital próprio",action:c}));29!=i.tipo&&30!=i.tipo||r.acoes.push({divider:!0,tipo:51,label:"Dividendos (US)",action:c});m()&&(r.acoes.push({divider:!0,tipo:32,label:"Proventos",action:c}),r.acoes.push({tipo:34,label:"Amortização",action:c}),r.acoes.push({tipo:35,label:"Resgate das cotas",action:c}));2==i.tipo&&(r.acoes.push({divider:!0,tipo:50,label:"Exercício da opção",action:c}),r.acoes.push({tipo:31,label:"Vencimento da opção",action:c}));if(1==i.tipo||12==i.tipo||32==i.tipo||m()||2==i.tipo||28==i.tipo||29==i.tipo||30==i.tipo){var p=29!=i.tipo&&30!=i.tipo&&12!=i.tipo&&32!=i.tipo;p&&r.acoes.push({divider:p,tipo:10,label:"Bonificação",action:c}),r.acoes.push({divider:!p,tipo:8,label:"Grupamento",action:c}),r.acoes.push({tipo:9,label:"Desdobramento",action:c}),1!=i.tipo&&29!=i.tipo||r.acoes.push({tipo:34,label:"Restituição de Capital",action:c})}1!=i.tipo&&12!=i.tipo&&32!=i.tipo||r.acoes.push({divider:!0,tipo:33,label:"Outros proventos",action:c});(1==i.tipo||12==i.tipo||m())&&(r.acoes.push({divider:1!=i.tipo,tipo:53,label:"Crédito BTC",action:c}),r.acoes.push({tipo:44,label:"Taxa BTC",action:c}));3!=i.tipo&&25!=i.tipo||(r.acoes.push({divider:!0,tipo:30,label:"IR Come cotas",action:c}),r.acoes.push({tipo:101,label:"Portabilidade",action:c}),r.acoes.push({tipo:34,label:"Amortização",action:c}));24==i.tipo&&r.acoes.push({divider:!0,tipo:10,label:"Bônus com mineração",action:c});(7==i.tipo||11==i.tipo||i.tipo>=18&&i.tipo<=22||i.tipo>=33&&i.tipo<=35)&&(r.acoes.push({divider:!0,tipo:36,label:"Cupom de juros",action:c}),7==i.tipo&&r.acoes.push({tipo:37,label:"Taxa de custódia",action:c}));17==i.tipo&&(r.acoes.push({divider:!0,tipo:32,label:"Aluguel",action:c}),r.acoes.push({tipo:37,label:"Despesas",action:c}));11==i.tipo&&(r.acoes.push({tipo:34,label:"Amortização",action:c}),r.acoes.push({divider:!0,tipo:37,label:"Despesas",action:c}),r.acoes.push({tipo:32,label:"Aluguel",action:c}));-1!=[1,2,5,7,11,12,13,14,15,16,23,24,18,19,20,21,22,29,30,32,33,34,35].indexOf(i.tipo)&&(r.acoes.push({divider:!0,tipo:102,label:"Transferência de custódia",action:c}),(1==i.tipo||16==i.tipo||2==i.tipo||24==i.tipo||12==i.tipo||32==i.tipo||m()||29==i.tipo)&&r.acoes.push({tipo:101,label:24==i.tipo?"Permuta":"Conversão",action:c}));26==i.tipo&&(r.acoes.push({divider:!0,tipo:48,label:"Exercício do direito",action:c}),r.acoes.push({tipo:31,label:"Vencimento do direito",action:c}));27==i.tipo&&r.acoes.push({tipo:101,label:"Conversão",action:c})}(a.ativo)}]}}))}(),function(){"use strict";function a(a,t,o,e,n){var r=this;function i(){return n.importarNota()}function c(a){return n.escolharContaOperacao({grupo:a})}function s(){o.go(".operacoesNovaDt")}r.uiSref=a.parent+".operacoesNova",r.escolherAcao=c,r.importarNota=i,r.daytrade=s,a.$watch("vm.fabIsOpen",(function(a){a?t((function(){r.tooltipVisible=r.tooltipVisible1=r.fabIsOpen}),600):r.tooltipVisible1=r.tooltipVisible=r.fabIsOpen})),r.items=[{icon:"arrow_downward",action:function(){return c(2)},label:"Venda/Resgate"},{icon:"today",action:s,label:"Operação Day Trade"},{icon:"file_upload",action:i,label:"Importar nota de corretagem"},{icon:"more_horiz",action:function(){return c(3)},label:"Operações em conta"}]}a.$inject=["$scope","$timeout","$state","$mdDialog","operacoesService"],angular.module("md").component("mdwBtnNovaOperacao",{controllerAs:"vm",controller:a,templateUrl:"/partials/investimentos/operacoes/edicao/botaoCriar.html",bindings:{parent:"@"}})}(),function(){"use strict";function a(a,t,o,e,n,r,i){var c=this,s=[{id:29,nome:"Stock / REIT  (US)",moeda:2},{id:30,nome:"ETF (US)",moeda:2},{id:1,nome:"Ação / BDR",moeda:1},{id:2,nome:"Opção de ação",moeda:1},{id:13,nome:"FII",moeda:1},{id:14,nome:"Fiagro",moeda:1},{id:15,nome:"Fi-infra",moeda:1},{id:16,nome:"FIP",moeda:1},{id:12,nome:"ETF",moeda:1},{id:32,nome:"ETF Renda Fixa",moeda:1},{id:7,nome:"Tesouro Direto",moeda:1},{id:6,nome:"CDB, RDB, LCA, LCI, LC, LGI, CRA, CRI",moeda:1},{id:3,nome:"Fundo de investimentos",moeda:1},{id:24,nome:"Criptomoeda"},{id:5,nome:"Moeda",moeda:1},{id:17,nome:"Imóvel"},{id:23,nome:"Debênture",moeda:1},{id:26,nome:"Direito de Subscrição",moeda:1},{id:28,nome:"Contrato de Termo",moeda:1},{id:8,nome:"Mercado Futuro",moeda:1},{id:11,nome:"Outros Ativos"}],l=[{id:1,nome:"Aplicação",tipo:"t",tipoL:11},{id:2,nome:"Resgate",tipo:"t",tipoL:12},{id:3,nome:"Rendimento",tipo:"r",tipoL:1},{id:25,nome:"Perda",tipo:"d",tipoL:7},{id:23,nome:"Transferência",tipo:"t",tipoL:15},{id:26,nome:"Custos operacionais",tipo:"d",tipoL:6},{id:16,nome:"IR",tipo:"d",tipoL:5},{id:17,nome:"IOF",tipo:"d",tipoL:4},{id:14,nome:"Custódia",tipo:"d",tipoL:8},{id:15,nome:"Juros",tipo:"r",tipoL:3}];function u(t){return e.hide().then((function(){return i.dialogPlanoInvestimentos((function(){a.go(".operacoesNova",{tipo:t.tipoAtivo?t.id:5,tativo:t.tipoAtivo||t.id,conta:c.conta.id})}))}))}function d(t){return e.hide().then((function(){return i.dialogPlanoInvestimentos((function(){a.go(".operacoesNova",{tipo:6,tativo:t.id,conta:c.conta.id})}))}))}function m(a){return e.hide().then((function(){var o=1==a.id?"contaD":"conta";return a[o]=c.conta.id,t.criarLancamento(a)}))}c.$onInit=function(){if(c.grupo)c.title={1:"Lançar compra/aplicação",2:"Lançar venda/resgate",3:"Operações em conta"}[c.grupo],c.subtitle={1:"Escolha o tipo de ativo",2:"Escolha o tipo de ativo",3:"Escolha a operação"}[c.grupo],c.acao={1:u,2:d,3:m}[c.grupo];else if(c.title="Nova operação",c.subtitle="",c.tipoInvestimento)for(var a=0;a<s.length;a++)s[a].id==c.tipoInvestimento&&(c.filtroMoeda=s[a].moeda);c.filtrarContas(),c.exibirBusca=n.contas.length>6},c.filtrarContas=function(){var a=o(c.filtroConta||""),t=a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),e=a.length<4?"\\s+":"";c.contas=n.contas.filter((function(a){return!!a.status&&(("CONTA CORRENTE"==a.tipo||"INVESTIMENTO"==a.tipo&&1==a.tipoInvestimento)&&((!c.filtroMoeda||c.filtroMoeda==a.moeda)&&(!c.filtroConta||o(a.nome).match(new RegExp("(^"+t+")|("+e+t+")","i")))))})),c.contas.sort((function(a,t){return a.nome>t.nome?1:-1}))},c.escolherConta=function(a){if(c.conta=a,!c.grupo)return e.hide({conta:c.conta.id});3==c.grupo?c.items=l:c.items=s.filter((function(t){return!t.moeda||t.moeda==a.moeda}))},c.novaConta=function(){return r.novo().then((function(a){return c.filtrarContas(),c.escolherConta(a)}))}}a.$inject=["$state","operacoesService","mdwAccentFold","$mdDialog","cadastrosDatasource","contasInvestService","usuariosService"],angular.module("md").controller("EscolherOperacaoInvestimentoController",a)}(),function(){"use strict";function a(a,t){var o=this;o.o=null,o.ok=function(){return t.delete(o.o).then(a.hide)},angular.forEach(o.operacoesNota,(function(a){24==a.tipo&&(o.o=a)})),o.operacoesNota=o.operacoesNota.filter((function(a){return 24!=a.tipo}))}a.$inject=["$mdDialog","operacoesService"],angular.module("md").controller("ExcluirNotaCorretagemController",a)}(),function(){"use strict";function a(a,t,o){var e=this;e.o=t,e.ok=function(){return o.delete(e.o).then(a.hide)}}a.$inject=["$mdDialog","operacao","operacoesService"],angular.module("md").controller("ExcluirOperacaoController",a)}(),function(){"use strict";function a(a,t,o,e,n){var r=this;function i(){var a;if(t.b)try{a=angular.fromJson(atob(t.b))}catch(a){}r.service.buscar(a),r.service.showTotalInView()}e.title="Histórico de operações",r.service=n,o.$on("$destroy",r.service.addObserver(i)),r.$onInit=i,r.abrirNota=function(t){var o={};o.b=btoa(angular.toJson({nota:t})),a.go("notas.historico",o)}}a.$inject=["$state","$stateParams","$scope","mdwTopmenu","historicoOperacoesService"],angular.module("md").controller("OperacoesHistoricoController",a)}(),function(){"use strict";function a(a,t,o,e,n,r,i,c,s,l,u){var d=this,m=r(),f=u.getConfig("histOper",{o:"inclusao",b:!0}),p=0;function v(){let a=angular.copy(d.busca);a.order&&delete a.order,null===a.ativo&&delete a.ativo,d.exibirTotal=!angular.equals(a,{filtroOp:1})}function g(){var e=o,n=angular.copy(d.busca);n.inicio&&(n.inicio=t(n.inicio).format("YYYY-MM-DD")),n.fim&&(n.fim=t(n.fim).format("YYYY-MM-DD")),e.b=btoa(angular.toJson(n)),v(),a.go("operacoes.historico",e)}function h(){var a=angular.copy(d.busca||{});return a.conta&&(a.conta=a.conta.join(",")),a.tipo&&(a.tipo=a.tipo.join(",")),a.tipoAtivo&&(a.tipoAtivo=a.tipoAtivo.join(",")),a}function C(){return angular.equals({},d.busca)||angular.equals({ativo:null},d.busca)}d.buscaEnabled=f.b,d.addObserver=m.add,l.addObserver(m.notify),d.loading=!0,d.buscaAvancada=g,d.resetBusca=function(){d.busca={filtroOp:1},v(),a.go("operacoes.historico",{b:void 0})},d.toggleBuscaAvancada=function(){d.buscaEnabled=!d.buscaEnabled,f.b=d.buscaEnabled,u.updateConfig("histOper",f)},d.buscaValida=function(){return!C()},d.formVazio=C,d.detalharOperacao=i.detalharOperacao,d.changeOrder=function(){f.o=d.busca.order,u.updateConfig("histOper",f),g()},d.exportar=function(){e.show({templateUrl:"partials/investimentos/operacoes/historico/exportacao.html",bindToController:!0,locals:{count:p,params:h()},controllerAs:"vm",controller:["$http",function(a){var t=this;t.dismiss=e.cancel,t.getLinkDownload=function(){return a.get("/api/v2/investimentos/operacoes/exportar",{params:t.params}).then((function(a){return function(a,t,o){if(null!=o&&navigator.msSaveBlob)return navigator.msSaveBlob(new Blob([o],{type:t}),a);var e=angular.element("<a style='display: none;'/>"),n=window.URL.createObjectURL(new Blob([o],{type:t}));e.attr("href",n),e.attr("download",a),angular.element(document.body).append(e),e[0].click(),window.URL.revokeObjectURL(n),e.remove()}(t.nomeArquivo+".csv","text/csv",a.data),e.hide()}))},t.nomeArquivo="Meu_Dinheiro_Operacoes"+moment().format("YYYYMMDDHHmmSS"),t.ok=function(){}}]})},d.showTotalInView=v,d.busca={filtroOp:1},d.contasBusca=s.contas.filter((function(a){return-1!=["CONTA CORRENTE","INVESTIMENTO"].indexOf(a.tipo)})),d.tiposBusca={1:"Aplicação",2:"Resgate",3:"Rendimento",5:"Compra",6:"Venda",7:"Posicão inicial",8:"Grupamento",9:"Desdobramento",10:"Bonificação",11:"Dividendos",14:"Custódia",15:"Juros",16:"IR",17:"IOF",22:"JCP",45:"Prêmio de Debênture",46:"Participação de Debênture",23:"Transferência",24:"Importação de nota",25:"Perda",26:"Custos operacionais",27:"Receita de poupança",28:"Despesa de poupança",30:"Come cotas",31:"Vencimento de opção (comprada)",43:"Vencimento de opção (vendida)",32:"Proventos",34:"Amortização de cotas de fundos",35:"Resgate de fundos",36:"Cupom de juros",39:"Conversão/Portabilidade",41:"Transferência de custódia",47:"Registro de Direito de Subscrição",48:"Exercício de Direito de Subscrição"},d.tiposAtivosBusca={1:"Ação / BDR",2:"Opção",13:"FII",14:"Fiagro",15:"Fi-Infra",16:"FIP",12:"ETF",32:"ETF Renda Fixa",29:"Stock",30:"ETF US",3:"Fundo de investimento",5:"Moeda",24:"Criptpmoeda",6:"Título privado",7:"Tesouro Direto",8:"Mercado futuro",10:"Fundo Bovespa",11:"Outros",17:"Imóvel",26:"Direito de Subscrição",27:"Recibo de Subscrição",28:"Contrato de Termo"},d.paginator=n({pageSize:200,onFetch:function(a){var t=h();return d.loadingPage=!0,c.buscarOperacoes(angular.extend({page:a,pageSize:d.paginator.pageSize},t)).then((function(a){d.loading=!1,d.loadingPage=!1,d.operacoes=a.operacoes,function(){d.totalCalculado=0;for(const a of d.operacoes)8!=a.tipoInvestimento&&a.valorTotal&&(d.totalCalculado+=a.valorTotal)}(),p=a.count}))},getTotal:function(){return p}}),d.buscar=function(a){return d.busca=a||d.busca,d.busca.order||(d.busca.order=f.o),d.paginator.fetch()}}a.$inject=["$state","mdwMoment","$stateParams","$mdDialog","mdwPaginator","mdwObserver","operacoesService","operacoesDatasource","cadastrosDatasource","investimentosDatasource","configuracoesService"],angular.module("md").service("historicoOperacoesService",a)}(),function(){"use strict";function a(a){var t=this;t.ok=function(){return t.acao(2==t.alteracao).then(a.hide)},t.alteracao=1}a.$inject=["$mdDialog"],angular.module("md").controller("ExcluirOperacoesLoteController",a)}(),function(){"use strict";angular.module("md").component("mdwSelectMercadoFuturo",{controllerAs:"vm",controller:function(){var a=this,t=["F","G","H","J","K","M","N","Q","U","V","X","Z"],o={IND:["G","J","M","Q","V","Z"],WIN:["G","J","M","Q","V","Z"],DOL:t,WDO:t,WSP:["H","M","U","Z"],CCM:["F","H","K","N","Q","U","X"],ETH:t,BGI:t,ICF:["H","K","N","U","Z"],SJC:["H","K","M","N","Q","U","X"],WTI:t,OZ1:t,DI1:t,ACAO:t};a.anos=[],a.ano=moment().year(),a.contratos=[{id:"ACAO",nome:"Ação"},{id:"IND",nome:"Índice Cheio"},{id:"WIN",nome:"Mini Índice"},{id:"DOL",nome:"Dólar Cheio"},{id:"WDO",nome:"Mini Dólar"},{id:"WSP",nome:"Mini S&P"},{id:"BGI",nome:"Boi Gordo"},{id:"OZ1",nome:"Ouro"},{id:"CCM",nome:"Milho"},{id:"SJC",nome:"Soja"},{id:"ETH",nome:"Etanol"},{id:"ICF",nome:"Café"},{id:"WTI",nome:"Petróleo"},{id:"DI1",nome:"DI"}],a.acoes=[{id:"B3SAO",nome:"B3 ON"},{id:"BBDCP",nome:"Bradesco PN"},{id:"CCROO",nome:"CCR Rodovias ON"},{id:"CIELO",nome:"Cielo ON"},{id:"CMIGP",nome:"Cemig PN"},{id:"HYPEO",nome:"Hypera Pharma ON"},{id:"LRENO",nome:"Lojas Renner ON"},{id:"COGNO",nome:"Cogna ON"},{id:"PCARO",nome:"Grupo Pão de Açúcar ON"},{id:"PETRP",nome:"Petrobras PN"},{id:"PSSAO",nome:"Porto Seguro ON"},{id:"USIMA",nome:"Usiminas PNA"},{id:"VALEO",nome:"B3 ON"},{id:"VIIAO",nome:"Via ON"}],a.vencimentos=[],a.$onInit=function(){for(var t=-10;t<11;t++)a.anos.push(a.ano-t);if(a.model){if(a.contrato=a.model.substr(0,3),!o[a.contrato]){a.contrato="ACAO";var e=a.model.slice(0,-3).toLowerCase(),n=a.acoes.find((function(a){return a.id.toLowerCase()==e||a.nome.toLowerCase()==e}));n&&(a.acao=n.id)}a.vencimentos=o[a.contrato],a.vencimento=a.model.substr(-3,1),a.ano=parseInt(a.model.slice(-2))+2e3,a.updateModel()}},a.onChangeContrato=function(){a.vencimentos=o[a.contrato];for(var e=moment().month(),n=t[e],r=0;r<a.vencimentos.length;r++)if(a.vencimentos[r]>=n){a.vencimento=a.vencimentos[r];break}a.updateModel()},a.updateModel=function(){var t=a.contrato;if("ACAO"==a.contrato){if(!a.acao)return;t=a.acao}t&&a.vencimento&&a.ano&&(a.model=t+a.vencimento+(a.ano-2e3),a.change&&a.change({codigo:a.model}))}},templateUrl:"/partials/investimentos/operacoes/mdw-select-mercado-futuro.directive.html",bindings:{model:"=ngModel",change:"&ngChange",disabled:"=ngDisabled"},require:{form:"?^form"}})}(),function(){"use strict";function a(a){this.historico=a,this.historico.init()}a.$inject=["historicoOperacoesService"],angular.module("md").controller("OperacoesController",a)}(),function(){"use strict";function a(a){a.define("operacoes","/investimentos/operacoes/:id"),a.define("transacoesdt","/investimentos/operacoes/daytrade/:id")}function t(a){var t=a();this.add=t.add,this.notify=t.notify}function o(a,t,o,e,n,r,i){var c=this,s=t("operacoesDatasource"),l=a("/investimentos/operacoes/:id"),u=a("/api/v2/investimentos/operacoes"),d=a("/api/v2/investimentos/operacoes/notas"),m=a("/investimentos/operacoes/daytrade/:id"),f=a("/investimentos/operacoes/nota/:conta/:nota"),p=a("/investimentos/operacoes/darf/:darf"),v=a("/investimentos/operacoes/inconsistencias"),g=e;function h(a){return C(a,!1)}function C(a,t){l.reset(),u.reset(),d.reset(),m.reset(),v.reset(),t||g.notify(a),s.notify(a)}c.addObserver=s.add,c.get=function(a){return l.get({id:a})},c.carregar=function(a){return l.get(a)},c.buscarOperacoes=function(a){return u.get(a)},c.carregarNotas=function(a){return d.get(a)},c.notify=h,c.confirmar=function(a){return i.post("/investimentos/operacoes/"+a.conta+"/confirmar/"+a.id,a).then((function(){C()}))},c.carregarOperacoesNota=function(a,t){return f.get({conta:a,nota:t})},c.carregarOperacoesDarf=function(a){return p.get({darf:a})},c.carregarInconsistencias=function(){return v.get()},c.corrigirInconsistencias=function(a){return i.post("/investimentos/operacoes/inconsistencias",{lancamentos:a}).then((function(){C()}))},c.carregarTransacao=function(a){return m.get({id:a})},c.converterAcao=function(a){return i.post("/investimentos/operacoes/converter",a).then((function(){C()}))},c.transferirCustodia=function(a){return i.post("/investimentos/operacoes/transferirCustodia",a).then((function(){C()}))},c.exercerSubscricao=function(a){return i.post("/investimentos/operacoes/exercerSubscricao",a).then((function(){C()}))},c.exercerOpcao=function(a){return i.post("/investimentos/operacoes/exercerOpcao",a).then((function(){C()}))},c.atualizarNota=function(a,t){return i.put("/api/v2/investimentos/operacoes/nota/"+a,t).then((function(a){return C(),a.data}))},c.batchDelete=function(a){return i.post("/api/v2/investimentos/operacoes/excluirlote",{ids:a}).then(C)},o("operacoes",h),o("transacoesdt",h),g.add((function(a){C(a,!0)})),n.addObserver("contas",h),r.addObserver(h)}o.$inject=["mdwCache","mdwObserver","mdwResourceObserver","operacoesLancamentosDatasourceBinder","cadastrosDatasource","eventosDatasource","$http"],a.$inject=["mdwResourceProvider"],t.$inject=["mdwObserver"],angular.module("md").config(a).service("operacoesDatasource",o).service("operacoesLancamentosDatasourceBinder",t)}(),function(){"use strict";function a(a,t,o,e,n,r){r&&(a.state("operacoes",{abstract:!0,url:"/operacoes",controller:["$scope","historicoOperacoesService",function(a,t){var o=this;o.service=t,a.$watch("vm.codigoAtivo",(function(a){a&&""!=a||(o.service.busca.ativo=null)}))}],controllerAs:"vm",templateUrl:"partials/investimentos/operacoes/historico/operacoes.html"}).state("operacoes.historico",{url:"?inicio&fim&i&b",controller:"OperacoesHistoricoController",controllerAs:"vm",templateUrl:"partials/investimentos/operacoes/historico/historico.html"}),t.addStates("operacoes.historico"),o.addStates("operacoes.historico"))}function t(a,t){this.addStates=function(o){a.state(o+".escolherOperacao",t.getState({url:"/escolherop?tipo",action:"operacoesService.escolherOperacao"})).state(o+".operacoesNova",t.getState({url:"/novaop?tipo&tativo&ativo&conta",action:"operacoesService.criarOperacao"})).state(o+".operacoesEditar",t.getState({url:"/editarop/:id",action:"operacoesService.editar"})).state(o+".operacoesConfirmar",t.getState({url:"/confirmar/:id",action:"operacoesService.confirmar"})).state(o+".operacoesExcluir",t.getState({url:"/excluirop/:id",action:"operacoesService.excluir"})).state(o+".operacoesNovaDt",t.getState({url:"/novaopdt?tipo&tativo&ativo&conta",action:"operacoesService.criarOperacaoDt"})).state(o+".operacoesEditarDt",t.getState({url:"/editaropdt/:id",action:"operacoesService.editarDt"}))},this.$get=function(){}}a.$inject=["$stateProvider","operacoesRoutesProvider","lancamentosRoutesProvider","mdwStateDialogProvider","mdwBaseStateProvider","MD_INVEST_MOD"],t.$inject=["$stateProvider","mdwStateDialogProvider"],angular.module("md").provider("operacoesRoutes",t).config(a)}(),function(){"use strict";function a(a,t,o,e,n,r,i,c,s,l,u,d,m){var f=s("operacoes"),p=s("transacoesdt");return{create:v,update:g,delete:h,criarOperacao:function(a){if(a.tipoInvestimento=a.tativo,a.tipo=a.tipo,!a.conta)return x(a).then((function(e){return a.conta=e.conta,o(t,10)}));return t();function t(){return a.ativo?(d(),r.getId(a.ativo).then((function(t){return a.ativo=t,a.codigoAtivo=t.codigo,C(a)}))):C(a)}},editar:function(a){return d(),u.get(a.id).then((function(a){return a.inconsistente?S(a):a.transacaoDaytrade?b(a.transacaoDaytrade):a.lancamento?i.editar({id:a.lancamento}):C(a)}))},excluir:function(a){return e.dialogPlanoInvestimentos((function(){return d(),u.get(a.id).then((function(a){return!a.nota&&a.transacaoOperacao?function(a){return d(),u.carregarTransacao(a).then((function(a){return c.show({id:"excluir-operacao-daytrade",templateUrl:"/partials/investimentos/operacoes/daytrade/excluir.html",controller:t,controllerAs:"vm",bindToController:!0,locals:{tdt:a}}).then((function(){l.showSimple("Operações excluídas")}))}));function t(){var a=this;a.ok=function(){return p.delete(a.tdt).then(c.hide)}}}(a.transacaoOperacao):a.lancamento?i.excluir({id:a.lancamento}):function(a){return 24==a.tipo?c.show({id:"deletar-operacao-nota",controller:"ExcluirNotaCorretagemController",controllerAs:"vm",templateUrl:"/partials/investimentos/operacoes/excluirNotaCorretagem.html",bindToController:!0,locals:{isNota:24==a.tipo},resolve:{operacoesNota:["operacoesDatasource",function(t){return t.carregarOperacoesNota(a.conta,a.nota)}]},clickOutsideToClose:!0}):c.show({id:"deletar-operacao",controller:"ExcluirOperacaoController",controllerAs:"vm",templateUrl:"/partials/investimentos/operacoes/excluirOperacao.html",locals:{operacao:a},clickOutsideToClose:!0})}(a)}))}))},getOperacoesPosicaoInicial:function(t){return a.get("/investimentos/"+t+"/operacoes/operacoesposicaoinicial").then((function(a){return a.data}))},importarNota:function(){return e.dialogPlanoInvestimentos((function(){return c.show({id:"escolher-conta-importar",templateUrl:"/partials/investimentos/importacaoNota/escolherConta.html",controller:"EscolherContaController",controllerAs:"vm"}).then((function(a){return a}))}))},criarLancamento:function(a){return e.dialogPlanoInvestimentos((function(){t.go(".lancamentosNovo",{base:{descricao:a.nome,conta:a.conta,contaDestino:a.contaD,categoria:n.categorias.filter((function(t){return t.tipoL==a.tipoL}))[0].id,data:moment().format("YYYY-MM-DD"),tipo:a.tipo},tipo:a.tipo})}))},criarOperacaoDt:function(a){if(a.tipoInvestimento=a.tativo,a.tipo=a.tipo,a.ativo)return d(),r.getId(a.ativo).then((function(t){return a.ativo=t,a.codigoAtivo=t.codigo,A(a)}));return A(a)},editarDt:b,salvarOperacaoDaytrade:function(a){if(!a.id)return p.insert(a).then((function(){l.showSimple("Operação criada")}));return p.update(a).then((function(){l.showSimple("Operação atualizada")}))},converterAcao:function(a){return u.converterAcao(a)},transferirCustodia:function(a){return u.transferirCustodia(a)},exercerSubscricao:function(a){return u.exercerSubscricao(a)},exercerOpcao:function(a){return u.exercerOpcao(a)},excluirLote:function(a){return c.show({id:"excluir-lote",templateUrl:"/partials/investimentos/operacoes/lote/excluir.html",controller:"ExcluirOperacoesLoteController",controllerAs:"vm",bindToController:!0,locals:{quantidade:a.length,acao:function(){return u.batchDelete(a).then((function(){l.showSimple(a.length+" operaç"+(1==a.length?"ão":"ões")+" excluída"+(1==a.length?"":"s"))}))}}})},escolharContaOperacao:x,detalharOperacao:function(a){c.show({templateUrl:"partials/investimentos/operacoes/historico/detalhar.html",bindToController:!0,locals:{o:a},controllerAs:"vm",controller:["$http",function(a){var t=this;t.dismiss=c.cancel,39!=t.o.tipo&&40!=t.o.tipo||a.get("/investimentos/operacoes/parconv/"+t.o.id).then((function(a){a.data&&(t.opconv=a.data)}))}]})},openInconsistentOpDialog:S};function v(a){return f.insert(a).then((function(){l.showSimple(24==a.tipo?"Nota importada":"Operação criada")}))}function g(a){return f.update(a).then((function(){l.showSimple("Operação atualizada")}))}function h(a){return f.delete(a).then((function(){l.showSimple(24==a.tipo?"Nota excluída":"Operação excluída")}))}function C(a){return e.dialogPlanoInvestimentos((function(){var t="dialog-operacao-"+a.tipo+a.tipoInvestimento,o=!!a.id,e=a.tipoInvestimento;return 12!=e&&13!=e&&14!=e&&15!=e&&16!=e&&32!=e||(e=10),18!=e&&19!=e&&20!=e&&21!=e&&22!=e&&33!=e&&34!=e&&35!=e||(e=6),25==e&&(e=3),c.show({id:t,templateUrl:"/partials/investimentos/operacoes/edicao/"+a.tipo+"/"+e+".html",controller:"OperacaoInvestimentoController_"+a.tipo+"_"+e,controllerAs:"vm",bindToController:!0,locals:{edicao:o,dialogId:t,operacao:a,conta:n.get("contas",a.conta,!0),acao:function(t){return t&&(t.dataOperacao&&(t.dataOperacao=moment(t.dataOperacao).format("YYYY-MM-DD")),t.dataLiquidacao&&(t.dataLiquidacao=moment(t.dataLiquidacao).format("YYYY-MM-DD")),t.dataSubscricao&&(t.dataSubscricao=moment(t.dataSubscricao).format("YYYY-MM-DD"))),(a.acaoEdicao||(o?g:v))(t).then(c.hide)}}})}))}function b(a){return d(),u.carregarTransacao(a).then(A)}function A(a){return e.dialogPlanoInvestimentos((function(){return c.show({id:"editar-operacao-daytrade",templateUrl:"/partials/investimentos/operacoes/daytrade/editar.html",controller:"OperacaoDaytrade",controllerAs:"vm",bindToController:!0,locals:{tdt:a}})}))}function x(a){return c.show({id:"escolher-acao",templateUrl:"/partials/investimentos/operacoes/edicao/escolherOperacao.html",controller:"EscolherOperacaoInvestimentoController",controllerAs:"vm",bindToController:!0,locals:a})}function S(a){return c.show({id:"inconsistent-op-dialog",templateUrl:"partials/investimentos/operacoes/historico/inconsistente.html",bindToController:!0,locals:{o:a},controllerAs:"vm",controller:["$http",function(a){var t=this;t.dismiss=c.cancel,t.excluir=function(){return h(t.o).then((()=>c.hide()))}}]})}}a.$inject=["$http","$state","$timeout","usuariosService","cadastrosDatasource","ativosDatasource","lancamentosService","$mdDialog","mdwResource","$mdToast","operacoesDatasource","mdwDialogLoading","importacaoNotaService"],angular.module("md").factory("operacoesService",a)}(),function(){"use strict";function a(a,t){const o=this;o.loading=!0,o.ok=function(){const a=function(){let a=[];for(const t of o.benchmarks)o.map[t.id]&&a.push(t.id);return a}();t.hide(a)},o.$onInit=function(){o.map={},a.carregarBenchmarksDisponiveis().then((a=>{o.loading=!1,o.benchmarks=a;for(const t of a)o.map[t.id]=!1;for(const a of o.confAtivas)o.map[a]=!0}))}}a.$inject=["rentabilidadeDatasource","$mdDialog"],angular.module("md").controller("ConfigurarRentabilidadeAvancadaController",a)}(),function(){"use strict";function a(a,t){var o=/^(conta|conta\.\w+|assinatura|pagamentoFinalizado)$/,e=this;e.service=a,e.hide=!0,t.onSuccess({},(function(a){e.hide=o.test(a.to().name)})),e.processar=function(){return a.processarCarteira()}}a.$inject=["rentabilidadeDatasource","$transitions"],angular.module("md").component("mdwProcessarCarteira",{templateUrl:"/partials/investimentos/rentabilidade/processar-carteira.html",controller:a,controllerAs:"vm"})}(),function(){"use strict";function a(a,t,o,e,n,r,i,c,s,l,u,d,m,f){const p=this;var v=n;const g=c.getConfig("rentAvanc",{c:0});var h=g.c;p.hasPerm=d.planoHasInvestimentos("avancado"),o.title="Rentabilidade avançada",p.service=i;var C=r.addObserver($),b=m.onChange((function(){p.rent&&m.prepareChartOptions(p.rent.chart.options)}));t.$on("$destroy",(function(){C(),b()})),p.configurarBenchmarks=function(){return p.service.configurarBenchmarks().then((a=>{if(p.config.config.benchmarks=a,p.config.id)return p.salvarConfig();$()}))},p.printConfig={controller:["rentabilidadeAvancadaPrintService",function(a){this.service=a}],templateUrl:"/partials/investimentos/rentabilidade/print.html"},v.optDatas=p.optDatas=["30 dias","3 meses","6 meses","1 ano","Início do mês","Início do ano"];var A={nome:"",config:{data:3,series:[{nome:"Série 1",tipo:1}]}},x={},S={};function D(){return i.carregarConfiguracoes().then((function(a){if(a.sort((function(a,t){return a.nome<t.nome?-1:1})),p.configs=a,!p.config)if(a.length>0){if(h)for(var t=0;t<a.length;t++)if(a[t].id==h){p.config=a[t];break}p.config||(p.config=a[0])}else p.config=A;"p"==p.config.config.data&&(p.config.config.inicio&&(p.config.config.inicio=moment(p.config.config.inicio)),p.config.config.fim&&(p.config.config.fim=moment(p.config.config.fim))),p.config.config.moeda||(p.config.config.moeda=1),p.configId=p.config.id}))}function $(){p.loading=!0;var a={};"p"==p.config.config.data?(a.inicio=(p.config.config.inicio?moment(p.config.config.inicio):moment().subtract(1,"month")).format("YYYY-MM-DD"),a.fim=moment(p.config.config.fim).format("YYYY-MM-DD")):a.periodo=p.config.config.data;var t=[],o=[];p.config.config.series.forEach((function(a,e){o.push(a.nome||"Série "+e),1==a.tipo?t.push({t:1}):2==a.tipo?t.push({t:2,d:a.ativos}):3==a.tipo?t.push({t:3,d:a.contas}):4==a.tipo?t.push({t:4,d:a.estrategia}):5==a.tipo&&t.push({t:5,d:a.visao})})),a.series=t,a.moeda=p.config.config.moeda;const e=p.config.config.benchmarks;return i.carregarRentabilidadeAvancada(o,a,e,p.config.id).then((function(a){p.loading=!1,p.rent=a,m.prepareChartOptions(p.rent.chart.options),v.rent=a,v.config=p.config.config}))}function M(){return c.updateConfig("rentAvanc",{c:p.configId})}p.minConfDate=moment(e),p.maxConfDate=moment().subtract(1,"day"),p.$onInit=function(){p.loading=!0,D().then($),p.moedas=f.disponiveis,s.carregarGrupos().then((function(a){p.grupos=a[0],p.ativos=a[1],p.ativos.forEach((function(a){x[a.id]=a})),v.mapAtivos=x})),u.carregarEstrategias().then((function(a){v.mapEstrategias={},v.mapVisoes={},a.forEach((function(a){v.mapVisoes[a.id]=a,a.grupos.forEach((function(a){v.mapEstrategias[a.id]=a}))})),p.estrategias=a.filter((function(a){return a.status}))})),p.contas=l.contas.filter((function(a){return"CONTA CORRENTE"==a.tipo||"INVESTIMENTO"==a.tipo})),p.contas.forEach((function(a){S[a.id]=a})),v.mapContas=S},p.buscar=function(){const a=p.config.config.benchmarks;i.atualizarConfBenchmarksRentabilidade(a),$()},p.onChangeConfig=function(){if(-1!=p.configId){for(var a=0;a<p.configs.length;a++)if(p.configs[a].id==p.configId){p.config=p.configs[a];break}return M(),$()}const t=p.config.config.benchmarks;p.config=A,p.config.config.benchmarks=t},p.clonarConfig=function(){var a=p.config.id;return p.config=angular.copy(p.config),p.config.nome+=" (2)",delete p.config.id,p.editarConfig().catch((function(){p.config.id=a}))},p.salvarConfig=function(){return p.config.id?i.salvarConfiguracao(p.config).then((function(){a.hide(g),$()})):p.editarConfig()},p.excluirConfig=function(){return a.show({id:"excluir-config-rent",templateUrl:"/partials/investimentos/rentabilidade/excluirConfig.html",controller:["$mdDialog",function(a){var t=this.configId;this.ok=function(){return i.excluirConfiguracao(t).then((function(){return a.hide()}))}}],size:"sm",controllerAs:"vm",bindToController:!0,locals:{nome:p.config.nome,configId:p.config.id}}).then((function(){p.config=null,D()}))},p.editarConfig=function(){return a.show({id:"edicao-config-rent",templateUrl:"/partials/investimentos/rentabilidade/editarConfig.html",controller:["$mdDialog",function(a){this.ok=function(){var t=this.config;return i.salvarConfiguracao(t).then((function(t){a.hide({config:t})}))}}],size:"sm",controllerAs:"vm",bindToController:!0,locals:{config:angular.copy(p.config),edicao:!!p.config.id}}).then((function(a){p.configId=a.config.id,p.config=a.config,M(),D()}))},p.excluirSerie=function(a){p.config.config.series.splice(a,1)},p.incluirSerie=function(a){p.config.config.series.push({tipo:1,nome:"Série "+(p.config.config.series.length+1)})}}a.$inject=["$mdDialog","$scope","mdwTopmenu","DATA_INICIO_RENTABILIDADE","rentabilidadeAvancadaPrintService","carteiraService","rentabilidadeService","configuracoesService","ativosService","cadastrosDatasource","estrategiasDatasource","usuariosService","mdwDarkModeService","moedaService"],angular.module("md").controller("RentabilidadeAvancadaController",a).service("rentabilidadeAvancadaPrintService",(function(){}))}(),function(){"use strict";function a(a,t,o,e,n,r,i,c,s){var l=this,u=n("rentabilidade"),d=e("/api/v2/investimentos/benchmarkDisponiveis"),m=e("/api/v2/investimentos/benchmark"),f=e("/api/v2/investimentos/rentabilidade"),p=e("/api/v2/investimentos/rentabilidade/ativos"),v=e("/api/v2/investimentos/configuracoesRentabilidade");function g(a){f.reset(),u.notify(a)}l.addObserver=u.add,l.carregarRentabilidade=function(a){return f.get(a)},l.carregarRentabilidadeAtivos=function(a){return p.get({inicio:a})},l.carregarBenchmark=function(a){return m.get(a)},l.processarCarteira=function t(e,n){if(1===l.processandoCarteira.status)return;return 2===l.processandoCarteira.status?u():function(){return r.get("/api/v2/investimentos/pendenciasCarteira").then((function(a){return a.data}))}().then((function(a){return 1==a.s?(l.processandoCarteira.status=1,s(a),u()):2==a.s?(l.processandoCarteira.status=2,u()):a.d?(l.processandoCarteira.status=3,o(t,1e3*a.d)):void(l.processandoCarteira={status:0})}),i);function i(a){l.processandoCarteira.status=-1}function c(a){a&&(a.returnValue="")}function s(a){a.t&&(l.processandoCarteira.total=a.t,l.processandoCarteira.atual=a.i,l.processandoCarteira.pageSize=a.ps,l.processandoCarteira.progress=Math.floor(a.i/a.t*100))}function u(n){var r=angular.element(a);return r.bind("beforeunload",c),l.processandoCarteira.status=1,d(n).then((function(a){if(r.unbind("beforeunload",c),0==a.s&&a.d)return l.processandoCarteira.status=3,o(t,1e3*a.d);l.processandoCarteira={status:0},1==a.s&&g(e)}),(function(){r.unbind("beforeunload",c),i()}))}function d(a){var t=o(angular.noop,1e3);return r.post("/api/v2/investimentos/processarCarteira",{k:a}).then((function(a){var o=a.data;return 0!=o.s&&o.k?(s(o),t.then((function(){return d(o.k)}))):o}))}},l.carregarConfiguracoesRentabilidade=function(){return v.get()},l.salvarConfiguracoesRentabilidade=function(a){var t=a.id?"put":"post";return r[t]("/api/v2/investimentos/configuracoesRentabilidade"+(a.id?"/"+a.id:""),a).then((function(a){return v.reset(),a.data}))},l.excluirConfiguracoesRentabilidade=function(a){return r.delete("/api/v2/investimentos/configuracoesRentabilidade/"+a).then((function(){v.reset()}))},l.carregarBenchmarksDisponiveis=function(){return d.get()},i.addObserver(g),c.addObserver(g),l.processandoCarteira={}}a.$inject=["$window","$q","$timeout","mdwCache","mdwObserver","$http","operacoesDatasource","ativosDatasource","MD_INVEST_MOD"],angular.module("md").service("rentabilidadeDatasource",a)}(),function(){"use strict";function a(a,t,o){t&&a.state("rentabilidade",{url:"/rentabilidade",controller:"RentabilidadeAvancadaController",controllerAs:"vm",templateUrl:"partials/investimentos/rentabilidade/rentabilidade.html"})}a.$inject=["$stateProvider","MD_INVEST_MOD","operacoesRoutesProvider"],angular.module("md").config(a)}(),function(){"use strict";angular.module("md").service("rentabilidadeService",["$filter","$mdToast","$mdDialog","ativosDatasource","rentabilidadeDatasource","mdwColors","configuracoesService",function(a,t,o,e,n,r,i){const c=this,s=i.getConfig("bchmark",{b:[1,2,3],p:2});let l;var u=0;function d(){return r.getColorAtIndex(u++,["yellow"])}c.periodo=s.p;let m,f=[];function p(a){var t=moment();return 1==(a=a||c.periodo)?t.subtract(30,"days"):2==a?t.subtract(3,"months"):3==a?t.subtract(6,"months"):4==a?t.subtract(12,"months"):5==a?t.startOf("month"):6==a&&t.startOf("year"),t.subtract(1,"day").format("YYYY-MM-DD")}function v(t){const r=this;var i,v,g,h,C=[],b=-1,A=t.series;const x=t.params.tickerTipo;let S;function D(){var a=t.params||{},o=angular.copy(a||{});return o.inicio||(b=o.periodo||c.periodo,o.inicio=p(b)),o.series&&(o.series=btoa(angular.toJson(o.series))),o}function $(a,t){r.tabelaRent||(r.tabelaRent=[]);var o=0;h.forEach((function(e){var n=e.data;if(!(n<v||n>g)&&a[0]){for(var i=a[0][1],c=0;c<a.length&&null==i;c++)i=a[c][1];for(c=a.length-1;c>=0;c--){if(a[c][0]<=n){i=a[c][1];break}}if(!r.tabelaRent[o]){var s=[];for(c=0;c<A.length+f.length;c++)s.push(null);r.tabelaRent[o]={periodo:e.periodo,label:e.label,valores:s}}r.tabelaRent[o].valores[t]=i&&a[a.length-1][1]?a[a.length-1][1]/i-1:0,o++}}))}function M(a,t){var o=a,e=o-2;function n(a){t?(a.view.columns[o]=o,a.options.colors[e]=C[e]):(a.view.columns[o]={label:a.data.cols[o].label,type:a.data.cols[o].type,calc:function(){return null}},a.options.colors[e]="#CCCCCC")}n(r.chart),n(r.chartMes),r.chartMes.options.series||(r.chartMes.options.series={}),r.chartMes.options.series[e]={type:t?"column":"line"}}function w(){var t=A.length+2,o={};function e(o,e,n){const c=moment(o[0].v).format("YYYY-MM-DD");var s='<div class="mdw-chart-tooltip-rent">';s+='<div class="titulo">'+e+"</div>";for(var l=2,u=0;l<o.length-f.length&&o[l];l++,u++){var d=100*o[l].v,m=d<0?"negativo":"positivo";s+='<div class="princ">',i.length>1&&(s+="<span>"+A[u]+"</span>"),s+='<span class="'+m+'">'+a("number")(d,2)+"%</span>",s+="</div>"}if(s+='<div class="footer"><table>',f.forEach((function(e,n){var r=n+t,i=o[r]?o[r].v:0,c=e.label,l=C[1+n],u=n%2;u||(s+="<tr>"),s+="<td>",s+='<span class="color" style="color:'+l+'"></span>',s+="<span>"+c+": </span>",s+='<span class="valor '+(i<0?"negativo":"")+'">'+a("number")(100*i,2)+"%</span>",s+="</td>",u&&(s+="</tr>")})),s+="</table></div>",void 0!==r.cotacoesMap&&void 0!==r.cotacoesMap[c]){const t=a("currency")(r.cotacoesMap[c],S);let e,i=0;if(n){let a=(o[2].v+1)/(n[2].v+1)-1;i=0!=n[2].v?100*a:0}e=0==i?"":i>0?"up":"down",s+='<div class="cotacao"><span>Cotação: '+t+' </span>(<span class="'+e+'">'+a("number")(i,2)+"%</span>)</div>"}s+="</div>",o[1].v=s}f.forEach((function(a,t){o[t]=-1==l.indexOf(a.id)})),i[0].forEach((function(a,t){var o=a[0];e(r.chart.data.rows[t].c,moment(o).format("dddd, D [de] MMMM [de] YYYY"),t>0?r.chart.data.rows[t-1].c:null)})),r.chartMes.data.rows.forEach((function(a,t){e(a.c,moment(a.c[0].v,"MMM YYYY").format("MMMM [de] YYYY"))}))}r.carregar=function(){r.tabelaRent=[],u=0,C=[];var t=D();return n.carregarBenchmarksDisponiveis().then((o=>{const c=m||s.b;return f=o.filter((a=>c.includes(a.id))),l=f.map((a=>a.id)),r.ids=A.concat(f.map((function(a){return a.label}))),n.carregarRentabilidade(t).then((function(t){var o,c,s;return i=t,t&&t[0].length>0&&(function(a){var t=[["30 dias",p(1)],["3 meses",p(2)],["6 meses",p(3)],["1 ano",p(4)],["Inicio do mês",p(5)],["Inicio do ano",p(6)]];v=a[0][0][0],g=a[0][a[0].length-1][0],h=[];var o=!1;if(t.forEach((function(a,t){var e=a[1];if(!(e<v||e>g)){var n=t+1===b;n&&(o=!0),h.push({label:a[0],data:a[1],periodo:n})}})),!o){var e=moment(v),n=moment(g),r=e.year()!=n.year()?"DD/MM/YYYY":"DD/MMM";h.unshift({label:moment(v).format(r)+" - "+moment(g).format(r),data:v,periodo:!0})}}(t),r.hasDados=!0,r.chart=function(){var a=[{type:"date"},{type:"string",role:"tooltip",p:{html:!0}}],t=[],o=[];A.forEach((function(t){a.push({type:"number",label:t}),C.push(d()),o.push({lineWidth:3,areaOpacity:A.length>1?0:.08})})),f.forEach((function(t){a.push({type:"number",label:t.label}),C.push(d()),o.push({lineWidth:2,areaOpacity:0,tooltip:!1})}));return i.forEach((function(a,o){var e=0==o,n=o+1==i.length;a.forEach((function(a,o){var r,i=a[0],c=a[1];e?(t.push({c:[]}),(r=t[o].c).push({v:moment(i).toDate()}),r.push({v:""})):r=t[o].c,r.push({v:null!==c?c-1:null}),n&&f.forEach((function(a){r.push({v:0})}))}))})),{type:"AreaChart",view:{columns:a.map((function(a,t){return t}))},data:{cols:a,rows:t},options:{areaOpacity:.15,lineWidth:1,series:o,crosshair:{orientation:"both",trigger:"both",color:"#888"},backgroundColor:"transparent",colors:angular.copy(C),chartArea:{width:"90%"},hAxis:{gridlines:{color:"transparent",units:{months:{format:["MMM yy"]},days:{format:["dd MMM","dd"]},hours:{format:[""]}}},minorGridlines:{color:"transparent",units:{days:{format:[""]},hours:{format:[""]}}}},vAxis:{baseline:0,baselineColor:"#888",gridlines:{color:"#e2e2e2"},format:"#.##%",textPosition:"in"},legend:{position:"bottom"},focusTarget:"category",tooltip:{isHtml:!0,trigger:"both"}}}}(),r.chartMes=(o=[{type:"string"},{type:"string",role:"tooltip",p:{html:!0}}],c=[],s=[],A.forEach((function(a){o.push({type:"number",label:a}),s.push({lineWidth:3,areaOpacity:A.length>1?0:.08})})),f.forEach((function(a){o.push({type:"number",label:a.label}),s.push({lineWidth:2,areaOpacity:0,tooltip:!1})})),i.forEach((function(t,o){for(var e=0==o,n=o+1==i.length,r=[],s=t[0][1],l=t[1],u=1,d=1;u<t.length;u++)t[u][0].substr(0,7)!=l[0].substr(0,7)&&(r.push([l[0],l[1]/s]),s=l[1],d=u+1),l=t[u];d!=u&&r.push([l[0],l[1]/s]),r.forEach((function(t,o){var r,i=t[0],s=t[1];e?(c.push({c:[]}),(r=c[o].c).push({v:moment(i).format("MMM YY")}),r.push({v:""})):r=c[o].c,r.push({v:s-1,f:a("number")(100*(s-1),2)+"%"}),n&&f.forEach((function(a){r.push({v:0})}))}))})),{type:"ColumnChart",view:{columns:o.map((function(a,t){return t}))},data:{cols:o,rows:c},options:{colors:angular.copy(C),hAxis:{format:"MMM/yy",gridlines:{color:"transparent"}},vAxis:{baseline:0,baselineColor:"#888",gridlines:{color:"#e2e2e2"},format:"#.##%",textPosition:"in"},legend:{position:"bottom"},tooltip:{isHtml:!0,trigger:"both"},focusTarget:"category",chartArea:{width:"90%"}}}),w(),i.forEach((function(a,t){$(a,t)})),function(){const t=function(){const a=[],t=A.length+2;return f.forEach((function(o,e){-1!=l.indexOf(o.id)||M(e+t,!1),a.push(o.id)})),a}();if(0==t.length)return;n.carregarBenchmark({indice:t.join(","),inicio:v,fim:g}).then((function(t){t.forEach((function(t,o){!function(t,o){for(var e,n,c=o+A.length+2,s=0,l=0,u=0,d=0;s<i[0].length;s++){var m=i[0][s],f=r.chart.data.rows[s].c;if(f[c])for(;l<t.length&&t[l][0]<=m[0];l++)if(!(t[l][0]<m[0])){var p=t[l][1];if(f[c].v=p-1,f[c].f=a("number")(100*(p-1),2)+"%",void 0!==e){if(void 0===n&&(n=t[l]),t[l][0].substr(0,7)!=n[0].substr(0,7)){if(f=r.chartMes.data.rows[u].c,u++,p=n[1]/e,!f[c])continue;f[c].v=p-1,f[c].f=a("number")(100*(p-1),2)+"%",e=n[1],d=s+1}n=t[l]}else e=t[l][1]}}d!=s&&(f=r.chartMes.data.rows[u].c,p=n[1]/e,f[c]&&(f[c].v=p-1,f[c].f=a("number")(100*(p-1),2)+"%"))}(t,o),$(t,o+A.length)})),w()}))}(),x&&function(a){S=28==a.tipo||29==a.tipo?"$":"R$";e.carregarCotacoes({ticker:a.ticker,inicio:v}).then((a=>{r.cotacoesMap={},a.forEach((a=>{r.cotacoesMap[a[0]]=a[1]})),w()}))}(x)),r}))}))},r.onSelectChart=function(a){if(a&&null===a.row){var t=a.column,o=r.chart.view.columns[t]!=t,e=A.length+1;M(t,o),t>e&&(!function(a,t){for(var o,e=0;e<f.length;e++)if(f[e].label==a){o=e;break}var n=f[o].id;(o=l.indexOf(n))>=0&&l.splice(o,1),t||l.push(n)}(r.chart.data.cols[t].label,o),w())}},r.detalhar=function(){o.show({id:"rentabilidade-detalhe",templateUrl:"/partials/investimentos/rentabilidade/detalhar.html",bindToController:!0,controllerAs:"vm",controller:["$scope","rentabilidadeDatasource",function(a,t){var o=this,e=D();o.loading=!0,e.detalhar=!0,t.carregarRentabilidade(e).then((function(a){o.loading=!1,o.dados=a}))}]})}}c.atualizarConfBenchmarksRentabilidade=function(a){m=a},c.carregarRentabilidadeAtivo=function(a,t){m=void 0;return new v({series:["Ativo"],params:{ativo:a,tickerTipo:t}}).carregar()},c.carregarRentabilidadeCarteira=function(a){m=void 0;return new v({series:["Carteira"],params:a}).carregar()},c.carregarRentabilidadeAvancada=function(a,t,o,e){m=e&&-1!=e&&!o?s.b:o;return new v({series:a,params:t}).carregar()},c.carregarRentabilidadeAtivos=function(){return n.carregarRentabilidadeAtivos(p())},c.carregarConfiguracoes=function(){return n.carregarConfiguracoesRentabilidade()},c.salvarConfiguracao=function(a){return n.salvarConfiguracoesRentabilidade(a).then((function(a){return t.showSimple("Configuração salva"),a}))},c.excluirConfiguracao=function(a){return n.excluirConfiguracoesRentabilidade(a).then((function(){t.showSimple("Configuração excluída")}))},c.changePeriodo=function(a){s.p=a,c.periodo=a,i.updateConfig("bchmark",s)},c.configurarBenchmarks=function(){return o.show({id:"configurar-benchmarks",templateUrl:"/partials/investimentos/rentabilidade/configurar.html",bindToController:!0,locals:{confAtivas:m||s.b},controllerAs:"vm",controller:"ConfigurarRentabilidadeAvancadaController"}).then((a=>void 0===m?(s.b=a,void i.updateConfig("bchmark",s)):a))}}])}(),function(){"use strict";function a(a,o,e,n,r,i,c,s){var l=this;l.meses=[1,2,3,4,5,6,7,8,9,10,11,12,13],l.max=moment().startOf("month"),l.calendarioConfig={restrict:["m"],interval:"m"};var u=n.getConfig("investResult",{p:13,v:!0,liq:1,f:1,fo:1,fl:[]});function d(a,t){t=t||l.periodo;var o=l.dtliq;if(a){for(var e=moment(a).startOf("month"),n=l.max.format("YYYY-MM");e.format("YYYY-MM")>n;)e=e.subtract(1,"month");a=e}else a=l.inicio||moment().startOf("month").subtract(t-1,"months");var i={inicio:a.format("YYYY-MM-DD"),periodo:t||l.periodo,liquidacao:1==o,filtroOp:l.filtroOp};l.filtroAtual>1&&(i[3==l.filtroAtual?"contas":"estrategia"]=l.listaFiltros.join(","));return l.inicio=moment(i.inicio),l.periodo=i.periodo,l.dtliq=o,l.loading=!0,r.carregarResultados(i).then((function(a){l.loading=!1,l.relatorio=a}))}function m(){u={p:l.periodo,v:l.detalhar,liq:l.dtliq,f:l.filtro,fo:l.filtroOp,fl:l.listaFiltros},n.updateConfig("investResult",u)}l.periodo=u.p,l.detalhar=u.v,l.dtliq=u.liq,l.listaFiltros=u.fl,l.filtroAtual=l.filtro=u.f,l.filtroOp=u.fo,l.carregar=d,l.exportar=function(){var a={inicio:l.inicio.format("YYYY-MM-DD"),periodo:l.periodo,caminho:"Meu_Dinheiro_"+moment().format("YYYYMMDDHHmmSS"),liquidacao:1==l.dtliq,filtroOp:l.filtroOp};if(l.filtroAtual>1){var t=3==l.filtroAtual?"contas":"estrategia";a[t]=l.listaFiltros.join(",")}i.get("/api/v2/investimentos/resultados/exportar",{params:a}).then((function(t){!function(a,t,o){if(null!=o&&navigator.msSaveBlob)return navigator.msSaveBlob(new Blob([o],{type:t}),a);var e=angular.element("<a style='display: none;'/>"),n=window.URL.createObjectURL(new Blob([o],{type:t}));e.attr("href",n),e.attr("download",a),angular.element(document.body).append(e),e[0].click(),window.URL.revokeObjectURL(n),e.remove()}(a.caminho.replace(/\.\w*$/,"")+".xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",function(a){for(var t=new ArrayBuffer(a.length),o=new Uint8Array(t),e=0;e!=a.length;++e)o[e]=255&a.charCodeAt(e);return t}(atob(t.data)))}))},l.onChangeFiltroOp=function(){m(),d()},l.onChangeForm=function(){u.p!=l.periodo&&m(),o.go("resultados.relatorio",{p:l.periodo,inicio:moment(l.inicio).format("YYYY-MM-DD")})},l.toggleAtivos=function(){l.detalhar=!l.detalhar,m()},l.filtros=function(){return(1!=l.filtro?e.show({id:"edicao-filtro-resultado",templateUrl:"/partials/investimentos/resultados/filtro.html",controller:t,bindToController:!0,controllerAs:"vm",locals:{tipo:l.filtro,dados:l.filtro==l.filtroAtual?l.listaFiltros:[]}}):a.when(null)).then((function(a){l.filtroAtual=l.filtro,l.listaFiltros=a?a.dados:[],m(),d()}),(function(){l.filtro=l.filtroAtual}))},l.onChangeLiq=function(){m(),d()}}function t(a,t,o){var e=this;function n(){e.lista.sort((function(a,t){return a.nome<t.nome?-1:1})),3==e.tipo?(e.lista.forEach((function(a){e.mapDados[a.id]=!1})),e.dados&&e.dados.forEach((function(a){e.mapDados[a]=!0}))):4==e.tipo&&e.dados&&(e.estrategia=e.dados[0])}e.nomeTipo={3:"contas",4:"estratégia de investimento"}[e.tipo],e.$onInit=function(){e.mapDados={},3==e.tipo?(e.lista=t.contas.filter((function(a){return a.status&&("CONTA CORRENTE"==a.tipo||"INVESTIMENTO"==a.tipo)})),n()):4==e.tipo&&o.carregarEstrategias().then((function(a){e.lista=a.filter((function(a){return a.status})),n()}))},e.filtrar=function(){var t={dados:[]};3==e.tipo?angular.forEach(e.mapDados,(function(a,o){a&&t.dados.push(o)})):4==e.tipo&&e.estrategia&&t.dados.push(e.estrategia),t.dados.length?a.hide(t):a.cancel()}}function o(a,t,o,e,n){this.service=n,o.title="Resultados da carteira",this.printConfig={landscape:!0,controller:["ResultadosCarteiraService",function(a){this.service=a}],templateUrl:"/partials/investimentos/resultados/print.html"}}function e(a,t,o,e,n){var r=this;function i(){return r.service.carregar(e.inicio,e.p)}r.service=n,a.$on("$destroy",t.addObserver(i)),r.$onInit=i}o.$inject=["$state","$stateParams","mdwTopmenu","configuracoesService","ResultadosCarteiraService"],a.$inject=["$q","$state","$mdDialog","configuracoesService","investimentosDatasource","$http","mdwCalendarService","$timeout"],e.$inject=["$scope","carteiraService","investimentosDatasource","$stateParams","ResultadosCarteiraService"],t.$inject=["$mdDialog","cadastrosDatasource","estrategiasDatasource"],angular.module("md").service("ResultadosCarteiraService",a).controller("ResultadosCarteiraController",o).controller("ResultadosCarteiraRelController",e)}(),function(){"use strict";function a(a,t,o){t&&a.state("resultados",{abstract:!0,url:"/analise/resultados",controller:"ResultadosCarteiraController",controllerAs:"vm",templateUrl:"partials/investimentos/resultados/resultados.html"}).state("resultados.relatorio",{url:"?inicio&p",controller:"ResultadosCarteiraRelController",controllerAs:"vm",templateUrl:"partials/investimentos/resultados/relatorio.html"})}a.$inject=["$stateProvider","MD_INVEST_MOD","operacoesRoutesProvider"],angular.module("md").config(a)}(),function(){"use strict";function a(a,t,o,e,n){var r=this,i=a.$parent.card,c=e.getConfig("vgInvestAtivos",{c:!0}),s=o.addObserver((function(){u()})),l=n.onChange((function(){n.prepareChartOptions(r.chart.options)}));function u(){i.closed||(r.loading=!0,o.carregarCarteira({moeda:r.moeda}).then((function(a){r.ativos=[],r.loading=!1;var e=[];a.c[0].grupos.forEach((function(a){r.ativos=r.ativos.concat(o.mesclarAtivosGrupo(a))})),r.ativos.sort((function(a,t){return a.valorAtual<t.valorAtual?1:-1}));var n=t("moeda")(r.moeda);r.ativos.forEach((function(a){e.push({c:[{v:a.nome},{v:a.valorAtual,f:t("currency")(a.valorAtual,n+" ")},{v:a.corg}]})})),r.chart.data.rows=e})))}r.moeda=i.moeda,r.visibility=i.visibility,a.$on("$destroy",(function(){s(),l()})),i.onChangeMoeda=function(){r.moeda=i.moeda,u()},i.onChangeVisibility=function(){r.visibility=i.visibility,r.chart&&(r.chart.options.vAxis.textPosition=r.visibility?"out":"none")},r.collapsed=c.c,r.chart={type:"ColumnChart",data:{cols:[{label:"Ativo",type:"string"},{label:"Valor atual",type:"number"},{role:"style",type:"string"}],rows:[]},options:n.prepareChartOptions({vAxis:{format:"short",textPosition:r.visibility?"out":"none"},legend:{position:"none"}})},r.$onInit=u,r.toggleCollapsed=function(){r.collapsed=!r.collapsed,e.updateConfig("vgInvestAtivos",{c:r.collapsed})},r.onSelectChart=function(a){},r.togglePanel=function(){a.$parent.vm.togglePanel(i),u()}}a.$inject=["$scope","$filter","carteiraService","configuracoesService","mdwDarkModeService"],angular.module("md").controller("InvestimentosVisaogeralAtivosController",a)}(),function(){"use strict";function a(a,t,o,e,n){var r=this,i=a.$parent.card;r.chart={type:"ColumnChart",data:{cols:[{type:"string"},{type:"number",label:"BRL (R$)"},{type:"number",label:"Descontado IPCA (R$)"},{type:"number",label:"USD ($)"}],rows:[]},options:n.prepareChartOptions({hAxis:{format:"MMM/yy",gridlines:{color:"transparent"}},vAxis:{format:"short"},legend:{position:"bottom"},focusTarget:"category",chartArea:{width:"80%",height:"70%"}}),formatters:{date:[{columnNum:0,pattern:"MMMM 'de' yyyy"}]}},r.visibility=i.visibility;var c=o.addObserver(l),s=n.onChange((function(){r.chart&&(n.prepareChartOptions(r.chart.options),u())}));function l(){if(!i.closed){r.loading=!0;var a=moment().startOf("month").subtract(3,"months").format("YYYY-MM-DD"),o=moment().endOf("month").format("YYYY-MM-DD");r.loading=!0,e.carregarEvolucao(a,o).then((function(a){r.loading=!1,r.bp=a,r.chart.data.rows=[],a.forEach((function(a){var o=[];const e=moment(a.data).format("MMMM YY");o.push({v:e}),a.saldo.forEach((function(a,e){o.push({v:a,f:t("currency")(a,"")})})),r.chart.data.rows.push({c:o})})),u()}))}}function u(){r.chart.options.vAxis=r.visibility?{format:"short"}:{textPosition:"none"}}a.$on("$destroy",(function(){c(),s()})),r.$onInit=function(){l()},r.togglePanel=function(){a.$parent.vm.togglePanel(i),l()},i.onChangeVisibility=function(){r.visibility=i.visibility,u()}}a.$inject=["$scope","$filter","carteiraService","bpService","mdwDarkModeService"],angular.module("md").controller("InvestimentosVisaogeralBPController",a)}(),function(){"use strict";function a(a,t,o,e,n,r){var i=this,c=a.$parent.card,s=e.getConfig("vgInvestContas",{c:!0}),l=o.addObserver((function(){d()})),u=r.onChange((function(){r.prepareChartOptions(i.chart.options)}));function d(){c.closed||(i.loading=!0,o.carregarCarteira({moeda:i.moeda}).then((function(a){i.contas=[],i.loading=!1;var o=[],e={},r=0;a.c[0].grupos.forEach((function(a){a.ativos.forEach((function(a){e[a.conta]||(e[a.conta]={nome:n.get("contas",a.conta,!0).nome,cor:a.corg,valorAtual:0,valorInvestido:0}),e[a.conta].valorAtual+=a.valorAtual,e[a.conta].valorInvestido+=a.valorInvestido,r+=a.valorAtual}))})),angular.forEach(e,(function(a){i.contas.push(a)})),i.contas.sort((function(a,t){return a.valorAtual<t.valorAtual?1:-1}));var c=t("moeda")(i.moeda);i.contas.forEach((function(a){a.resultado=a.valorAtual-a.valorInvestido,a.variacao=a.valorAtual/a.valorInvestido-1,a.participacao=a.valorAtual/r,o.push({c:[{v:a.nome},{v:a.valorAtual,f:t("currency")(a.valorAtual,c+" ")},{v:a.cor}]})})),i.chart.data.rows=o})))}a.$on("$destroy",(function(){l(),u()})),i.moeda=c.moeda,i.visibility=c.visibility,c.onChangeMoeda=function(){i.moeda=c.moeda,d()},c.onChangeVisibility=function(){i.visibility=c.visibility,i.chart&&(i.chart.options.vAxis.textPosition=i.visibility?"out":"none")},i.collapsed=s.c,i.chart={type:"ColumnChart",data:{cols:[{label:"Conta",type:"string"},{label:"Valor atual",type:"number"},{role:"style",type:"string"}],rows:[]},options:r.prepareChartOptions({vAxis:{format:"short",textPosition:i.visibility?"out":"none"},legend:{position:"none"}})},i.$onInit=d,i.toggleCollapsed=function(){i.collapsed=!i.collapsed,e.updateConfig("vgInvestContas",{c:i.collapsed})},i.onSelectChart=function(a){},i.togglePanel=function(){a.$parent.vm.togglePanel(c),d()}}a.$inject=["$scope","$filter","carteiraService","configuracoesService","cadastrosDatasource","mdwDarkModeService"],angular.module("md").controller("InvestimentosVisaogeralContasController",a)}(),function(){"use strict";function a(a,e,n,r,i,c){var s=this,l=a.$parent.card;a.$on("$destroy",i.addObserver(f)),s.$onInit=f,s.moeda=l.moeda,s.visibility=l.visibility;var u=c.getConfig("vgInvestDisponivel",{c:!1,s:"a",cf:[],p:0,cz:0});function d(){u.c=s.collapsed,u.s=s.orderBy,u.cz=s.contaZerada?1:0,u.cf=s.contasFiltradas,u.p=s.projetado,c.updateConfig("vgInvestDisponivel",u)}function m(){s.saldos.sort("a"==s.orderBy?function(a,t){return a.conta.nome.toLowerCase()>t.conta.nome.toLowerCase()?1:a.conta.nome.toLowerCase()<t.conta.nome.toLowerCase()?-1:0}:function(a,t){return t.disponivel-a.disponivel})}function f(){if(!l.closed){s.fim=moment(),"f"!=s.projetado?s.fim.add(s.projetado,"days"):s.fim.endOf("month"),s.fim=s.fim.format("YYYY-MM-DD"),s.loading=!0;var a={finalidade:n.lancamentos.FIN_EXTRATO,fim:s.fim,contas:{faturas:s.projetado,ids:r.contas.filter((function(a){return 0!=a.liquidez&&("INVESTIMENTO"==a.tipo&&1==a.tipoInvestimento||"CONTA CORRENTE"==a.tipo)})).map((function(a){return a.id}))},moeda:-1};0==s.projetado&&(a.status=n.lancamentos.STATUS_CONFIRMADO|n.lancamentos.STATUS_CONCILIADO),n.lancamentos.sum(a,{groupBy:"conta",converter:s.moeda}).then((function(a){s.loading=!1,s.total=0,s.totalP=0,s.saldos=[],s.filtroMap=[],s.contas=[],a.sum.forEach((function(a){var t=s.projetado?a.projetado:a.confirmado;!s.contaZerada&&Math.abs(t)<.01||(s.contas.push({id:a.conta,nome:r.get("contas",a.conta,!0).nome}),-1==s.contasFiltradas.indexOf(a.conta)?(s.filtroMap[a.conta]=!0,s.total+=t,s.filtroMap[a.conta]=!0,s.saldos.push({id:a.conta,conta:r.get("contas",a.conta,!0),disponivel:t})):s.filtroMap[a.conta]=!1)})),m()}))}}s.collapsed=u.c,s.orderBy=u.s,s.contaZerada=!!u.cz,s.contasFiltradas=u.cf,s.projetado=u.p,s.filtrarContas=function(){return e.show({id:"filtro-contas-disponivel",templateUrl:"/partials/investimentos/visaogeral/disponivel/filtro.html",controller:o,bindToController:!0,controllerAs:"vm",locals:{filtroMap:s.filtroMap,contas:s.contas}}).then((function(a){s.contasFiltradas=a,d(),f()}))},s.alterarProjecao=function(){return e.show({id:"projetado-disponivel",templateUrl:"/partials/investimentos/visaogeral/disponivel/projetado.html",controller:t,bindToController:!0,controllerAs:"vm",locals:{projetado:s.projetado}}).then((function(a){s.projetado=a.projetado,d(),f()}))},s.togglePanel=function(){a.$parent.vm.togglePanel(l),f()},s.toggleCollapsed=function(){s.collapsed=!s.collapsed,d()},s.toggleSort=function(a){s.orderBy=a,d(),m()},s.toggleContaZerada=function(){s.contaZerada=!s.contaZerada,d(),f()},l.onChangeMoeda=function(){s.moeda=l.moeda,f()},l.onChangeVisibility=function(){s.visibility=l.visibility}}function t(a){var t=this;t.escolhaProj=1,"f"==t.projetado?t.escolhaProj=2:t.projetado>0&&(t.escolhaProj=3),t.$onInit=function(){t.fimMes=moment().endOf("month").format("YYYY-MM-DD")},t.escolher=function(){3==t.escolhaProj&&(t.projetado=3)},t.alterar=function(){1==t.escolhaProj&&(t.projetado=0),2==t.escolhaProj&&(t.projetado="f"),a.hide({projetado:t.projetado})}}function o(a){var t=this;t.escolheu=!1,t.$onInit=function(){t.contasOriginal=angular.copy(t.filtroMap)},t.escolher=function(){t.escolheu=JSON.stringify(t.contasOriginal)!==JSON.stringify(t.filtroMap)},t.filtrar=function(){var o=[];t.contas.forEach((function(a){t.filtroMap[a.id]||o.push(a.id)})),a.hide(o)}}a.$inject=["$scope","$mdDialog","relatoriosDatasource","cadastrosDatasource","carteiraService","configuracoesService"],t.$inject=["$mdDialog"],o.$inject=["$mdDialog"],angular.module("md").controller("InvestimentosVisaogeralDisponivelController",a)}(),function(){"use strict";function a(a,t,o,e){var n=this,r=a.$parent.card,i=t.addObserver(l),c=e.onChange((function(){n.chart&&(e.prepareChartOptions(n.chart.options),d())}));function s(){o.updateConfig("vgInvestDist",{v:n.carteira.id,p:n.pizza})}function l(){if(!r.closed){var a=o.getConfig("vgInvestDist",{v:0,p:0});n.loading=!0,n.visao=a.v,n.pizza=a.p,t.carregarCarteira({moeda:n.moeda}).then((function(a){n.loading=!1,n.carteiras=a.c,u()}))}}function u(){var a;n.carteira=null;for(var o=0;o<n.carteiras.length;o++){if(n.carteiras[o].id==n.visao){n.carteira=n.carteiras[o];break}0===n.carteiras[o].id&&(a=n.carteiras[o])}n.carteira||(n.carteira=a,n.visao=0),n.carteira=angular.copy(n.carteira),t.sortVa(n.carteira.grupos),m();var e=n.carteira.grupos.length>0&&angular.isDefined(n.carteira.grupos[0].alocacao);n.tipoGrafico=e}function d(){n.visibility||(n.chart.options.vAxis=angular.extend(n.chart.options.vAxis||{},{textPosition:"none"}))}function m(){n.chart=t.getChartsValorInvestido(n.carteira.grupos,n.pizza,n.moeda),n.showPartIdealCol="PieChart"!=n.chart.type,e.prepareChartOptions(n.chart.options),d()}n.moeda=r.moeda,n.visibility=r.visibility,a.$on("$destroy",(function(){i(),c()})),n.$onInit=function(){l()},n.onChangeVisao=function(){u(),s()},n.toggleTipoGrafico=function(){n.pizza=1==n.pizza?0:1,m(),s()},r.onChangeMoeda=function(){n.moeda=r.moeda,l()},r.onChangeVisibility=function(){n.visibility=r.visibility,r.closed||m()},n.togglePanel=function(){a.$parent.vm.togglePanel(r),l()}}a.$inject=["$scope","carteiraService","configuracoesService","mdwDarkModeService"],angular.module("md").controller("InvestimentosVisaogeralDistribuicaoController",a)}(),function(){"use strict";function a(a,t,o,e,n,r){var i=this,c=a.$parent.card;function s(){c.closed||(i.loading=!0,e.carregarApuracao().then((function(a){if(i.loading=!1,i.apuracao=a,a){var t=n.totalIr(a);i.totalApuracao=t>=0?t:0,i.isCurrentMonth=a.ultimoDiaMesApuracao.substr(0,7)==moment().format("YYYY-MM")}})))}i.visibility=c.visibility,a.$on("$destroy",r.addObserver(s)),i.$onInit=s,i.detalharApuracao=function(){o.dialogPlanoInvestimentos((function(){t.go("apurarir")}),"ir")},i.togglePanel=function(){a.$parent.vm.togglePanel(c),s()},c.onChangeVisibility=function(){i.visibility=c.visibility}}a.$inject=["$scope","$state","usuariosService","apuracaoIrDatasource","darfService","carteiraService"],angular.module("md").controller("InvestimentosVisaogeralIRController",a)}(),function(){"use strict";function a(a,t,o,e,n){var r=this,i=a.$parent.card;r.card=i;var c=e.getConfig("vgInvestRent",{p:3,v:1,c:!0,ima:!0,tv:1});r.visao=c.v,r.tipov=c.tv,r.collapsed=c.c,r.periodo=c.p,r.moeda=1,r.incluirMesAtual=c.ima,r.visibility=i.visibility,r.moedas=[];var s=o.addObserver(d),l=n.onChange((function(){r.chart&&r.chart.options&&n.prepareChartOptions(r.chart.options)}));function u(){e.updateConfig("vgInvestRent",{p:r.periodo,v:r.visao,tv:r.tipov,ima:r.incluirMesAtual,c:r.collapsed})}function d(){if(!i.closed)return r.loading=!0,function(){r.datas=function(){var a=moment().startOf("month"),t=moment(),o=r.periodo;o>=1&&o<=5&&(t=t.endOf("month"));o>=2&&o<=4&&!r.incluirMesAtual&&(t=t.startOf("month").subtract(1,"day").endOf("month"));if(2==o)a.subtract(3,"months");else if(3==o)a.subtract(6,"months");else if(4==o)a.subtract(12,"months");else if(5==o)a.startOf("year");else if(6==o)a.startOf("month").subtract(1,"month"),t=moment(a).endOf("month");else if(7==o||9==o){var e=9==o?"year":"quarter";a.subtract(1,e).startOf(e),t.subtract(1,e).endOf(e)}else if(8==o){moment().month()<6?a.subtract(1,"year").month(6):a.month(0),a.startOf("month"),t=moment(a).add(5,"months").endOf("month")}return{inicio:a.format("YYYY-MM-DD"),fim:t.format("YYYY-MM-DD")}}();var a=t(r.datas);return r.relatorio=a,a.getAtivos().then((function(a){r.ativos=a})),a.getProventos().then((function(t){if(r.hasDados=t.total.length>0,r.hasDados)return r.proventos=t,a.getTotais().then((function(a){return r.total=a,r.moedas=[],angular.forEach(r.total,(function(a,t){r.moedas.push(t)})),r.moeda=r.moedas[0],m(),f()}))}))}().then((function(){r.loading=!1}))}function m(){r.avisoMoeda=r.moedas.length>1||r.moeda!=i.moeda}function f(){var a=1==r.visao?"getVisaoTotal":"getVisaoMensal";1==r.visao?r.relatorio.getVisaoTotal:r.relatorio.getVisaoMensal(r.moeda,1==r.tipov);return r.relatorio[a](r.moeda,1==r.tipov).then((function(a){r.chart=a.chart,r.chart.options.vAxis.textPosition=r.visibility?"out":"none",r.totaisMes=a.totaisMes}))}a.$on("$destroy",(function(){s(),l()})),r.$onInit=d,r.togglePanel=function(){a.$parent.vm.togglePanel(i),d()},i.onChangeMoeda=m,r.onChangePeriodo=function(){u(),d()},r.toggleCollapsed=function(){r.collapsed=!r.collapsed,u()},r.toggleVisao=function(){r.visao=1==r.visao?2:1,u(),d()},r.onChangeIncluirMesAtual=function(){u(),d()},r.onChangeTipoV=function(){u(),f()},r.onChangeMoeda=function(){f()},i.onChangeVisibility=function(){r.visibility=i.visibility,r.chart&&(r.chart.options.vAxis.textPosition=r.visibility?"out":"none")}}a.$inject=["$scope","analiseCarteiraProventos","carteiraService","configuracoesService","mdwDarkModeService"],angular.module("md").controller("InvestimentosVisaogeralProventosController",a)}(),function(){"use strict";function a(a,t,o,e,n,r,i,c){var s=this,l=t.$parent.card;s.card=l;var u=r.getConfig("vgInvestRent",{v:1});s.visao=u.v,s.periodoRentabilidade=e.periodo;var d=n.addObserver(f),m=c.onChange((function(){s.chart&&c.prepareChartOptions(s.chart.options);s.rent&&c.prepareChartOptions(s.rent.chart.options)}));function f(){l.closed||(s.loading=!0,(1==s.visao?p():function(){var t={},n=e.carregarRentabilidadeAtivos().then((function(a){s.dadosAtivos=a})),r=i.carregarGrupos().then((function(a){a[1].forEach((function(a){t[a.id]=a}))}));function c(a){return 0!==a.ativo?a.ativo:"C"+a.conta}function l(a){var o=c(a);return t[o]?t[o].nome:""}return a.all([n,r]).then((function(){s.chart.data.rows=[],s.dadosAtivos.forEach((function(a){s.chart.data.rows.push({c:[{v:l(a)},{v:a.valor,f:o("number")(100*a.valor,2)+"%"},{v:a.valor>=0?"#179428":"#ff0000"}]})}));var a=s.dadosAtivos.length,t=Math.min(a,10),e=Math.ceil(t/2),n=Math.floor(t/2);s.melhores=[];for(var r=0;r<e&&r<a;r++){var i=s.dadosAtivos[r];s.melhores.push({id:c(i),label:l(i),v:i.valor})}s.piores=[];for(r=a-1;r>=a-n;r--){i=s.dadosAtivos[r];s.piores.push({id:c(i),label:l(i),v:i.valor})}}))}()).then((function(){s.loading=!1})))}function p(){return e.carregarRentabilidadeCarteira({moeda:s.moeda}).then((function(a){s.rent=a,s.rent.chart&&c.prepareChartOptions(s.rent.chart.options)}))}s.moeda=l.moeda,l.onChangeMoeda=function(){s.moeda=l.moeda,f()},t.$on("$destroy",(function(){d(),m()})),s.$onInit=f,s.chart={type:"ColumnChart",data:{cols:[{label:"Ativo",type:"string"},{label:"Valor atual",type:"number"},{role:"style",type:"string"}],rows:[]},options:c.prepareChartOptions({backgroundColor:"transparent",vAxis:{format:"percent"},legend:{position:"none"}})},s.togglePanel=function(){t.$parent.vm.togglePanel(l),f()},s.onChangePeriodoRent=function(){e.changePeriodo(s.periodoRentabilidade),f()},s.toggleVisao=function(){s.visao=1==s.visao?2:1,r.updateConfig("vgInvestRent",{v:s.visao}),f()},s.configurarBenchmarks=function(){return e.configurarBenchmarks().then((()=>{p()}))}}a.$inject=["$q","$scope","$filter","rentabilidadeService","carteiraService","configuracoesService","ativosService","mdwDarkModeService"],angular.module("md").controller("InvestimentosVisaogeralRentabilidadeController",a)}(),function(){"use strict";function a(a,t,o,e,n){var r=this,i=a.$parent.card;r.moeda=i.moeda,r.visibility=i.visibility,r.visaoAlt=n.getConfig("rescard",{v:"n"}).v,a.$on("$destroy",o.addObserver(l)),r.$onInit=l;var c=o.addObserver(l),s=e.onChange((function(){r.chart&&(e.prepareChartOptions(r.chart.options),u())}));function l(){i.closed||(r.loading=!0,o.carregarCarteira({moeda:r.moeda}).then((function(a){r.loading=!1,r.carteira=a.c[0],r.carteirav=a.v[0];var o,n,i,c,s,l=t("moeda")(r.moeda),d=[],m={},f=[],p=[];r.carteirav?(i="ComboChart",c="bars",r.carteirav.valorAtual*r.carteira.valorAtual>0?o=r.carteira.valorAtual>0?"#179428":"#CE6060":(o=r.carteira.valorAtual>0?"#179428":"#CE6060",n=r.carteira.valorAtual>0?"#179428":"#CE6060"),p=["#0178D6",o,"","#4DAFFF",n||o],s={2:{type:"bars",visibleInLegend:!1},3:{type:"bars"},4:{type:"bars",visibleInLegend:!!n}},f=[{type:"string"},{type:"number",label:"Valor Investido"},{type:"number",label:"Valor Atual"},{type:"number"},{type:"number",label:"Valor Vendido"},{type:"number",label:"Valor Atual"}],m={c:[{v:""},{v:r.carteira.valorInvestido,f:t("currency")(r.carteira.valorInvestido,l+" ")},{v:r.carteira.valorAtual,f:t("currency")(r.carteira.atual,l+" ")},{},{v:r.carteirav.valorAtual,f:t("currency")(r.carteirav.valorAtual,l+" ")},{v:r.carteirav.valorInvestido,f:t("currency")(r.carteirav.valorInvestido,l+" ")}]}):(i="ColumnChart",p=["#0178D6",o=r.carteira.valorAtual>0?"#179428":"#CE6060"],f=[{type:"string"},{type:"number",label:"Valor Investido"},{type:"number",label:"Valor Atual"}],m={c:[{v:""},{v:r.carteira.valorInvestido,f:t("currency")(r.carteira.valorInvestido,l+" ")},{v:r.carteira.valorAtual,f:t("currency")(r.carteira.valorAtual,l+" ")}]}),d.push(m),r.chart={type:i,data:{cols:f,rows:[]},options:e.prepareChartOptions({colors:p,vAxis:{format:"short",textPosition:r.visibility?"out":"none"},seriesType:c,series:s,hAxis:{gridlines:{color:"transparent"}},vAxis:{baseline:0,baselineColor:"#888",gridlines:{color:"#e2e2e2"}},chartArea:{width:"80%",height:"80%"},legend:{position:"bottom"}})},r.chart.data.rows=d,u()})))}function u(){r.chart&&(r.visibility?r.chart.options.vAxis.format="short":r.chart.options.vAxis.textPosition="none")}a.$on("$destroy",(function(){c(),s()})),r.togglePanel=function(){a.$parent.vm.togglePanel(i),l()},r.alternarVisao=function(){r.visaoAlt="n"==r.visaoAlt?"g":"n",n.updateConfig("rescard",{v:r.visaoAlt})},i.onChangeMoeda=function(){r.moeda=i.moeda,l()},i.onChangeVisibility=function(){r.visibility=i.visibility,u()}}a.$inject=["$scope","$filter","carteiraService","mdwDarkModeService","configuracoesService"],angular.module("md").controller("InvestimentosVisaogeralResumoController",a)}(),function(){"use strict";function a(a,t,o,e,n){const r=this,i=a.$parent.card,c=n.getConfig("vgInvestVencimento",{c:!0});function s(){i.closed||(r.collapsed=c.c,r.loading=!0,e.carregarAtivosUsuario().then((a=>{const e={};for(const t of a)t.vencimento&&(e[t.id]=t);!function(a){function e(t){for(const e of t.grupos)for(const t of e.ativos){if(!a[t.id])continue;let e=a[t.id].vencimento;r.ativos.push(angular.extend({vencimento:e,vencido:o().isAfter(o(e))},t))}}t.carregarCarteira().then((a=>{r.loading=!1,r.ativos=[],a.c&&a.c[0]&&e(a.c[0]),r.ativos.sort(((a,t)=>o(a.vencimento).isAfter(o(t.vencimento))?1:o(t.vencimento).isAfter(o(a.vencimento))?-1:0))}))}(e)})))}r.$onInit=s,r.togglePanel=function(){a.$parent.vm.togglePanel(i),s()},r.toggleCollapsed=function(){r.collapsed=!r.collapsed,n.updateConfig("vgInvestVencimento",{c:r.collapsed})}}a.$inject=["$scope","carteiraService","moment","ativosDatasource","configuracoesService"],angular.module("md").controller("InvestimentosVisaogeralVencimentoController",a)}(),function(){"use strict";function a(a,t,o){var e,n=this;t.title="Visão geral",n.cardssm=[],n.cardslg=[];var r=[{id:6,ref:"resumo",col:"sm"},{id:2,ref:"distribuicao",col:"sm"},{id:8,ref:"bp",col:"sm"},{id:1,ref:"disponivel",col:"sm"},{id:3,ref:"ir",col:"sm"},{id:5,ref:"rentabilidade",col:"lg"},{id:4,ref:"ativos",col:"lg"},{id:7,ref:"contas",col:"lg"},{id:9,ref:"proventos",col:"lg"},{id:10,ref:"vencimento",col:"lg"}];function i(){return o.updateConfig("vginvest",e)}n.dragDisabled=a.innerWidth<=960,n.sortableConfig={longTouch:!0,accept:function(a,t){return a.itemScope.sortableScope.$id===t.$id},orderChanged:function(a){var t=a.dest.sortableScope,o="sm"==t.col?"csm":"clg";e[o]=t.modelValue.map((function(a){return a.id})),i()}},n.$onInit=function(){function a(a,t){0!=t.length&&a.sort((function(a,o){var e=t.indexOf(a.id),n=t.indexOf(o.id);return-1===e?1:-1===n?-1:e-n}))}void 0===(e=o.getConfig("vginvest",{csm:[],clg:[],f:[],m:1})).v&&(e.v=o.getConfig("investimentos",{v:!0}).v),n.moeda=e.m,n.visibility=e.v,r.forEach((function(a){a.moeda=n.moeda,a.visibility=n.visibility,"sm"===a.col?n.cardssm.push(a):n.cardslg.push(a),a.closed=-1!==e.f.indexOf(a.id)})),a(n.cardssm,e.csm),a(n.cardslg,e.clg)},n.togglePanel=function(a){a.closed=!a.closed;var t=e.f.indexOf(a.id);t>-1&&e.f.splice(t,1),a.closed&&e.f.push(a.id),i()},n.onChangeMoeda=function(a){n.moeda=a,e.m=a,r.forEach((function(t){t.moeda=a,t.onChangeMoeda&&t.onChangeMoeda()})),i()},n.toggleVisibility=function(){n.visibility=!n.visibility,e.v=n.visibility?1:0,r.forEach((function(a){a.visibility=n.visibility,a.onChangeVisibility&&a.onChangeVisibility()})),i()}}a.$inject=["$window","mdwTopmenu","configuracoesService"],angular.module("md").controller("InvestimentosVisaogeralController",a)}(),function(){"use strict";function a(a,t,o,e,n,r){r&&(a.state("visaogeral",{url:"/visaogeral",templateUrl:"partials/investimentos/visaogeral/visaogeral.html",controllerAs:"vm",controller:"InvestimentosVisaogeralController"}),t.addStates("visaogeral"),o.addStates("visaogeral"))}a.$inject=["$stateProvider","operacoesRoutesProvider","lancamentosRoutesProvider","mdwStateDialogProvider","mdwBaseStateProvider","MD_INVEST_MOD"],angular.module("md").config(a)}(),function(){"use strict";a.$inject=["$compile"],angular.module("md").directive("mdwAcoesLancamento",a).directive("mdwBtnNovoLancamento",(function(){return{restrict:"E",templateUrl:"/partials/lancamentos/btnNovo.html",controllerAs:"vm",scope:{l:"=",parent:"@",cartao:"=?cartao"},controller:["$scope","$state","lancamentosService","importacaoService",function(a,t,o,e){var n=this;n.l=a.l,n.uiSref=a.parent+".lancamentosNovo",n.isCartao=!!a.cartao,n.novo=function(o){t.go(n.uiSref,angular.extend({tipo:o},a.l||{}))},n.conciliacaoBancaria=function(){e.escolhaArquivo(a.l.conta)},n.pagamento=function(){o.novo({conta:a.l.conta,tipo:"p"})}}]}}));function a(a){return{restrict:"E",scope:{lancamento:"=ngModel",cartao:"=?cartao",max:"=?max",noRoutes:"=?"},templateUrl:"/partials/lancamentos/acoes.html",controllerAs:"vm",controller:["$scope","$timeout","$state","cadastrosDatasource","usuariosService","MD_INVEST_MOD","lancamentosService",function(a,t,o,e,n,r,i){var c=this;c.openMenu=function(u,d){if(s=a.lancamento,c.acoes=[],!s.operacaoInvestimento)if(c.isCartao=s.conta&&"CARTAOCREDITO"==e.get("contas",s.conta,!0).tipo,s.projecaoFatura&&!n.hasRest("contas",s.projecaoFatura,"v"))c.acoes.push({label:"Visualizar fatura",icon:"open_in_new",action:function(){o.go("fatura.listar",{conta:s.projecaoFatura,inicio:s.dataPrevista})}});else{var m=!n.hasRest("lancamentos",s.conta,"g")&&!n.hasRest("lancamentos",s.contaT,"g");m&&(c.isCartao||"fixa"!=s.parcela||s.dataReconhecimento||"d"!=s.tipo&&"r"!=s.tipo||c.acoes.push({label:"Reconhecer",icon:"offline_pin",action:function(){l?i.reconhecer(s):o.go(".lancamentosReconhecer",s)}}),c.isCartao&&"p"!=s.tipo||"i"==s.tipo||s.dataEfetiva||(c.acoes.push({label:"Confirmar",icon:"done",action:function(){l?i.confirmar(s):o.go(".lancamentosConfirmar",s)}}),c.acoes.push({label:"Confirmar parcialmente",icon:"done",action:function(){l?i.confirmarParcial(s):o.go(".lancamentosConfirmarParcial",s)}})),s.conciliado||c.acoes.push({label:"Conciliar",icon:"done_all",action:function(){l?i.conciliar(s):o.go(".lancamentosConciliar",s)}}),c.acoes.push({label:"Editar",icon:"mode_edit",action:function(){l?i.editar(s):o.go(".lancamentosEditar",s)}})),"i"!=s.tipo&&(n.hasRest("lancamentos",s.conta,"e")||n.hasRest("lancamentos",s.contaT,"e")||c.acoes.push({label:"Excluir",icon:"delete",action:function(){l?i.excluir(s):o.go(".lancamentosExcluir",s)}}),s.operacaoInvestimento||(m&&c.acoes.push({divider:!0,label:"Clonar",icon:"content_copy",action:function(){l?i.clonar(s):o.go(".lancamentosClonar",s)}}),c.recibo=!c.isCartao&&n.planoHas("recibos")&&!r,c.estorno=!s.estorno&&!s.transferencia&&(!c.isCartao&&s.dataEfetiva||c.isCartao),c.agrupar=!s.detalhes,c.desagrupar=!!s.detalhes))}c.acoes.length>0&&t((function(){u(d)}))},c.estornar=function(){l?i.estornar(s):o.go(".lancamentosEstornar",s)},c.addDetalhe=function(){s=[s],i.agruparLote(s,{detalhar:!0})},c.ungroup=function(){i.ungroupLancamentos(s,{ungroup:!0})},a.uid=n.usuario.id;var s,l=a.noRoutes}]}}}(),function(){"use strict";angular.module("md").component("mdwChipsCadastrosLancamento",{template:['<span ng-repeat="chip in vm.chips track by $index" class="chip-cadastro" ng-class="{\'icon\':chip.icon}" ng-style="chip.color">',"<md-tooltip>{{chip.label}}</md-tooltip>",'<span class="content">','<md-icon ng-if="chip.icon">{{chip.icon}}</md-icon>',"{{chip.text}}","</span>","</span>"].join(""),controllerAs:"vm",bindings:{l:"=ngModel",ignore:"@",tipo:"@",watchModel:"="},controller:["$scope","cadastrosDatasource","$mdDialog","configuracoesService",function(a,t,o,e){var n=this;function r(a){if(a){var o=[{id:"plastico",label:"Cartão",service:"plasticos",icon:"credit_card"},"conta",{id:"contaT",label:function(){return a.valor<0?"conta destino":"conta origem"},service:"contas",icon:"swap_horiz"},"categoria","projeto",{id:"tags",label:"Tag",service:"tags"},{id:"nomePlastico",label:"Cartão",textColor:"FF5722",cor:"eee"}],r=n.ignore?n.ignore.split(","):[],i=n.tipo?n.tipo.split(","):[];if(n.chips=[],"pendente"==a.status)c({id:"status",label:"Dias de atraso",nome:moment().diff(moment(a.dataPrevista),"days"),cor:e.utilizacao.cores[0]});o.forEach((function(a){if(angular.isObject(a))return c(a);c({id:a,label:a,service:a+"s"})}))}function c(o){function e(a){var e=o.service?t.get(o.service,a,!0):o;"nomePlastico"==o.id&&(e.nome=a);var r={text:e.nome,label:angular.isFunction(o.label)?o.label():o.label,icon:o.icon};if(e.cor){var i=e.textColor;if(!i){var c=parseInt(e.cor.substr(0,2),16),s=parseInt(e.cor.substr(2,2),16),l=parseInt(e.cor.substr(4,2),16);i=Math.round((299*c+587*s+114*l)/1e3)>125?"000":"FFF"}r.color={"background-color":"#"+e.cor,color:"#"+i}}n.chips.push(r)}r.indexOf(o.id)>-1||i.length>0&&-1==i.indexOf(o.id)||a[o.id]&&(angular.isArray(a[o.id])?a[o.id].forEach((function(a){e(a)})):e(a[o.id]))}}n.$onInit=function(){r(),a.$watch("vm.l",r,!!n.watchModel)}}]})}(),function(){"use strict";function a(a){var t=this;t.ok=function(){return t.acao().then(a.hide)},t.fechar=function(){return a.hide()}}a.$inject=["$mdDialog"],angular.module("md").controller("DesagruparLancamentosController",a)}(),function(){"use strict";angular.module("md").component("mdwDescricaoLancamento",{templateUrl:"/partials/lancamentos/descricaoLancamento.directive.html",bindings:{l:"=l",_chips:"@?chips",_extra:"@?extra",_mods:"@?mods",ignore:"@?",watchModel:"=?",clickDisabled:"=?"},controller:["$scope","$element","cadastrosDatasource","mdwDarkModeService",function(a,t,o,e){const n=this;function r(){if(n.extra=angular.isUndefined(n._extra)||"false"!==n._extra&&n._extra,n.chips=angular.isUndefined(n._chips)||"false"!==n._chips&&n._chips,n.tags=[],n.exibirDetalhe=null!==`${n.l.id}`.match(/^\d+G\d+L/i),n.l.tags&&n.l.tags.length>0&&n.l.tags.forEach((function(a){(a=o.get("tags",a,!0))&&n.tags.push(a)})),n.chips&&!0!==n.chips){var a=n.chips.split(",");n.ignoreChips=["categoria","conta","contaT","projeto","plastico","nomePlastico"].filter((function(t){return-1==a.indexOf(t)})).join(",")}else n.ignoreChips=n.ignore;if(n.extra){var t=[],e=n.ignore?n.ignore.split(","):[],r=function(a){n.l[a]&&-1==e.indexOf(a)&&("ndocumento"==a?t.push("ndoc: "+n.l[a]):"nomePlastico"==a?t.push(n.l[a]):t.push(o.get(a+"s",n.l[a],!0).nome))};if(!0===n.extra)r("ndocumento"),r("centro"),r("contato"),r("forma");else n.extra.split(",").forEach(r);n.extra=t.length>0,n.extraText=t.join(", ")}}n.$onInit=function(){"fixa"==n.l.parcela&&(n.infoFixa="mensal"),n.mods="false"!==n._mods,a.$watch("$ctrl.l",r,!0),r()}}]})}(),function(){"use strict";function a(a,t){var o=a-t;return Math.abs(o)<.01?0:o}function t(a,t,o){return t.tipo==a.tipo&&(!("INVESTIMENTO"==o.tipo&&1==o.tipoInvestimento&&!t.tipoL)&&("CARTAOCREDITO"!=o.tipo||!t.tipoL))}function o(a){switch(a){case"d":return"dias";case"s":return"semanas";case"M":return"meses";case"y":return"anos"}}function e(a,t,o){return"t"==a||"p"==a?t>0?"to":"td":o?t>0?"ed":"er":a}r.$inject=["$timeout","$mdDialog","$scope","$state","$filter","mdwApiError","configuracoesService","usuariosService","lancamento","acao","lancamentosService","cadastrosDatasource","documentosService","moment","mdwMoment","documentosDatasource","regrasService","mdwAnalytics","moedaService","currencyRound"],i.$inject=["$scope","$mdDialog","$filter","cadastrosDatasource","lancamento","mdwMoment","moedaService"],c.$inject=["$scope","$mdDialog","configuracoesService","cadastrosDatasource","mdwMoment"],angular.module("md").controller("EditarLancamentoController",r).controller("EdicaoLancamentoParcelamentoController",i).controller("EdicaoLancamentoDetalharController",c);var n={repeticao:"u",intervalo:"M",quantidade:2,frequencia:1,inicial:1};function r(r,i,c,u,d,m,f,p,v,g,h,C,b,A,x,S,D,$,M,w){var E,y=this,I=g.editar,O={origem:null,destino:null};let T;function P(a){"Escape"==a.key&&T==angular.toJson(y.l)&&i.cancel()}function R(a){y.edicaoCartao="CARTAOCREDITO"==z().tipo,y.edicaoCartaoDestino=y.l.contaDestino&&"CARTAOCREDITO"==C.get("contas",y.l.contaDestino,!0).tipo,y.edicaoCartao&&(y.l.status.confirmado=y.l.status.conciliado),Y()}function Y(){var a={},t={};function o(a){var t=[],o=x(a.proximoVencimento),e=x(y.l.data);for(y.l.agenda&&y.l.agenda.quantidade>1&&y.l.agenda.inicial>1&&e.add((y.l.agenda.inicial-1)*y.l.agenda.frequencia,y.l.agenda.intervalo);o.isBefore(e,"day");)o.add(1,"month");for(var n=0;n<2;n++)t.push(x(o).add(n,"months").format("YYYY-MM-DD"));var r=x(t[0]).subtract(a.fechamento,"days");return t[e.isBefore(r,"day")?0:1]}y.l.conta&&(a=C.get("contas",y.l.conta,!0)),y.l.contaDestino&&(t=C.get("contas",y.l.contaDestino,!0)),"CARTAOCREDITO"==a.tipo&&(y.l.dataPrevista=(y.edicao||y.agrupar)&&O.origem==y.l.conta?y.l.dataPrevista:o(a)),"CARTAOCREDITO"==t.tipo&&(y.l.dataPrevistaDestino=(y.edicao||y.agrupar)&&O.destino==y.l.contaT?y.l.dataPrevistaDestino:o(t))}function j(){for(var a=0;a<C.categorias.length;a++){var t=C.categorias[a];if(15==t.tipoL)return void(y.l.categoria=t.id)}}function _(a){if(y.validate()&&!y.salvando){var t=angular.copy(y.l);t.agenda&&(y.criacao||y.agrupar)&&("u"==t.agenda.repeticao?delete t.agenda:"f"==t.agenda.repeticao?t.agenda.quantidade=-1:function(a){if(3==y.opcaoParcelamento)return;var t=a.agenda.quantidade,o=Math.abs(a.valor),e=Math.abs(parseFloat((o/t).toFixed(2))),n=e*t,r=n-o,i=e-r;y.isValorParcela&&(n=o=Math.abs(a.valor)*t,r=0,i=e=Math.abs(a.valor));for(var c=[],s=0;s<t;s++){var l=c[s]?c[s].data:x(a.data).add(s*a.agenda.frequencia,a.agenda.intervalo).format("YYYY-MM-DD");o=0;o=0==s?2==y.opcaoParcelamento?e:i:s==t-1&&2==y.opcaoParcelamento?i:e,c[s]?(c[s].data=l,c[s].valor=o):c.push({data:l,valor:o})}a.parcelas=c}(t)),y.salvando=!0;var o=y.edicao&&!t.grupoIrregular&&!y.reconhecer&&!y.confirmacao&&!y.conciliacao&&t.agendaId&&t.parcela;o&&t.detalhes&&"fixa"!=t.parcela&&(o=!1);var e=o?i.show({controller:["$mdDialog",function(a){this.ok=function(){a.hide(this.alteracao)}}],controllerAs:"vm",templateUrl:"/partials/lancamentos/modoEdicaoLancamentoParcelado.html",id:"modo-edicao-lancamento-parc"}).then((function(a){return n(2==a)}),(function(){y.salvando=!1})):n();return e}function n(o){let e;return"t"==t.tipo||"p"==t.tipo?(delete t.conta,t.transferencia=!0):(t.transferencia=!1,delete t.contaOrigem,delete t.contaDestino),y.enviarLembrete||delete t.lembrete,t.conciliado=t.status.conciliado,function(){var a=x(t.data).format("YYYY-MM-DD");if(y.edicaoCartao){var o=t.agenda&&-1==t.agenda.quantidade;t.conciliado=t.status.conciliado,t.dataCompetencia=a,o&&t.conciliado?t.dataEfetiva=a:t.dataEfetiva=null,"t"!=t.tipo||x(a).isAfter(A().endOf("day"))||(t.dataEfetiva=t.dataEfetiva||a)}else(!f.utilizacao.dataCompetencia&&y.acao.reconhecer||y.edicaoCartaoDestino)&&(t.dataCompetencia=a),t.status.confirmado?(t.dataEfetiva=a,t.dataPrevista=t.dataPrevista||t.dataEfetiva,t.conciliado=t.status.conciliado):(t.dataPrevista=a,t.dataEfetiva=null,t.conciliado=!1,A(a).format("YYYY-MM-DD")<=A().format("YYYY-MM-DD")&&(t.automatico=!1));t.dataCompetencia&&(t.dataCompetencia=A(t.dataCompetencia).format("YYYY-MM-DD"))}(),function(){var a="r"!=t.tipo?-1:1;if(t.detalhes){var o=0;t.detalhes.forEach((function(a){t.parcelas&&y.isValorParcela?a.valor=t.parcelas.reduce((t=>w(t+l(a.tipoL,a.valor))),0):a.valor=l(a.tipoL,a.valor),o+=a.valor})),a=o>0?1:-1}t.parcelas&&(t.parcelas=t.parcelas.map((function(t){return{valor:Math.abs(t.valor)*a,data:x(t.data).format("YYYY-MM-DD")}})),y.isValorParcela&&(t.valor=t.parcelas.reduce(((a,t)=>w(a+t.valor)),0)));t.valor=a*Math.abs(t.valor),t.dataEfetiva||t.status.confirmado||t.status.conciliado?(t.valorEfetivo=t.parcelas?t.parcelas[0].valor:t.valor,t.valorPrevisto=Math.abs(t.valorPrevisto||t.valor)*a,"t"==t.tipo&&(t.valorEfetivoT=t.valorT,t.valorPrevistoT=Math.abs(t.valorPrevistoT||t.valorT))):(t.valorPrevisto=t.valor,t.valorEfetivo=null,"t"==t.tipo&&(t.valorPrevistoT=t.valorT,t.valorEfetivoT=null))}(),e=g.detalhar?h.createAgrupamento(t):I?h.update(t,o):h.create(t),e.then((function(o){var e;e=y.edicaoCartao?t.conciliado?"Conciliado":"Confirmado":t.conciliado?"Conciliado":t.dataEfetiva?"Confirmado":x(t.dataPrevista).isAfter()?"Agendado":"Pendente";var n=t.detalhes?"Detalhado":t.transferencia?"Transferência":"d"==t.tipo?"Despesa":"Receita",c="única",s=t.dataEfetiva||t.dataPrevista,l=-1*A().startOf("day").diff(s,"days");return I?(t.parcela&&(c="fixa"==t.parcela?"fixa":"parcelada"),$.transactionEntryAdjusted(n,e,c,l)):(t.agenda&&(c=t.agenda.repeticao?"fixa":"parcelada"),$.transactionEntryAdded(n,e,c,l)),i.hide(o).then((function(){if(y.criacao&&!y.hasSelectedRegra&&t.descricao.length>0&&y.criarRegra){var o={nome:t.descricao,descricao:t.descricao,tipoLancamento:t.tipo,conta:t.transferencia?t.contaOrigem:t.conta,contaDestino:t.contaDestino,categoria:t.categoria,centro:t.centro,contato:t.contato,projeto:t.projeto,forma:t.forma,plastico:t.plastico,tags:t.tags};D.create(o)}y.gerarResiduo&&U()>0&&(t.id=null,r((function(){var a=t.descricao;t.parcela&&"fixa"!=t.parcela&&(a+=" "+t.parcela);const o=t.dataCompetencia&&t.parcela&&"fixa"==t.parcela;var e={base:angular.extend(t,{_naoIniciarDtCompetencia:o,dataCompetencia:o?null:t.dataCompetencia,valor:U(),data:E,descricao:a+" (resíduo)",agenda:{repeticao:"u"},status:{confirmado:!1}}),tipo:t.tipo};u.go(".lancamentosNovo",e)}),100)),a?(t.id=null,t.observacoes=null,r((function(){var a=angular.extend(t,{descricao:"",valor:0,valorPrevisto:0,valorEfetivo:0,parcelas:!1,_enviarLembrete:y.enviarLembrete});a.contaOrigem&&(a.conta=a.contaOrigem),t.agenda&&"p"==t.agenda.repeticao&&delete a.agenda,a.anexos=[],u.go(".lancamentosNovo",{base:a,tipo:t.tipo})}),100)):y.criacao&&$.askForWebPushPermission()}))}),(function(){y.salvando=!1}))}}function L(){y.edicao&&!y.edicaoCartao&&(y.l.status.confirmado?(y.l.valorEfetivo&&(y.l.valor=y.l.valorEfetivo),y.l.dataEfetiva?y.l.data=x(y.l.dataEfetiva):y.l.data=x(y.l.dataPrevista).isBefore(x(),"day")?x(y.l.dataPrevista):x()):(y.l.valorPrevisto&&(y.l.valor=y.l.valorPrevisto),y.l.dataPrevista&&(y.l.data=x(y.l.dataPrevista))),y.l.dataCompetencia=y.l.dataReconhecimento||y.l.data,y.l.dataReconhecimento=y.l.dataCompetencia)}function U(){return Math.abs(y.l.valorPrevisto)-Math.abs(y.l.valor)}function F(){var a=z();if("CARTAOCREDITO"!=a.tipo)return!1;var t=x(y.l.dataPrevista).format("YYYY-MM")<x(a.proximoVencimento).format("YYYY-MM");return y.l.id&&void 0===y.edicaoFaturaFechada&&(y.edicaoFaturaFechada=t),t}function z(){return C.get("contas",y.l.conta,!0)}y.maxConfDate=A().endOf("day"),y.configuracoesService=f,y.usuariosService=p,y.ok=_,y.validate=function(a){if(!c.form||c.form.$invalid&&(!a||c.form.$submitted))return!1;if("g"==y.l.tipo&&y.l.detalhes&&y.l.detalhes.length<=1)return!1;if("t"==y.l.tipo&&y.l.contaOrigem==y.l.contaDestino)return!1;return!0},y.perm=p.usuario.plano.permissoes,y.tipoLancamento=function(){return a=y.l,"d"==a.tipo?"despesa":"r"==a.tipo?"receita":"transferência";var a},y.opcoesParcelamento=function(){h.parcelamentoEdicao(angular.extend(y.l,{opcaoParcelamento:y.opcaoParcelamento,isValorParcela:y.isValorParcela})).then((function(a){"u"==a.agenda.repeticao?(y.l.agenda=angular.copy(n),y.l.valor=a.valor):(y.l.agenda=a.agenda,y.l.valor=a.valor),y.l.parcelas=a.parcelas,y.l.parcelas&&(y.l.data=y.l.parcelas[0].data),y.opcaoParcelamento=a.opcaoParcelamento,y.isValorParcela=a.isValorParcela,y.l.valor=a.valor,Y()}))},y.detalharLancamento=function(a){h.detalharEdicao(y.l,a).then((function(a){y.l.valor=y.l.agenda&&"p"==y.l.agenda.repeticao?y.l.valor:a.lancamento.valor,y.l.data=a.lancamento.data,y.l.detalhes=a.detalhes||[]}))},y.excluirDetalheLancamento=function(a){y.l.detalhes.splice(a,1)},y.estornarDetalheLancamento=function(a){i.cancel().then((function(){r((function(){u.go(".lancamentosEstornar",{id:y.l.detalhes[a].id||y.l.detalhes[a]._id})}),100)}))},y.toggleConfirmar=function(){y.l.status.confirmado&&(y.l.status.conciliado=!1);y.l.status.confirmado=!y.l.status.confirmado,L()},y.toggleConciliar=function(){var a=y.l.status.confirmado;y.l.status.conciliado||(y.l.status.confirmado=!0);y.l.status.conciliado=!y.l.status.conciliado,y.edicaoCartao&&(y.l.status.confirmado=y.l.status.conciliado);a||L()},y.calcularResiduo=U,y.filtrarContasT=function(a){return a.id!=y.l.conta},y.gerarRegras=!0,y.isFaturaFechada=F,y.filterCats=function(a){return t(y.l,a,z())},y.diferencaDetalhes=function(){return y.l.detalhes&&y.l.detalhes.length>0?a(Math.abs(y.l.valor),Math.abs(s(y.l.detalhes))):0},y.ajustarValorDetalhes=function(){y.l.valor=s(y.l.detalhes)},y.changeTipo=function(){y.l.categoria=null,"t"==y.l.tipo&&j()},y.moeda="R$",y.labelIntervaloRepeticao=o,y.toggleOpcao=function(a){y.l[a]=!y.l[a]},y.toggleLembretes=function(a){if(y.displayLembretes)return y.displayLembretes=0;y.displayLembretes=angular.element(a.currentTarget)[0].offsetLeft-36,y.enviarLembrete||(y.enviarLembrete=!0,y.l.lembrete=0)},y.anexarDocumentos=function(){b.anexar().then((function(a){a&&(y.l.anexos=y.l.anexos||[],a=a.filter((function(a){for(var t=!1,o=0;o<y.l.anexos.length;o++)if(y.l.anexos[o]==a){t=!0;break}return!t})),y.l.anexos=y.l.anexos.concat(a))}))},y.unlinkAnexo=function(a){var t=y.l.anexos.indexOf(a.id);y.l.anexos.splice(t,1)},y.textoParcelamento=function(){if("f"==y.l.agenda.repeticao)return"Personalizar";if(!y.l.agenda||"p"!=y.l.agenda.repeticao||!y.l.agenda.quantidade)return"";if(!y.l.valor)return"Personalizar";var a=y.l.agenda.quantidade,t=Math.abs(y.l.valor),o=y.l.conta?d("moedaConta")(y.l.conta):d("moeda")(M.moeda);if(y.isValorParcela)return a+" parcelas de "+d("currency")(t,o);if(3==y.opcaoParcelamento)return a+" parcelas personalizadas";var e=Math.abs(parseFloat((t/a).toFixed(2))),n=e*a-t,r={parcela:d("currency")(e,o),parcelaR:d("currency")(e-n,o)};return n?["1 parcela de "+r.parcelaR+" + "+(a-1)+"x de "+r.parcela,a-1+" parcela"+(a>2?"s":"")+" de "+r.parcela+" + 1x de "+r.parcelaR][y.opcaoParcelamento-1]:a+" parcelas de "+r.parcela},y.anexos=[],y.$onInit=function(){!function(){var a="OS X"==platform.os.family;y.scSalvarContinuar=a?"⌘⇧Enter":"Ctrl+⇧Enter",y.scSalvar=a?"⌘Enter":"Ctrl+Enter",Mousetrap.bind("mod+enter",(function(a){_()})),Mousetrap.bind("mod+shift+enter",(function(a){_(!0)}));var t=Mousetrap.prototype.stopCallback;Mousetrap.prototype.stopCallback=function(){return!1},c.$on("$destroy",(function(){Mousetrap.unbind(["mod+enter","mod+shif+enter"]),Mousetrap.prototype.stopCallback=t,removeEventListener("keyup",P,!0)}))}(),function(){if(y.acao=g,y.agrupar=g.detalhar,y.criacao=g.criacao,y.confirmacao=g.confirmar,y.conciliacao=g.conciliar,y.clonar=g.clonar,y.estornar=!!g.estornar,y.reconhecer=g.reconhecer,y.edicao=I,y.gerarResiduo=!!g.parcial,g.detalhar){var a=angular.copy(v);(v=angular.copy(v[0])).agenda=null,v.tipo="g",v.detalhes=a;const t=[];let o=[],e=[];a.forEach((a=>{a.agenda=null,a.anexos&&a.anexos.forEach((a=>{t.includes(a)||t.push(a)})),a.parcela&&"fixa"!=a.parcela&&(a.descricao+=` ${a.parcela}`),a.observacoes&&o.push(a.observacoes),a.ndocumento&&e.push(a.ndocumento)})),v.anexos=t;const n=(a,t,o)=>o.indexOf(a)===t;o.length>0&&(y.observacoesMescladas=o.length>1,v.observacoes=o.filter(n).join("\n").substring(0,400)),e.length>0&&(y.ndocumentoMesclado=e.length>1,v.ndocumento=e.filter(n).join(", ").substring(0,60)),v.valor=0,v.detalhes.forEach((function(a){v.valor+=a.valor,v.valorPrevisto+=a.valor,a.tipoL=a.tipoL||("t"!=a.tipo?a.tipo:a.valor>0?"to":"td")}))}if(function(){c.$watch("vm.l.data",(function(a){A(a).isValid()&&(y.posicaoData=A(a).startOf("day").diff(A().startOf("day"),"days"),Y(),y.edicao||y.posicaoData>0&&(y.l.status.confirmado=!1,y.l.status.conciliado=!1),y.criacao&&f.utilizacao.dataCompetencia&&!y.l.dataCompetencia&&!y.l._naoIniciarDtCompetencia&&(y.l.dataCompetencia=a))})),c.$watch("vm.l.dataPrevista",(function(a){F()&&(y.l.status.conciliado=!0)})),c.$watchCollection("vm.l.anexos",(function(a){a&&(y.anexos=[],a.forEach((function(a){S.get(a).then((function(a){y.anexos.push(a)}))})))})),c.$watch("vm.l.conta",(function(a,t){if(R(),angular.isDefined(y.isValorParcela))return;const o=f.utilizacao.parcelas;if(1==o)return y.isValorParcela=!y.edicaoCartao;y.isValorParcela=2==o})),c.$watch("vm.l.contaOrigem",(function(a){a&&(y.l.conta=a)})),c.$watch("vm.l.contaDestino",(function(a){if(a){var t=C.get("contas",a,!0);if(R(),"CARTAOCREDITO"==t.tipo){const a=C.categorias.find((function(a){return 18==a.tipoL}));if(!y.l.categoria||y.criacao&&!y.clonar&&!y.estornar)return void(y.l.categoria=a.id);"t"!=C.get("categorias",y.l.categoria,!0).tipo&&(y.l.categoria=a.id)}}}))}(),!y.criacao||y.clonar||y.estornar){if(function(){y.l=angular.copy(v),y.l.status={confirmado:!y.clonar&&("confirmado"==v.status||"conciliado"==v.status),conciliado:!y.clonar&&v.conciliado},y.l.dataCompetencia=y.l.dataReconhecimento,E=y.l.dataPrevista,y.clonar&&(y.configuracoesService.utilizacao.dataCompetencia||(y.l.dataCompetencia=null),y.l.dataPrevista=null,y.l.valorPrevisto=null,y.l.dataReconhecimento=null);y.l.detalhes&&(y.l.tipo="g",y.l.detalhes.forEach((function(a){a.tipoL="t"!=a.tipo?a.tipo:a.valor>0?"to":"td"})));var a=x(y.l.dataEfetiva||y.l.dataPrevista||E);if(y.l.conta){"CARTAOCREDITO"==C.get("contas",y.l.conta,!0).tipo&&(a=x(y.l.data))}y.l.data=a,O.origem=y.l.conta,("t"==y.l.tipo||"p"==y.l.tipo)&&(y.l.tipo="t",y.l.plastico=v.plastico||v.plasticoT||void 0,y.l.valor<0?(y.l.contaOrigem=y.l.conta,y.l.contaDestino=y.l.contaT,y.l.metaEconomiaOrigem=y.l.metaEconomiaOrigem||y.l.metaEconomia,y.l.dataPrevistaDestino=y.l.dataPrevistaT):(y.l.contaOrigem=y.l.contaT,y.l.contaDestino=y.l.conta,y.l.metaEconomiaDestino=y.l.metaEconomiaDestino||y.l.metaEconomia,y.l.dataPrevistaDestino=y.l.dataPrevista,y.l.dataPrevista=y.l.dataPrevistaT,y.l.valor=v.valorT,y.l.valorT=v.valor,y.l.valorPrevisto=v.valorPrevistoT,y.l.valorPrevistoT=v.valorPrevisto,y.l.valorEfetivo=v.valorEfetivoT,y.l.valorEfetivoT=v.valorEfetivo),O.origem=y.l.contaOrigem,O.destino=y.l.contaDestino,y.l.conta=y.l.contaOrigem);y.l.agenda?y.l.agenda.repeticao=-1==y.l.agenda.quantidade?"f":"p":y.l.agenda=angular.copy(n);y.enviarLembrete=angular.isDefined(v.lembrete),y.l.fatura&&(y.maxConfDate=A(y.l.dataPrevista).endOf("day"));y.l.detalhes&&y.l.detalhes.forEach((function(a){a.tipoL=e(a.tipo,a.valor,a.estorno)}))}(),y.estornar&&(r((function(){y.l.descricao="Estorno "+y.l.descricao}),10),y.l.agenda=angular.copy(n),y.l.estorno=!0),y.confirmacao&&(y.l.status.confirmado=!0,y.l.data=x(y.l.data).isAfter(A(),"days")?x():x(y.l.data)),y.conciliacao&&(y.l.status.confirmado=!0,y.l.status.conciliado=!0),y.l.transferencia){const a=`${y.l.transferencia}`;y.isPernaGrupo=!!a.match(/\d+G/)}}else!function(){y.l=angular.extend({descricao:"",tipo:v.tipo||"d",status:{confirmado:!0,conciliado:!1},exibirCp:!0,exibirCr:!0,automatico:!1,lembrete:0,anexos:[],agenda:angular.copy(n)},v||{}),y.dataPrevista=null,y.dataEfetiva=null,y.valorPrevisto=null,y.valorEfetivo=null,("t"==y.l.tipo||"p"==y.l.tipo)&&(y.l.transferencia=!0);"t"!=y.l.tipo||y.l.categoria||j();if("p"==y.l.tipo){var a=C.get("contas",y.l.conta,!0);y.l.tipo="t",y.l.descricao="Pagamento "+a.nome,y.l.contaDestino=y.l.conta,y.l.contaOrigem=a.contada,y.l.conta=y.l.contaOrigem,y.gerarRegras=!1}else y.l.contaOrigem=y.l.contaOrigem||y.l.conta;"g"!=y.l.tipo||g.detalhar||(y.l.detalhes=[]);y.enviarLembrete=!angular.isDefined(y.l._enviarLembrete)||y.l._enviarLembrete,y.opcaoParcelamento=1}()}(),r((()=>{T=angular.toJson(y.l)}),200),addEventListener("keyup",P,!0)},y.abrirPernaDetalhe=function(){i.cancel().then((()=>{r((()=>{u.go(".lancamentosEditar",{id:y.l.transferencia})}),800)}))},y.verificarMoedaTransf=function(){if("t"!=y.l.tipo||!y.l.conta||!y.l.contaDestino)return!1;var a=C.get("contas",y.l.conta,!0),t=C.get("contas",y.l.contaDestino,!0);return a.moeda!=t.moeda}}function i(a,t,e,n,r,i,c){var s=this;function l(a,t){if(!angular.isUndefined(a)&&!s.isValorParcela){var o=s.config.quantidade,n=Math.abs(s.valor),l=Math.abs(parseFloat((n/o).toFixed(2))),u=l*o-n,d=s.l.conta?e("moedaConta")(s.l.conta):e("moeda")(c.moeda),m=e("currency")(l,d),f=e("currency")(l-u,d);s.opcoesParcelamento=u?["1 parcela de "+f+" + "+(o-1)+"x de "+m,o-1+" parcela"+(o>2?"s":"")+" de "+m+" + 1x de "+f]:[o+" parcelas de "+m],a!=t&&function(){var a=s.config.quantidade,t=Math.abs(s.valor),o=Math.abs(parseFloat((t/a).toFixed(2))),e=o-(o*a-t);s.parcelas=[];for(var n=0;n<a;n++){var c=s.parcelas[n]?s.parcelas[n].data:i(r.data).add(n*s.config.frequencia,s.config.intervalo).format("YYYY-MM-DD");t=0;t=0==n?2==s.opcaoParcelamento?o:e:n==a-1&&2==s.opcaoParcelamento?e:o,s.parcelas[n]?(s.parcelas[n].data=c,s.parcelas[n].valor=t):s.parcelas.push({data:c,valor:t})}}()}}s.l=r,s.sempreValorParcela=r.sempreValorParcela,s.valor=r.valor,s.opcaoParcelamento=r.opcaoParcelamento||1,s.parcelas=r.parcelas||[],s.edicaoCartao=r.conta&&"CARTAOCREDITO"==n.get("contas",r.conta,!0).tipo,s.isValorParcela=angular.isUndefined(r.isValorParcela)?r.sempreValorParcela||!r.parcelas&&!s.edicaoCartao:r.isValorParcela,s.config=angular.extend({repeticao:"p",intervalo:"M",quantidade:2,frequencia:1,inicial:1},r.agenda||{}),-1==s.config.quantidade&&(s.config.quantidade=2),s.definirQuantidadeFixa=!!s.config.quantidadeFixa,s.hasAgenda=!!r.agenda,s.diferencaSomaParcelas=function(){if("p"!=s.config.repeticao||s.isValorParcela||0==s.parcelas.length)return 0;var a=s.parcelas.reduce((function(a,t){return a+Math.abs(t.valor)}),0)-Math.abs(s.valor);return parseFloat(a.toFixed(2))},s.recalcularVencimentos=function(){for(var a=s.parcelas[0].data,t=1;t<s.parcelas.length;t++)s.parcelas[t].data=i(a).add(t*s.config.frequencia,s.config.intervalo).format("YYYY-MM-DD")},s.dismiss=t.cancel,s.ok=function(){var a={agenda:s.config,valor:s.valor};"f"==s.config.repeticao?(a.agenda.quantidade=-1,s.definirQuantidadeFixa||delete s.config.quantidadeFixa):delete s.config.quantidadeFixa;"p"==s.config.repeticao&&(a.isValorParcela=s.isValorParcela,s.isValorParcela||(a.parcelas=s.parcelas,a.opcaoParcelamento=s.opcaoParcelamento));return t.hide(a)},s.labelIntervaloRepeticao=function(){return o(s.config.intervalo)},a.$watch("vm.config.intervalo",l),a.$watch("vm.config.quantidade",l),a.$watch("vm.valor",l),a.$watch("vm.isValorParcela",l),a.$watch("vm.opcaoParcelamento",l)}function c(o,n,r,i,c){var s=this,u=s.lancamento;function d(a,t){s.edicao=a,s.ld=angular.extend({tipo:"d",valor:0},angular.extend(t||{})),s.ld.tipoL=e(s.ld.tipo,s.ld.valor,s.ld.estorno),v()}function m(){var a=0;return angular.forEach(s.detalhes,(function(t){a+=l(t.tipoL,t.valor)})),parseFloat(a.toFixed(2))}function f(){return a(Math.abs(s.l.valor),Math.abs(m()))}function p(){var a=angular.element(document.getElementById("edicao-grupo")).find("md-dialog-content");a.prop("scrollTop",a.prop("scrollHeight")+100)}function v(){var a=document.getElementById("edicao-grupo-valor");a&&(a.focus(),p())}s.l=s.lancamento,s.edicaoDetalhes=u.detalhes&&u.detalhes.length>0,s.configuracoesService=r,s.dismiss=n.cancel,s.editar=d,s.excluir=function(){s.detalhes.splice(s.edicao,1),d()},s.detalhes=angular.copy(u.detalhes)||[],s.adicionar=function(){var a=angular.copy(s.ld);angular.isDefined(s.edicao)?s.detalhes[s.edicao]=a:s.detalhes.push(a);a.valor=l(a.tipoL,a.valor),d(void 0,{tipo:a.tipo,tipoL:a.tipoL,metaEconomia:0}),o.form.$setPristine(),o.form.$setUntouched()},s.total=m,s.diferenca=f,s.copiarDiferenca=function(){s.ld.valor=f()},s.valorTipo=l,s.salvarDetalhes=function(){var a=0;angular.forEach(s.detalhes,(function(t){t.valorPrevisto=t.valor,a+=l(t.tipoL,t.valor)})),s.l.valor=a,n.hide({detalhes:s.detalhes,lancamento:s.l})},s.goDown=p,s.trocarTipo=function(){s.ld.tipo="to"==s.ld.tipoL||"td"==s.ld.tipoL?"t":s.ld.tipoL,s.ld.categoria=null,"t"==s.ld.tipo&&(s.l.id=null)},s.filterCats=function(a){return t(s.ld,a,i.get("contas",s.l.conta,!0))},s.verificarMoedaTransf=function(){if("t"!=s.ld.tipo||!s.l.conta||!s.ld.contaT)return!1;var a=i.get("contas",s.l.conta,!0),t=i.get("contas",s.ld.contaT,!0);return a.moeda!=t.moeda},s.ajustarValorDetalhes=function(){var a=0;angular.forEach(s.detalhes,(function(t){t.valorPrevisto=t.valor,a+=l(t.tipoL,t.valor)})),s.l.valor=a},s.salvarCopiar=function(){const a=angular.copy(s.ld);angular.isDefined(s.edicao)?s.detalhes[s.edicao]=a:s.detalhes.push(a);a.valor=l(a.tipoL,a.valor),t=void 0,n=a,s.edicao=t,s.ld=angular.copy(n),s.ld.valor=0,s.ld.tipoL=e(s.ld.tipo,s.ld.valor,s.ld.estorno),v(),o.form.$setPristine(),o.form.$setUntouched();var t,n},angular.isDefined(s.indexDetalhe)?d(s.indexDetalhe,s.detalhes[s.indexDetalhe]):d()}function s(a){var t=0;return angular.forEach(a,(function(a){t+=l(a.tipoL,a.valor)})),parseFloat(t.toFixed(2))}function l(a,t){return("d"==a||"td"==a||"er"==a?-1:1)*Math.abs(t)}}(),function(){"use strict";function a(a,t,o,e,n){var r=this;r.today=t(),r.valor=o.valor,r.data=t(o.data),r.conta=e,r.sinal=r.valor>0?1:-1,r.ok=function(){return r.valor=Math.abs(r.valor)*r.sinal,e.saldoInicial=r.valor,e.dataSaldoInicial=r.data,n.update(e).then(a.hide)}}a.$inject=["$mdDialog","moment","lancamento","conta","contasService"],angular.module("md").controller("EditarLancamentoInicialController",a)}(),function(){"use strict";function a(a,t,o,e,n,r){var i=this;i.contaNome=n.conta.nome,i.conta=n.conta.id,i.data=moment(),i.sinal=1,i.novoSaldo=0,i.loadingBalance=!0,i.configUtilizacao=r.utilizacao,i.requiredData={};let c=i.data.format("YYYY-MM-DD");const s="editarSaldoConta",l=o.categorias,u={},d=r.getConfig(s,{d:0,r:0});function m(){e.lancamentos.sum({fim:i.data.format("YYYY-MM-DD"),contas:{ids:[i.conta]},moeda:i.moeda,finalidade:e.lancamentos.FIN_EXTRATO,status:6}).then((a=>a.sum.confirmado)).then((a=>{!function(a){i.valorLancamento=function(a,t){return t-a}(a,Math.abs(i.novoSaldo)*i.sinal)}(a),i.tipoLancamento=i.valorLancamento<0?"d":"r",i.loadingBalance=!1}))}l.forEach((a=>{a.sistema&&!a.tipoL&&(u[a.tipo]=d[a.tipo]||a.id)})),i.categoria=angular.copy(u),i.$onInit=function(){m()},i.onDateBlur=function(){c!=moment(i.data).format("YYYY-MM-DD")&&(i.loadingBalance=!0,c=moment(i.data).format("YYYY-MM-DD"),m())},i.onInputChange=function(){m()},i.onFormSubmit=function(){return i.lancamento=angular.extend({conta:i.conta,dataPrevista:i.data.format("YYYY-MM-DD"),dataEfetiva:i.data.format("YYYY-MM-DD"),categoria:i.categoria[i.tipoLancamento],valorPrevisto:i.valorLancamento,valorEfetivo:i.valorLancamento,descricao:"Ajuste de Saldo"},i.requiredData),void r.updateConfig(s,{d:i.categoria.d,r:i.categoria.r}),t.create(i.lancamento).then(a.hide)}}a.$inject=["$mdDialog","lancamentosService","cadastrosDatasource","relatoriosDatasource","extratoContaService","configuracoesService"],angular.module("md").controller("EditarSaldoController",a)}(),function(){"use strict";function a(a,t,o){var e=this;e.l=t,e.todos=!0,e.ok=function(){return o.delete(t,"2"===e.alteracao).then((function(t){a.hide(t)})).finally((function(){e.salvando=!1}))},e.sequencia=t.agendaId&&t.parcela,e.sequencia||(e.alteracao=2)}a.$inject=["$mdDialog","lancamento","lancamentosService"],angular.module("md").controller("ExcluirLancamentoController",a)}(),function(){"use strict";function a(a){return t.$inject=["lancamentosService"],{require:"mdwExportListBtn",scope:{paginator:"=mdwExportListBtn"},controller:t,controllerAs:"vm",bindToController:!0,link:function(a,t,o,e){angular.element(t).bind("click",(function(){e.service.exportar(null,e.paginator)}))}};function t(a){this.service=a}}a.$inject=["mdwPrintService"],angular.module("md").directive("mdwExportListBtn",a)}(),function(){"use strict";t.$inject=["$http","colunasExportacao","configuracoesService","ids","paginator","$mdDialog","cadastrosDatasource","moment"],angular.module("md").controller("ExportarLancamentosController",t);var a="exportarLancs";function t(t,o,e,n,r,i,c,s){var l=this;l.listaColunas=[],l.marcarTodas=!0;var u=e.getConfig(a,{cc:[],ss:!1,sd:!1,sv:!1,sg:!1,dc:!1,o:"xls"});l.output=u.o,l.configColunas=u.cc,l.config={separarSubCategorias:u.ss,separarData:u.sd,separarValores:u.sv,separarGrupos:u.sg,dadosContatos:u.dc},angular.forEach(o,(function(a,t){var o=-1==l.configColunas.indexOf(t);l.listaColunas.push({checked:o,nome:a})})),l.excelEnabled=!0,n?l.config.ids=n:(l.config.params=r.getParams(),l.excelEnabled=r.total()<=500,l.excelEnabled||(l.output="csv")),l.ids=n,l.ds=c,l.getLinkDownload=function(){e.updateConfig(a,{cc:l.configColunas,ss:l.config.separarSubCategorias,sd:l.config.separarData,sv:l.config.separarValores,sg:l.config.separarGrupos,dc:l.config.dadosContatos,o:l.output});return l.config.colunas=l.listaColunas.filter((function(a){return a.checked})).map((function(a){return a.nome})).join(","),l.config.output=l.output,(n?t.post("lancamentos/exportarlancamentos",l.config):t.get("/api/v2/lancamentos/exportar",{params:l.config})).then((function(a){var t=a.headers("Content-Type");return/text\/csv/.test(t)||"xls"!=l.output?o(l.nomeArquivo.replace(/\.\w*$/,"")+".csv","text/csv",a.data):o(l.nomeArquivo.replace(/\.\w*$/,"")+".xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",function(a){for(var t=new ArrayBuffer(a.length),o=new Uint8Array(t),e=0;e!=a.length;++e)o[e]=255&a.charCodeAt(e);return t}(atob(a.data))),i.hide();function o(a,t,o){if(null!=o&&navigator.msSaveBlob)return navigator.msSaveBlob(new Blob([o],{type:t}),a);var e=angular.element("<a style='display: none;'/>"),n=window.URL.createObjectURL(new Blob([o],{type:t}));e.attr("href",n),e.attr("download",a),angular.element(document.body).append(e),e[0].click(),window.URL.revokeObjectURL(n),e.remove()}}))},l.updateListaColunas=function(a,t){if(a.checked){var o=l.configColunas.indexOf(t);o>=0&&l.configColunas.splice(o,1)}else l.configColunas.push(t)},l.nomeArquivo="Meu_Dinheiro_"+s().format("YYYYMMDDHHmmSS"),l.toggleMarcarTodas=function(){l.configColunas=[],l.listaColunas.forEach((function(a,t){a.checked=l.marcarTodas,a.checked||l.configColunas.push(t)}))}}}(),function(){"use strict";function a(a){a.define("lancamentos","/lancamentos/:id")}function t(a,t,o,e,n,r){var i=this,c=o("lancamentosDatasource"),s=a("/lancamentos/:id"),l=a("/lancamentos/duplicidade"),u=r;function d(a){return m(a,!1)}function m(a,t){s.reset(),l.reset(),t||u.notify(a),c.notify(a)}t("lancamentos",d),u.add((function(a){m(a,!0)})),n.addObserver("contas",d),i.get=function(a,t){return s.get({id:a,permitirDetalhe:t||!1})},i.query=function(a){return s.get(a).then((function(a){return a}))},i.duplicidades=function(a,t,o){var e={inicio:a,fim:t,conta:o};return l.get(e)},i.atualizarValoresGrupo=function(a,t){return e.post("/lancamentos/atualizarValoresGrupo",{id:a,valores:t}).then((function(a){return m(),a.data}))},i.getListaColunasExportacao=function(){return e.get("/lancamentos/listacolunasexportacao",{cache:!0}).then((function(a){return a.data}))},i.addObserver=c.add,i.notify=d,i.batchUpdate=function(a,t,o){return e.post("/lancamentos/editarlote",{ids:a,campos:t,todos:o}).then(m)},i.batchConfirm=function(a,t,o){return e.post("/lancamentos/confirmarlote",{ids:a,data:t,conciliar:o}).then(m)},i.batchDelete=function(a,t){return e.post("/lancamentos/excluirlote",{ids:a,todos:t}).then(m)},i.batchMoverFatura=function(a,t,o){return e.post("/lancamentos/moverFaturaLote",{ids:a,incr:t,todos:o}).then(m)},i.batchDesconcilia=function(a){return e.post("/lancamentos/desconciliarlote",{ids:a}).then(m)},i.batchAgrupa=function(a,t){return e.post("/lancamentos/agruparLote",{ids:a,descricao:t}).then(m)},i.batchDesconfirma=function(a){return e.post("/lancamentos/desconfirmarlote",{ids:a}).then(m)},i.confirmacaoAutomatica=function(){return e.post("/lancamentos/confirmacaoauto",{},{handleErrors:!1})}}a.$inject=["mdwResourceProvider"],t.$inject=["mdwCache","mdwResourceObserver","mdwObserver","$http","cadastrosDatasource","operacoesLancamentosDatasourceBinder"],angular.module("md").config(a).service("lancamentosDatasource",t)}(),function(){"use strict";function a(a,t,o){this.addStates=function(e){a.state(e+".lancamentosNovo",t.getState({url:"/nova?tipo",action:"lancamentosService.novo",params:{valor:0,data:o().hour(4),base:null}})).state(e+".lancamentosClonar",t.getState({url:"/clonar/:id",action:"lancamentosService.clonar"})).state(e+".lancamentosEstornar",t.getState({url:"/estornar/:id",action:"lancamentosService.estornar"})).state(e+".lancamentosEditar",t.getState({url:"/editar/:id",action:"lancamentosService.editar"})).state(e+".lancamentosReconhecer",t.getState({url:"/reconhecer/:id",action:"lancamentosService.reconhecer"})).state(e+".lancamentosConfirmar",t.getState({url:"/confirmar/:id",action:"lancamentosService.confirmar"})).state(e+".lancamentosConfirmarParcial",t.getState({url:"/confirmarp/:id",action:"lancamentosService.confirmarParcial"})).state(e+".lancamentosConciliar",t.getState({url:"/conciliar/:id",action:"lancamentosService.conciliar"})).state(e+".lancamentosExcluir",t.getState({url:"/excluir/:id",action:"lancamentosService.excluir"})).state(e+".pagarFatura",t.getState({url:"/pagarfatura?conta",action:"cartoesService.pagarFatura"})).state(e+".fecharFatura",t.getState({url:"/fecharfatura?conta",action:"cartoesService.fecharFatura"}))},this.$get=function(){}}a.$inject=["$stateProvider","mdwStateDialogProvider","moment"],angular.module("md").provider("lancamentosRoutes",a)}(),function(){"use strict";function a(a,t,o,e,n,r,i,c,s,l,u,d,m,f,p){var v=r("lancamentos");return{create:function(a){return v.insert(a).then((function(a){return t.showSimple("Lançamento criado"),a}))},update:g,delete:function(a,o){return v.delete(a,{todos:o}).then((function(a){return t.showSimple("Lançamento excluído"),a}))},createAgrupamento:function(a){return a.agrupar=!0,n.post("/lancamentos/agrupar",a).then((function(a){return t.showSimple("Lançamentos agrupados"),c.notify(),a}))},novo:function(a,t){if("g"==a.tipo)return m.dialogPlanoBasico((function(){return h(a,t)}));if(a.conta){if("CARTAOCREDITO"==i.get("contas",a.conta,!0).tipo)return m.dialogPlano("cartoes",(function(){return h(a,t)}));for(var o=i.contas.filter((function(a){return a.status})).slice(0,m.usuario.plano.permissoes.ncontas),e=!1,n=0;n<o.length;n++)if(o[n].id==a.conta){e=!0;break}if(!e)return m.dialoPlanoInvalido()}return h(a,t)},editar:h,detalharEdicao:function(t,o){return a.show({id:"edicao-grupo",escapeToClose:!1,controller:"EdicaoLancamentoDetalharController",controllerAs:"vm",bindToController:!0,locals:{lancamento:angular.copy(t),indexDetalhe:o},templateUrl:"/partials/lancamentos/editarGrupo.html"})},parcelamentoEdicao:function(t){return a.show({id:"edicao-parcelas",controller:"EdicaoLancamentoParcelamentoController",controllerAs:"vm",locals:{lancamento:angular.copy(t)},templateUrl:"/partials/lancamentos/opcoesParcelamento.html"})},reconhecer:function(a){return h(a,{reconhecer:!0})},confirmar:function(a){return h(a,{confirmar:!0})},confirmarParcial:function(a){return h(a,{confirmar:!0,parcial:!0})},conciliar:function(a){if(!a.dataEfetiva)return h(a,{confirmar:!0,conciliar:!0});return a.dataConciliacao=a.dataEfetiva,g(a)},excluir:function(t){return a.show({id:"excluir-lancamento",controller:"ExcluirLancamentoController",controllerAs:"vm",templateUrl:"/partials/lancamentos/excluirLancamento.html",resolve:{lancamento:function(){return c.get(t.id)}},clickOutsideToClose:!0})},clonar:function(a){return h(a,{clonar:!0})},estornar:function(a){return h(a,{estornar:!0})},conciliacao:function(a){return n.post("/lancamentos/conciliacao",a).then((function(){var t=i.notify("contas");c.notify(t);const o=i.get("contas",a.conta,!0);o.saldoUltimoExtrato=a.saldo,o.dataUltimoExtrato=moment().format("YYYY-MM-DD")}))},importar:function(a,t){var o=t||{};return o.lancamentos=a,n.post("/lancamentos/importar",o).then((function(a){return c.notify(a)}))},exportar:function(t,o){return a.show({id:"exportar-lancamento",templateUrl:"/partials/lancamentos/exportarLancamentos.html",controller:"ExportarLancamentosController",controllerAs:"vm",resolve:{colunasExportacao:["contatosService",function(a){return c.getListaColunasExportacao()}]},locals:{ids:t,paginator:o}})},edicaoSaldo:function(t){return a.show({id:"edicao-saldo",controller:"EditarSaldoController",controllerAs:"vm",templateUrl:"partials/lancamentos/editarSaldo.html",locals:{conta:t},bindToController:!0})},editarLote:function(o,e){return a.show({id:"editar-lote",templateUrl:"/partials/lancamentos/lote/editar.html",controller:"EditarLancamentosLoteController",controllerAs:"vm",bindToController:!0,locals:{quantidade:o.length,params:e,acao:function(a,e){return c.batchUpdate(o,a,e).then((function(){var a=1==o.length?"":"s";t.showSimple(o.length+" lançamento"+a+" atualizado"+a)}))}}})},confirmarLote:b,conciliarLote:function(a){return b(a,!0)},desconciliarLote:function(o){return a.show({id:"desconciliar-lote",templateUrl:"/partials/lancamentos/lote/desconciliar.html",controller:"DesconciliarLancamentosLoteController",controllerAs:"vm",bindToController:!0,locals:{quantidade:o.length,acao:function(){return c.batchDesconcilia(o).then((function(){var a=1==o.length?"":"s";t.showSimple(o.length+" lançamento"+a+" desconciliado"+a)}))}}})},agruparLote:function(a){return m.dialogPlanoBasico((function(){return C(a,{detalhar:!0})}))},excluirLote:function(o){return a.show({id:"excluir-lote",templateUrl:"/partials/lancamentos/lote/excluir.html",controller:"ExcluirLancamentosLoteController",controllerAs:"vm",bindToController:!0,locals:{quantidade:o.length,acao:function(a){return c.batchDelete(o,a).then((function(){var a=1==o.length?"":"s";t.showSimple(o.length+" lançamento"+a+" excluído"+a)}))}}})},detalhar:function(t,e){return e=angular.isUndefined(e)||!0===e,a.show({id:"edicao-lancamento",templateUrl:"/partials/lancamentos/detalharLancamento.html",controller:["$state","$mdDialog","cadastrosDatasource","usuariosService",function(a,o,e,n){var r=this;r.perm=!t.conta||!n.hasRest("lancamentos",t.conta,"g"),r.cartao="CARTAOCREDITO"==e.get("contas",r.l.conta,!0).tipo,r.editar=o.hide,r.dismiss=o.cancel}],controllerAs:"vm",bindToController:!0,locals:{l:t,permitirAcoes:e,configuracoesService:s}}).then((function(){o.go(".lancamentosEditar",t)}))},desconfirmarLote:function(o){return a.show({id:"desconfirmar-lote",templateUrl:"/partials/lancamentos/lote/desconfirmar.html",controller:"DesconfirmarLancamentosLoteController",controllerAs:"vm",bindToController:!0,locals:{quantidade:o.length,acao:function(){return c.batchDesconfirma(o).then((function(){var a=1==o.length?"":"s";t.showSimple(o.length+" lançamento"+a+" desconfirmado"+a)}))}}})},avancarFaturaLote:function(a){return A(a,1)},voltarFaturaLote:function(a){return A(a,-1)},duplicidades:function(a,t,o){return c.duplicidades(a,t,o)},atualizarValoresGrupo:function(a,t){return c.atualizarValoresGrupo(a,t)},ungroupLancamentos:function(o){return a.show({id:"desagrupar-detalhes",templateUrl:"/partials/lancamentos/desagruparLancamentos.html",controller:"DesagruparLancamentosController",controllerAs:"vm",bindToController:!0,locals:{acao:function(){var a=o.id;return n.post("/lancamentos/desagruparDetalhes",{idGrupo:a}).then((function(){c.notify(),t.showSimple("Lançamentos desagrupados")}))}}})}};function g(a,o){return a.todos=o,v.update(a).then((function(a){return t.showSimple("Lançamento atualizado"),a}))}function h(t,o){return f(),t.base&&delete(t=t.base).base,t.idMeta&&!t.id?l.get(t.idMeta).then((function(a){if(t.tipo=t.tipo||"t","t"!=t.tipo)t.conta=a.contas[0].conta,t.metaEconomia=a.id;else{t.categoria=t.categoria||d.getCategoriaTipoLancamento(u.APLICACAO).id;for(var o=d.get(t.categoria),n=i.get("contas",a.contas[0].conta,!0),r=0;r<a.contas.length;r++){if("INVESTIMENTO"==i.get("contas",a.contas[r].id,!0).tipo)break}o.tipoL==u.RESGATE?(t.contaOrigem=n.id,t.metaEconomiaOrigem=a.id):(t.contaDestino=n.id,t.metaEconomiaDestino=a.id),"INVESTIMENTO"!=n.tipo&&(t.categoria=d.getCategoriaTipoLancamento(u.TRANSFERENCIA).id)}return e()})):e();function e(){var e=!(!t||!t.id||o&&(o.clonar||o.estornar));return o=angular.extend({editar:e,criacao:!e},o||{}),e||o.clonar||o.estornar?c.get(t.id,o.estornar).then((function(t){if(t=angular.copy(t),o.clonar||o.estornar){if(t._id=t._id||t.id,t.id=null,t.detalhes)for(var e=0;e<t.detalhes.length;e++)t.detalhes[e]._id=t.detalhes[e]._id||t.detalhes[e].id,t.detalhes[e].id=null;t.fatura=null}return"i"==t.tipo?function(t){return a.show({id:"edicao-lancamento",controller:"EditarLancamentoInicialController",controllerAs:"vm",templateUrl:"/partials/lancamentos/editarLancamentoInicial.html",locals:{lancamento:t},resolve:{conta:["cadastrosDatasource",function(a){return a.get("contas",t.conta)}]}})}(t):n(t)})):n(t);function n(a){return C(a,o)}}}function C(t,o){return a.show({id:"edicao-lancamento",escapeToClose:!1,controller:"EditarLancamentoController",controllerAs:"vm",templateUrl:"/partials/lancamentos/editarLancamento.html",locals:{acao:o,lancamento:t}})}function b(o,e){return a.show({id:"confirmar-lote",templateUrl:"/partials/lancamentos/lote/confirmar.html",controller:"ConfirmarLancamentosLoteController",controllerAs:"vm",bindToController:!0,locals:{quantidade:o.length,conciliar:e,acao:function(a){return c.batchConfirm(o,a,e).then((function(){var a=1==o.length?"":"s";t.showSimple(o.length+" lançamento"+a+(e?" conciliado":" confirmado")+a)}))}}})}function A(o,e){return a.show({id:"mover-fatura",templateUrl:"/partials/lancamentos/lote/moverFatura.html",controller:"MoverFaturaLancamentosLoteController",controllerAs:"vm",bindToController:!0,locals:{quantidade:o.length,incr:e,acao:function(a){return c.batchMoverFatura(o,e,a).then((function(){var a=1==o.length?"":"s";t.showSimple(o.length+" lançamento"+a+" movido"+a)}))}}})}}a.$inject=["$mdDialog","$mdToast","$state","$stateParams","$http","mdwResource","cadastrosDatasource","lancamentosDatasource","configuracoesService","metaseconomiaDatasource","TIPO_LANCAMENTO","categoriasDatasource","usuariosService","mdwDialogLoading","$q"],angular.module("md").constant("TIPO_LANCAMENTO",{INVESTIMENTOS:31,RENDIMENTO:1,DIVIDENDOS:2,JUROS:3,IOF:4,IR:5,CUSTOS_OPERACIONAIS:6,PERDAS_INVESTIMENTOS:7,CUSTODIA:8,COMPRA:9,VENDA:10,APLICACAO:11,RESGATE:12,TRANSFERENCIA:15,JCP:16,LIQUIDO_NOTA:17,PAGAMENTO_CARTAO:18,SAQUE:19}).factory("lancamentosService",a)}(),function(){"use strict";function a(a,t,o){var e=this;e.ok=function(){return e.acao(e.projetarData?null:t(e.data).format("YYYY-MM-DD")).then((function(){return o.transactionEntryAdjusted("Lote",e.conciliar?"Conciliado":"Confirmado"),a.hide()}))},e.hoje=t().endOf("day"),e.data=t(),e.projetarData=!0}a.$inject=["$mdDialog","moment","mdwAnalytics"],angular.module("md").controller("ConfirmarLancamentosLoteController",a)}(),function(){"use strict";function a(a,t){var o=this;o.ok=function(){return o.acao(null).then((function(){return t.transactionEntryAdjusted("Lote","Confirmado"),a.hide()}))}}a.$inject=["$mdDialog","mdwAnalytics"],angular.module("md").controller("DesconciliarLancamentosLoteController",a)}(),function(){"use strict";function a(a,t){var o=this;o.ok=function(){return o.acao(null).then((function(){return t.transactionEntryAdjusted("Lote","Pendente"),a.hide()}))}}a.$inject=["$mdDialog","mdwAnalytics"],angular.module("md").controller("DesconfirmarLancamentosLoteController",a)}(),function(){"use strict";function a(a,t,o,e){var n=this;n.ok=function(){return a.show({controller:["$mdDialog",function(a){this.ok=function(){a.hide(this.alteracao)}}],controllerAs:"vm",templateUrl:"/partials/lancamentos/lote/modoEdicaoLancamentoParcelado.html",id:"modo-edicao-lancamento-parc"}).then((function(t){var o={};return angular.forEach(n.l,(function(a,t){"dataPrevista"===t||"dataEfetiva"===t||"dataCompetencia"===t?a&&(o[t]=a.format("YYYY-MM-DD")):null!==a&&(o[t]=!!a&&(a||null))})),n.acao(o,2==t).then(a.hide)}))},n.hoje=t().endOf("day"),n.data=t(),n.projetarData=!0,n.anexarDocumentos=function(){e.anexar().then((function(a){a&&(n.l.anexos=n.l.anexos||[],a=a.filter((function(a){for(var t=!1,o=0;o<n.l.anexos.length;o++)if(n.l.anexos[o]==a){t=!0;break}return!t})),n.l.anexos=n.l.anexos.concat(a))}))},n.contasPR="1",n.configuracoesService=o,n.l={dataPrevista:null,dataEfetiva:null,dataCompetencia:null,contaOrigem:null,contaDestino:null,categoriaD:null,categoriaR:null,centro:null,projeto:null,exibirCp:null,exibirCr:null,forma:null,contato:null,plastico:null,tags:null,observacoes:null},n.toggleContasPR=function(){"2"==n.contasPR&&(n.l.exibirCp=!0,n.l.exibirCr=!0),"3"==n.contasPR&&(n.l.exibirCp=!1,n.l.exibirCr=!1)}}a.$inject=["$mdDialog","moment","configuracoesService","documentosService"],angular.module("md").controller("EditarLancamentosLoteController",a)}(),function(){"use strict";function a(a){var t=this;t.ok=function(){return t.acao(2==t.alteracao).then(a.hide)},t.alteracao=1}a.$inject=["$mdDialog"],angular.module("md").controller("ExcluirLancamentosLoteController",a)}(),function(){"use strict";function a(a,t){var o=this;o.ok=function(){return o.acao(2==o.alteracao).then(a.hide)},o.hoje=t().endOf("day"),o.data=t(),o.alteracao=1}a.$inject=["$mdDialog","moment"],angular.module("md").controller("MoverFaturaLancamentosLoteController",a)}(),function(){"use strict";angular.module("md").service("selecaoLancamentosLote",["mdwTopmenu","lancamentosService",function(a,t){var o=!1;return window.addEventListener("keydown",(function(a){"Shift"==a.key&&(o=!0)})),window.addEventListener("keyup",(function(a){"Shift"==a.key&&(o=!1)})),function(a){return new e(a)};function e(e){var n,r=this,i=e.controller,c=r.getLancamentos=e.getLancamentos;function s(){return!angular.equals({},r.selected)}function l(){r.selected={},n=null,u()}function u(){s()?a.changeTemplateUrl(e.templateUrl,i,!0,!0):(n=null,a.restorePrevious(!0))}function d(){return Object.keys(r.selected).length}r.acaoLote=function(a,o){let e=[];if("agruparLote"==a){c().filter((function(a){return r.selected[a.id]})).forEach((function(a){a.detalhes?a.detalhes.forEach((function(t){const o=angular.copy(t);o.conta=a.conta,o.tags=a.tags,o.observacoes=a.observacoes,o.plastico=a.plastico,o.forma=a.forma,o.ndocumento=a.ndocumento,o.anexos=a.anexos,o.parcela=a.parcela,e.push(o)})):e.push(a)}))}else e=Object.keys(r.selected).filter((a=>"v"!=a[0]));if(!e.length)return;return t[a](e,o).then((a=>(l(),a)))},r.selected={},r.clearSelection=l,r.updateSelection=function(){if(!s())return;var a=c(),t={};angular.forEach(a,(function(a){r.selected[a._idLote]&&(t[a._idLote]=!0)})),r.selected=t,u()},r.hasSelection=s,r.countSelected=d,r.toggleSelected=function(a){if(o){if(n)for(var t,e=c(),i=!1,s=!!r.selected[a],l=0;l<e.length;l++){var d=e[l];if(!i){if(d._idLote!=a&&d._idLote!=n)continue;i=!0,t=d._idLote==a?n:a}if(s?r.selected[d._idLote]=!0:delete r.selected[d._idLote],d._idLote==t)break}}else r.selected[a]||delete r.selected[a];n=a,u()},r.toggleAll=function(){var a=c();d()==a.length?(r.selected={},u()):a.forEach((function(a){r.selected[a._idLote]=!0}))},r.valorSelected=function(){var a=0,t=c();return angular.forEach(t,(function(t){r.selected[t._idLote]&&(a+=t.valor)})),a}}}])}(),function(){"use strict";angular.module("md").directive("mdwDblclickLancamento",(function(){return a.$inject=["$scope","$state","$q","usuariosService"],{restrict:"A",require:"^mdwDblclickLancamento",scope:{lancamento:"=mdwDblclickLancamento",mdwDblclickDisabled:"=?"},bindToController:!0,controllerAs:"vm",controller:a,link:function(a,t,o,e){var n=angular.element(t),r=function(){e.clickCtrl.isPrevented()||e.clickCtrl.prevent(e.action())};n.bind("dblclick",r),a.$on("$destroy",(function(){n.unbind("dblclick",r)}))}};function a(a,t,o,e){var n=this;a.$watch("vm.lancamento",(function(){n.clickCtrl&&(n.clickCtrl.lancamento=n.lancamento)}),!0),n.register=function(a){n.clickCtrl=a,n.clickCtrl.lancamento=n.lancamento},n.action=function(){var a=n.lancamento;n.mdwDblclickDisabled||a.operacaoInvestimento||a.projecaoFatura||!e.hasRest("lancamentos",a.conta,"g")&&!e.hasRest("lancamentos",a.contaT,"g")&&t.go(".lancamentosEditar",a);return o.resolve()}}})).directive("mdwClickLancamento",(function(){return a.$inject=["$timeout","$q","$state","lancamentosService"],{restrict:"A",require:["^mdwDblclickLancamento","mdwClickLancamento"],controller:a,link:function(a,t,o,e){var n=angular.element(t),r=e[1];r.parentCtrl=e[0],e[0].register(r);var i=function(){r.isPrevented()||r.prevent(r.action())};n.bind("click",i),a.$on("$destroy",(function(){n.unbind("click",i)}))}};function a(a,t,o,e){var n=this,r=!1;n.prevent=function(o){r=!0;var e=a(angular.noop,500);t.all([e,t.when(o)]).finally((function(){r=!1}))},n.isPrevented=function(){return r},n.action=function(){return n.parentCtrl.mdwDblclickDisabled?t.resolve():n.lancamento.projecaoFatura?o.go("fatura.listar",{conta:n.lancamento.projecaoFatura,inicio:n.lancamento.dataPrevista}):e.detalhar(n.lancamento)}}}))}(),function(){"use strict";angular.module("md").component("mdwStatusLancamento",{template:'<span class="status-lancamento" ng-class="$ctrl.status"></span>',bindings:{status:"=",l:"=?l"},controller:["$scope","moment",function(a,t){}]}).component("mdwStatusLancamentoFatura",{template:'<span class="status-lancamento" ng-class="$ctrl.status"></span>',bindings:{l:"="},controller:["$scope",function(a){var t=this;t.$onInit=function(){t.status="p"==t.l.tipo?t.l.status:t.l.conciliado?"conciliado":"nconciliado",a.$watch("$ctrl.l.status",(function(a){t.status="p"==t.l.tipo?t.l.status:t.l.conciliado?"conciliado":"nconciliado"}),!0)}}]}).component("mdwStatusLancamentoHolder",{template:'<span class="status-lancamento"></span>'})}(),function(){"use strict";function a(a,t){if(!a)return"";var o=function(){if(!a.agenda)return{text:"Repetir",tip:"Definir repetição"};var t=a.agenda;if(-1==t.quantidade)return a.id?e("fixa",r()+" fixa"):1==t.frequencia?e("fixa "+n(),r()+" fixa "+n()):e("fixa a cada "+t.frequencia+" "+n(!0),r()+" fixa a cada "+t.frequencia+" "+n(!0));var o="";t.inicial>1&&(o=" com parcela inicial "+t.inicial);if(1==t.frequencia)return e(t.quantidade+"x "+n(!1,!0),r()+" "+n()+" parcelada em "+t.quantidade+"x"+o);return e(t.quantidade+"x a cada "+t.frequencia+" "+n(!0),r()+" parcelada em "+t.quantidade+"x com repetição a cada "+t.frequencia+" "+n(!0)+o);function e(a,t){return{text:a,tip:t}}function n(a,o){switch(t.intervalo){case"d":return a?"dias":o?"diárias":"diária";case"M":return a?"meses":o?"mensais":"mensal";case"w":return a?"semanas":o?"semanais":"semanal";case"y":return a?"anos":o?"anuais":"anual"}}function r(){return"d"==a.tipo?"despesa":"r"==a.tipo?"receita":"transferência"}}();return t?o.tip:o.text}angular.module("md").filter("textoParcelamento",(function(){return a}))}(),function(){"use strict";function a(a,t,o,e){var n=this;n.login=e.usuario.login,n.form={email:n.login.email,senha:"",persistente:!1};var r=platform.os.family;-1!=r.search(/.*(windows).*/i)&&(r=r.replace(/.*(windows).*/i,"$1")),n.form.device=r+" "+platform.os.version,n.form.version=platform.name+" "+platform.version,n.authenticate=function(){return n.loading=!0,a.post("/usuarios/login",n.form).then((function(a){return t.hide(a.data)})).catch((function(){location.reload(),n.loading=!1}))}}a.$inject=["$http","$mdDialog","$mdToast","usuariosService"],angular.module("md").controller("LoginAuthenticateController",a)}(),function(){"use strict";function a(a,t,o){var e=this;e.login=o.usuario.login,e.form={email:e.login.email,nome:e.login.nome,senha:"Senha do usuario"}}a.$inject=["$scope","$mdDialog","usuariosService"],angular.module("md").controller("LoginConfiguracoesController",a)}(),function(){"use strict";function a(a,t){var o=this;o.usuario=t.usuario,o.contas=angular.copy(t.usuarios),o.contas.unshift(t.usuario),o.linkCancelamentoLogin=!0;for(var e=0;e<o.contas.length;e++)if(1!=o.contas[e].papel){o.linkCancelamentoLogin=!1;break}function n(e,n){a.show({id:"inativar-conta",templateUrl:"partials/login/inativar.html",locals:{conta:e,reativar:n},bindToController:!0,controllerAs:"vm",controller:["$http","$timeout","$mdToast","usuariosService",function(t,o,r,i){var c=this;c.mesmoUsuario=!e||i.usuario.conta.id==e.id,c.inativar=function(){var e={cid:c.conta&&c.conta.id,senha:c.senha};return t.post("usuarios/"+(n?"reativar":"inativar")+"conta",e,{handleErrors:!1}).then((function(){c.mesmoUsuario?location.href="/sair":(r.showSimple("Conta "+(n?"reativada":"inativada")+" com sucesso"),a.hide())}),(function(a){c.error=a.status,o((function(){delete c.error}),2e3)}))}}]}).then((function(){for(var a=0;a<t.usuarios.length;a++)if(t.usuarios[a].conta.id==e.id){t.usuarios[a].conta.status=!!n;break}o.contas=angular.copy(t.usuarios),o.contas.unshift(t.usuario)}))}o.inativarConta=n,o.inativarLogin=n,o.reativarConta=function(a){return n(a,!0)}}a.$inject=["$mdDialog","usuariosService"],angular.module("md").controller("LoginContasController",a)}(),function(){"use strict";function a(a,t,o,e){var n=this;o.title="Configurações de acesso",n.login=e.usuario.login,n.usuarioService=e,n.validadorPlano=e.validarPlanoAtual()}a.$inject=["$scope","$mdDialog","mdwTopmenu","usuariosService"],angular.module("md").controller("LoginController",a)}(),function(){"use strict";angular.module("md").filter("loginNome",["usuariosService",function(a){return function(t){return a.getUsuarioConta(t).login.nome}}])}(),function(){"use strict";function a(a,t,o,e,n,r){var i=this;function c(){return r.carregarSessoes().then((function(a){i.sessoes=a}))}function s(n){return o.show({id:"alterar-senha",templateUrl:"/partials/login/alterarSenha.html",controllerAs:"vm",controller:function(){var t=this;t.form={senhaAntiga:"",senhaNova:"",senhaNovaC:"",validade:!!n},t.ok=function(){return a.post("/apiweb/usuarios/alterarSenha",t.form).then((function(a){var t=a.data;return i.login.ultima_alteracao_senha=t.ultima_alteracao_senha,i.login.validade_senha=t.validade_senha,o.hide()}))},t.passvalid=r(),t.onChangeSenha=function(){t.passvalid=r(t.form.senhaNova)}}}).then((function(){e.showSimple("Senha alterada com sucesso. Você será deslogado..."),t((function(){location.href="/"}),1e3)}));function r(a){a||(a="");var t=a.length>=8,o=/[A-Z]/.test(a),e=/[a-z]/.test(a),n=/\d/.test(a),r=/\W/.test(a);return{length:t,upper:o,lower:e,number:n,symbol:r,_valid:t&&o&&e&&n&&r}}}i.login=n.usuario.login,i.form={email:i.login.email,nome:i.login.nome,senha:"Senha do usuario",mfa:i.login.mfa,validade:!!i.login.validade_senha},i.validadorPlano=n.validarPlanoAtual(),i.alterarNome=function(){i.alterando&&i.login.nome!=i.form.nome&&a.post("/apiweb/usuarios/alterarNomeLogin",{nome:i.form.nome}).then((function(){i.login.nome=i.form.nome,e.showSimple("Nome alterado com sucesso")}));i.alterando=!i.alterando},i.alterarSenha=s,i.alterarEmail=function(){return o.show({id:"alterar-email",templateUrl:"/partials/login/alterarEmail.html",controllerAs:"vm",bindToController:!0,controller:function(){var t=this;t.form={emailAntigo:t.emailAntigo,email:""},t.ok=function(){return a.post("/apiweb/usuarios/emailAlterarEmail",t.form).then((function(){return o.hide({email:t.form.email})}))}},locals:{emailAntigo:i.login.email}}).then((function(a){o.show({id:"alterar-email-confirmacao",templateUrl:"/partials/login/alterarEmailConfirmacao.html",controllerAs:"vm",bindToController:!0,controller:t,locals:{email:a.email}}).then((function(){i.login.email=a.email,e.showSimple("Email alterado com sucesso")}))}));function t(){var t=this;t.form={crypto:"",email:t.email},t.ok=function(){return a.post("/apiweb/usuarios/alterarEmail",t.form).then(o.hide)}}},i.toggleMfa=function(){return t.$inject=["$mdDialog","$timeout"],o.show({id:"dialog-mfa",templateUrl:"/partials/login/mfa.html",controllerAs:"vm",bindToController:!0,controller:t,closeOnEscape:!1,locals:{mfa:i.form.mfa}}).then((function(){i.login.mfa=i.form.mfa,i.validadorPlano=n.validarPlanoAtual(!0)})).catch((function(){i.form.mfa=!i.form.mfa}));function t(t,o){var n=this;n.dismiss=t.cancel,n.ok=t.hide,n.ativar=function(){return n.loading=!0,a.post("/apiweb/usuarios/mfa").then((function(t){(n.token=t.data.token,a.get(t.data.uri,{responseType:"blob"}).then((function(a){var t=new FileReader;t.readAsDataURL(a.data),t.onload=function(a){o((function(){n.qrcode=a.target.result,n.loading=!1}),0)}})),Clipboard)&&new Clipboard("#copiar").on("success",(function(){e.showSimple("Copiado para área de transferência")}))}))},n.validar=function(){return n.erroValidacao=!1,a.post("/apiweb/usuarios/mfa/ativar",{mfa:n.mfaCode}).then((function(a){if(0!=a.data.s)return e.showSimple("MFA ativado com sucesso"),t.hide();n.erroValidacao=!0}))},n.desativar=function(){return a.post("/apiweb/usuarios/mfa/desativar",{senha:n.senha}).then((function(a){t.hide()}))}}},i.toggleValidade=function(){if(i.form.validade&&(!i.login.ultima_alteracao_senha||moment(i.login.ultima_alteracao_senha).add(90,"days").isBefore()))return s(!0).then((function(){i.validadorPlano=n.validarPlanoAtual(!0)}),(function(){i.form.validade=!1}));return o.show({id:"alterar-senha",templateUrl:"/partials/login/alterarValidadeSenha.html",controllerAs:"vm",controller:["$http",function(a){var t=this;t.ok=function(){return a.post("/apiweb/usuarios/alterarValidadeSenha",{senha:t.senha}).then((function(a){var t=a.data;return i.login.ultima_alteracao_senha=t.ultima_alteracao_senha,i.login.validade_senha=t.validade_senha,o.hide()}))}}]}).then((function(){i.validadorPlano=n.validarPlanoAtual(!0)}),(function(){i.form.validade=!i.form.validade}))},i.$onInit=function(){c()},i.desconectarSessao=function(t){return o.show(o.confirm().textContent("Deslogar "+(t?"desta sessão":"de todas as sessões")+"?").ok("Deslogar").cancel("Cancelar")).then((function(){var o={};return t&&(o.id=t),a.post("usuarios/sessoes/desconectar",o).then((function(){if(t)return c();location.href="/"}))}))}}a.$inject=["$http","$timeout","$mdDialog","$mdToast","usuariosService","loginService"],angular.module("md").controller("LoginGeralController",a)}(),function(){"use strict";function a(a,t){var o=this;o.loading=!0,o.maxDate=moment().format("YYYY-MM-DD"),o.minDate=moment().subtract(30,"days").format("YYYY-MM-DD"),o.data=a.inicio||moment().format("YYYY-MM-DD"),o.data<o.minDate?o.data=o.minDate:o.data>o.maxDate&&(o.data=o.maxDate);t.carregarHistoricosAcesso({inicio:o.data}).then((function(a){o.historicos=a,o.loading=!1}))}a.$inject=["$stateParams","loginService"],angular.module("md").controller("LoginHistoricoController",(function(){var a=this;a.maxDate=moment(),a.minDate=moment().subtract(30,"days"),a.calendarioConfig={restrict:["d"],interval:"d"}})).controller("LoginHistoricoListaController",a)}(),function(){"use strict";function a(a,t,o){var e=this;e.loading=!0,e.iniciarPdi=function(){return o.iniciarPdi()},o.carregarIndicacoes().then((function(a){e.loading=!1,e.indicacoes=a,0==a.length&&e.iniciarPdi()}))}a.$inject=["$q","$mdToast","loginService"],angular.module("md").controller("LoginIndicacoesController",a)}(),function(){"use strict";function a(a,t){t.state({id:"login",title:"Configurações de login",templates:["partials/login/login.html","partials/login/geral.html","partials/login/contas.html","partials/login/historico.html"]},{abstract:!0,url:"/acesso",templateUrl:"partials/login/login.html",controller:"LoginController",controllerAs:"vm"}),a.state("login.geral",{url:"",templateUrl:"partials/login/geral.html",controller:"LoginGeralController",controllerAs:"vm"}).state("login.contas",{url:"/contas",templateUrl:"partials/login/contas.html",controller:"LoginContasController",controllerAs:"vm"}).state("login.historico",{abstract:!0,url:"/historico",templateUrl:"partials/login/historico.html",controller:"LoginHistoricoController",controllerAs:"vm"}).state("login.historico.lista",{url:"?inicio",templateUrl:"partials/login/historico_lista.html",controller:"LoginHistoricoListaController",controllerAs:"vm"}).state("login.indicacoes",{url:"/indicacoes",templateUrl:"partials/login/indicacoes.html",controller:"LoginIndicacoesController",controllerAs:"vm"})}a.$inject=["$stateProvider","mdwBaseStateProvider"],angular.module("md").config(a)}(),function(){"use strict";function a(a,t,o){var e=this;e.carregarHistoricosAcesso=function(t){return a.get("/usuarios/historicosLogin",{params:t}).then((function(a){return a.data}))},e.carregarIndicacoes=function(){return a.get("/usuarios/indicacoesLogin",{cache:!0}).then((function(a){return a.data}))},e.carregarSessoes=function(){return a.get("/usuarios/sessoes").then((function(a){return a.data}))},e.refazerLogin=function(){return o.toggle(!1),t.show({id:"refazer-login",templateUrl:"/partials/login/authenticate.html",controller:"LoginAuthenticateController",controllerAs:"vm",bindToController:!0,escapeToClose:!1}).then((function(a){return a.access_token}))},e.desconectar=function(t){return a.post("/usuarios/desconectar",{hid:t})},e.iniciarPdi=function(){return t.show({id:"pdi",wait:!0,templateUrl:"partials/login/pdi.html",controllerAs:"vm",controller:["$mdConstant","$http","$mdToast","$timeout",function(a,t,o,e){var n=this;n.emails=[],n.keys=[a.KEY_CODE.ENTER,a.KEY_CODE.COMMA],n.onAddChip=function(a){if(!a.match(/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/))return null},n.url=!1,t.get("/apiweb/urlpdi",{cache:!0}).then((function(a){Clipboard&&(n.url=a.data.id,new Clipboard("#copiar").on("success",(function(){o.showSimple("Copiado para área de transferência")})));n.fb=function(){FB.ui({method:"share",href:a.data.longUrl},(function(a){}))}})),n.sendEmail=function(){return t.post("/apiweb/emailpdi",{emails:n.emails}).then((function(){o.showSimple((n.emails.length>1?"Convites enviados":"Convite enviado")+" com sucesso"),n.emails=[]}))}}]})},e.abrirTicket=function(){return t.show({id:"ticket",templateUrl:"partials/login/ticket.html",controllerAs:"vm",controller:["$http","$q","usuariosService","FileUploader","mdwAnalytics",function(a,t,o,e,n){var r=this;r.contatoEquipe=!1,r.urlSuporte=document.location.href.replace("//app","//suporte").replace(/(\/u\/\d+\/?).*/,"$1"),r.uploader=new e({url:"/",autoUpload:!1,withCredentials:!0}),r.email=o.usuario.login.email,r.chamado={assunto:"",mensagem:"",anexos:[]},r.setPrioridade=function(){1!=r.chamado.tipo&&null!==r.chamado.tipo&&(r.contatoEquipe=!0),r.chamado.prioridade||(r.chamado.prioridade=2==r.chamado.tipo?2:4)},r.comunicarEquipe=function(){r.contatoEquipe=!0},r.ok=function(){var o=r.uploader.queue,e=t.defer(),i=function(){return a.post("usuarios/ticket",r.chamado).then((function(a){a.data;r.enviado=!0;var t="Outros";1==r.chamado.tipo?t="Dúvida":2==r.chamado.tipo?t="Reportar problema":3==r.chamado.tipo?t="Elogio":4==r.chamado.tipo&&(t="Críticas e sugestões"),n.supportTicketOpened(t)}))};return o.length>0?(a.get("/usuarios/ticket/s3").then((function(a){var t=a.data,o=t.credentials;r.uploader.queue.forEach((function(a){var e=t.key+"/"+a.file.name.replace(/\,/g,"_");a.url=t.url,a.formData=[angular.extend({},o,{key:e,"Content-Type":a.file.type})],r.chamado.anexos.push(a.url+"/"+e)})),r.uploader.uploadAll()})),r.uploader.onErrorItem=function(a,t,o,n){r.erro="Falha ao realizar upload dos arquivos anexados",r.uploader.clearQueue(),e.reject()},r.uploader.onCompleteAll=function(a){e.resolve()},e.promise.then(i)):i()}}]})}}a.$inject=["$http","$mdDialog","mdwLeftmenu"],angular.module("md").service("loginService",a)}(),function(){"use strict";function a(a,t,o,e){var n=this;n.config={},n.utilizacao={},n.updateConfig=function(o,e){if(angular.isUndefined(n.config[o]))throw new Error("Chave "+o+" de configuração inexistente");if(angular.toJson(n.config[o])==angular.toJson(e))return t.when();return n.config[o]=angular.copy(e),a.put("/apiweb/atualizarConfig",{config:n.config}).then((function(){r.notify()}))},n.getConfig=function(a,t){var o=angular.isUndefined(n.config[a])?angular.merge(t):angular.extend(t,n.config[a]);return n.config[a]=angular.copy(o),o},n.setConfigUtilizacao=function(){n.config=e.usuario.config.mdweb||{},n.utilizacao=e.usuario.conta.config};var r=o();n.addObserverUtilizacao=r.add}a.$inject=["$http","$q","mdwObserver","usuariosService"],angular.module("md").service("configuracoesService",a)}(),function(){"use strict";function a(a,t,o,e,n,r,i,c,s,l,u,d){var m,f=this,p=this;f.items=[],f.opened=!1,f.usuario=r.usuario,f.init=function(){m=i.getConfig("mdwLeftMenu",{pinned:[],pinnedi:[],opened:[]}),v={},g=[],f.pinnedItems=[];var a,t=e.carregarCartoes(!0).map((function(a){return a.id})),o=e.carregarCartoes().map((function(a){return a.id})),n=e.carregarContasCaixa().map((function(a){return a.id}));f.items=[];var s=new b({id:"fechar_posicao",label:"Fechamento posição",perm:r.isAdmin(),action:function(){return h(!1),r.fecharPosicaoMensal()},icon:"lock"});if(d)f.items=[new b({id:"visaogeralinv",label:"Visão geral",href:"visaogeral",sref:"visaogeral",icon:"dashboard",pinnable:!0}),new b({id:"carteira",label:"Carteira de investimentos",href:"carteira",sref:"carteira",icon:"account_balance_wallet",pinLabel:"Carteira de investimentos",pinnable:!0})],(a=new b({id:"analise_carteira",label:"Análise da carteira",icon:"assignment_turned_in",pinnable:!0})).setItems([new b({id:"carteira_mensal",label:"Mensal",pinLabel:"Análise Mensal da Carteira",href:"analise/mensal",sref:"analise_mensal.dados",pinnable:!0}),new b({id:"carteira_evolucao",label:"Evolução",pinLabel:"Evolução da Carteira",href:"analise/evolucao",sref:"analise_evolucao.dados",pinnable:!0}),new b({id:"resultados",label:"Resultados financeiros",pinLabel:"Resultados financeiros da carteira",href:"analise/resultados",sref:"resultados.relatorio",pinnable:!0})]),f.items.push(a),f.items=f.items.concat([new b({id:"ativos",label:"Ativos",href:"ativos",sref:"ativos",icon:"book",pinnable:!0}),new b({id:"bp",label:"Balanço patrimonial",href:"bp/mensal",sref:"bp.mensal.dados",icon:"insert_chart",pinnable:!0}),new b({id:"rentabilidade",label:"Rentabilidade avançada",href:"rentabilidade",sref:"rentabilidade",icon:"timeline",pinnable:!0})]),f.items.push(new b({divider:!0})),(a=new b({id:"ir",label:"Imposto de Renda",svg:"calculator"})).setItems([new b({id:"air",label:"Apuração mensal",href:"ir",sref:"ir"}),new b({id:"dir",label:"Declaração anual",href:"declaracao",sref:"declaracao"}),new b({id:"gcap",label:"GCAP",href:"gcap/e",sref:"gcap.mes.e"})]),f.items.push(a),f.items=f.items.concat([new b({divider:!0}),new b({id:"historico",label:"Histórico de operações",href:"operacoes",sref:"operacoes.historico",icon:"history",pinLabel:"Histórico de operações",pinnable:!0}),new b({id:"extratoinv",label:"Extrato de contas",href:"extrato",sref:"extratoContas",icon:"subject",states:["extratoConta"],pinnable:!0}),new b({id:"notas",label:"Notas de corretagem",href:"notas",sref:"notas.historico",icon:"receipt",pinnable:!0}),new b({divider:!0}),new b({id:"estrategias",label:"Estratégias de alocação",href:"estrategias",sref:"estrategias",pinLabel:"Estratégias de alocação",icon:"group_work"}),new b({id:"contas",label:"Contas",href:"contas",sref:"contas",icon:"account_balance"}),new b({id:"documentos",label:"Documentos",perm:r.canView("outros.documentos"),href:"documentos",sref:"documentos.listar",icon:"description"}),s,new b({id:"configuracoes",label:"Configurações",href:"investimentos/configuracoes",sref:"configuracoes",pinLabel:"Configurações de investimentos",icon:"settings"}),new b({divider:!0}),new b({id:"financeiro",label:"Financeiro",href:"/u/"+r.usuario.id+"/visaogeral",target:"_self",postAction:function(){},icon:"monetization_on",pinnable:!0})]);else{f.items.push(new b({id:"visaogeral",label:"Visão geral",href:"visaogeral",sref:"visaogeral.paineis",icon:"dashboard",pinnable:!0})),a=new b({id:"caixa",label:"Movimentações e caixa",perm:!r.hasRest("contas",0,"v",n),icon:"show_chart",pinnable:!0});var l=r.canView("relatorios.contaspagar")?"pagar":"receber",u=r.canView("relatorios.contaspagar")?"pagas":"recebidas";a.setItems([new b({id:"lancamentos",label:"Lançamentos",perm:r.canView("relatorios.movimentacoes")&&!r.hasRest("lancamentos",0,"v",n),href:"caixa/lancamentos",sref:"caixalancamentos.listar",pinLabel:"Lançamentos de caixa"}),new b({id:"fluxo",label:"Fluxo",perm:r.canView("relatorios.fluxodecaixa")&&!r.hasRest("contas",0,"v",n),href:"caixa/fluxo",sref:"caixafluxo.listar",pinLabel:"Fluxo de caixa"}),new b({id:"pr",label:"A pagar e receber",perm:(r.canView("relatorios.contaspagar")||r.canView("relatorios.contasreceber"))&&!r.hasRest("lancamentos",0,"v",n),href:"caixa/pr/"+l,sref:"caixapr."+l,pinLabel:"Contas a pagar e receber"}),new b({id:"prr",label:"Pagas e recebidas",perm:(r.canView("relatorios.contaspagar")||r.canView("relatorios.contasreceber"))&&!r.hasRest("lancamentos",0,"v",n),href:"caixa/prc/"+u,sref:"caixaprc."+u,pinLabel:"Contas pagas e recebidas"})]),f.items.push(a),f.items.push(new b({id:"extrato",label:"Extrato de contas",perm:!r.hasRest("lancamentos",0,"v",t),href:"extrato",sref:"extratoContas",icon:"subject",states:["extratoConta"],pinnable:!0})),f.items.push(new b({id:"cartoes",label:"Cartões de crédito",perm:!r.hasRest("lancamentos",0,"v",o),href:"cartoes",states:["fatura"],icon:"credit_card",pinnable:!0})),(a=new b({id:"metas",label:"Metas",icon:"equalizer",perm:r.canView("metas"),pinnable:!0})).setItems([new b({id:"rd",label:"Orçamento",perm:r.canView("metas.rd"),href:"metas/despesa",sref:"metasrd.lista.despesa",pinLabel:"Metas de orçamento"}),new b({id:"metascentros",label:"Centros",perm:r.canView("metas.centros")&&i.utilizacao.centros,href:"metas/centros/despesa",sref:"metasc.lista.despesa",pinLabel:"Metas por centros"}),new b({id:"economia",label:"Economia",perm:r.canView("metas.economia"),href:"metas/economia",sref:"metaseconomia",pinLabel:"Metas de economia"})]),f.items.push(a),f.items.push(new b({id:"relatorios",label:"Relatórios",href:"relatorios",perm:r.canView("relatorios"),icon:"donut_small",pinnable:!0})),"JURIDICA"==r.usuario.conta.tipoPessoa&&r.canView("outros.carneleao")&&f.items.push(new b({id:"contabilidade",label:"Integração Contábil",svg:"balance-scale-solid",href:"contabilidade",sref:"contabilidade"})),r.canView("investimentos")&&(f.items=f.items.concat([new b({divider:!0}),new b({id:"investimentos",label:"Investimentos",href:"investimentos",target:"_self",postAction:function(){},icon:"trending_up",pinnable:!0})])),f.items=f.items.concat([new b({divider:!0})]),(a=new b({id:"cadastros",label:"Cadastros",icon:"label"})).setItems([new b({id:"categorias",label:"Categorias",href:"cadastros/categorias",sref:"categorias"}),new b({id:"centros",label:"Centros",perm:i.utilizacao.centros&&r.canView("cadastros.centros"),href:"cadastros/centros",sref:"centros"}),new b({id:"contas",label:"Contas",href:"cadastros/contas",sref:"contas.listar"}),new b({id:"contatos",label:"Contatos",perm:i.utilizacao.contatos&&r.canView("cadastros.contatos"),href:"cadastros/contatos",sref:"contatos.listar"}),new b({id:"formas",label:"Formas de pagamento",perm:i.utilizacao.formas&&r.canView("cadastros.formas"),href:"cadastros/formas",sref:"formas"}),new b({id:"projetos",label:"Projetos",perm:i.utilizacao.projetos&&r.canView("cadastros.projetos"),href:"cadastros/projetos",sref:"projetos"}),new b({id:"tags",label:"Tags",perm:i.utilizacao.tags&&r.canView("cadastros.tags"),href:"cadastros/tags",sref:"tags"})]),f.items.push(a),f.items=f.items.concat([new b({id:"documentos",label:"Documentos",perm:r.canView("outros.documentos"),href:"documentos",sref:"documentos.listar",icon:"description"}),new b({id:"propostas",label:"Propostas comerciais",perm:"JURIDICA"==r.usuario.conta.tipoPessoa&&r.canView("outros.propostas"),href:"propostas",sref:"propostas.listar",icon:"assignment",pinnable:!0}),new b({id:"regras",label:"Regras de preenchimento",perm:r.canView("outros.regras"),href:"regras",sref:"regras",icon:"style"}),new b({id:"carneleao",label:"Carnê Leão",svg:"paw",href:"carneleao",sref:"carneleao",perm:(2==r.usuario.plano.tipo||3==r.usuario.plano.tipo)&&r.canView("outros.carneleao")}),new b({id:"importar",label:"Importar lançamentos",perm:!r.hasRest("lancamentos",0,"g"),action:function(){return h(!1),c.escolhaArquivo()},icon:"file_upload"}),s,new b({id:"configuracoes",label:"Configurações de utilização",perm:r.isAdmin(),href:"configuracoes",sref:"configuracoes",icon:"settings"})])}},f.toggle=h,f.toggleGroup=function(a,t){a.expanded=angular.isUndefined(t)?!a.expanded:t,C()},f.togglePin=function(a,t){t.preventDefault(),t.stopImmediatePropagation(),a.pinned=!a.pinned,a.pinned?(f.pinnedItems.push(a),f.pinnedItems.sort((function(a,t){return o(g,a)>o(g,t)}))):f.pinnedItems.splice(o(f.pinnedItems,a),1);function o(a,t){for(var o=0;o<a.length;o++)if(a[o].id==t.id)return o;return-1}C()},f.pinnedItems=[];var v={},g=[];function h(a){f.opened=angular.isUndefined(a)?!f.opened:a}function C(){var a=[],t=[];angular.forEach(v,(function(o){o.pinnable&&o.pinned&&a.push(o.id),o.expanded&&t.push(o.id)}));var o={opened:t},e=d?"pinned":"pinnedi";o[d?"pinnedi":"pinned"]=a,o[e]=m[e],i.updateConfig("mdwLeftMenu",o)}function b(a){var t=angular.extend(this,{states:[]},a||{});function e(a){var t=d?"pinnedi":"pinned";a.pinned=-1!==m[t].indexOf(a.id),a.pinned&&a.perm&&p.pinnedItems.push(a)}angular.isUndefined(t.perm)&&(t.perm=!0),t.isActive=function(){for(var a=0;a<t.states.length;a++)if(o.current.name.match(new RegExp("^"+t.states[a]+"(..*)?$")))return!0;if(t.items)for(var e=0;e<t.items.length;e++){if(t.items[e].isActive())return!0}return!1},t.sref=t.sref||t.href,t.sref&&t.states.push(t.sref),v[t.id]=t,t.pinnable&&(t.pinIcon=t.icon,t.pinLabel=t.pinLabel||t.label,e(t)),g.push(t),t.setItems=function(a){t.items=a,t.expanded=-1!==m.opened.indexOf(t.id);var o=!1;a.forEach((function(a){g.push(a),a.id=t.id+a.id,a.perm=angular.isUndefined(a.perm)?t.perm:a.perm,a.perm&&(o=!0),t.pinnable&&(a.pinnable=!0,a.pinIcon=t.icon,a.pinLabel=a.pinLabel||a.label,e(a))})),t.perm&&(t.perm=o)}}}a.$inject=["$mdSidenav","$http","$state","contasService","cadastrosDatasource","usuariosService","configuracoesService","importacaoService","$rootScope","$mdDialog","$timeout","MD_INVEST_MOD"],angular.module("md").service("mdwLeftmenu",a)}(),function(){"use strict";function a(a,t,o,e,n,r,i,c,s,l,u,d,m,f,p,v,g,h,C,b,A,x){var S=this;S.leftmenu=s,S.topmenu=c,S.teste="teste",t.fbAsyncInit=function(){FB.init({appId:"382155878518031",status:!0,cookie:!0,xfbml:!0,version:"v2.4"})},u.$mdMedia=r,u.loadingMdConfig=!0,u.toastLoadingMdConfig=!0;var D=l.defer();u.loadingPromise=D.promise,d.setarUsuarioLogado(u.mdconfig),f.setConfigUtilizacao(),S.usuario=d.usuario;var $=l.defer();b.confirmacaoAutomatica().finally((function(){$.resolve(!0)}));var M=[m.carregar(),p.query(),C.carregarDisponiveis(),$.promise];A||n.isEnabled()&&M.push(o.carregarConexoes()),l.all(M).then((function(){x.identifyCurrentUser(!0).then((function(){x.startWelcomeTour()})),u.loadingMdConfig=!1,u.toastLoadingMdConfig=!1,c.init(),s.init(),v.carregarNaoLidas(),C.init().then((function(){D.resolve(!0)})),A?h.processarCarteira().then((function(){g.carregarEventosPendentes()})):e.startUpdate()})),u.$on("mdwUsuarioConfig",s.init),u.$on("mdwUsuarioPermissoes",s.init),i(d.registrarAcessoUsuario,36e5),d.registrarAcessoUsuario()}a.$inject=["MD_IN_PRODUCTION","$window","conexoesApi","conexoesUpdate","conexoesService","$mdMedia","$timeout","mdwTopmenu","mdwLeftmenu","$q","$rootScope","usuariosService","cadastrosDatasource","configuracoesService","metaseconomiaDatasource","notificacoesService","eventosCorporativosService","rentabilidadeDatasource","moedaService","lancamentosDatasource","MD_INVEST_MOD","mdwAnalytics"],angular.module("md").controller("mdMainController",a)}(),function(){"use strict";function a(a,t,o,e,n,r,i,c){var s,l=this;function u(t){var o=n.usuario.plano,e=moment().format("YYYY-MM-DD"),r=o.fim&&o.fim<e,i=o.cortesia,c=3==o.origem,s=0!=o.tipo&&!c;return o.fim&&(t.subscription_plan_validity=moment(o.fim).toDate()),!s||r||i?(t.subscription_credits=0,n.hasPagamentoConfirmado().then((function(a){t.subscription_status=a?"ex-assinante":"nunca pagou"}))):(t.subscription_status="assinante",t.subscription_credits=moment(o.fim).diff(e,"months")+1,a.when())}function d(a,t,e){if(!c){var r=angular.extend({account_identify_code:n.usuario.id},t||{});return e?u(r).then((function(){return o.track(a,r)})):o.track(a,r)}}function m(a,t,o){if(localStorage){const t="meudinheiro::daily_tracked_events",o=localStorage.getItem(t),e=moment().format("YYYY-MM-DD");let n={};if(o&&(n=angular.fromJson(o),n[a]&&e<=n[a]))return;n[a]=e,localStorage.setItem(t,angular.toJson(n))}return d(a,t,o)}l.identifyCurrentUser=function(a){var t,l=n.usuario,d=l.login.id;if(localStorage){var m=localStorage.getItem("meudinheiro::signup_completed_event");if(m){localStorage.removeItem("meudinheiro::signup_completed_event");var f=angular.fromJson(m);o.track("Sign Up Completed",f)}}return a?o.user().then((function(a){if(a&&a.userId)if(d==a.userId){var n=!0;if(a.traits){var r={};angular.forEach(p(),(function(t,o){r[o]=a.traits[o]})),n=angular.toJson(p())==angular.toJson(r)}localStorage&&n&&e==localStorage.getItem("meudinheiro::analyticsEnv")&&(t={plugins:{all:!1}})}else o.reset();return v(t)})):v();function p(){var a,t,o,e=l.conta.config,c="FISICA"==l.conta.tipoPessoa;void 0===s&&(s=n.usuarios.filter((function(a){return a.status})).length>0);try{c&&l.conta.dataNascimento&&moment(l.conta.dataNascimento).isValid()&&(a=moment(l.conta.dataNascimento).toDate())}catch(a){}try{l.conta.sexo&&l.conta.sexo.toUpperCase&&(t=l.conta.sexo.toUpperCase())}catch(a){}try{l.conta.dataCriacao&&moment(l.conta.dataCriacao).isValid()&&(o=moment(l.conta.dataCriacao).toDate())}catch(a){}var u=r.disponiveis.find((function(a){return a.id==i.utilizacao.moeda})).nome.toLowerCase(),d=n.usuario.plano,m=d.cortesia,f=m&&!!d.tipo,p=m&&d.inv_basico;d.planoVigente&&(d.planoVigente.tipo?f=!1:p=!1);var v=s?"":n.usuario.id;return{email:l.login.email,is_email_confirmed:!0,name:l.login.nome,district:l.conta.bairro,city:l.conta.cidade,state:l.conta.uf,signup_date:o,config_centros:e.centros,config_formas:e.formas,config_contatos:e.contatos,config_projetos:e.projetos,config_tags:e.tags,multiple_accounts:s,birthday:a,gender:t,default_currency:u,user_account_type:c?"física":"jurídica",finance_account_plan:{0:"gratuito",1:"pessoal",2:"profissional",3:"família",10:"empresarial 1",11:"empresarial 2",12:"empresarial 3"}[d.tipo],investment_plan:d.inv_basico,is_trial_user_finance:f,is_trial_user_investment:p,account_identify_code:v}}function v(a){return function(a,t,e){if(!c)return u(t).then((function(){return o.identify(a,t,e)}))}(d+"",p(),a)}},l.startWelcomeTour=function(){if(localStorage){var a="meudinheiro::display_welcome_tour",t=localStorage.getItem(a);t&&(moment().diff(t,"day")<7?(localStorage.setItem("mdw_first_tour_v3","v3"),o.runUsetiful()):localStorage.removeItem(a))}},l.checkGate=function(a,t){return o.ff(a,t)},l.askForWebPushPermission=function(){return o.askForWebPushPermission()},l.recordAdded=function(a){d("Record Added",{record_type:a})},l.accountSetupStarted=function(){d("Account Setup Started")},l.accountSetupCompleted=function(a,t){d("Account Setup Completed",{account_type:a,has_balance:t})},l.goalSetStarted=function(){d("Goal Set Started")},l.goalSetCompleted=function(a){d("Goal Set Completed",{goal_type:a})},l.moduleEnablementChanged=function(a,t){d("Module Enablement Changed",{module_name:a,module_new_status:t})},l.positionClosed=function(){d("Position Closed")},l.automationRuleSet=function(){d("Automation Rule Set")},l.transactionEntryAdded=function(a,t,o,e){m("Transaction Entry Added",{transaction_type:a,status:t,recurrence_type:o,transaction_date:e})},l.transactionEntryAdjusted=function(a,t,o,e,n){m("Transaction Entry Adjusted",{transaction_type:a,status:t,recurrence_type:o,transaction_date:e,transaction_file_duration:n})},l.transactionEntryFileAdded=function(a,t,o){m("Transaction Entry File Added",{file_format:a,transaction_file_date:t,transaction_file_duration:o})},l.transactionEntryFileAdjusted=function(a,t){m("Transaction Entry File Adjusted",{file_format:a,transaction_file_date:t})},l.subcriptionIntentViewed=function(){d("Subscription Intent Viewed",{},!0)},l.planPageViewed=function(){d("Plan Page Viewed",{},!0)},l.planPaymentViewed=function(a,t,o,e,n,r){d("Plan Payment Viewed",angular.extend({total_value:a,finance_plan:t,period:n,payment_type:r},o,e),!0)},l.planPaymentInserted=function(a,t,o,e,n,r,i){d("Plan Payment Inserted",angular.extend({payment_method:a,total_value:t,finance_plan:o,period:r,payment_type:i},e,n),!0)},l.thankYouPageViewed=function(a,t,o,e,r,i,c){var s=n.usuario;d("Thank You Page Viewed",angular.extend({payment_method:a,total_value:t,finance_plan:o,period:i,payment_type:c,name:s.login.nome,state:s.conta.uf,city:s.conta.cidade},e,r),!0)},l.personalInformationInserted=function(){d("Personal Information Inserted")},l.accountReseted=function(){d("Account Reseted")},l.supportTicketOpened=function(a){d("Support Ticket Oppened",{motive:a,support_origin_screen:t.current.name.replace(/\..+$/,"")})},l.supportSourceRequested=function(a){d("Support Source Requested",{support_channel:a,support_origin_screen:t.current.name.replace(/\..+$/,"")})}}a.$inject=["$q","$state","analytics","analyticsEnv","usuariosService","moedaService","configuracoesService","IS_ADMIN_ACCESS"],angular.module("md").service("mdwAnalytics",a)}(),function(){"use strict";function a(a,t){var o=this,e=t(),n=a.getConfig("dm",{a:0});o.active=n.a,o.onChange=e.add,o.toggle=function(){o.active=!o.active,e.notify(),n.a=o.active,a.updateConfig("dm",n)};var r=!1;o.handlePrint=function(){(o.active||r)&&(o.active=!o.active,r=!r,e.notify())},o.prepareChartOptions=function(a){a.backgroundColor="transparent";var t=o.active?"#eee":"#333";return a.vAxis||(a.vAxis={}),a.vAxis.gridlines||(a.vAxis.gridlines={}),a.vAxis.minorGridlines||(a.vAxis.minorGridlines={color:"transparent"}),a.vAxis.textStyle||(a.vAxis.textStyle={}),a.vAxis.baselineColor=o.active?"#888":"#999",a.vAxis.gridlines.color=o.active?"#333":"#ddd",a.vAxis.textStyle.color=t,a.hAxis||(a.hAxis={gridlines:{color:"red"}}),a.hAxis.textStyle||(a.hAxis.textStyle={}),a.hAxis.textStyle.color=t,a.legend&&(a.legend.textStyle||(a.legend.textStyle={}),a.legend.textStyle.color=t),a}}a.$inject=["configuracoesService","mdwObserver"],angular.module("md").service("mdwDarkModeService",a)}(),function(){"use strict";function a(a){return{restrict:"E",template:"<div ng-include='vm.url'></div>",controllerAs:"vm",controller:["$scope","$http","$sce","$state","mdwAnalytics","moment","mdwLeftmenu","mdwTopmenu","$stateParams","importacaoService","usuariosService","loginService","buscaService","MD_INVEST_MOD","mdwDarkModeService","conexoesService","conexoesUpdate",function(a,t,o,e,n,r,i,c,s,l,u,d,m,f,p,v,g){var h=this;h.topmenu=c,h.leftmenu=i,h.url=h.topmenu.getTemplateUrl(),h.urlSuporte=document.location.href.replace("//app","//suporte").replace(/(\/u\/\d+\/?).*/,"$1"),a.$on("$destroy",p.onChange((function(){h.theme=p.active?"dm":"default"}))),h.theme=p.active?"dm":"default",h.importacao=l,u.demoAvailable().then((function(a){if(h.linkExperimentar=f?a.inv:a.fin,!h.linkExperimentar){var t=r().format("YYYY-MM-DD"),o=u.usuario.plano.planoVigente||u.usuario.plano;r(o.fim).diff(r(t),"d")<10&&u.carregarPagamentos().then((function(a){a=a.filter((function(a){return 3==a.status}));var t=u.usuario.plano.fim;a.forEach((function(a){a.assinatura&&a.assinatura.fim>t&&(t=a.assinatura.fim)})),t<=u.usuario.plano.fim&&(h.linkAssinatura=a.length>0?"Renovar assinatura":"Assinar o Meu Dinheiro")}))}})),a.$watch("vm.topmenu.title",(function(a){h.title=o.trustAsHtml(a)}),!0),h.topmenu.onChangeTemplateUrl((function(t,o){h.url=t,a.parent=o})),h.buscarLancamentos=function(){m.prevState={name:e.current.name,params:angular.copy(s)},e.go("busca.lancamentos")},h.experimentar=c.experimentar,h.pdi=function(){return d.iniciarPdi()},h.ticket=function(){return d.abrirTicket()},h.supportEvent=function(a){n.supportSourceRequested(a)},h.toggleDM=function(){p.toggle()},h.cup=g.updateCtrl,h.conexoesEnabled=v.isEnabled()}]}}a.$inject=["$mdTheming"],angular.module("md").directive("mdwTopmenu",a)}(),function(){"use strict";t.$inject=["$sce","$mdDialog","$timeout","$state","$rootScope","$transitions","$stateParams","usuariosService","MD_INVEST_MOD"],angular.module("md").service("mdwTopmenu",t);var a="/partials/md/default-topmenu.html";function t(t,o,e,n,r,i,c,s,l){var u=this,d=a,m=[],f=!1;u.tabs=[],u.enabled=!0,u.title="",u.secondaryUrl=null,u.secondaryScope=null,u.investMod=l,u.init=function(){u.enabled=!0},u.onChangeTemplateUrl=function(a){m.push(a)},u.getTemplateUrl=function(){return d},u.changeTemplateUrl=g,u.restorePrevious=function(a){if(!a&&f)return g(f.url,f.parentScope);if(a&&p)return g(p[0],p[1]);g()},u.secondary=function(a,t){if(a==d)return;u.secondaryUrl=a,u.secondaryScope=t};var p,v=0;function g(t,o,e,n){if(!1===e&&(f=!1),e&&(f={url:t,parentScope:o}),t!=d){d=t||a,n||(p=[d,o]);for(var r=0;r<m.length;r++)m[r].call(this,d,o)}}r.$watch((function(){return u.title}),(function(a){a&&(a=a.replace(/<a.*?>(.+?)<\/a>/,"$1"),l&&(a+=" - Investimentos"),s.usuarios&&s.usuarios.length>0&&s.usuario&&(a=s.usuario.conta.nome+" - "+a),r.pageTitle=t.trustAsHtml(a))})),i.onSuccess({},(function(){var a={};u.preservStateParams&&(a=c),angular.forEach(u.tabs,(function(t){t.active=n.current.name==t.state,!1!==t.preserve&&(t.params=a)})),f||g()})),u.setTabs=function(a,t){v++,u.tabs=[],e((function(){u.tabs=t;var a={};u.preservStateParams&&(a=c),angular.forEach(t,(function(t){t.active=n.current.name==t.state,!1!==t.preserve&&(t.params=a)}))})),a.$on("$destroy",(function(){--v<=0&&(u.tabs=[])}))},u.setTitle=function(a){if(angular.isArray(a)){var t=[];angular.forEach(a,(function(a){angular.isObject(a)&&a.href&&a.label?t.push('<a href="'+a.href+'">'+a.label+"</a>"):t.push(a)})),u.title=t.join(" / ")}else u.title=a},u.experimentar=function(){o.show({id:"experimentar",templateUrl:"partials/md/experimentar.html",controllerAs:"vm",bindToController:!0,locals:{invest:l},controller:["$http","$q","$timeout","usuariosService","moment",function(a,t,o,e,n){var r=this,i=e.usuario.plano;r.isCortesia=i.cortesia&&(!l&&!!i.tipo||l&&i.inv_basico),r.nomePlano="FISICA"==e.usuario.conta.tipoPessoa?"Família":"Empresarial 3",r.data=n().add(7,"d").format("DD [de] MMMM [de] YYYY"),r.experimentar=function(){e.experimentar(l?"inv":"fin")}}]})}}}(),function(){"use strict";function a(a){a.state("metasc.evolucao",{abstract:!0,url:"/evolucao",templateUrl:"partials/relatorios/evolucao/evolucao.html",controller:"RelatorioEvolucaoController",controllerAs:"vm"}),a.state("metasc.evolucao.listar",{url:"?inicio&p&tm&i&r",controller:"RelatorioEvolucaoDadosController",controllerAs:"vm",params:{tipo:"metas",tm:"centro"},data:{disableMoeda:!0,enableMoeda:!0},templateUrl:"partials/relatorios/evolucao/dadosMetas.html"})}a.$inject=["$stateProvider"],angular.module("md").config(a)}(),function(){"use strict";a.$inject=["$mdDialog","relatoriosDatasource","cadastrosDatasource","configuracoesService","filtrosService"],angular.module("md").service("EvolucaoMetasCentrosService",a);function a(a,t,o,e,n){var r=this,i=e.getConfig("evolucaometasc",{collapse:{d:!1,r:!1},interval:"y",orderBy:"a",realizado:"1",pendentes:!0,somarTotal:!0,regime:"ca",acumular:!1});r.intervalo=i.interval;var c=moment().startOf("year");if("s"==r.intervalo)c.month(moment().month()>5?6:0);else if("t"==r.intervalo){var s=moment().month();c.month(s>=9?9:s>=6?6:s>=3?3:0)}function l(){e.updateConfig("evolucaometasc",{interval:r.intervalo,collapse:r.collapse,orderBy:r.orderBy,somarTotal:r.somarTotal,realizado:r.visualizacaoRealizado,regime:r.regime,pendentes:r.pendentes,acumular:r.acumular,filtro:r.filterManager.getId()})}function u(a,o){r.inicio=a||r.inicio,r.intervalo=o||r.intervalo,"y"!=r.intervalo?r.semestre=0:r.semestre=r.semestre||1,r.loading=!0,r.filterManager.ready((function(){var a={inicio:r.inicio,intervalo:r.intervalo,filtros:r.filterManager,regime:r.regime,pendentes:r.pendentes,acumular:r.acumular,orderBy:r.orderBy,metas:!r.somarTotal,investimentos:!1,tipo:"centro",evolmetas:!0};t.v2.evolucaoRd(a,2).then((function(a){r.loading=!1,angular.extend(r,a),r.meses=a.gerarMeses(r.semestre)}))}))}r.inicio=c.format("YYYY-MM-DD"),r.collapse=i.collapse,r.somarTotal=i.somarTotal,r.orderBy=i.orderBy,r.visualizacaoRealizado=i.realizado,r.regime=i.regime,r.pendentes=i.pendentes,r.acumular=i.acumular,r.calendarioConfig={restrict:["t","s","y"],interval:r.intervalo,onUpdate:function(){r.intervalo!=this.currentInterval&&(r.calendarioConfig.interval=this.currentInterval,r.intervalo=this.currentInterval,l())}},r.filterManager=n.getManagerLancamentos({funcionalidade:16,onUpdate:function(){this.getId()!=i.filtro&&l(),u()},tipo:!1,status:!1,plasticos:!0}),r.filterManager.startWith(i.filtro,!0),r.load=u,r.toggleCollapse=function(a){r.collapse[a]=!r.collapse[a],l()},r.toggleSort=function(a){r.orderBy=a,l(),prepararExibicao()},r.toggleRealizado=l,r.outrasConfiguracoes=function(){a.show({id:"personalizar-evolucaocat",templateUrl:"partials/metas/centros/evolucao/configuracoes.html",locals:{service:r,config:{regime:r.regime,acumular:r.acumular,subcategorias:r.subcategorias,situacao:r.pendentes?"pr":"co",total:!r.somarTotal}},bindToController:!0,controllerAs:"vm",controller:function(){var t=this;t.ok=function(){t.service.regime=t.config.regime,t.service.acumular=t.config.acumular,t.service.subcategorias=t.config.subcategorias,t.service.pendentes="pr"==t.config.situacao,t.service.somarTotal=!t.config.total,a.hide()}}}).then((function(){l(),u()}))},r.detalharSemestre=function(a){r.semestre=a,u()},r.getRealizado=function(a,t){if(!a)return 0;var o=1==r.visualizacaoRealizado?"projetado":"realizarp";return a[o]},r.getParamsDetalhes=function(a,t){return{inicio:t+"-01",fim:moment(t+"-01").endOf("month").format("YYYY-MM-DD"),cen:a.categoria.id,tipo:a.tipo,i:"m",regime:r.regime,pendentes:r.pendentes?1:0,filtro:r.filterManager.encode()}}}}(),function(){"use strict";function a(a,t,o,e,n,r,i){var c=this,s=!1;function l(a,t){return n.query({inicio:a,tipo:c.service.tipoMeta}).then((function(a){return a.forEach((function(a){a.centro&&a.tipo==c.tipo&&(t[a.centro]=a.valor)})),a}))}function u(){var a=0;return c.categorias.forEach((function(t){c.metasMes[t.id]?a+=Math.abs(c.metasMes[t.id]):t.filhos&&t.filhos.forEach((function(t){a+=Math.abs(c.metasMes[t.id])}))})),a}function d(){var a=u();(!c.editandoTotal||Math.abs(c.metaTotal)<a)&&(c.metaTotal=a)}c.service=e,c.editandoTotal=!1,c.ultMes=o(c.mes).subtract(1,"M").format("YYYY-MM-DD"),c.ultAno=o(c.mes).subtract(1,"y").format("YYYY-MM-DD"),c.metasMes={},c.metasOrg={},c.metasUltMes={},c.metasUltAno={},c.metaTotal=0,c.totalCategorias=u,c.atualizarTotal=d,c.aplicarMeta=function(a,t){c.metasMes[a]=t,d()},c.aplicarMetas=function(a){angular.forEach(a,(function(a,t){c.metasMes[t]=a})),d()},c.ok=function(){return t.show({id:"definir-acao",templateUrl:"/partials/metas/centros/definir.acao.html",locals:{mes:c.mes,alteracao:1},controller:["$scope","moment","$mdDialog",function(a,t,o){var e=this;e.meses=[],e.anos=[],e.repetirMes=t(e.mes).month(),e.repetirAno=t(e.mes).add(1,"y").year(),e.sobreescrever=!1,e.apenasAlteradas=!0,a.$watch("vm.repetirMes",r),a.$watch("vm.repetirAno",r),r();for(var n=0;n<12;n++)e.meses.push(t(e.mes).date(1).month(n).format("YYYY-MM-DD"));function r(){var a=t(e.mes).month(),o=0;for(e.repetirMes<a&&(e.repetirAno=t(e.mes).add(1,"y").year(),o=1),e.anos=[];o<4;o++)e.anos.push(t(e.mes).add(o,"y").year())}e.ok=function(){var a=2==e.alteracao&&e.sobreescrever;return o.hide({sobreescrever:a,mesFim:2==e.alteracao?t().date(1).month(parseFloat(e.repetirMes)).year(parseFloat(e.repetirAno)).format("YYYY-MM-DD"):e.mes,apenasAlteradas:a&&e.apenasAlteradas})}}],controllerAs:"vm",bindToController:!0}).then((function(a){for(var n=[],r=[],i=c.mes;i<=a.mesFim;)r.push(i),i=o(i).add(1,"M").format("YYYY-MM-DD");return(c.editandoTotal||s)&&n.push({tipo:c.tipo,datas:r,meta:c.metaTotal,sobreescrever:a.sobreescrever}),angular.forEach(c.metasMes,(function(t,o){a.apenasAlteradas&&c.metasOrg[o]==t||n.push({meta:t,centro:o,tipo:c.tipo,datas:r,sobreescrever:a.sobreescrever})})),c.criandoMetas=!0,e.salvar(n).then(t.hide,(function(){c.criandoMetas=!1}))}))},c.apagarMeta=function(a){c.metasMes[a.id]=0,d()},c.apagarMetas=function(){angular.forEach(c.metasMes,(function(a,t){c.metasMes[t]=0})),d()},c.hasAlteracao=function(a){return!c.loading&&Math.abs(c.metasMes[a])!=Math.abs(c.metasOrg[a])},c.categorias=[],r.centros.filter((function(a){return a.status})).forEach((function(a){c.metasMes[a.id]=0,c.metasUltMes[a.id]=0,c.metasUltAno[a.id]=0,c.categorias.push(a)})),c.loading=!0,a.all([l(c.mes,c.metasMes).then((function(a){for(var t=0;t<a.length;t++)if(!a[t].centro&&a[t].tipo==c.tipo){c.editandoTotal=!0,s=!0,c.metaTotal=Math.abs(a[t].valor);break}return c.metasOrg=angular.copy(c.metasMes),a})),l(c.ultMes,c.metasUltMes),l(c.ultAno,c.metasUltAno)]).then((function(){c.loading=!1}))}a.$inject=["$q","$mdDialog","moment","metasCentrosService","metasCentrosDatasource","cadastrosDatasource","mdwApiError"],angular.module("md").controller("MetasCentrosDefinirController",a)}(),function(){"use strict";function a(a,t,o){var e=this;e.service=o,e.service.attrs.rd.tipo=t,e.service.carregar(),a.$on("$destroy",o.addObserver(o.carregar)),e.getParamsDetalhes=function(a){var t=e.service.attrs[e.service.tipoMeta].inicio.format("YYYY-MM-DD"),o=e.service.attrs[e.service.tipoMeta].fim.format("YYYY-MM-DD"),n=e.service.attrs[e.service.tipoMeta].interval,r={cen:a,inicio:t,fim:o,i:n};return r.pendentes="c"==e.service.attrs[e.service.tipoMeta].situacao?0:1,r.regime=e.service.attrs[e.service.tipoMeta].regime,r}}a.$inject=["$scope","tipoMetaRd","metasCentrosService"],angular.module("md").controller("MetasCentrosController",a)}(),function(){"use strict";function a(a,t,o,e){var n=this,r=t(),i=a("/metas/centros/:id");n.query=function(a){return i.get(a).then((function(a){return a}))},n.salvar=function(a){return o.post("/metas/centros",{metas:a}).then((function(a){i.reset();var t=r.notify();return e.notify(t),a.data}))},n.addObserver=r.add}a.$inject=["mdwCache","mdwObserver","$http","lancamentosDatasource"],angular.module("md").service("metasCentrosDatasource",a)}(),function(){"use strict";function a(a,t,o){o.state({id:"metasc",title:"Metas por centros",templates:["metas/centros/metas.html","metas/centros/metas.listar.html"]},{abstract:!0,url:"/metas/centros",template:"<div layout='row' flex ui-view></div>",controller:["$scope","mdwTopmenu",function(a,t){t.preservStateParams=!0,t.setTabs(a,[{label:"Despesas",state:"metasc.lista.despesa"},{label:"Receitas",state:"metasc.lista.receita"},{label:"Evolução",state:"metasc.evolucao.listar"}])}],controllerAs:"vm",data:{permmd:"metas.centros"}}),a.state("metasc.lista",{abstract:!0,url:"",templateUrl:"partials/metas/centros/metas.html",controllerAs:"vm",controller:["metasCentrosService",function(a){this.service=a,this.printConfig={controller:["metasCentrosService",function(a){this.service=a}],templateUrl:"/partials/metas/centros/metas.print.html"}}]}),["receita","despesa"].forEach((function(t){a.state("metasc.lista."+t,{url:"/"+t+"?inicio&fim&i",templateUrl:"partials/metas/centros/metas.listar.html",controller:"MetasCentrosController",data:{enableMoeda:!0,disableMoeda:!0},controllerAs:"vm",resolve:{tipoMetaRd:function(){return t.substr(0,1)}}})}))}a.$inject=["$stateProvider","mdwStateDialogProvider","mdwBaseStateProvider"],angular.module("md").config(a)}(),function(){"use strict";function a(a,t,o,e,n,r,i,c,s,l,u){var d=this,m=o();function f(a,t){if(angular.isUndefined(t))return d.attrs[d.tipoMeta][a];d.attrs[d.tipoMeta][a]=t}function p(){e.updateConfig("metasc_"+d.tipoMeta,{situacao:f("situacao"),regime:f("regime"),fs:f("fullscreen")?1:0,interval:f("interval")})}function v(){var a=angular.copy(i);a.inicio&&a.fim||(a=s.getDefaultParams(f("calendarioConfig").interval)),f("inicio",n(a.inicio)),f("fim",n(a.fim))}function g(){return v(),d.loading=!0,d.semMetas=!0,r.v2.metasOrcamento({inicio:f("inicio").format("YYYY-MM-DD"),fim:f("fim").format("YYYY-MM-DD"),tipo:"centro",regime:f("regime")}).then((function(a){d.loading=!1,d.metas=a,h()}))}function h(){angular.forEach(d.metas,(function(a,t){d.semMetas=!1,angular.forEach(a.categorias,(function(a){C(a,t)})),a.nome="Total de "+t,C(a,t),C(a.geral,t)}))}function C(a,t){"c"==f("situacao")?(a.valor=a.confirmado,a.cor=a.corConfirmada,a.razao=a.razaoConfirmada,a.residuo=a.realizarConfirmado,a.situacao=a.situacaoconfirmada):(a.valor=a.projetado,a.cor=a.corProjetada,a.razao=a.razaoProjetada,a.residuo=a.realizarProjetado,a.situacao=a.situacaoprojetada)}d.attrs={},["rd"].forEach((function(a){var t=e.getConfig("metasc_"+a,{tipo:"rd"==a?"d":"s",situacao:"c",regime:"ca",fs:0,interval:"m"}),o=t.interval;d.attrs[a]={busca:{},config:t,tipo:t.tipo,interval:t.interval,fullscreen:1==t.fs,situacao:t.situacao,regime:t.regime,calendarioConfig:{restrict:["m","t","s"],interval:o,onUpdate:function(){o!=this.currentInterval&&(d.attrs[a].calendarioConfig.interval=this.currentInterval,d.attrs[a].interval=o=this.currentInterval,p())}}}})),d.tipoMeta="rd",d.addObserver=m.add,d.definir=function(){return u.dialogPlano("metas",(function(){return v(),a.show({id:"definir-meta-orcamento",templateUrl:"/partials/metas/centros/definir.html",controller:"MetasCentrosDefinirController",controllerAs:"vm",bindToController:!0,locals:{mes:f("inicio").format("YYYY-MM-DD"),tipo:f("tipo")}})}))},d.salvar=function(a){return l.salvar(a).then((function(){}))},d.carregar=g,d.toggleTipo=p,d.toggleSituacao=function(){f("situacao","c"==f("situacao")?"p":"c"),h(),p()},d.toggleRegime=function(){f("regime","ca"==f("regime")?"co":"ca"),g(),p()},d.toggleFullscreen=function(){f("fullscreen",!f("fullscreen")),p()},d.attr=f,d.getTipoStr=function(a){var t=f("tipo");return("d"==t?"despesa":"r"==t?"receita":"e"==t?"entrada":"saída")+(a?"s":"")},l.addObserver(m.notify)}a.$inject=["$mdDialog","$filter","mdwObserver","configuracoesService","moment","relatoriosDatasource","$stateParams","googleChartApiPromise","mdwCalendarService","metasCentrosDatasource","usuariosService"],angular.module("md").service("metasCentrosService",a)}(),function(){"use strict";angular.module("md").directive("mdwMetaEconomiaSelect",(function(){return a.$inject=["$scope","cadastrosDatasource","metaseconomiaDatasource"],{template:["<md-input-container flex>","<label>Meta de economia ({{vm.conta.nome}})</label>",'<md-select ng-model="vm.metaId" ng-disabled="vm.ngDisabled">','<md-option value="0">Não associar</md-option>','<md-option ng-repeat="meta in vm.metas" value="{{meta.id}}">{{meta.descricao}}</md-option>',"</md-select>","</md-input-container>"].join(""),restrict:"E",require:"mdwMetaEconomiaSelect",scope:{contaId:"=conta",meta:"=ngModel",ngDisabled:"="},bindToController:!0,controllerAs:"vm",controller:a,link:function(a,t,o,e){function n(a){t.css("display",a?"flex":"none"),e.metaId=a?e.metaId:0}a.$watchCollection("vm.metas",(function(a){e.contaId?a&&n(a.length>0):n(!1)}))}};function a(a,t,o){var e=this;function n(){if(e.contaId)return e.conta=t.get("contas",e.contaId,!0),o.query().then((function(a){e.metas=a.filter((function(a){for(var t=0;t<a.contas.length;t++)if(a.contas[t].conta==e.contaId)return a.status;return!1}))}))}e.$onInit=function(){e.metaId=e.meta||0},a.$watch("vm.contaId",n),a.$watch("vm.meta",(function(a){0==a&&(e.metaId=0)})),a.$watch("vm.metaId",(function(a){e.meta=0==a||"0"==a?null:a})),n(),e.hasMetas=function(){if(!e.contaId)return!1;var a=t.get("contas",e.contaId,!0).metasEconomia;return a&&a.length>0}}}))}(),function(){"use strict";function a(a,t,o,e,n,r,i,c,s,l,u,d,m){var f,p=this;p.service=c,p.extrato=s,p.aplicacaoMensal=function(){if(p.editarSaldoInicial)p.meta.saldo=p.meta.contas.reduce((function(a,t){return a+t.saldoInicial}),0),p.meta.saldoInicial=p.meta.saldo;else{var a=0;p.meta.contas.forEach((function(t){a=t.saldoInicial})),p.meta.saldo=f+a}return p.service.aplicacaoMensal(p.meta)},p.adicionarContas=h,p.removerConta=function(a){p.meta.contas.splice(a,1)},p.filtroContas=function(a){return m.moeda==a.moeda&&"CARTAOCREDITO"!=a.tipo&&"CARTEIRA_INVEST"!=a.tipo&&a.status},p.ok=function(){var o=p.meta.id,c=o?"update":"insert";return p.meta.data=n(p.meta.data).format("YYYY-MM-DD"),p.meta.dataSaldoInicial=n(p.meta.dataSaldoInicial).format("YYYY-MM-DD"),r("metaseconomia")[c](p.meta).then((function(n){return d.reload("contas").then((function(){return i.showSimple("Meta de economia "+(o?"atualizada":"criada")),e.hide().then((function(){p.agendar&&a((function(){p.extrato.agendarOnLoad=!0,t.go("metaseconomiaextrato",{idMeta:n.id})}),100)}))}))}))},p.meta.id||h(),p.agendar=!p.meta.id,p.meses=[],p.anos=[],p.mes=n(p.meta.data).month(),p.ano=n(p.meta.data).year(),p.editarSaldoInicial=!p.meta.id||p.meta.saldo==p.meta.saldoInicial,p.editarSaldoInicial||(f=p.meta.saldo,p.meta.contas.forEach((function(a){f-=a.saldoInicial,a._prev=!0}))),o.$watch("vm.mes",g),o.$watch("vm.ano",g),g();for(var v=0;v<12;v++)p.meses.push(n().date(1).month(v).format("YYYY-MM-DD"));function g(){var a=n().month(),t=0;for(p.mes<a&&(p.repetirAno=n().add(1,"y").year(),t=1),p.anos=[];t<41;t++)p.anos.push(n().add(t,"y").year());p.meta.data=n().date(1).month(parseFloat(p.mes)).year(parseFloat(p.ano))}function h(){p.meta.contas.push({saldoInicial:0})}}a.$inject=["$timeout","$state","$scope","$mdDialog","moment","mdwResource","$mdToast","metaseconomiaService","metaseconomiaExtratoService","TIPO_LANCAMENTO","categoriasDatasource","cadastrosDatasource","moedaService"],angular.module("md").controller("MetaEconomiaEditarController",a)}(),function(){"use strict";function a(a,t,o,e,n){var r=this;t.title="Metas de economia",r.cor="#40a64d",r.service=o,r.printConfig={controller:["metaseconomiaService",function(a){this.service=a}],templateUrl:"/partials/metas/economia/metaseconomia.print.html"},r.service.carregar(),a.$on("$destroy",o.addObserver(o.carregar))}a.$inject=["$scope","mdwTopmenu","metaseconomiaService","cadastrosDatasource","mdwColors"],angular.module("md").controller("MetasEconomiaController",a)}(),function(){"use strict";function a(a){a.define("metaseconomia","/metas/economia/:id")}function t(a,t,o,e){var n=this,r=o(),i=a("/metas/economia/:id"),c=a("/metas/economia/:id/lancamentos"),s=a("/metas/economia/:id/saldo");function l(a){i.reset(),c.reset(),r.notify(a)}function u(){return i.get()}t("metaseconomia",l),e.addObserver(l),n.get=function(a){return u().then((function(t){for(var o=0;o<t.length;o++)if(t[o].id==a)return t[o]}))},n.query=u,n.lancamentos=function(a,t,o){return c.get({id:a,inicio:t,fim:o})},n.saldoData=function(a,t){return s.get({id:a,data:t})},n.addObserver=r.add,n.notify=l}a.$inject=["mdwResourceProvider"],t.$inject=["mdwCache","mdwResourceObserver","mdwObserver","lancamentosDatasource"],angular.module("md").config(a).service("metaseconomiaDatasource",t)}(),function(){"use strict";function a(a,t,o,e,n,r,i,c,s,l,u,d){var m=this;r.setTitle([{label:"Metas de economia",href:"metas/economia"},"Extrato"]),m.cor="#40a64d",m.extrato=c,m.service=i,m.novo=function(o){return d.dialogPlano("metas",(function(){a.go("metaseconomiaextrato.lancamentosNovo",{base:{tipo:"t",categoria:l.getCategoriaTipoLancamento(o).id,idMeta:t.idMeta,data:moment()}})}))},m.TIPO_LANCAMENTO=s,m.printConfig={controller:["metaseconomiaService","metaseconomiaExtratoService",function(a,t){var o=this;o.extrato=t,o.service=a;var e=[];o.extrato.meta.contas.forEach((function(a){e.push(u.get("contas",a.conta,!0).nome)})),o.nomeContas=e.join(", ")}],templateUrl:"/partials/metas/economia/extrato.print.html"},m.selection=e({controller:m,templateUrl:"/partials/extratoConta/acoesLoteTopmenu.html",getLancamentos:function(){return m.extrato.lancamentos}});var f=m.extrato.addObserver((function(){m.extrato.carregar()}));n.$on("$destroy",(function(){f(),m.selection.clearSelection()})),n.$watchCollection("vm.extrato.lancamentos",(function(){m.selection.updateSelection()})),m.extrato.carregar().then((function(){var t=[];m.extrato.meta.contas.forEach((function(a){t.push(u.get("contas",a.conta,!0).nome)})),m.nomeContas=t.join(", "),m.extrato.agendarOnLoad&&(m.extrato.agendarOnLoad=!1,a.go(".lancamentosNovo",{base:{tipo:"t",descricao:"Aplicação programada",agenda:{quantidade:m.service.numeroAplicacoesMensais(m.extrato.meta),intervalo:"M",frequencia:1,repeticao:"p"},categoria:l.getCategoriaTipoLancamento(s.APLICACAO).id,idMeta:m.extrato.meta.id,valor:m.service.aplicacaoMensal(m.extrato.meta),data:moment(m.extrato.meta.dataSaldoInicial).format("YYYY-MM-DD")}}))}))}a.$inject=["$state","$stateParams","$timeout","selecaoLancamentosLote","$scope","mdwTopmenu","metaseconomiaService","metaseconomiaExtratoService","TIPO_LANCAMENTO","categoriasDatasource","cadastrosDatasource","usuariosService"],angular.module("md").controller("MetasEconomiaExtratoController",a)}(),function(){"use strict";function a(a,t,o,e,n,r,i,c,s,l){var u=this,d=n(),m=r,f=s.getConfig("extratoMe",{fsl:15});u.filtroStatusLancamento=f.fsl,u.lancamentos=[],u.addObserver=d.add,u.carregar=function(t){u.loading=!0,u.metaId=t||o.idMeta;var e=m.carregar().then((function(a){for(var t=0;t<a.length;t++)if(a[t].id==u.metaId){u.meta=a[t];break}})),n=angular.copy(o);if(!n.inicio||!n.fim){var r=c.getDefaultParams(u.calendarioConfig.interval,!0);n.inicio=r.inicio,n.fim=r.fim}var s=moment().format("YYYY-MM-DD");u.diaMensal&&n.inicio<=s&&n.fim>=s&&(n.inicio=s);u.inicio=n.inicio,u.fim=n.fim;var l=i.lancamentos(u.metaId,u.inicio,u.fim).then((function(a){u.lancamentosBase=a,v()}));return a.all([e,l]).then((function(){u.loading=!1,function(){var a="y"===u.calendarioConfig.interval?"YYYY":"YYYY-MM";if(moment(u.meta.dataSaldoInicial).format(a)==moment(u.inicio).format(a))u.anterior={desc:"Saldo inicial",valor:u.meta.saldoInicial,data:u.meta.dataSaldoInicial},o(u.meta.saldoInicial);else{var t=moment(u.inicio).subtract(1,"day").format("YYYY-MM-DD");i.saldoData(u.metaId,t).then((function(a){u.anterior={desc:"Saldo anterior",valor:a,data:t},o(a)}))}function o(a){var t=a;angular.forEach(u.lancamentos,(function(a){t+=a.valor,a.saldo=t}))}}()}))},u.alterarMeta=function(){t.go("metaseconomiaextrato",{idMeta:u.metaId})},u.toggleFiltroStatus=function(a){u.filtros.status[a]=!u.filtros.status[a],u.filtroStatusLancamento=l.encode(u.filtros.status),s.updateConfig("extratoMe",{fsl:u.filtroStatusLancamento}),v()},i.addObserver(d.notify),u.calendarioConfig={restrict:["m","y","p"],interval:"y"},u.filtros={status:l.decode(u.filtroStatusLancamento)};const p={pendente:1,confirmado:2,conciliado:4,agendado:8};function v(){u.lancamentos=[];const a=e;var t=l.encode(u.filtros.status);u.lancamentos=[],angular.forEach(u.lancamentosBase,(function(a){let o=p[a.status];l.checkBit(t,o)&&u.lancamentos.push(a)})),u.lancamentos=a.idLancGenerator(u.lancamentos)}}a.$inject=["$q","$state","$stateParams","relatoriosDatasource","mdwObserver","metaseconomiaService","metaseconomiaDatasource","mdwCalendarService","configuracoesService","filtrosService"],angular.module("md").service("metaseconomiaExtratoService",a)}(),function(){"use strict";function a(a,t,o,e){e.state({id:"metaseconomia",title:"Metas de economia",templates:["metas/economia/metaseconomia.html","metas/economia/extrato.html"]},{url:"/metas/economia",templateUrl:"partials/metas/economia/metaseconomia.html",controller:"MetasEconomiaController",controllerAs:"vm",data:{permmd:"metas.economia",disableMoeda:!0,enableMoeda:!0}}),a.state("metaseconomiaextrato",{url:"/metas/economia/extrato/:idMeta?inicio&fim&i",templateUrl:"partials/metas/economia/extrato.html",controller:"MetasEconomiaExtratoController",controllerAs:"vm",data:{permmd:"metas.economia",disableMoeda:!0,enableMoeda:!0}}).state("metaseconomia.nova",t.getState({url:"/nova",action:"metaseconomiaService.nova",data:{permmdt:"g"}})).state("metaseconomia.editar",t.getState({url:"/editar/:id",action:"metaseconomiaService.editar",data:{permmdt:"g"}})).state("metaseconomia.excluir",t.getState({url:"/excluir/:id",action:"metaseconomiaService.excluir",data:{permmdt:"e"}})),o.addStates("metaseconomiaextrato")}a.$inject=["$stateProvider","mdwStateDialogProvider","lancamentosRoutesProvider","mdwBaseStateProvider"],angular.module("md").config(a)}(),function(){"use strict";function a(a,t,o,e,n,r,i,c,s,l,u){var d=this,m=i();function f(){return d.loading=!0,c.query().then((function(a){var t=0,e=0;return d.metas=a,d.metas.forEach((function(a){a.status||(d.exibirSwitch=!0,t+=1),a.status&&(e+=1),e==d.metas.length&&(d.exibirSwitch=!1,d.exibirApenasAtivos=!0),t==d.metas.length&&(d.exibirSwitch=!1,d.exibirApenasAtivos=!1),function(a){let t=0,e=[];a.chart={type:"PieChart",data:{cols:[{id:"conta",label:"Conta",type:"string"},{id:"saldo",label:"Saldo total atualizado",type:"number"}],rows:[]},options:{pieHole:.4,backgroundColor:"transparent",legend:{position:"none"},chartArea:{width:"90%",height:"90%"},tooltip:{trigger:"selection"}}},a.contas.forEach((i=>{i.cor=r.getColorAtIndex(t++),i.saldo<0||(a.chart.data.rows.push({c:[{v:o("nomeCadastro")(i.conta,"contas")},{v:i.saldo+i.saldoInicial,f:o("currency")(i.saldo+i.saldoInicial,o("moeda")(n.moeda)+" ")}]}),e.push(i.cor))})),a.chart.data.rows.push({c:[{v:"A realizar"},{v:a.valor-a.saldo,f:o("currency")(a.valor-a.saldo,o("moeda")(n.moeda)+" ")}]}),e.push("#E0E0E0"),a.chart.options.colors=e}(a)})),d.metas.sort((function(a,t){return t.descricao<=a.descricao?1:-1})),d.loading=!1,a}))}function p(a){var t=a.dataSaldo||a.dataSaldoInicial,o=0;return a.saldo!=a.saldoInicial&&(o=1),moment(a.data).startOf("M").diff(moment(t).startOf("M").add(o,"M"),"months")}function v(t){var o={id:"editar-meta-economia",templateUrl:"/partials/metas/economia/editar.html",controller:"MetaEconomiaEditarController",controllerAs:"vm",bindToController:!0};return t&&t.id?o.resolve={meta:["metaseconomiaDatasource",function(a){return a.get(t.id).then((function(a){return angular.copy(a)}))}]}:o.locals={meta:{dataSaldoInicial:moment(),taxa:.006,valor:0,data:moment().add(1,"y"),contas:[]}},a.show(o)}d.agendarOnLoad=!1,d.addObserver=m.add,d.carregar=f,d.aplicacaoMensal=function(a){var t=a.saldo,o=a.taxa,e=p(a),n=moment(a.data).startOf("M").diff(moment().startOf("M"),"months"),r=a.valor-t*Math.pow(1+o,n),i=0!=o?r*o/((1+o)*(Math.pow(1+o,e)-1)):(a.valor-a.saldo)/e;if(e<=0)return a.valor;var c=Math.max(0,i||0);return u(c)},d.numeroAplicacoesMensais=p,d.nova=function(a){return s.dialogPlano("metas",(function(){return v(a)}))},d.editar=v,d.excluir=function(o){return n.$inject=["$mdDialog","cadastrosDatasource"],a.show({id:"excluir-meta",templateUrl:"/partials/metas/economia/excluir.html",controller:n,controllerAs:"vm",bindToController:!0,resolve:{meta:["metaseconomiaDatasource",function(a){return a.get(o.id).then((function(a){return angular.copy(a)}))}]}});function n(a,o){var n=this;n.excluir=function(){return e("metaseconomia").delete(n.meta).then((function(e){return n.meta.contas.forEach((function(a){var t=o.get("contas",a.conta,!0),e=t.metasEconomia.indexOf(n.meta.id);t.metasEconomia.splice(e,1),0==t.metasEconomia.length&&delete t.metasEconomia})),a.hide(),t.showSimple("Meta excluída"),e}))}}},d.nomesContas=function(a){return a.contas.map((function(a){return l.get("contas",a.conta,!0).nome})).join(", ")},d.toggleStatus=function(a){d.exibirSwitch=!0,a.status=!a.status,function(a){e("metaseconomia").update(a).then((function(a){return t.showSimple("Meta atualizada."),a}))}(a),f()},d.metas=[],d.exibirSwitch=!1,d.exibirApenasAtivos=!0,c.addObserver(m.notify)}a.$inject=["$mdDialog","$mdToast","$filter","mdwResource","moedaService","mdwColors","mdwObserver","metaseconomiaDatasource","usuariosService","cadastrosDatasource","currencyRound"],angular.module("md").service("metaseconomiaService",a)}(),function(){"use strict";function a(a){a.state("metasrd.evolucao",{abstract:!0,url:"/evolucao",controller:"RelatorioEvolucaoController",controllerAs:"vm",templateUrl:"partials/relatorios/evolucao/evolucao.html"}),a.state("metasrd.evolucao.listar",{url:"?inicio&p&tm&i&r",controller:"RelatorioEvolucaoDadosController",controllerAs:"vm",params:{tipo:"metas",tm:"categoria"},data:{disableMoeda:!0,enableMoeda:!0},templateUrl:"partials/relatorios/evolucao/dadosMetas.html"})}a.$inject=["$stateProvider"],angular.module("md").config(a)}(),function(){"use strict";function a(a,t,o,e,n,r,i,c){c.goalSetStarted();var s=this,l=!1;function u(a,t){return n.query({inicio:a}).then((function(a){return a.forEach((function(a){a.conta&&(t[a.conta]=a.valor)})),a}))}function d(){var a=0;return s.contas.forEach((function(t){s.metasMes[t.id]&&(a+=Math.abs(s.metasMes[t.id]))})),a}function m(){var a=d();(!s.editandoTotal||Math.abs(s.metaTotal)<a)&&(s.metaTotal=a)}s.service=e,s.editandoTotal=!1,s.ultMes=o(s.mes).subtract(1,"M").format("YYYY-MM-DD"),s.ultAno=o(s.mes).subtract(1,"y").format("YYYY-MM-DD"),s.metasMes={},s.metasOrg={},s.metasUltMes={},s.metasUltAno={},s.metaTotal=0,s.totalContas=d,s.atualizarTotal=m,s.aplicarMeta=function(a,t){s.metasMes[a]=t,m()},s.aplicarMetas=function(a){angular.forEach(a,(function(a,t){s.metasMes[t]=a})),m()},s.ok=function(){return t.show({id:"definir-acao",templateUrl:"/partials/metas/orcamento/investimentos/definir.acao.html",locals:{mes:s.mes,alteracao:1},controller:["$scope","moment","$mdDialog",function(a,t,o){var e=this;e.meses=[],e.anos=[],e.repetirMes=t(e.mes).month(),e.repetirAno=t(e.mes).add(1,"y").year(),e.sobreescrever=!1,e.apenasAlteradas=!0,a.$watch("vm.repetirMes",r),a.$watch("vm.repetirAno",r),r();for(var n=0;n<12;n++)e.meses.push(t(e.mes).date(1).month(n).format("YYYY-MM-DD"));function r(){var a=t(e.mes).month(),o=0;for(e.repetirMes<a&&(e.repetirAno=t(e.mes).add(1,"y").year(),o=1),e.anos=[];o<4;o++)e.anos.push(t(e.mes).add(o,"y").year())}e.ok=function(){var a=2==e.alteracao&&e.sobreescrever;return o.hide({sobreescrever:a,mesFim:2==e.alteracao?t().date(1).month(parseFloat(e.repetirMes)).year(parseFloat(e.repetirAno)).format("YYYY-MM-DD"):e.mes,apenasAlteradas:a&&e.apenasAlteradas})}}],controllerAs:"vm",bindToController:!0}).then((function(a){for(var n=[],r=[],i=s.mes;i<=a.mesFim;)r.push(i),i=o(i).add(1,"M").format("YYYY-MM-DD");return(s.editandoTotal||l)&&n.push({datas:r,meta:s.metaTotal,sobreescrever:a.sobreescrever}),angular.forEach(s.metasMes,(function(t,o){a.apenasAlteradas&&s.metasOrg[o]==t||n.push({meta:t,conta:o,datas:r,sobreescrever:a.sobreescrever})})),s.criandoMetas=!0,e.salvar(n).then((function(a){return a&&a.count&&c.goalSetCompleted("Investimento"),t.hide()}),(function(){s.criandoMetas=!1}))}))},s.apagarMeta=function(a){s.metasMes[a.id]=0,m()},s.apagarMetas=function(){angular.forEach(s.metasMes,(function(a,t){s.metasMes[t]=0})),m()},s.hasAlteracao=function(a){return!s.loading&&Math.abs(s.metasMes[a])!=Math.abs(s.metasOrg[a])},s.contas=r.contas.filter((function(a){return a.status&&-1!=["INVESTIMENTO","CONTA CORRENTE"].indexOf(a.tipo)&&i.moeda==a.moeda})),s.contas.forEach((function(a){s.metasMes[a.id]=0,s.metasUltMes[a.id]=0,s.metasUltAno[a.id]=0})),s.loading=!0,a.all([u(s.mes,s.metasMes).then((function(a){for(var t=0;t<a.length;t++)if(!a[t].conta){s.editandoTotal=!0,l=!0,s.metaTotal=Math.abs(a[t].valor);break}return s.metasOrg=angular.copy(s.metasMes),a})),u(s.ultMes,s.metasUltMes),u(s.ultAno,s.metasUltAno)]).then((function(){s.loading=!1}))}a.$inject=["$q","$mdDialog","moment","metasInvestimentosService","metasInvestimentosDatasource","cadastrosDatasource","moedaService","mdwAnalytics"],angular.module("md").controller("MetasInvestimentosDefinirController",a)}(),function(){"use strict";function a(a,t){this.service=t,this.service.carregar(),a.$on("$destroy",t.addObserver(t.carregar))}a.$inject=["$scope","metasInvestimentosService"],angular.module("md").controller("MetasInvestimentosController",a)}(),function(){"use strict";function a(a,t,o,e){var n=this,r=t(),i=a("/investimentos/metas");n.query=function(a){return i.get(a).then((function(a){return a}))},n.salvar=function(a){return o.post("/investimentos/metas",{metas:a}).then((function(a){i.reset();var t=r.notify();return e.notify(t),a.data}))},n.addObserver=r.add}a.$inject=["mdwCache","mdwObserver","$http","lancamentosDatasource"],angular.module("md").service("metasInvestimentosDatasource",a)}(),function(){"use strict";function a(a,t,o,e,n,r,i,c,s,l){var u=this,d=t(),m=o.getConfig("metasinvest",{situacao:"c",fs:0,interval:"m",ordenacao:"a"}),f=m.interval;function p(a,t){if(angular.isUndefined(t))return u.attrs[a];u.attrs[a]=t}function v(){o.updateConfig("metasinvest",{situacao:u.situacao,fs:u.fullscreen?1:0,interval:f,ordenacao:p("ordenacao")})}function g(){var a=angular.copy(r);u.inicio=e(a.inicio),u.fim=e(a.fim)}function h(){return g(),u.loading=!0,u.semMetas=!0,n.metasinvestimentos({inicio:u.inicio.format("YYYY-MM-DD"),fim:u.fim.format("YYYY-MM-DD")}).then((function(a){u.loading=!1,u.metas=a,C()}))}function C(){var a,t;u.metas.contas&&(u.semMetas=!1,angular.forEach(u.metas.contas,(function(a){b(a)})),a=u.metas.contas,t="a"!=p("ordenacao"),a.sort((function(a,o){if(t){var e=Math.abs(o.razao)-Math.abs(a.razao);if(e)return e}return a.nome.toLowerCase()<o.nome.toLowerCase()?-1:1})),b(u.metas),b(u.metas.geral))}function b(a){"c"==u.situacao?(a.valor=a.confirmado,a.cor=a.corConfirmada,a.razao=a.razaoConfirmada,a.residuo=a.residuoConfirmado,a.situacao=a.situacaoconfirmada):(a.valor=a.projetado,a.cor=a.corProjetada,a.razao=a.razaoProjetada,a.residuo=a.residuoProjetado,a.situacao=a.situacaoprojetada)}u.busca={},u.attrs={},u.situacao=m.situacao,u.situacao=m.situacao,u.fullscreen=1==m.fs,u.attrs.ordenacao=u.ordenacao,u.calendarioConfig={restrict:["m","t","s"],interval:f,onUpdate:function(){f!=this.currentInterval&&"p"!=this.currentInterval&&(u.calendarioConfig.interval=this.currentInterval,f=this.currentInterval,v())}},s.addObserver(d.notify),u.addObserver=d.add,u.definir=function(){return l.dialogPlano("investimentos",(function(){return g(),a.show({id:"definir-meta-orcamento",templateUrl:"/partials/metas/orcamento/investimentos/definir.html",controller:"MetasInvestimentosDefinirController",controllerAs:"vm",bindToController:!0,locals:{mes:u.inicio.format("YYYY-MM-DD")}})}))},u.salvar=function(a){return s.salvar(a)},u.carregar=h,u.toggleSituacao=function(){u.situacao="c"==u.situacao?"p":"c",C(),v()},u.toggleFullscreen=function(){u.fullscreen=!u.fullscreen,v()},u.toggleSort=function(a){p("ordenacao",a),v(),h()},u.attr=p}a.$inject=["$mdDialog","mdwObserver","configuracoesService","moment","relatoriosDatasource","$stateParams","googleChartApiPromise","mdwCalendarService","metasInvestimentosDatasource","usuariosService"],angular.module("md").service("metasInvestimentosService",a)}(),function(){"use strict";function a(a,t){t.state({id:"metasrd.investimentos",templates:["metas/orcamento/investimentos/metas.html","metas/orcamento/investimentos/metas.listar.html"]},{abstract:!0,url:"/investimentos",templateUrl:"partials/metas/orcamento/investimentos/metas.html",controller:["metasInvestimentosService",function(a){this.service=a,this.printConfig={controller:["metasInvestimentosService",function(a){this.service=a}],templateUrl:"/partials/metas/orcamento/investimentos/metas.print.html"}}],controllerAs:"vm"}),a.state("metasrd.investimentos.listar",{url:"?inicio&fim&i",templateUrl:"partials/metas/orcamento/investimentos/metas.listar.html",controllerAs:"vm",controller:"MetasInvestimentosController",data:{disableMoeda:!0,enableMoeda:!0}})}a.$inject=["$stateProvider","mdwBaseStateProvider"],angular.module("md").config(a)}(),function(){"use strict";function a(a,t,o,e,n,r,i,c){c.goalSetStarted();var s=this,l=!1;s.service=e,s.editandoTotal=!1,s.ultMes=o(s.mes).subtract(1,"M").format("YYYY-MM-DD"),s.ultAno=o(s.mes).subtract(1,"y").format("YYYY-MM-DD"),s.metasMes={},s.metasOrg={},s.metasUltMes={},s.metasUltAno={},s.metaTotal=0,s.totalCategorias=f,s.atualizarTotal=p,s.reiniciarTotal=function(){s.metaTotal=f()},s.atualizarPai=g,s.aplicarMeta=function(a,t){s.metasMes[a]=t,p(),v()},s.aplicarMetas=function(a){angular.forEach(a,(function(a,t){s.metasMes[t]=a})),p(),v()},s.ok=function(){for(var a=0;a<s.categorias.length;a++){var n=s.categorias[a];if(!h(n))return void i.notify("A soma da categoria <strong>"+n.nome+"</strong> deve ser maior ou igual a soma das filhas")}return t.show({id:"definir-acao",templateUrl:"/partials/metas/orcamento/definir.acao.html",locals:{mes:s.mes,alteracao:1},controller:["$scope","moment","$mdDialog",function(a,t,o){var e=this;e.meses=[],e.anos=[],e.repetirMes=t(e.mes).month(),e.repetirAno=t(e.mes).add(1,"y").year(),e.sobreescrever=!1,e.apenasAlteradas=!0,a.$watch("vm.repetirMes",r),a.$watch("vm.repetirAno",r),r();for(var n=0;n<12;n++)e.meses.push(t(e.mes).date(1).month(n).format("YYYY-MM-DD"));function r(){var a=t(e.mes).month(),o=0;for(e.repetirMes<a&&(e.repetirAno=t(e.mes).add(1,"y").year(),o=1),e.anos=[];o<4;o++)e.anos.push(t(e.mes).add(o,"y").year())}e.ok=function(){var a=2==e.alteracao&&e.sobreescrever;return o.hide({sobreescrever:a,mesFim:2==e.alteracao?t().date(1).month(parseFloat(e.repetirMes)).year(parseFloat(e.repetirAno)).format("YYYY-MM-DD"):e.mes,apenasAlteradas:a&&e.apenasAlteradas})}}],controllerAs:"vm",bindToController:!0}).then((function(a){for(var n=[],r=[],i=s.mes;i<=a.mesFim;)r.push(i),i=o(i).add(1,"M").format("YYYY-MM-DD");return(s.editandoTotal||l)&&n.push({tipo:s.tipo,datas:r,meta:s.metaTotal,sobreescrever:a.sobreescrever&&!a.apenasAlteradas}),angular.forEach(s.metasMes,(function(t,o){a.apenasAlteradas&&s.metasOrg[o]==t||n.push({meta:t,categoria:o,tipo:s.tipo,datas:r,sobreescrever:a.sobreescrever})})),s.criandoMetas=!0,e.salvar(n).then((function(a){return a&&a.count&&c.goalSetCompleted("d"==s.tipo?"Despesa":"Receita"),t.hide()}),(function(){s.criandoMetas=!1}))}))},s.apagarMeta=function(a){s.metasMes[a.id]=0,p()},s.apagarMetas=function(){angular.forEach(s.metasMes,(function(a,t){s.metasMes[t]=0})),p()},s.hasAlteracao=function(a){return!s.loading&&Math.abs(s.metasMes[a])!=Math.abs(s.metasOrg[a])},s.validarSomaFilhos=h;var u={},d=r.categorias.filter((function(a){var t="rd"==s.service.tipoMeta?s.tipo:"s"==s.tipo?"d":"r";return"t"==a.tipo&&"orcamento"==s.service.tipoMeta||a.tipo==t}));function m(a,t){return n.query({inicio:a,tipo:s.service.tipoMeta,inativas:!0}).then((function(a){return a.forEach((function(a){a.categoria&&a.tipo==s.tipo&&(t[a.categoria]=a.valor)})),a}))}function f(){var a=0;return s.categorias.forEach((function(t){s.metasMes[t.id]?a+=Math.abs(s.metasMes[t.id]):t.filhos&&t.filhos.forEach((function(t){a+=Math.abs(s.metasMes[t.id])}))})),a}function p(){var a=f();(!s.editandoTotal||Math.abs(s.metaTotal)<a)&&(s.metaTotal=a)}function v(){s.categorias.forEach(g)}function g(a){Math.abs(s.metasMes[a.id]);var t=0;a.filhos.forEach((function(a){t+=Math.abs(s.metasMes[a.id])})),t>0&&(a.expanded=!0),p()}function h(a){if(!a.filhos||!s.metasMes[a.id])return!0;var t=a.filhos.reduce((function(a,t){return a+s.metasMes[t.id]}),0);return Math.abs(t)<=Math.abs(s.metasMes[a.id])}d.forEach((function(a){s.metasMes[a.id]=0,s.metasUltMes[a.id]=0,s.metasUltAno[a.id]=0})),d.forEach((function(a){a.pai?(u[a.pai]||(u[a.pai]={filhos:[]}),u[a.pai].filhos.push(a)):(u[a.id]||(u[a.id]={filhos:[]}),u[a.id].id=a.id,u[a.id].nome=a.nome,u[a.id].tipo=a.tipo,u[a.id].status=a.status,u[a.id]._ordenacao=a._ordenacao)})),s.categorias=[],s.transferencias=[],angular.forEach(u,(function(a){"t"==a.tipo?s.transferencias.push(a):s.categorias.push(a)})),s.loading=!0,a.all([m(s.mes,s.metasMes).then((function(a){s.categorias.forEach(g);for(var t=0;t<a.length;t++)if(!a[t].categoria&&a[t].tipo==s.tipo){s.editandoTotal=!0,l=!0,s.metaTotal=Math.abs(a[t].valor);break}return s.metasOrg=angular.copy(s.metasMes),a})),m(s.ultMes,s.metasUltMes),m(s.ultAno,s.metasUltAno)]).then((function(){s.loading=!1}))}a.$inject=["$q","$mdDialog","moment","metasorcamentoService","metasorcamentoDatasource","cadastrosDatasource","mdwApiError","mdwAnalytics"],angular.module("md").controller("MetasOrcamentoDefinirController",a)}(),function(){"use strict";function a(a,t,o,e){var n=this;n.service=o,n.configSvc=e,n.printConfig={controller:["metasorcamentoService",function(a){this.service=a}],templateUrl:"/partials/metas/orcamento/metasorcamento.print.html"},n.service.attrs.rd.tipo=t,n.service.carregar(),n.getParamsDetalhes=function(a){var t=n.service.attrs[n.service.tipoMeta].inicio.format("YYYY-MM-DD"),o=n.service.attrs[n.service.tipoMeta].fim.format("YYYY-MM-DD"),e=n.service.attrs[n.service.tipoMeta].interval,r={cat:a,inicio:t,fim:o,i:e};return r.pendentes="c"==n.service.attrs[n.service.tipoMeta].situacao?0:1,r.regime=n.service.attrs[n.service.tipoMeta].regime,r},a.$on("$destroy",o.addObserver(o.carregar))}a.$inject=["$scope","tipoMetaRd","metasorcamentoService","configuracoesService"],angular.module("md").controller("MetasOrcamentoController",a)}(),function(){"use strict";function a(a,t,o,e){var n=this,r=t(),i=a("/metas/orcamento/:id");n.query=function(a){return i.get(a).then((function(a){return a}))},n.salvar=function(a){return o.post("/metas/orcamento",{metas:a}).then((function(a){i.reset();var t=r.notify();return e.notify(t),a.data}))},n.addObserver=r.add}a.$inject=["mdwCache","mdwObserver","$http","lancamentosDatasource"],angular.module("md").service("metasorcamentoDatasource",a)}(),function(){"use strict";function a(a,t,o){o.state({id:"metasrd",title:"Metas de orçamento",templates:["metas/orcamento/metasorcamento.html","metas/orcamento/metasorcamento.listar.html"]},{abstract:!0,url:"/metas",template:"<div layout='row' flex ui-view></div>",controller:["$scope","mdwTopmenu",function(a,t){t.preservStateParams=!0,t.setTabs(a,[{label:"Despesas",state:"metasrd.lista.despesa"},{label:"Receitas",state:"metasrd.lista.receita"},{label:"Investimentos",state:"metasrd.investimentos.listar"},{label:"Evolução",state:"metasrd.evolucao.listar",preserve:!1}])}],controllerAs:"vm",data:{permmd:"metas.rd"}}),a.state("metasrd.lista",{abstract:!0,url:"",templateUrl:"partials/metas/orcamento/metasorcamento.html",controllerAs:"vm",controller:["metasorcamentoService","configuracoesService",function(a,t){this.service=a,this.configSvc=t}]}),["receita","despesa"].forEach((function(t){a.state("metasrd.lista."+t,{url:"/"+t+"?inicio&fim&i",templateUrl:"partials/metas/orcamento/metasorcamento.listar.html",controller:"MetasOrcamentoController",data:{disableMoeda:!0,enableMoeda:!0},controllerAs:"vm",resolve:{tipoMetaRd:function(){return t.substr(0,1)}}})}))}a.$inject=["$stateProvider","mdwStateDialogProvider","mdwBaseStateProvider"],angular.module("md").config(a)}(),function(){"use strict";function a(a,t,o,e,n,r,i,c,s,l,u){var d=this,m=o();function f(a,t){if(angular.isUndefined(t))return d.attrs[d.tipoMeta][a];d.attrs[d.tipoMeta][a]=t}function p(){e.updateConfig("metas_"+d.tipoMeta,{situacao:f("situacao"),subcategorias:f("subcategorias"),indefinidas:f("indefinidas"),regime:f("regime"),fs:f("fullscreen")?1:0,interval:f("interval"),ordenacao:f("ordenacao")})}function v(){var a=angular.copy(i);a.inicio&&a.fim||(a=s.getDefaultParams(f("calendarioConfig").interval)),f("inicio",n(a.inicio)),f("fim",n(a.fim))}function g(){return v(),d.loading=!0,d.semMetas=!0,r.v2.metasOrcamento({inicio:f("inicio").format("YYYY-MM-DD"),fim:f("fim").format("YYYY-MM-DD"),regime:f("regime"),indefinidas:f("indefinidas"),investimentos:!1}).then((function(a){d.loading=!1,d.metas=a,h()}))}function h(){angular.forEach(d.metas,(function(a,t){d.semMetas=!1,angular.forEach(a.categorias,(function(a){C(a,t),a.subcategorias&&(a.subcategorias.forEach((function(a){C(a,t)})),b(a.subcategorias))})),a.nome="Total de "+t,C(a,t),C(a.geral,t),b(a.categorias)}))}function C(a,t){"c"==f("situacao")?(a.valor=a.confirmado,a.cor=a.corConfirmada,a.razao=a.razaoConfirmada,a.residuo=a.realizarConfirmado,a.excedente=a.excedentec):(a.valor=a.projetado,a.cor=a.corProjetada,a.razao=a.razaoProjetada,a.residuo=a.realizarProjetado,a.situacao=a.situacaoprojetada,a.excedente=a.excedentep)}function b(a){var t=f("ordenacao"),o="a"==t,e=o?"":{e:"excedente",r:"residuo",c:"razao"}[t];a.sort((function(a,t){if(!o){var n=Math.abs(t[e])-Math.abs(a[e]);if(n)return n}return a.nome.toLowerCase()<t.nome.toLowerCase()?-1:1}))}d.attrs={},["rd"].forEach((function(a){var t=e.getConfig("metas_"+a,{tipo:"rd"==a?"d":"s",situacao:"c",subcategorias:!0,regime:"ca",fs:0,interval:"m",indefinidas:!1,ordenacao:"c"}),o=t.interval;d.attrs[a]={busca:{},config:t,tipo:t.tipo,interval:t.interval,fullscreen:1==t.fs,situacao:t.situacao,subcategorias:t.subcategorias,indefinidas:t.indefinidas,ordenacao:t.ordenacao,regime:t.regime,calendarioConfig:{restrict:["m","t","s","y"],interval:o,onUpdate:function(){o!=this.currentInterval&&(d.attrs[a].calendarioConfig.interval=this.currentInterval,d.attrs[a].interval=o=this.currentInterval,p())}}}})),d.tipoMeta="rd",d.addObserver=m.add,d.definir=function(){return u.dialogPlano("metas",(function(){return v(),a.show({id:"definir-meta-orcamento",templateUrl:"/partials/metas/orcamento/definir.html",controller:"MetasOrcamentoDefinirController",controllerAs:"vm",bindToController:!0,locals:{mes:f("inicio").format("YYYY-MM-DD"),tipo:f("tipo")}})}))},d.salvar=function(a){return l.salvar(a)},d.carregar=g,d.toggleTipo=p,d.toggleSituacao=function(){f("situacao","c"==f("situacao")?"p":"c"),h(),p()},d.toggleSubcategorias=function(){f("subcategorias",!f("subcategorias")),p()},d.toggleIndefinidas=function(){f("indefinidas",!f("indefinidas")),p(),g()},d.toggleRegime=function(){f("regime","ca"==f("regime")?"co":"ca"),g(),p()},d.toggleFullscreen=function(){f("fullscreen",!f("fullscreen")),p()},d.toggleSort=function(a){f("ordenacao",a),p(),g()},d.attr=f,d.getTipoStr=function(a){var t=f("tipo");return("d"==t?"despesa":"r"==t?"receita":"e"==t?"entrada":"saída")+(a?"s":"")},l.addObserver(m.notify)}a.$inject=["$mdDialog","$filter","mdwObserver","configuracoesService","moment","relatoriosDatasource","$stateParams","googleChartApiPromise","mdwCalendarService","metasorcamentoDatasource","usuariosService"],angular.module("md").service("metasorcamentoService",a)}(),function(){"use strict";function a(a,o,e,n,r,i,c){var s=this,l="FISICA"==c.usuario.conta.tipoPessoa,u=c.usuario.plano.tipo,d=l?3:2;function m(){s.plano.contas.sort((function(a,t){return a.identificador<t.identificador?-1:1}))}function f(a){return o.show({id:"exportar-carne-leao",templateUrl:"/partials/planocontas/exportar.html",controller:t,controllerAs:"vm",bindToController:!0,locals:a})}s.isPf=l,s.$onInit=function(){var a;(s.habilitado=l&&(2==u||3==u)||!l&&(11==u||12==u),s.habilitado)&&(s.loading=!0,(a=s.uploader=new i({url:"/api/v2/planoscontas/importar"+(l?"CarneLeao":""),headers:r.getHeaders(),autoUpload:!0})).onProgressItem=function(){s.errorMsg=null,s.loading=!0},a.onSuccessItem=function(a,t,o,e){s.loading=!1,s.plano=t,t&&m()},a.onErrorItem=function(a,t,o){s.loading=!1,s.errorFile=a,s.errorMsg=401==o||403==o?"Por favor, atualize a página e tente novamente.":t.error},n.query({tipo:d}).then((function(a){3!=d||a?(s.loading=!1,s.plano=a,a?m():l&&s.gerarTemplateSistema()):n.query({tipo:1}).then((function(a){s.loading=!1,s.plano=a,a?m():s.gerarTemplateSistema()}))})))},s.gerarTemplateSistema=function(){s.loading=!0,n.gerarTemplateSistema(d).then((function(a){s.loading=!1,s.plano=a}))},s.vincularCadastro=function(t,o){return e.vincularCadastro(t,s.plano,o).then((function(e){o[t]=e[t],a.showSimple("Conta atualizada")}))},s.excluirConta=function(t){return e.excluirConta(s.plano.contas[t]).then((function(){s.plano.contas.splice(t,1),a.showSimple("Conta excluída")}))},s.editarConta=function(t){return e.editarConta(s.plano,s.plano.contas[t]).then((function(o){console.log(o),s.plano.contas[t]=o,m(),a.showSimple("Conta atualizada")}))},s.criarConta=function(){return e.criarConta(s.plano).then((function(t){s.plano.contas.push(t),m(),a.showSimple("Conta criada")}))},s.excluirPlano=function(){return e.excluirPlano(s.plano).then((function(){s.plano=null,a.showSimple("Plano de contas excluído"),l&&s.gerarTemplateSistema()}))},s.exportar=function(){return f({plano:s.plano})},s.exportarCarneLeao=function(a){return f({plano:s.plano,carneleao:!0,ecac:a})}}function t(a,t,o){var e=this,n=3==e.plano.tipo;e.$onInit=function(){e.meses=[1,2,3,4,5,6,7,8,9,10,11,12],e.max=moment().startOf("month"),e.calendarioConfig={restrict:["m"],interval:"m"},e.inicio=moment().startOf("month").subtract(1,"month"),e.periodo=1,n&&(e.ocupacao=o.usuario.conta.config.ocupacao,e.ocupacao<0&&(e.ocupacao=null)),e.cpf=o.usuario.conta.cpfCnpj,e.hasCat=!1;for(var a=0;a<e.plano.contas.length;a++)if(e.plano.contas[a].categorias.length>0){e.hasCat=!0;break}},e.ok=function(){var a=moment(e.inicio).format("YYYY-MM-DD"),r=moment(a).add(e.periodo,"months").subtract(1,"day").format("YYYY-MM-DD"),i=moment(a).format("YYYYMM"),c=moment(r).format("YYYYMM");e.nomeArquivo=e.cpf.replace(/[^0-9]/g,"")+"-"+i,i!=c&&(e.nomeArquivo+="-"+c),e.nomeArquivo+=".csv";var s={plano:e.plano.id,inicio:a,fim:r,ecac:e.ecac};return n&&(s.tipoexp=e.tipoexp,s.ocupacao=e.ocupacao),t.exportar(s).then((function(a){n&&null!==e.ocupacao&&e.ocupacao!=o.usuario.conta.config.ocupacao&&o.updateConfigKey("ocupacao",e.ocupacao),function(a,t,o){if(null!=o&&navigator.msSaveBlob)return navigator.msSaveBlob(new Blob([o],{type:t}),a);var e=angular.element("<a style='display: none;'/>"),n=window.URL.createObjectURL(new Blob([o],{type:t}));e.attr("href",n),e.attr("download",a),angular.element(document.body).append(e),e[0].click(),window.URL.revokeObjectURL(n),e.remove()}(e.nomeArquivo,"text/csv",a)}))}}a.$inject=["$mdToast","$mdDialog","planoContasService","planoContasDatasource","mdHeadersFactory","FileUploader","usuariosService"],t.$inject=["$mdDialog","planoContasDatasource","usuariosService"],angular.module("md").controller("ContabilidadeController",a)}(),function(){"use strict";function a(a,t,o,e){var n=this,r=t(),i=a("/api/v2/planoscontas/:id");n.query=function(a){return i.get(a)},n.gerarTemplateSistema=function(a){return o.post("/api/v2/planoscontas/templateSistema/"+a).then((function(a){return a.data}))},n.criarContaContabil=function(a){return o.post("/api/v2/planoscontas/contas",a).then((function(a){return a.data}))},n.updateContaContabil=function(a){return o.put("/api/v2/planoscontas/contas/"+a.id,a).then((function(a){return a.data}))},n.excluirConta=function(a){return o.delete("/api/v2/planoscontas/contas/"+a)},n.excluirPlano=function(a){return o.delete("/api/v2/planoscontas/"+a)},n.exportar=function(a){return o.get("/api/v2/lancamentos/contabilidade",{params:a}).then((function(a){return a.data}))},n.addObserver=r.add}a.$inject=["mdwCache","mdwObserver","$http","lancamentosDatasource"],angular.module("md").service("planoContasDatasource",a)}(),function(){"use strict";function a(a,t){return{vincularCadastro:function(t,o,e,n){return a.show({id:"vincular-cadastro-cc",templateUrl:"/partials/planocontas/vincularCadastro.html",controller:"VincularCadastroCCController",controllerAs:"vm",bindToController:!0,locals:{tipoCadastro:t,cadastros:n,plano:o,contaContabil:angular.copy(e)}})},excluirConta:function(t){return o.$inject=["planoContasDatasource"],a.show({id:"excluir-conta-cc",templateUrl:"/partials/planocontas/excluirConta.html",controller:o,controllerAs:"vm",bindToController:!0,locals:{conta:t}});function o(t){var o=this;o.excluir=function(){return t.excluirConta(o.conta.id).then((function(){a.hide()}))}}},editarConta:o,criarConta:function(a){return o(a)},excluirPlano:function(o){return e.$inject=["planoContasDatasource","usuariosService"],a.show({id:"excluir-plano-cc",templateUrl:"/partials/planocontas/excluirPlano.html",controller:e,controllerAs:"vm",bindToController:!0,locals:{plano:o}});function e(o,e){var n=this;n.isPf="FISICA"==e.usuario.conta.tipoPessoa,n.excluir=function(){return t.post("/apiweb/usuarios/validarSenha",{senha:n.senha}).then((function(t){if(t.data)return o.excluirPlano(n.plano.id).then((function(){a.hide()}));n.senhaInvalida=!0}))}}}};function o(t,o){return e.$inject=["planoContasDatasource"],a.show({id:"editar-conta-cc",templateUrl:"/partials/planocontas/editarConta.html",controller:e,controllerAs:"vm",bindToController:!0,locals:{conta:angular.copy(o||{}),plano:t}});function e(t){var o=this;o.ok=function(){var e=o.conta.id?"updateContaContabil":"criarContaContabil";return o.conta.plano=o.plano.id,t[e](o.conta).then((function(t){return a.hide(t)}))}}}}a.$inject=["$mdDialog","$http"],angular.module("md").factory("planoContasService",a)}(),function(){"use strict";function a(a,t){var o="FISICA"==a.$get().mdconfig.usuario.conta.tipoPessoa;t.state({id:o?"carneleao":"contabilidade",title:o?"Carnê Leão":"Integração Contábil"},{url:"/"+(o?"carneleao":"contabilidade"),templateUrl:"partials/planocontas/contabilidade.html",controller:"ContabilidadeController",controllerAs:"vm",data:{permmd:"outros.carneleao",enableMoeda:!0,disableMoeda:!0,moeda:1}})}a.$inject=["$windowProvider","mdwBaseStateProvider"],angular.module("md").config(a)}(),function(){"use strict";function a(a,t,o,e){var n=this;n.$onInit=function(){n.items=[],n.itemsOrg=[];var a={};n.plano.contas.forEach((function(t){n.contaContabil.id!=t.id&&t[n.tipoCadastro].forEach((function(t){a[t]=!0}))})),t[n.tipoCadastro].forEach((function(t){if(!a[t.id]&&t.status&&("categorias"!=n.tipoCadastro||"t"!=t.tipo)){if(1==n.plano.tipo){if(n.contaContabil.identificador<4e3&&"d"==t.tipo)return;if(n.contaContabil.identificador>=4e3&&"r"==t.tipo)return}else if(3==n.plano.tipo){if("P"==n.contaContabil.identificador[0]&&"r"==t.tipo)return;if("R"==n.contaContabil.identificador[0]&&"d"==t.tipo)return}var o={id:t.id,name:t.nome,status:t.status,checked:-1!=n.contaContabil.categorias.indexOf(t.id)};n.itemsOrg.push(o),n.items.push(o)}}))},n.search=function(){var a=e(n.query).replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),t=new RegExp("(^"+a+")|("+(n.query.length<4?"\\s+":"")+a+")","i");n.items=n.itemsOrg.filter((function(a){return e(a.name).match(t)}))},n.ok=function(){var t=[];return n.itemsOrg.forEach((function(a){a.checked&&t.push(a.id)})),n.contaContabil[n.tipoCadastro]=t,o.updateContaContabil(n.contaContabil).then((function(t){return a.hide(t)}))}}a.$inject=["$mdDialog","cadastrosDatasource","planoContasDatasource","mdwAccentFold"],angular.module("md").controller("VincularCadastroCCController",a)}(),function(){"use strict";function a(a,t,o,e,n,r){var i=this,c=!!e&&!!e.id&&!i.clonar;i.configuracoesService=r,i.edicao=c,i.proposta=angular.extend({titulo:"",status:1,observacoes:"",formaPagto:"",itens:[["",0],["",0]]},e||{}),i.financeiro=!!i.proposta.financeiro,i.clonar&&(i.proposta.status=1,i.financeiro=0,delete i.proposta.id,delete i.proposta.identificador),i.proposta.id||(i.loadingId=!0,n.carregarProximoNumero().then((function(a){i.loadingId=!1,i.proposta.identificador=""+a}))),i.ok=function(){return i.proposta.financeiro=i.financeiro,(c?n.update(i.proposta):n.create(i.proposta)).then((function(){t.hide(i.proposta)}))},i.dismiss=function(){t.cancel()},i.adicionarItem=function(){i.proposta.itens.push(["",0])},i.removerItem=function(a){i.proposta.itens.splice(a,1)}}a.$inject=["$scope","$mdDialog","cadastrosDatasource","proposta","propostasService","configuracoesService"],angular.module("md").controller("EditarPropostaController",a)}(),function(){"use strict";function a(a,t,o,e,n){var r=this;function i(){e.carregarUtilizacao().then((function(a){r.utilizacao=a,r.razaoUtilizacao=100*a/r.totalPropostas,r.cor=r.razaoUtilizacao>.7?"#f79483":r.razaoUtilizacao>1?"#f7ea83":"#7fce7a"}))}r.service=o,t.title="Propostas comerciais",a.$on("$destroy",r.service.addObserver(i)),i(),r.utilizacao=0,r.totalPropostas=n.usuario.plano.permissoes.propostas,r.razaoUtilizacao=0}function t(a,t,o){var e=this;function n(){e.service.carregarPropostas(t.inicio,t.b)}e.service=o,e.service.loading=!0,e.$onInit=n,a.$on("$destroy",e.service.addObserver(n))}a.$inject=["$scope","mdwTopmenu","propostasListaService","propostasService","usuariosService"],t.$inject=["$scope","$stateParams","propostasListaService"],angular.module("md").controller("PropostasController",a).controller("PropostasListaController",t)}(),function(){"use strict";function a(a){a.define("propostas","/propostas/:id")}function t(a,t,o,e){var n=this,r=o("propostasDatasource"),i=a("/propostas/:id"),c=a("/propostas/utilizacao"),s=a("/propostas/proximo");function l(a){i.reset(),r.notify(a)}t("propostas",{insert:function(a){c.reset(),s.reset(),l(a)},update:l,delete:l}),n.get=function(a){return e.get("propostas/"+a).then((function(a){return a.data}))},n.query=function(a){return e.get("propostas",{params:a}).then((function(a){return a.data}))},n.enviarProposta=function(a,t,o){return e.post("propostas/"+a.id+"/enviar",{email:t,cc:o}).then((function(){l()}))},n.utilizacao=function(){return c.get()},n.proximo=function(){return s.get()},n.addObserver=r.add}a.$inject=["mdwResourceProvider"],t.$inject=["mdwCache","mdwResourceObserver","mdwObserver","$http"],angular.module("md").config(a).service("propostasDatasource",t)}(),function(){"use strict";angular.module("md").filter("mdwPropostaStatusName",(function(){return function(a){return 1===a?"Pendente":2===a?"Enviada":3===a?"Aprovada":4===a?"Não aprovada":5===a?"Cancelada":void 0}}))}(),function(){"use strict";function a(a,t,o){o.state({id:"propostas",title:"Propostas comerciais",templates:["propostas/propostas.html"]},{url:"/propostas",templateUrl:"partials/propostas/propostas.html",controller:"PropostasController",abstract:!0,controllerAs:"vm",data:{permmd:"outros.propostas"}}),a.state("propostas.listar",{url:"?inicio&b",templateUrl:"partials/propostas/propostas.lista.html",controller:"PropostasListaController",controllerAs:"vm",data:{disableMoeda:!0},resolve:{security:["usuariosService","$q",function(a,t){if(!a.canView("outros.propostas"))return t.reject(403)}]}}).state("propostas.listar.nova",t.getState({url:"/nova",params:{id:null,tipo:"d"},action:"propostasService.nova",data:{permmdt:"g"}})).state("propostas.listar.editar",t.getState({url:"/editar/:id",action:"propostasService.editar",data:{permmdt:"g"}})).state("propostas.listar.clonar",t.getState({url:"/clonar/:id",action:"propostasService.clonar",data:{permmdt:"g"}}))}a.$inject=["$stateProvider","mdwStateDialogProvider","mdwBaseStateProvider"],angular.module("md").config(a)}(),function(){"use strict";function a(a,t,o,e,n,r){var i=e("propostas");return{create:function(a){return i.insert(a).then((function(){t.showSimple("Proposta comercial criada")}))},update:function(a){return i.update(a).then((function(){t.showSimple("Proposta comercial atualizada")}))},nova:function(a){return r.dialogPlanoPropostas((function(){return c(a)}))},editar:c,clonar:function(a){return r.dialogPlanoPropostas((function(){return c(a,!0)}))},carregarPropostas:function(a){return n.query(a)},enviarProposta:function(a,t,o){return n.enviarProposta(a,t,o)},carregarUtilizacao:function(){return n.utilizacao()},carregarProximoNumero:function(){return n.proximo()}};function c(t,o){var e=!!t&&!!t.id;return a.show({id:"editar-proposta",templateUrl:"/partials/propostas/editarProposta.html",controller:"EditarPropostaController",controllerAs:"vm",bindToController:!0,locals:{clonar:!!o},resolve:{proposta:function(){if(e)return n.get(t.id)}}})}}a.$inject=["$mdDialog","$mdToast","$http","mdwResource","propostasDatasource","usuariosService"],angular.module("md").factory("propostasService",a)}(),function(){"use strict";function a(a,t,o,e,n,r,i,c){var s=this;function l(a){s.filtro=a,s.propostasBusca=s.propostas.filter((function(a){return s.filtro===a.status}))}s.addObserver=n.addObserver,s.carregarPropostas=function(a,t){var n=r.getDefaultParams("m",!0);s.inicio=a?o(a).format("YYYY-MM-DD"):n.inicio,s.isBusca=!!t,s.busca={},s.isBusca&&(s.busca=angular.fromJson(atob(t)));return e.carregarPropostas({inicio:s.inicio,busca:t}).then((function(a){s.loading=!1,s.propostas=a,s.msgMaxResults=!1,s.isBusca&&51==a.length&&(s.msgMaxResults=!0,s.propostas.pop()),s.cnt={1:0,2:0,3:0,4:0,5:0},a.forEach((function(a){s.cnt[a.status]+=1})),s.isBusca?s.propostasBusca=s.propostas:l(s.filtro)}))},s.filtrar=l,s.enviarProposta=function(t){var o=i.get("contatos",t.contato,!0);a.show({id:"enviar-proposta",controller:["$mdConstant",function(o){var n=this;n.emails=[],n.email=n.contato.email,n.ok=function(){return e.enviarProposta(t,n.email,n.emails).then((function(){return a.hide()}))}}],bindToController:!0,controllerAs:"vm",locals:{contato:angular.copy(o)},templateUrl:"/partials/propostas/enviarPropostaDialog.html"})},s.criarFinanceiro=function(a){c.novo({base:{tipo:"r",valor:a.valor,contato:a.contato,observacoes:a.titulo,data:moment()}}).then((function(){a.financeiro=moment().format(),e.update(a)}))},s.cancelarProposta=function(a){a.status=5,e.update(a)},s.buscaAvancada=function(){var a=angular.toJson(s.busca);if("{}"===a)return;var o=btoa(a);t.go("propostas.listar",{b:o})},s.resetBusca=function(){s.busca={},t.go("propostas.listar",{b:void 0})},s.loading=!0,s.calendarioConfig={restrict:["m"],interval:"m"},s.filtro=1,s.busca={},s.isBusca=!1,s.propostas=[],s.propostasBusca=[]}a.$inject=["$mdDialog","$state","mdwMoment","propostasService","propostasDatasource","mdwCalendarService","cadastrosDatasource","lancamentosService"],angular.module("md").service("propostasListaService",a)}(),function(){"use strict";function a(a,t,o,e,n,r){var i=this,c=!!e&&!!e.id;i.configuracoesService=r,i.edicao=c,i.regra=angular.extend({tipoLancamento:"d"},e||{}),i.ok=function(){i.edicaoCartao||(i.regra.plastico=null);i.regra.isImportacaoV2&&delete i.regra.isImportacaoV2;return(c?n.update(i.regra):n.create(i.regra)).then((function(a){return t.hide(a)}))},i.dismiss=function(){t.cancel()},i.$onInit=function(){i.regra.isImportacaoV2&&(i.sugerirDescricao=1,i.changeSugerirDescricao())},i.changeSugerirDescricao=function(){i.regra.nome=1==i.sugerirDescricao?i.regra.descricao:(a=i.regra.descricao,a.split(/\s+/).filter((a=>a.length>4)).join(","));var a},a.$watch("vm.regra.conta",(function(a){const t=o.get("contas",a,!0);i.edicaoCartao=!!a&&"CARTAOCREDITO"==t.tipo;const e=o.get("plasticos",i.regra.plastico,!0).conta;t.id!=e&&(i.regra.plastico=null)}))}a.$inject=["$scope","$mdDialog","cadastrosDatasource","regra","regrasService","configuracoesService"],angular.module("md").controller("EditarRegraController",a)}(),function(){"use strict";function a(a,t,o,e,n,r){const i=this;i.regra={},i.configuracoesService=t,i.dismiss=function(){a.cancel()},i.regra.tipoLancamento=i.tipoLancamento,n.$watch("vm.regra.conta",(function(a){i.edicaoCartao=!!a&&"CARTAOCREDITO"==r.get("contas",a,!0).tipo,i.edicaoCartao||(i.regra.plastico=null)})),i.ok=function(){return o.salvarLote(i.regra,i.ids).then((function(){e.showSimple("Regras de preenchimento atualizadas"),a.hide()}))}}a.$inject=["$mdDialog","configuracoesService","regrasService","$mdToast","$scope","cadastrosDatasource"],angular.module("md").controller("EditarRegraLoteController",a)}(),function(){"use strict";angular.module("md").filter("filtroListarCategorias",(function(){return function(a,t){var o;return angular.forEach(t,(function(t,e){t.id===a&&(o=t.nome)})),o}}))}(),function(){"use strict";angular.module("md").directive("mdwRegrasAutocomplete",(function(){return a.$inject=["$scope","cadastrosDatasource","usuariosService","regrasService","configuracoesService"],{restrict:"E",require:"^ngModel",scope:{l:"=ngModel",hasSelected:"=?",filter:"="},templateUrl:"/partials/regras/mdwRegrasAutocomplete.html",controllerAs:"vm",controller:a,bindToController:!0};function a(a,t,o,e,n){var r=this;r.query=function(a){var t=e.buscarRegras(a);r.filter&&(t=t.filter((function(a){return r.filter==a.tipoLancamento})));return t},r.selectRegra=function(a){if(!a)return;var e=n.utilizacao;r.hasSelected=!0,r.l.descricao=a.descricao,r.l.tipo=a.tipoLancamento,r.l.categoria=c("categorias",a.categoria)||r.l.categoria,e.formas&&(r.l.forma=c("formas",a.forma)||r.l.forma);e.centros&&(r.l.centro=c("centros",a.centro)||r.l.centro);e.contatos&&(r.l.contato=c("contatos",a.contato)||r.l.contato);e.projetos&&(r.l.projeto=c("projetos",a.projeto)||r.l.projeto);e.tags&&(r.l.tags=function(a,t){let o=[];for(const e of t){const t=c(a,e);t&&o.push(t)}return o}("tags",a.tags)||r.l.tags);var i=r.l.plastico;if(r.l.plastico=c("plasticos",a.plastico)||r.l.plastico,"t"==r.l.tipo)r.l.contaOrigem=r.l.conta||c("contas",a.conta),r.l.contaDestino=r.l.contaT||c("contas",a.contaDestino),r.l.tipoL&&(r.l.contaT="td"==r.l.tipoL?r.l.contaDestino:"to"==r.l.tipoL?r.l.contaOrigem:r.l.contaT),r.l.valor&&(r.l.conta||(r.l.conta=r.l.valor<=0?r.l.contaOrigem:r.l.contaDestino),r.l.contaT||(r.l.contaT=r.l.valor>0?r.l.contaOrigem:r.l.contaDestino));else{if(r.l.conta=r.l.conta||c("contas",a.conta),r.l.plastico)t.get("plasticos",r.l.plastico,!0).conta!=r.l.conta&&(r.l.plastico=i)}function c(a,e){if(e){var n=t.get(a,e,!0);if(n&&n.status){if(("contas"==a||"projetos"==a||"centros"==a)&&o.hasRest(a,e))return;return e}}}},a.$watch("vm.l",(function(a){r.searchText=a.descricao}),!0),a.$watch("vm.searchText",(function(a){a=a||"",r.l.descricao=a.trim(),r.l.descricao||(r.hasSelected=!1)}))}}))}(),function(){"use strict";function a(a,t,o,e,n,r){var i=this;function c(){return i.checkboxes={}}function s(){return u(i.tipoSel).length}function l(){i.regrasDespesa=u("d"),i.regrasReceita=u("r"),i.regrasTransferencia=u("t")}function u(a){var t=[];for(var o in i.regras)i.regras[o].tipoLancamento==a&&t.push(i.regras[o]);return t}function d(){var a=0;return angular.forEach(i.checkboxes,(function(t){t&&a++})),a}e.title="Regras de preenchimento",i.regras=r.regras,i.regraSelecionada=[],i.tipoSel=null,i.searchInput="",l(),i.regraSelecionada.length||(i.regrasDespesa.length>0?(i.regraSelecionada=i.regrasDespesa,i.tipoSel="d"):i.regrasReceita.length>0?(i.regraSelecionada=i.regrasReceita,i.tipoSel="r"):i.regrasTransferencia.length>0?(i.regraSelecionada=i.regrasTransferencia,i.tipoSel="t"):(i.regraSelecionada=[],i.tipoSel="d")),i.toggleStatus=function(a){a.status=!a.status,n.update(a)},i.toggleAll=function(a){angular.isUndefined(a)&&(a=s()!=d());for(const t of i.regraSelecionada)i.checkboxes[t.id]=a},i.totalTipoSelecionado=s,i.removerSelecionados=function(){var a=[];angular.forEach(i.checkboxes,(function(t,o){t&&a.push(o)})),n.excluirLote(a).then((function(){i.regras=r.regras}))},i.editarSelecionados=function(){var a=[];angular.forEach(i.checkboxes,(function(t,o){t&&a.push(o)})),n.editarLote(a,i.tipoSel).then((function(){i.regras=r.regras,c()}))},i.countSelected=d,i.searchRegra=function(){c(),i.hasSearched||(i.regrasSearch=i.regraSelecionada,i.hasSearched=!0);var a=i.searchInput;i.regraSelecionada=i.regrasSearch.filter((function(t){return t.nome.toLowerCase().indexOf(a.toLowerCase())>=0||t.descricao.toLowerCase().indexOf(a.toLowerCase())>=0}))},i.selecionaRegra=function(a){i.searchInput="",i.hasSearched=!1,i.regrasSearch=[],void c(),i.tipoSel!==a&&c();i.tipoSel=a,"d"==a&&(i.regraSelecionada=i.regrasDespesa);"r"==a&&(i.regraSelecionada=i.regrasReceita);"t"==a&&(i.regraSelecionada=i.regrasTransferencia)},i.hasSearched=!1,i.selected={},a.$watchCollection("vm.regras",(function(a){l(),i.regraSelecionada=u(i.tipoSel),c();for(var t=0;t<a.length;t++)i.checkboxes[a[t].id]=!1})),a.$watch("vm.checkboxes",(function(a){d()>0?e.changeTemplateUrl("/partials/regras/acoesLoteTopmenu.html",i):e.changeTemplateUrl()}),!0)}a.$inject=["$scope","$window","$timeout","mdwTopmenu","regrasService","cadastrosDatasource"],angular.module("md").controller("RegrasController",a)}(),function(){"use strict";function a(a,t,o){o.state({id:"regras",title:"Regras de preenchimento",templates:["regras/regras.html"]},{url:"/regras",templateUrl:"partials/regras/regras.html",controller:"RegrasController",controllerAs:"vm",data:{permmd:"outros.regras"}}),a.state("regras.nova",t.getState({url:"/nova",params:{id:null,tipo:"d"},action:"regrasService.nova",data:{permmdt:"g"}})).state("regras.editar",t.getState({url:"/editar/:id",action:"regrasService.editar",data:{permmdt:"g"}})).state("regras.excluir",t.getState({url:"/excluir/:id",action:"regrasService.excluir",data:{permmdt:"e"}})).state("regras.clonar",t.getState({url:"/clonar/:id",action:"regrasService.clonar",data:{permmdt:"g"}}))}a.$inject=["$stateProvider","mdwStateDialogProvider","mdwBaseStateProvider"],angular.module("md").config(a)}(),function(){"use strict";function a(a,t,o,e,n,r){var i=n("regras");return{create:function(a){return i.insert(a).then((function(a){return e.automationRuleSet(),t.showSimple("Regra de preenchimento criada"),a}))},update:function(a){return i.update(a).then((function(a){return t.showSimple("Regra de preenchimento atualizada"),a}))},delete:c,nova:s,editar:s,excluir:function(t){return a.show({id:"excluir-regra",templateUrl:"/partials/regras/excluirRegra.html",controller:["$mdDialog","regra",function(a,t){this.regra=t,this.ok=function(){return c(t).then((function(){return a.hide()}))}}],controllerAs:"vm",resolve:{regra:function(){return r.get("regras",t.id)}}})},clonar:function(t){return a.show({id:"clonar-regra",templateUrl:"/partials/regras/editarRegra.html",controller:"EditarRegraController",controllerAs:"vm",resolve:{regra:function(){return r.get("regras",t.id).then((a=>{const t=angular.copy(a);return t.id=null,t}))}}})},excluirLote:function(e){return a.show({id:"excluir-lote",templateUrl:"/partials/regras/excluirLote.html",locals:{quantidade:e.length,regras:e},bindToController:!0,controller:["$mdDialog","regras",function(a,e){e=e.map(parseFloat),this.ok=function(){return o.post("regras/excluirlote",{ids:e}).then((function(){r.regras=r.regras.filter((function(a){return-1==e.indexOf(a.id)})),t.showSimple("Regras de preenchimento excluídas"),a.hide()}))}}],controllerAs:"vm"})},editarLote:function(t,o){return a.show({id:"editar-lote",templateUrl:"/partials/regras/editarRegraLote.html",controller:"EditarRegraLoteController",controllerAs:"vm",bindToController:!0,locals:{ids:t,tipoLancamento:o}})},salvarLote:function(a,t){return o.post("regras/editarlote",{ids:t,regraEdicao:a}).then((function(){let o=null;a.conta&&(o=r.get("contas",a.conta,!0)),t.forEach((t=>{const e=r.get("regras",t,!0);if((0===a.conta||o&&("CARTAOCREDITO"!==o.tipo||e.conta!==o.id))&&(e.plastico=null),a.ntags&&angular.isArray(e.tags)){const t=[],o=a.ntags;e.tags.forEach((a=>{o.includes(a)||t.push(a)})),e.tags=t}if(a.tags){const t=[];if(angular.isArray(e.tags)){for(let o of a.tags)e.tags.includes(o)||t.push(o);e.tags=e.tags.concat(t)}else e.tags=a.tags}angular.forEach(a,((a,t)=>{null!=a&&"tags"!=t&&"ntags"!=t&&(e[t]=0===a?null:a)}))}))}))},buscarRegras:function(a){return a=l(a),r.regras.filter((function(t){if(!t.status)return!1;var o=t.nome.split(/\s*,\s*/);o.push(t.descricao);for(var e=0;e<o.length;e++)if(o[e]&&o[e].match(new RegExp("(^"+a+")|(\\s+"+a+")","i")))return!0;return!1}))},buscarRegrasLancamento:function(a){return r.regras.filter((function(t){return u(t,a)}))},matchRegraLancamento:u};function c(a,o){return i.delete(a,o).then((function(){t.showSimple("Regra de preenchimento excluída")}))}function s(t){var o=!!t&&!!t.id;return a.show({id:"editar-regra",templateUrl:"/partials/regras/editarRegra.html",controller:"EditarRegraController",controllerAs:"vm",resolve:{regra:function(){return o?r.get("regras",t.id):t}}})}function l(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function u(a,t){if(!a.status)return!1;var o=a.nome.split(/\s*,\s*/);o.push(a.descricao);for(var e=0;e<o.length;e++)if(o[e]){var n=l(o[e]);if(t.match(new RegExp("(^"+n+")|(\\s+"+n+")","i")))return!0}return!1}}a.$inject=["$mdDialog","$mdToast","$http","mdwAnalytics","mdwResource","cadastrosDatasource"],angular.module("md").factory("regrasService",a)}(),function(){"use strict";angular.module("md").filter("tipoLancamentoRegra",(function(){return function(a){return"d"==a?"Despesa":"r"==a?"Receita":"Transferência"}}))}(),function(){"use strict";function a(a,t,o,e){var n=this;function r(t){if((t=angular.extend({name:"Valor",legend:!1,_cols:[],chartArea:{width:"80%",height:"80%"},colors:[o.getHexColor("blue",400)],filter:function(t){return a("currency")(t,"R$")}},t||{}))._data){var r=[],i=[{type:"string",label:"Data"},{type:"number",label:t.name}];t._data.forEach((function(a){var o=0;angular.forEach(a,(function(a,e){r[o]||(r[o]={c:[{v:"m"==n.intervalo.id?moment(e+"-01").format("MMM/YY"):e}]}),r[o].c.push({v:Math.abs(a.valor),f:t.filter(a.valor)}),o++}))})),t._cols.forEach((function(a){i.push({type:"number",label:a})})),t.data={cols:i,rows:r}}return{type:"ColumnChart",data:t.data,options:e.prepareChartOptions({colors:t.colors,tooltip:{trigger:"selection"},hAxis:{gridlines:{color:"transparent"}},vAxis:{baseline:0,baselineColor:"#888",gridlines:{color:"#e2e2e2"}},legend:{position:t.legend?"top":"none"},chartArea:t.chartArea})}}n.getCharts=function(e){if(n.charts={},n.dateFormat="m"==e.intervalo.id?"MM/yy":"YYYY",n.datePattern="m"==e.intervalo.id?'"MMM yyyy"':"YYYY",n.intervalo=e.intervalo,n.cadId=e.cadId,n.catDatasMap=e.catDatasMap,n.grupoDatasMap=e.grupoDatasMap,n.grupos=e.grupos,n.tipoRel=e.tipoRel,n.isDespesas=e.isDespesas,n.cadId||0==n.cadId){n.cad=t.get(n.tipoRel+"s",n.cadId,!0),"categoria"==n.tipoRel&&(n.nome=n.cad.nomeRel),0==n.cadId?n.nome="Sem "+n.tipoRel:n.nome=n.cad.nome;var i=n.isDespesas?"red":"green";if(n.charts.comparativo={label:"Comparativo",chart:r({name:n.nome,legend:!0,_cols:["Total de "+(n.isDespesas?"despesas":"receitas")],_data:[n.catDatasMap,n.grupoDatasMap],colors:[o.getHexColor(i,400),o.getHexColor(i,900)]})},n.charts.valores={label:"Valores",chart:r({_data:[n.catDatasMap],colors:[o.getHexColor(i,400)]})},n.isDespesas){var c={};angular.forEach(n.catDatasMap,(function(a,t){c[t]={valor:Math.abs(a.valor)/n.grupoDatasMap[t].valor*100}})),n.charts.comprometimento={label:"Comprometimento (%)",chart:r({_data:[c],filter:function(t){return a("number")(t,2)+"%"},chartArea:{width:"86%",height:"80%"}})}}}else{n.grupos.forEach((function(a){"Receitas"==a.nome&&(n.receitas=a.datasMap,n.totalReceitas=a.total),"Despesas"==a.nome&&(n.despesas=a.datasMap,n.totalDespesas=Math.abs(a.total))}));var s=function(t){return a("currency")(t,"R$")};n.charts.resultado={label:"Resultado",chart:r({type:"ColumnChart",data:{cols:[{type:"string"},{type:"number",label:"Receitas"},{type:"number",label:"Despesas"}],rows:[{c:[{v:""},{v:n.totalReceitas,f:s(n.totalReceitas)},{v:n.totalDespesas,f:s(n.totalDespesas)}]}]},colors:[o.getHexColor("green",400),o.getHexColor("red",400)],vAxis:{format:"short"},hAxis:{gridlines:{color:"transparent"}},chartArea:{width:"80%",height:"80%"},legend:{position:"top"}})},n.charts.comparativo={label:"Comparativo",chart:r({legend:!0,name:"Receitas",_cols:["Despesas"],_data:[n.receitas,n.despesas],colors:[o.getHexColor("green",400),o.getHexColor("red",400)]})},n.charts.receitas={label:"Receitas",chart:r({_data:[n.receitas],colors:[o.getHexColor("green",400)],chartArea:{width:"86%",height:"80%"}})},n.charts.despesas={label:"Despesas",chart:r({_data:[n.despesas],colors:[o.getHexColor("red",400)],chartArea:{width:"86%",height:"80%"}})};c={};angular.forEach(n.despesas,(function(a,t){c[t]={valor:Math.abs(a.valor)/n.receitas[t].valor*100}})),n.charts.comprometimento={label:"Comprometimento das despesas (%)",chart:r({_data:[c],filter:function(t){return a("number")(t,2)+"%"},chartArea:{width:"86%",height:"80%"}})}}return n.charts},n.charts={}}a.$inject=["$filter","cadastrosDatasource","mdwColors","mdwDarkModeService"],angular.module("md").service("evolucaoChartsService",a)}(),function(){"use strict";function a(a){var t=this;t.charts=a.getCharts(t.config),t.nome=a.nome}a.$inject=["evolucaoChartsService"],angular.module("md").controller("DetalharEvolucaocatController",a)}(),function(){"use strict";function a(a,t,o){var e=this;function n(){e.service.updateConfig();var t=angular.toJson(e.service.config);t=btoa(t),a.go(".",{inicio:moment(e.service.inicio).format("YYYY-MM-DD"),p:e.service.periodo,i:e.service.intervalo.id,r:t})}e.meses=[1,2,3,4,5,6,7,8,9,10,11,12,13],e.intervaloLabels=["Mensal","Anual"],e.intervaloLabel="",e.anos=[1,2,3,4,5],e.carregarRelatorio=n,e.outrasConfiguracoes=function(){t.show({id:"personalizar-evolucao",templateUrl:"partials/relatorios/evolucao/configuracoes.html",locals:{service:e.service,tipoCad:e.service.tipoCad,tipoRel:e.service.tipoRel,config:{visualC:"c"==e.service.visualizacaoDespesas,subcategorias:e.service.subcategorias,orderBy:e.service.orderBy,apenasMetasDefinidas:e.service.apenasMetasDefinidas,acumular:e.service.acumular,somarTotal:e.service.somarTotal}},bindToController:!0,controllerAs:"vm",controller:function(){var a=this;a.ok=function(){return t.hide(a.config)}}}).then((function(a){e.service.visualizacaoDespesas=1==a.visualC?"c":"v",e.service.toggleSubcateg=!(e.service.subcategorias==a.subcategorias),e.service.subcategorias=a.subcategorias,e.service.orderBy=a.orderBy,e.service.somarTotal=a.somarTotal,e.service.acumular=a.acumular,e.service.apenasMetasDefinidas=a.apenasMetasDefinidas,e.service.updateConfig(),n()}))},e.toggleRegime=function(){"ca"==e.service.regime?e.service.regime="co":e.service.regime="ca";n()},e.exportarRelatorio=function(){var a={};return a.intervalo=e.service.intervalo,a.datas=e.service.datas,a.tipoCad=e.service.tipoCad,a.realizado=e.service.visualizacaoRealizado,a.collapseSubCat=e.service.collapseSubCat,a.grupos=e.service.grupos,a.tipoRel=e.service.tipoRel,a.tipoCad=e.service.tipoCad,a.realizado=e.service.visualizacaoRealizado,a.collapseSubCat=e.service.collapseSubCat,a.collapseGrupo=e.service.collapseGrupo,a.visualizacaoRealizado=e.service.visualizacaoRealizado,o.post("/api/v2/relatorios/exportarEvolucao",a).then((function(a){!function(a,t,o){if(null!=o&&navigator.msSaveBlob)return navigator.msSaveBlob(new Blob([o],{type:t}),a);var e=angular.element("<a style='display: none;'/>"),n=window.URL.createObjectURL(new Blob([o],{type:t}));e.attr("href",n),e.attr("download",a),angular.element(document.body).append(e),e[0].click(),window.URL.revokeObjectURL(n),e.remove()}((e.service.nomeRel+moment().format("YYYYMMDDHHmmSS")).replace(/\.\w*$/,"")+".xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",function(a){for(var t=new ArrayBuffer(a.length),o=new Uint8Array(t),e=0;e!=a.length;++e)o[e]=255&a.charCodeAt(e);return t}(atob(a.data)))}))},e.onChangeIntervalo=function(){"Anual"==e.intervaloLabel?(e.service.intervalo={id:"y",label:"Anual"},e.service.periodoAnteriorMeses=e.service.periodo,e.service.periodo=e.service.periodoAnteriorAnos,e.service.inicio=moment().startOf("month").subtract(5,"year")):(e.service.intervalo={id:"m",label:"Mensal"},e.service.periodoAnteriorAnos=e.service.periodo,e.service.periodo=e.service.periodoAnteriorMeses,e.service.inicio=moment().startOf("month"))},e.togglePendentes=function(){e.service.pendentes=!e.service.pendentes,n()}}function t(a,t,o,e,n,r,i,c,s,l){var u=this;function d(){u.charts&&angular.forEach(u.charts,(function(a){l.prepareChartOptions(a.chart.options)}))}function m(){var t="/partials/relatorios/evolucao/print"+(u.service.tipoRel.match(/metas|resultadoProjetos/)?"Metas":"")+".html";a.$parent.vm.printConfig={landscape:!0,controller:function(){this.service=u.service,this.grupos=u.service.grupos,this.charts=u.charts,this.getRealizado=p,this.getARealizar=g,this.getMediaARealizar=v,this.getCollapseGrupo=f},templateUrl:t}}function f(a){if("rt"!=a.tipo)return"r"==a.tipo?u.service.collapseGrupo.r:"i"==a.tipo?u.service.collapseGrupo.i:"d"==a.tipo?u.service.collapseGrupo.d:void 0}function p(a){if(!a)return 0;var t="valor";return a[t]||0==a[t]||(t="total"),a[t]}function v(a){return a?a.realizarpMedia:0}function g(a){return a?a.realizarp:null}function h(){return u.loading=!0,"metas"==u.service.tipoRel?u.service.carregarRelatorio().then(D):"resultadoProjetos"==u.service.tipoRel?u.service.carregarRelatorio().then(S):u.service.carregarRelatorio().then($)}function C(a){var t={},o=[];return u.service.datas.forEach((function(a){var e={valor:0,meta:0,realizarp:0};t[a]=e,o.push(e)})),{nome:a,datas:o,datasMap:t,media:0,total:0,totalMeta:0,mediaMeta:0,realizarp:0,realizarpMedia:0}}function b(a){var t=C(a);return t.itens=[],t}function A(a){"a"==u.service.orderBy&&a.sort((function(a,t){return a.nome>t.nome?1:t.nome>a.nome?-1:0})),"c"==u.service.orderBy&&a.sort((function(a,t){return a.total-t.total})),"%"==u.service.orderBy&&a.sort((function(a,t){return t.total/t.totalMeta-a.total/a.totalMeta}))}function x(a,t){return t?a*t>0&&Math.abs(a)>Math.abs(t)?0:t-a:0}function S(a){u.loading=!1,u.service.rel=a.length>0;var t=b("Despesas"),o=b("Receitas"),e=b("Resultado");e.tipo="rt",u.service.grupos=[o,t,e];var n={},r=[];function i(a,t,o){u.service.datas.forEach((function(e){a.total+=t.datas[e].valor,null==t.datas[e].meta&&(t.datas[e].meta=0),a.media+=t.datas[e].valor/u.service.periodo,a.datasMap[e].valor+=t.datas[e].valor,o?(a.datasMap[e].meta=null,a.datasMap[e].realizarp=null):a.metasVirtuaisDefinidas&&!a.isSub||(a.datasMap[e].meta=t.datas[e].meta,"y"!=u.service.intervalo.id?a.datasMap[e].realizarp=x(t.datas[e].valor,t.datas[e].meta):a.datasMap[e].realizarp=t.datas[e].realizarp,a.realizarpMedia=a.datasMap[e].realizarp/u.service.periodo,a.mediaMeta+=t.datas[e].meta/u.service.periodo,a.totalMeta+=t.datas[e].meta)})),o?(a.realizarp=null,a.realizarpMedia=null,a.totalMeta=null,a.mediaMeta=null):a.realizarp>Math.abs(a.totalMeta)?a.realizarp=0:a.realizarp=x(a.total,a.totalMeta),a.metasVirtuaisDefinidas=!0}a.sort((function(a,t){var o=s.get(u.service.tipoCad+"s",a[u.service.tipoCad],!0),e=s.get(u.service.tipoCad+"s",t[u.service.tipoCad],!0);return o.pai?e.pai?0:1:-1})),a.forEach((function(a){var t,o=a[u.service.tipoCad],e=s.get(u.service.tipoCad+"s",o,!0),c=e.pai||a[u.service.tipoCad],l=o==c;a.tipo=e.tipo,"y"==u.service.intervalo.id&&(angular.forEach(a.datas,(function(t,o){if(4!=o.length){var e=o.slice(0,4);a.datas[e]?(null==t.valor&&(t.valor=0),null==t.meta&&(t.meta=0),a.datas[e].valor+=t.valor,a.datas[e].meta+=t.meta):(a.datas[e]=t,null==a.datas[e].meta&&(a.datas[e].meta=0)),delete a.datas[o]}})),u.service.datas.forEach((function(t){a.datas[t].realizarp=x(a.datas[t].valor,a.datas[t].meta)}))),n[t=l?"v"+o:"v"+c]||function(a,t,o,e,n){var r=C(s.get(u.service.tipoCad+"s",o,!0).nome);r.tipo=e.tipo,r.filhos=[],r.id=o,r.isSub=!1,r.metasDefinidas=!1,a[n]=r,t.push(a[n])}(n,r,c,a,t);var d=n[t],m=C(s.get(u.service.tipoCad+"s",o,!0).nomeRel);l&&(m.paiPura=!0),m.tipo=a.tipo,m.isSub=!0,m.id=o,d.filhos.push(m),i(d,a,!1),i(m,a,l)})),A(r),r.forEach((function(a){var n="d"==a.tipo?t:o;n.tipo=a.tipo,A(a.filhos),n.itens.push(a),a.filhos.length>1?(a.hasFilhos=!0,a.filhos.forEach((function(t){(!t.paiPura||t.paiPura&&0!=t.total)&&(t.paiId=a.id,n.itens.push(t))})),a.filhos=null):a.filhos[0].isSub?(a.hasFilhos=!0,(!a.filhos[0].paiPura||a.filhos[0].paiPura&&0!=a.filhos[0].total)&&(a.filhos[0].paiId=a.id,n.itens.push(a.filhos[0]))):a.hasFilhos=!1,(!u.service.collapseSubCat.iniciado&&a.id&&a.hasFilhos||u.service.toggleSubcateg)&&(u.service.collapseSubCat[a.tipo][a.id]=u.service.subcategorias),u.service.datas.forEach((function(t){a.datasMap[t].realizarp=x(a.datasMap[t].valor,a.datasMap[t].meta),n.datasMap[t].valor+=a.datasMap[t].valor,n.datasMap[t].meta+=a.datasMap[t].meta,n.total+=a.datasMap[t].valor,n.totalMeta+=a.datasMap[t].meta,n.media+=a.datasMap[t].valor/u.service.periodo,e.datasMap[t].valor+=a.datasMap[t].valor,e.datasMap[t].meta+=a.datasMap[t].meta,e.totalMeta+=a.datasMap[t].meta})),n.realizarp=x(n.total,n.totalMeta),n.mediaMeta=n.totalMeta/u.service.periodo,n.realizarpMedia=n.realizarp/u.service.periodo,e.mediaMeta+=n.totalMeta/u.service.periodo,e.total+=a.total,e.media+=a.total/u.service.periodo})),u.service.datas.forEach((function(a){t.datasMap[a].realizarp=x(t.datasMap[a].valor,t.datasMap[a].meta),o.datasMap[a].realizarp=x(o.datasMap[a].valor,o.datasMap[a].meta),e.datasMap[a].realizarp+=x(e.datasMap[a].valor,e.datasMap[a].meta)})),e.mediaMeta=e.totalMeta/u.service.periodo,e.realizarp=x(e.total,e.totalMeta),e.realizarpMedia=e.realizarp/u.service.periodo,M(),m()}function D(a){u.loading=!1;var t=b("Despesas"),o=b("Receitas"),e=b("Investimentos"),n=b("Resultado");n.tipo="rt",u.service.grupos=[o,t],"categoria"==u.service.tipoCad&&u.service.grupos.push(e),u.service.grupos.push(n);var r={},i=[];if(u.service.rel=a.length>0,a.forEach((function(a){var t,o,e=a.categoriaPai,n="i"==a.tipo?a.conta:a[u.service.tipoCad],c=e+a.tipo,s=n+a.tipo;"y"==u.service.intervalo.id&&(a.data=a.data.slice(0,4)),e||n?e?(r[c]||(r[c]=l(e,a),r[c].filhos=[],r[c].filhosMap={},i.push(r[c])),(t=r[c]).filhosMap[n]||(o=l(n,a),t.filhosMap[n]=o,t.filhosMap[n].isSub=!0,t.filhos.push(o)),d(t.filhosMap[n],a)):(r[s]||(r[s]=l(n,a),r[s].filhos=[],r[s].filhosMap={},i.push(r[s])),d(r[s],a)):(c=a.tipo,r[c]||(r[c]=l(n,a),r[c].filhos=[],r[c].filhosMap={},i.push(r[c])),d(r[c],a))})),A(i),i.forEach((function(a){var r;"d"==a.tipo&&(r=t),"r"==a.tipo&&(r=o),"i"==a.tipo&&(r=e),r&&(r.tipo=a.tipo,A(a.filhos),a.id?(r.itens.push(a),"i"!=a.tipo&&(a.filhos.length>1?(a.hasFilhos=!0,a.filhos.forEach((function(t){t.paiId=a.id,r.itens.push(t)})),a.filhos=null):1==a.filhos.length?a.filhos[0].isSub&&(a.hasFilhos=!0,(!a.filhos[0].paiPura||a.filhos[0].paiPura&&0!=a.filhos[0].total)&&(a.filhos[0].paiId=a.id,r.itens.push(a.filhos[0]))):a.hasFilhos=!1),(!u.service.collapseSubCat.iniciado&&a.hasFilhos||u.service.toggleSubcateg&&"i"!=a.tipo)&&(u.service.collapseSubCat[a.tipo][a.id]=u.service.subcategorias)):(u.service.datas.forEach((function(t){r.datasMap[t].valor=a.datasMap[t].valor,r.datasMap[t].meta=a.datasMap[t].meta,r.datasMap[t].realizarp=a.datasMap[t].realizarp,r.total+=a.datasMap[t].valor,r.totalMeta+=a.datasMap[t].meta,r.media+=a.datasMap[t].valor/u.service.periodo,r.mediaMeta+=a.datasMap[t].meta/u.service.periodo,r.realizarp+=a.datasMap[t].realizarp,n.datasMap[t].valor+="i"==a.tipo?-1*a.datasMap[t].valor:a.datasMap[t].valor,n.datasMap[t].meta+="i"==a.tipo?-1*a.datasMap[t].meta:a.datasMap[t].meta,n.datasMap[t].realizarp+=a.datasMap[t].realizarp})),r.realizarpMedia+=r.realizarp/u.service.periodo,n.total+="i"==a.tipo?-1*a.total:a.total,n.totalMeta+="i"==a.tipo?-1*a.totalMeta:a.totalMeta,n.media+="i"==a.tipo?-1*a.total/u.service.periodo:a.total/u.service.periodo,n.mediaMeta+="i"==a.tipo?-1*a.mediaMeta:a.mediaMeta,n.realizarpMedia+=r.realizarpMedia,n.realizarp+=r.realizarp))})),u.service.acumular)for(var c=0;c<u.service.grupos.length;c++)u.service.grupos[c].itens.forEach((function(a){angular.forEach(a.datasMap,(function(t,o){var e=moment(o).subtract(1,"months").format("YYYY-MM");a.datasMap[e]&&(t.valor+=a.datasMap[e].valor,t.meta+=a.datasMap[e].meta,t.realizarp=x(t.valor,t.meta))}))})),angular.forEach(u.service.grupos[c].datasMap,(function(a,t){var o=moment(t).subtract(1,"months").format("YYYY-MM");u.service.grupos[c].datasMap[o]&&(a.valor+=u.service.grupos[c].datasMap[o].valor,a.meta+=u.service.grupos[c].datasMap[o].meta,a.realizarp=x(a.valor,a.meta))}));function l(a,t){var o,e,n;a&&0!=a?(n="i"==t.tipo?"conta":u.service.tipoCad,e=(o=s.get(n+"s",a,!0)).nomeRel||o.nome):e="r"==t.tipo?"Receitas":"Despesas";var r=C(e);return r.id=a,r.tipo=t.tipo,r}function d(a,t){a.datasMap[t.data].valor+=t.projetado,a.datasMap[t.data].meta+=t.meta,a.datasMap[t.data].realizarp+=t.realizarp,a.realizarpMedia+=a.datasMap[t.data].realizarp/u.service.periodo,a.mediaMeta+=t.meta/u.service.periodo,a.totalMeta+=t.meta,a.media+=t.projetado/u.service.periodo,a.total+=t.projetado,a.realizarp+=t.realizarp}M(),m()}function $(a){u.loading=!1,u.service.rel=a.length>0;var t=b("Despesas"),o=b("Receitas"),e=b("Resultado");e.tipo="rt",u.service.grupos=[o,t,e];var n={},r={},i=[];function c(a){return Math.abs(a)>1e-4&&"number"==typeof a}function l(a,t){a.datasMap[t.data].valor+=t.projetado,a.media+=t.projetado/u.service.periodo,a.total+=t.projetado}a.forEach((function(a){var t=a.categoriaPai||a[u.service.tipoCad],o=a[u.service.tipoCad],e=a.tipo+t;"y"==u.service.intervalo.id&&(a.data=a.data.slice(0,4)),n[e]||(n[e]=C(0!=t&&t?s.get(u.service.tipoCad+"s",t,!0).nome:"Sem "+u.service.tipoCad),n[e].tipo=a.tipo,n[e].filhos=[],n[e].filhosMap={},n[e].id=t,r[e]||(r[e]=!0,i.push(n[e])));var c=n[e];null!=o&&0!=o||(o=0);var d=a.tipo+o;if(!c.filhosMap[d]){var m,f=C(0==o?"Sem "+u.service.tipoCad:(m=s.get(u.service.tipoCad+"s",o,!0)).nomeRel||m.nome);c.filhosMap[d]=f,c.filhosMap[d].tipo=a.tipo,c.filhosMap[d].isSub=!0,c.filhosMap[d].id=o,c.filhos.push(f)}l(c.filhosMap[d],a),l(c,a)})),A(i),i.forEach((function(a){u.service.collapseSubCat.iniciado&&!u.service.toggleSubcateg||(u.service.collapseSubCat[a.tipo][a.id]=u.service.subcategorias);var n="d"==a.tipo?t:o;n.tipo=a.tipo,A(a.filhos),n.itens.push(a),a.filhos.length>1?(a.hasFilhos=!0,a.filhos.forEach((function(t){t.paiId=a.id,n.itens.push(t)})),a.filhos=null):a.filhos[0].isSub?(a.hasFilhos=!0,(!a.filhos[0].paiPura||a.filhos[0].paiPura&&0!=a.filhos[0].total)&&(a.filhos[0].paiId=a.id,n.itens.push(a.filhos[0]))):a.hasFilhos=!1,u.service.datas.forEach((function(t){n.datasMap[t].valor+=a.datasMap[t].valor,n.datasMap[t].meta+=a.datasMap[t].meta,e.datasMap[t].valor+=a.datasMap[t].valor,e.datasMap[t].meta+=a.datasMap[t].meta})),n.media+=a.total/u.service.periodo,n.total+=a.total,e.total+=a.total,e.media+=a.total/u.service.periodo})),t.totalC=Math.abs(t.total/o.total),t.mediaC=Math.abs(t.media/o.media),u.service.datas.forEach((function(a){t.datasMap[a].valorC=t.datasMap[a].valor/o.datasMap[a].valor,t.itens.forEach((function(t){c(t.media)&&c(o.media)?t.mediaC=t.media/o.media:t.mediaC=null,c(t.total)&&c(o.total)?t.totalC=t.total/o.total:t.totalC=null,c(t.datasMap[a].valor)&&c(o.datasMap[a].valor)?t.datasMap[a].valorC=-1*t.datasMap[a].valor/o.datasMap[a].valor:t.datasMap[a].valorC=null}))})),M(),m()}function M(){var a={};u.service.grupos.forEach((function(t){"Resultado"==t.nome&&(a=t)}));var t={cadId:null,catDatasMap:null,grupoDatasMap:a,tipo:null,intervalo:u.service.intervalo,grupos:u.service.grupos};u.charts=n.getCharts(t)}u.service=r.getService(t),u.toggleCollapseGrupo=function(a){if("rt"==a.tipo)return;"r"==a.tipo&&(u.service.collapseGrupo.r=!u.service.collapseGrupo.r);"i"==a.tipo&&(u.service.collapseGrupo.i=!u.service.collapseGrupo.i);"d"==a.tipo&&(u.service.collapseGrupo.d=!u.service.collapseGrupo.d);u.service.updateConfig()},u.toggleCollapseSubCat=function(a){u.service.collapseSubCat.inciado||(u.service.collapseSubCat.iniciado=!0);u.service.collapseSubCat[a.tipo][a.id]=!u.service.collapseSubCat[a.tipo][a.id]},u.getParamsDetalhes=function(a,t){var e=a.id,n="m"==u.service.intervalo.id?t+"-01":t+"-01-01",r="m"==u.service.intervalo.id?o(t+"-01").endOf("month").format("YYYY-MM-DD"):o(t+"-01").endOf("year").format("YYYY-MM-DD"),i={inicio:n,fim:r,i:"m",filtro:u.service.filterManager.encode()};"i"!=a.tipo?(i.pendentes=u.service.pendentes?1:0,i.regime=u.service.regime,"categoria"==u.service.tipoCad&&(i.cat=e),"centro"==u.service.tipoCad&&(i.cen=e),"contato"==u.service.tipoCad&&(i.con=e),"resultadoProjetos"==u.service.tipoRel&&(i.proj=u.service.projId)):i.conta=e;return i},u.detalhar=function(a,t,o,n){e.show({id:"detalhar-evolucaocat",templateUrl:"partials/relatorios/evolucao/detalhar.html",bindToController:!0,controllerAs:"vm",controller:"DetalharEvolucaocatController",locals:{config:{intervalo:u.service.intervalo,cadId:a,catDatasMap:t,grupoDatasMap:o,grupos:u.service.grupos,tipoRel:u.service.tipoCad,isDespesas:"d"==n}}})},u.toggleRealizado=function(){var a=Math.min(500,16*u.service.periodo);u.loadingToggle=!0,c((function(){u.service.visualizacaoRealizado=u.toggleTable,u.service.updateConfig()})),c((function(){u.loadingToggle=!1}),a)},u.getRealizado=p,u.getCollapseGrupo=f,u.getARealizar=g,u.getMediaARealizar=v,u.loadingToggle=!1,u.toggleTable=u.service.visualizacaoRealizado,u.buildCharts=M,u.$onInit=function(){a.$parent.vm.service=u.service,a.$parent.vm.intervaloLabel="y"==u.service.intervalo.id?"Anual":"Mensal",u.service.filterManager||u.service.setFilterManager(h),a.$parent.vm.filtrosService=u.service.filtrosService,a.$parent.vm.filterManager=u.service.filterManager,function(){var a,o="Evolução por ";"categoria"==t.tipo&&(a=o+" categoria");"centro"==t.tipo&&(a=o+"centro");"contato"==t.tipo&&(a=o+"contato");"metas"==t.tipo&&"categoria"==t.tm&&(a="Metas de orçamento");"metas"==t.tipo&&"centro"==t.tm&&(a="EvolMetaCentro");"resultadoProjetos"!=t.tipo&&"Metas de orçamento"!=a&&"EvolMetaCentro"!=a?i.setTitle([{label:"Relatórios",href:"relatorios"},a]):"Metas de orçamento"==a?i.title="Metas de orçamento":"resultadoProjetos"==t.tipo?i.setTitle([{label:"Resultados dos projetos",href:"relatorios/projetos"},u.service.projeto.nome]):"EvolMetaCentro"==a&&(i.title="Metas por centros")}(),u.service.setDatas(),u.intervalo=u.service.intervalo,h();var o=l.onChange(d);a.$on("$destroy",(function(){o()}))}}a.$inject=["$state","$mdDialog","$http"],t.$inject=["$scope","$stateParams","mdwMoment","$mdDialog","evolucaoChartsService","RelatorioEvolucaoService","mdwTopmenu","$timeout","cadastrosDatasource","mdwDarkModeService"],angular.module("md").controller("RelatorioEvolucaoController",a).controller("RelatorioEvolucaoDadosController",t)}(),function(){"use strict";function a(a){a.state("evolucao",{abstract:!0,url:"/relatorios/evolucao",controller:"RelatorioEvolucaoController",controllerAs:"vm",templateUrl:"partials/relatorios/evolucao/evolucao.html",data:{enableMoeda:!0}}).state("evolucao.dados",{url:"/:tipo?inicio&p&tm&i&r",controller:"RelatorioEvolucaoDadosController",controllerAs:"vm",templateUrl:function(a){return"partials/relatorios/evolucao/dados"+("metas"==a.tipo?"Metas":"")+".html"}})}a.$inject=["$stateProvider"],angular.module("md").config(a)}(),function(){"use strict";function a(a,t,o,e,n){var r=["categoria","centro","contato","metascategoria","metascentro","resultadoProjetoscategoria"],i={};return{getService:function(a){var t=a.tipo,o=a.inicio,e=a.i,n=t,s=null,l="0";return"metas"==t?a.tm?n=a.tm:t=r[0]:"resultadoProjetos"==t&&(a.tm?(n=a.tm,l=s=a.id):t=r[0]),i[t+n+l]||(i[t+n+l]=new c(t,n,s)),o&&i[t+n+l].setInicio(o),e&&i[t+n+l].setIntervalo(e),i[t+n+l]}};function c(r,i,c){var s=this;s.nomeConfig=r+i,s.visaoGraficaPermitida=!0,s.config=o.getConfig(s.nomeConfig,{sc:!1,reg:"ca",pnd:!0,p:6,oB:"a",v:"c",vR:"1",sT:!1,ac:!1,aMD:!0,clG:{d:!0,r:!0,i:!0},i:{id:"m",label:"Mensal"},pAA:5,pAM:6,filtro:null,vG:!1}),s.projId=c,s.projId&&(s.projeto=e.get("projetos",s.projId,!0)),s.intervalo=s.config.i,s.intervalos=[{id:"m",label:"Mensal"},{id:"y",label:"Anual"}],s.regime=s.config.reg,s.subcategorias=s.config.sc,s.pendentes=s.config.pnd,s.periodo=s.config.p,s.periodoAnteriorMeses=s.config.pAM,s.periodoAnteriorAnos=s.config.pAA,s.orderBy=s.config.oB,s.acumular=s.config.ac,s.somarTotal=s.config.sT,s.visualizacaoDespesas=s.config.v,s.visualizacaoRealizado=s.config.vR||"1",s.apenasMetasDefinidas=s.config.aMD,s.collapseGrupo=s.config.clG,s.tipoRel=r,s.tipoCad=i,s.filtro=s.config.filtro,s.visaoGrafica=s.config.vG,"y"==s.intervalo.id?s.inicio=moment().startOf("year").subtract(s.periodo-1,"year"):s.inicio=moment().startOf("month").subtract(s.periodo-1,"month"),s.collapseSubCat={iniciado:!1,r:{},d:{}};var l,u="Relatório de evolução por ";function d(){s.filterManager&&(s.config.filtro=s.filterManager.getId()),s.config.p=s.periodo,s.config.oB=s.orderBy,s.config.sc=s.subcategorias,s.config.pnd=s.pendentes,s.config.reg=s.regime,s.config.v=s.visualizacaoDespesas,s.config.vR=s.visualizacaoRealizado,s.config.sT=s.somarTotal,s.config.ac=s.acumular,s.config.aMD=s.apenasMetasDefinidas,s.config.clGGrupo=s.collapse,s.config.i=s.intervalo,s.config.pAM=s.periodoAnteriorMeses>13?13:s.periodoAnteriorMeses,s.config.pAA=s.periodoAnteriorAnos>5?5:s.periodoAnteriorAnos,s.config.vG=s.visaoGrafica,o.updateConfig(s.nomeConfig,s.config)}"categoria"==s.tipoRel&&(l=u+"categoria"),"centro"==s.tipoRel&&(l=u+"centro"),"contato"==s.tipoRel&&(l=u+"contato"),"metas"==s.tipoRel&&"categoria"==s.tipoCad&&(l=u+"metas de orçamento",s.visaoGraficaPermitida=!1),"metas"==s.tipoRel&&"centro"==s.tipoCad&&(l=u+"metas de centro",s.visaoGraficaPermitida=!1),"resultadoProjetos"==s.tipoRel&&(l="Resultado dos projetos - "+s.projeto.nome,s.visaoGraficaPermitida=!1),s.tipoCad==s.item&&(l=l+"por "+s.tipoCad),s.nomeRel=l,s.moedaService=n,s.setPeriodo=function(a){s.periodo=a},s.setIntervalo=function(a){s.intervalo="y"==a?{id:"y",label:"Anual"}:{id:"m",label:"Mensal"}},s.setInicio=function(a){s.inicio=moment(a,"YYYY-MM-DD")},s.updateConfig=d,s.getRealizado=function(a){if(!a)return 0;var t=1==s.visualizacaoRealizado?"valor":"realizarp";return a[t]},s.carregarRelatorio=function(){s.periodoCarregado=s.periodo,s.inicio=moment(s.inicio).startOf("y"==s.intervalo.id?"year":"month").format("YYYY-MM-DD");var t=s.periodo-1;"m"==s.intervalo.id&&(t=t>13?13:t);"y"==s.intervalo.id&&(t=t>5?5:t);s.fim=moment(s.inicio).add(t,"y"==s.intervalo.id?"years":"months").endOf("y"==s.intervalo.id?"year":"month").format("YYYY-MM-DD");var e=a.lancamentos.STATUS_PROJETADO;0==s.pendentes&&(e&=~(a.lancamentos.STATUS_PENDENTE|a.lancamentos.STATUS_AGENDADO));var r={inicio:s.inicio,fim:s.fim,regime:s.regime,status:e,tipoLancamento:a.lancamentos.TIPO_DESPESA|a.lancamentos.TIPO_RECEITA,moeda:n.moeda};if(s.filterManager){var i=a.lancamentos.parseFiltros(s.filterManager);angular.extend(r,i)}if("metas"==s.tipoRel)return r.evolmetas=!0,r.apenasMetasDefinidas=s.apenasMetasDefinidas,r.groupByData=!0,r.evolmetas=!0,r.metas=!s.somarTotal,r.acumular=s.acumular,r.tipoLancamento|=a.lancamentos.TIPO_TRANSFERENCIA,r.subcategorias=!1,"centro"==s.tipoCad&&(r.tipo="centro"),a.v2.evolucaoMetas(r).then((function(a){return a}));return"resultadoProjetos"==s.tipoRel?(r.pendentesPresente=o.utilizacao.pendentesPresente,r.considerarPaisNaoDefinidos=!s.subcategorias,r.id=s.projId,r.filtros=s.filterManager.getActive(),r.pendentes=s.pendentes,r.groupBy="m"==s.intervalo.id?"m":"y",a.evolucaoProjeto(r).then((function(a){return a}))):a.lancamentos.sum(r,{groupBy:s.tipoCad,groupByData:"month",groupByTipo:!0}).then((function(a){return a.sum}))},s.setDatas=function(){s.datas=[];for(var a=0;a<=s.periodo-1;a++)"m"==s.intervalo.id?s.datas.push(moment(s.inicio).add(a,"month").format("YYYY-MM")):s.datas.push(moment(s.inicio).add(a,"year").format("YYYY"))},s.setFilterManager=function(a){s.filterManager=s.filtrosService.getManagerLancamentos({funcionalidade:{categoriacategoria:12,metascentro:17,contatocontato:18,centrocentro:16,resultadoProjetoscategoria:14,metascategoria:13}[s.nomeConfig],onUpdate:function(){this.getId()!=s.config.filtro&&s.updateConfig(),a()},tipo:!1,status:!1,semTransferencia:!0}),s.filterManager.startWith(s.config.filtro,!0),s.filterManager.ready(a)},s.filtrosService=t,s.toggleDados=function(){s.visaoGrafica=!s.visaoGrafica,d()}}}a.$inject=["relatoriosDatasource","filtrosService","configuracoesService","cadastrosDatasource","moedaService"],angular.module("md").factory("RelatorioEvolucaoService",a)}(),function(){"use strict";function a(a,t,o){var e=this;e.rel=a,e.filtrosService=t;var n=+moment().add(5,"years").format("YYYY");e.anos=[];for(var r=2010;r<=n;r++)e.anos.push(r);e.meses=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],o.setTitle([{label:"Relatórios",href:"relatorios"},"DFC Instituto Bulla"]),e.printConfig={landscape:!0,controller:["IBullaDFCService",function(a){this.rel=a}],templateUrl:"/partials/relatorios/ibulla/dfc/print.html"},e.$onInit=function(){e.rel.carregarRelatorio()},e.getLinkDownload=function(){var a="Meu_Dinheiro_IBulla_"+moment().format("YYYYMMDDHHmmSS")+".xlsx";return e.rel.exportarExcel().then((function(t){!function(a,t,o){if(null!=o&&navigator.msSaveBlob)return navigator.msSaveBlob(new Blob([o],{type:t}),a);var e=angular.element("<a style='display: none;'/>"),n=window.URL.createObjectURL(new Blob([o],{type:t}));e.attr("href",n),e.attr("download",a),angular.element(document.body).append(e),e[0].click(),window.URL.revokeObjectURL(n),e.remove()}(a,"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",function(a){for(var t=new ArrayBuffer(a.length),o=new Uint8Array(t),e=0;e!=a.length;++e)o[e]=255&a.charCodeAt(e);return t}(atob(t)))}))}}a.$inject=["IBullaDFCService","filtrosService","mdwTopmenu"],angular.module("md").controller("IbullaDFCController",a)}(),function(){"use strict";function a(a,t){t.state({id:"ibulladfc",title:"Relatórios / DFC Instituto Bulla",templates:["relatorios/ibulla/dfc/dfc.html"]},{url:"/relatorios/ibulla/dfc",templateUrl:"partials/relatorios/ibulla/dfc/dfc.html",controller:"IbullaDFCController",controllerAs:"vm"})}a.$inject=["$stateProvider","mdwBaseStateProvider"],angular.module("md").config(a)}(),function(){"use strict";t.$inject=["$mdDialog","mdwMoment","relatoriosDatasource","cadastrosDatasource","configuracoesService","usuariosService"],angular.module("md").service("IBullaDFCService",t);var a="YYYY-MM-DD";function t(t,o,e,n,r,i){var c,s,l=this;function u(){return angular.equals(r.utilizacao._ibulladfc,c)||(c=angular.copy(r.utilizacao._ibulladfc),s=moment().valueOf()),{inicio:l.getInicio(),fim:l.getFim(),_ts:s}}function d(a){return l.loading=!0,e.ibulladfc(u()).then((function(a){l.loading=!1,l.relatorio=a}))}function m(a,o,e){var c=this;c.id=a,c.descricao=o,c.categorias=[],c.configuravel=e||!1,r.utilizacao._ibulladfc&&r.utilizacao._ibulladfc[a]&&(c.categorias=r.utilizacao._ibulladfc[a]),c.resultadoMes=function(t){if(!l.relatorio[a])return 0;var o=moment().year(l.ano).month(l.inicio).add(t,"months").startOf("month").format("YYYY-MM");return l.relatorio[a].periodo[o]?l.relatorio[a].periodo[o].projetado:0},c.acumuladoPerido=function(){return l.relatorio[a]?l.relatorio[a].acumulado.projetado:0},c.media=function(){return l.relatorio[a]?l.relatorio[a].media.projetado:0},c.mediaReceita=function(){return l.relatorio[a]?l.relatorio[a].media_receita.projetado:0},c.vincularCategorias=function(){return t.show({id:"vincular-categoria",templateUrl:"partials/relatorios/ibulla/dfc/vincular.html",bindToController:!0,controllerAs:"vm",controller:function(){var a=this;a.items=n.categorias.filter((function(t){return t.tipo==a.campo.configuravel})),a.map={},a.campo.categorias.forEach((function(t){a.map[t]=!0})),a.ok=function(){a.campo.categorias=[],angular.forEach(a.map,(function(t,o){t&&a.campo.categorias.push(+o)})),t.hide()}},locals:{campo:c}}).then((function(){return(a={},l.campos.forEach((function(t){t.configuravel&&(a[t.id]=t.categorias)})),r.utilizacao._ibulladfc=a,i.updateConfig(r.utilizacao)).then(d);var a}))}}l.relatorio={},l.ano=+moment().format("YYYY"),l.inicio=0,l.fim=2,l.campos=[new m("receitas_operacionais","Receitas Líquida Financeira Operacional","r"),new m("fornecedores","Fornecedores pagos efetivamente no mês","d"),new m("lucro_bruto","Lucro Bruto"),new m("despesas_variaveis","Despesas Variáveis pagas no mês","d"),new m("margem_contribuicao","Margem de Contribuição"),new m("despesas_fixas","Despesas Fixas pagas no mês","d"),new m("resultado_operacional","Resultado do Fluxo de Caixa Operacional "),new m("receitas_n_operacionais","Receita NÃO Operacional","r"),new m("despesas_n_operacionais","Despesa NÃO Operacional","d"),new m("resultado","Resultado do Fluxo de Caixa Ajustado"),new m("acumulado","Acumulado DFC")],l.getMeses=function(){return["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"].slice(l.inicio,l.fim+1)},l.changePeriodo=function(){l.fim<l.inicio&&(l.fim=l.inicio),d()},l.getInicio=function(){return moment().year(l.ano).month(l.inicio).startOf("month").format(a)},l.getFim=function(){return moment().year(l.ano).month(l.fim).endOf("month").format(a)},l.carregarRelatorio=d,l.exportarExcel=function(){var a=u();return a.output="excel",e.ibulladfc(a)}}}(),angular.module("md").directive("mdwRelatoriosPrintLogo",(function(){return{template:'<div style="margin-right : 15px;" layout="column" layout-align="start center"><img style="max-width:200px;height: auto;max-height:60px;margin: 0 auto;display: block;" ng-src="{{vm.logotipo}}"><a style="margin-top: 3px;" class="link-light-blue hide-print" href ng-if="vm.usuario.conta.avatar" ng-click="vm.alterar()">Alterar</a></div>',scope:{},controllerAs:"vm",controller:["usuariosService","configuracoesService",function(a,t){var o=this;o.usuario=a.usuario;var e="FISICA"==o.usuario.conta.tipoPessoa?"pf":"pj",n=t.getConfig("print",{l:"pj"==e?1:2});function r(){o.logotipo=1==n.l&&o.usuario.conta.avatar?o.usuario.conta.avatar:"https://s3.amazonaws.com/img.meudinheiroweb.com.br/logo/logo_small.png"}r(),o.alterar=function(){n.l=1==n.l?2:1,r(),t.updateConfig("print",n)}}]}})),angular.module("md").directive("mdwRelatoriosPrintNome",(function(){return{template:'<div><span ng-if="vm.exibir">{{vm.nome}}</span> <a class="link-light-blue hide-print" href ng-click="vm.alterar()">{{vm.exibir ? "Esconder" : "Exibir"}} nome {{vm.pf ? "de usuário" : "da empresa"}}</a></div>',scope:{},controllerAs:"vm",controller:["usuariosService","configuracoesService",function(a,t){var o=this,e=a.usuario;o.pf="FISICA"==e.conta.tipoPessoa;var n=t.getConfig("printn",{n:o.pf?0:1});o.nome=e.conta.nome,o.exibir=1==n.n,o.alterar=function(){n.n=1==n.n?0:1,o.exibir=!o.exibir,t.updateConfig("printn",n)}}]}})),function(){"use strict";function a(a,t,o,e,n,r){var i=this;i.projetos=[],i.loading=!0,i.isMoeda=!e.isDefaultActivated(),o.setTitle([{label:"Relatórios",href:"relatorios"},"Resultados dos Projetos"]);var c=r.getConfig("prjs",{o:"d"});i.filtrar=function(){var a=new RegExp(n(i.busca),"i");null==i.busca||""==i.busca?i.projetos=s:i.projetos=s.filter((function(t){return null!=t.projeto.nome.match(a)}))},i.sort=u,i.orderBy=c.o;var s=[];function l(){this.projetos=i.projetos}function u(a){i.orderBy=a,i.projetos.sort((function(t,o){return"a"==a?t.projeto.nome.toLowerCase()<o.projeto.nome.toLowerCase()?-1:1:t.id-o.id})),function(){var a={};a.o=i.orderBy,r.updateConfig("prjs",a)}()}a.resultadosProjetos().then((function(a){i.projetos=a,s=a,i.projetos.forEach((function(a){a.projeto=t.get(a.id,!0)})),u(i.orderBy),i.printConfig={landscape:!0,controller:l,templateUrl:"/partials/relatorios/projetos/resultados/geral.print.html"},i.loading=!1}))}a.$inject=["relatoriosDatasource","projetosDatasource","mdwTopmenu","moedaService","mdwAccentFold","configuracoesService"],angular.module("md").controller("ResultadosProjetosGeral",a)}(),function(){"use strict";function a(a,t,o){var e={};return function(a){return e[a]?e[a]:e[a]=new n(a)};function n(e){var n=this;n.loading=!0,n.projeto=o.get(e,!0),n.despesas=[],n.receitas=[];function r(){return n.rel?n.rel.receitas/n.projeto.metaReceita:0}function i(){return n.rel?-1*n.rel.despesas/n.projeto.metaDespesa:0}n.load=function(){n.totais={r:{totalR:0,totalMetas:0},d:{totalR:0,totalMetas:0},res:{totalR:0,totalMetas:0}},n.projeto=o.get(e,!0);var r={};return a.resultadosProjetos({id:e}).then((function(a){function o(a){if(a.meta){var t,o=Math.abs(a.total/a.meta);a.razao=o,t="d"==a.categoria.tipo?o>1?"critica":o<.7?"confortavel":"alerta":o>=1?"confortavel":o<.3?"critica":"alerta",a.cor="critica"==t?"#EF9A9A":"confortavel"==t?"#A5D6A7":"#FFE082",a.realizar=Math.abs(a.meta)-Math.abs(a.total)}}n.despesas=[],n.receitas=[],n.loading=!1,n.rel=a,n.rel.categorias.forEach((function(a){var e,n=t.get("categorias",a.categoria,!0),i=n.pai?n.pai:n.id;if(!r[i]){var c=t.get("categorias",i,!0);r[i]={categoria:c,total:0,subcategorias:[],meta:0}}n.pai?(e={categoria:n,total:a.total,meta:a.meta,_sub:!0},r[i].subcategorias.push(e)):((e=r[i]).total+=a.total,e.meta=a.meta),o(e)})),angular.forEach(r,(function(a){r(a);var t=0;if(a.subcategorias.forEach((function(o,e){a.total+=o.total,t+=o.meta,e+1==a.subcategorias.length&&(o._last=!0),r(o)})),a.meta=a.meta||t,a.meta){n.totais[a.categoria.tipo].totalR+=a.total,n.totais[a.categoria.tipo].totalMetas+=a.meta,n.totais.res.totalR+=a.total;var e="d"==a.categoria.tipo?-1*a.meta:a.meta;n.totais.res.totalMetas+=e}function r(a){("d"==a.categoria.tipo?n.despesas:n.receitas).push(a)}o(a)})),n.despesas&&i(n.despesas),n.receitas&&i(n.receitas)}));function i(a){a.sort((function(a,t){return a.categoria.nome.toLowerCase()<t.categoria.nome.toLowerCase()?-1:1}))}},n.razaoD=i,n.razaoR=r,n.corD=function(){var a=Math.abs(i());return a>1?"#EF9A9A":a<.7?"#A5D6A7":"#FFE082"},n.corR=function(){var a=Math.abs(r());return a>=1?"#A5D6A7":a<.3?"#EF9A9A":"#FFE082"}}}a.$inject=["relatoriosDatasource","cadastrosDatasource","projetosDatasource"],angular.module("md").factory("ResultadosProjetoService",a)}(),function(){"use strict";function a(a,t,o,e,n,r){var i=this,c=t.id;i.service=o(c),i.isMoeda=!r.isDefaultActivated(),i.moeda=r.moeda,i.printConfig={controller:["$stateParams","ResultadosProjetoService",function(a,t){this.service=t(c)}],templateUrl:"/partials/relatorios/projetos/resultados/geral/print.html"},i.service.load();var s=e.addObserverMetas(i.service.load),l=n.addObserver("projetos",i.service.load);a.$on("$destroy",(function(){s(),l()}))}a.$inject=["$scope","$stateParams","ResultadosProjetoService","projetosDatasource","cadastrosDatasource","moedaService"],angular.module("md").controller("ResultadosProjetoGeral",a)}(),function(){"use strict";function a(a,t,o){t.state({id:"resultadosprojetos",title:"Resultados dos projetos",templates:["relatorios/projetos/resultados/geral.html"]},{url:"/relatorios/projetos",templateUrl:"/partials/relatorios/projetos/resultados/geral.html",controller:"ResultadosProjetosGeral",controllerAs:"vm",data:{enableMoeda:!0}}),a.state("resultadosprojeto",{abstract:!0,url:"/relatorios/projetos/:id",template:"<div layout='row' layout-align='center' flex ui-view></div>",data:{enableMoeda:!0},controllerAs:"vm",controller:["$scope","$state","$stateParams","mdwTopmenu","projetosDatasource",function(a,t,o,e,n){var r=n.get(o.id,!0);e.setTitle([{label:"Resultados dos projetos",href:"relatorios/projetos"},r.nome]),e.preservStateParams=!0,e.setTabs(a,[{label:"Resultado geral",state:"resultadosprojeto.geral"},{label:"Evolução",state:"resultadosprojeto.evolucao.listar"}])}]}),a.state("resultadosprojeto.geral",{url:"",templateUrl:"/partials/relatorios/projetos/resultados/geral/projeto.html",controllerAs:"vm",controller:"ResultadosProjetoGeral"}).state("resultadosprojeto.geral.editarprojeto",o.getState({url:"/editar",action:"projetosService.editar",data:{permmdt:"g"}})).state("resultadosprojeto.geral.editarmetas",o.getState({url:"/editar/metas",action:"projetosService.metas",data:{permmdt:"g"}})),a.state("resultadosprojeto.evolucao",{abstract:!0,url:"/evolucao",controller:"RelatorioEvolucaoController",controllerAs:"vm",templateUrl:"partials/relatorios/evolucao/evolucao.html"}),a.state("resultadosprojeto.evolucao.listar",{url:"?inicio&p&tm&i&r",controller:"RelatorioEvolucaoDadosController",controllerAs:"vm",params:{tipo:"resultadoProjetos",tm:"categoria"},templateUrl:"partials/relatorios/evolucao/dadosMetas.html"})}a.$inject=["$stateProvider","mdwBaseStateProvider","mdwStateDialogProvider"],angular.module("md").config(a)}(),function(){"use strict";var a=angular.module("md"),t=7;["categoria","centro","contato","projeto"].forEach((function(o){a.service("relatoriolancamentos"+o+"Service",function(a,t){r.$inject=["$stateParams","mdwMoment","mdwObserver","configuracoesService","relatoriosDatasource","cadastrosDatasource","filtrosService","filtroStatusLancamentoService","googleChartApiPromise","mdwColors","$filter","mdwCalendarService"];var o="lancamentos",e=o+a,n="categoria"==a;return r;function r(r,i,c,s,l,u,d,m,f,p,v,g){var h=this,C=c(),b=s.getConfig(e,{intervalo:"m",regime:"ca",orderBy:"p",fs:0});function A(){s.updateConfig(e,{regime:h.regime,intervalo:h.intervalo,orderBy:h.orderBy,filtro:h.filterManager.getId(),fs:h.fullscreen?1:0})}function x(){var a=g.getDefaultParams(h.intervalo,!0);h.inicio=r.inicio?i(r.inicio).format("YYYY-MM-DD"):a.inicio,h.fim=r.fim?i(r.fim).format("YYYY-MM-DD"):a.fim,h.regime=r.regime||h.regime,angular.isDefined(r.pendentes)&&(h.filtroStatus.toggle(8,"1"==r.pendentes),h.filtroStatus.toggle(1,"1"==r.pendentes)),h.filterManager.ready((function(){h.desconsiderarParamFiltros||((r.cat||angular.isDefined(r.cen)||r.proj||angular.isDefined(r.con))&&(h.filterManager.clearAll(!0),angular.isDefined(r.filtro)&&h.filterManager.setActiveFilter(r.filtro)),r.cat&&h.filterManager.setFilter("categorias",r.cat,!1),angular.isDefined(r.cen)&&(h.filterManager.setFilter("centros",r.cen,!1),r.tipo&&h.filterManager.setFilter("tipo",r.tipo,!1)),angular.isDefined(r.con)&&(h.filterManager.setFilter("contatos",r.con,!1),r.tipo&&h.filterManager.setFilter("tipo",r.tipo,!1)),r.proj&&(h.filterManager.setFilter("projetos",r.proj,!1),r.tipo&&h.filterManager.setFilter("tipo",r.tipo,!1))),h.desconsiderarParamFiltros=!1;var a=$();h.paginator=l.lancamentos.list(M(),{orderBy:[{t:"tipo",v:"desc"},{t:h.grupo,v:"p"==h.orderBy?"part":"alfa``"},{t:"data"},{t:"valor"}]},{pageSize:200,onBeforeFetch:function(){h.loading=!0},onFetch:function(t){return a.then((function(){h.linhaRel=D(t),h.loading=!1}))},onCompleteIterate:function(a){h.linhaRelImp=D(a)}}),h.paginator.fetch(1)}))}h.printConfig={controller:function(){this.relatorio=h},templateUrl:"/partials/relatorios/rd/"+o+"_print.html",paginate:function(){return h.paginator}},h.grupo=a,h.regime=b.regime,h.intervalo=b.intervalo,h.fullscreen=1==b.fs,h.orderBy=b.orderBy,h.calendarioConfig={restrict:["d","w","m","t","s","y","p"],interval:h.intervalo,onUpdate:function(){h.intervalo!=this.currentInterval&&"p"!=this.currentInterval&&(h.calendarioConfig.interval=this.currentInterval,h.intervalo=this.currentInterval,A())}},l.addObserver("rd",(function(a){C.notify(a)})),h.filterManager=d.getManagerLancamentos({funcionalidade:t,onUpdate:function(){h.filterManager.getId()!=b.filtro&&A(),h.desconsiderarParamFiltros=!0,x()},status:!1,plasticos:!0}),h.filterManager.startWith(b.filtro),h.filtroStatus=m(x),h.carregar=x,h.updateConfig=A,h.addObserver=C.add,h.toggleRegime=I,h.toggleFullscreen=y,h.toggleSort=E;var S={id:0,nome:"Sem "+a};function D(t){var o,e,r,i=[];return h.lancamentos=t,t.forEach((function(t){var c=t[a]||0,s=c?w(c):S,l=!1,d=u.get("categorias",t.categoria,!0),m=(d&&"d"==d.tipo||!d&&t.valor<0?"despesas":"receitas")+c;if(m!=o){if(n){var f=t.categoriaPai||t.categoria,p=!t.categoriaPai,v=("d"==d.tipo?"despesas":"receitas")+"p"+f;l=p&&h.totaisCat[m].valor==h.totaisCat[v].valor,v!=r&&(o&&(i[i.length-1].ultimo=!0),r=v,i.push({categoria:{categoria:w(f),valor:h.totaisCat[v].valor,part:Math.abs(h.totaisCat[v].valor/h.totais[h.totaisCat[v].tipo]),pai:!0}}))}else o&&(i[i.length-1].ultimo=!0);l||(e={categoria:s,valor:h.totaisCat[m].valor,part:Math.abs(h.totaisCat[m].valor/h.totais[h.totaisCat[m].tipo]),pai:!n},i.push({categoria:e})),o=m}i.push({lancamento:t})})),i.length>0&&(i[i.length-1].ultimo=!0),i}function $(){return l.lancamentos.sum(M(),{groupBy:a,groupByTipo:!n}).then((function(t){var o={receitas:0,despesas:0},e={};t.sum.forEach((function(t){var r=t[a],i=r?w(t[a]):S,c=n&&"d"==i.tipo||t.tipo&&"d"==t.tipo||!n&&!t.tipo&&t.projetado<0?"despesas":"receitas";if(o[c]+=t.projetado,e[r=c+r]||(e[r]={tipo:c,valor:0}),e[r].valor+=t.projetado,n){var s=c+"p"+(i.pai||i.id);e[s]||(e[s]={tipo:c,valor:0}),e[s].valor+=t.projetado}})),h.totais=o,h.totaisCat=e}))}function M(){var a=l.lancamentos.parseFiltros(h.filterManager),t=angular.extend(a,{inicio:h.inicio,fim:h.fim,regime:h.regime,pendentesPresente:s.utilizacao.pendentesPresente,status:h.filtroStatus.get()});return t.tipoLancamento||(t.tipoLancamento=l.lancamentos.TIPO_TODOS),t.tipoLancamento=t.tipoLancamento&~l.lancamentos.TIPO_TRANSFERENCIA_ENTRADA&~l.lancamentos.TIPO_TRANSFERENCIA_SAIDA,t}function w(t){return u.get(a+"s",t,!0)}function E(a){h.orderBy=a,A(),h.loading=!0,x()}function y(){h.fullscreen=!h.fullscreen,A()}function I(){h.regime="ca"==h.regime?"co":"ca",r.regime&&(r.regime=h.regime),A(),h.loading=!0,x()}}}(o,t++))}))}(),function(){"use strict";function a(a,t,o,e,n,r,i){var c=this;c.tipoRel=a,e.setTitle([{label:"Relatórios",href:"relatorios"},("totais"==a?"Totais":"Lançamentos")+" por "+t]),c.relatorio=o,c.filtrosService=r,c.relatorio.carregar(),c.selection=i({controller:c,templateUrl:"/partials/relatorios/acoesLoteTopmenu.html",getLancamentos:function(){return"totais"!=a?c.relatorio.lancamentos:"dg"==c.relatorio.visao?c.relatorio.detalhamento.lancamentos:void 0}});var s=c.relatorio.addObserver(c.relatorio.carregar);function l(){c.selection.updateSelection()}n.$on("$destroy",(function(){s(),c.selection.clearSelection()})),n.$watchCollection("vm.relatorio.lancamentos",l),n.$watchCollection("vm.relatorio.detalhamento.lancamentos",l)}a.$inject=["tipoRel","cadRel","serviceRel","mdwTopmenu","$scope","filtrosService","selecaoLancamentosLote"],angular.module("md").controller("RelatorioRDController",a)}(),function(){"use strict";function a(a,t){["totais","lancamentos"].forEach((function(o){["categoria","centro","contato","projeto"].forEach((function(e){var n="relatorio"+o+e;a.state(n,{abstract:!0,url:"/relatorios/"+o+"/"+e,templateUrl:"partials/relatorios/rd/relatorio.html",data:{enableMoeda:!0},controller:["serviceRel","tipoRel","linkNovoLancamento","filtrosService",function(a,t,e,n){this.relatorio=a,this.tipoRel=o,this.linkNovoLancamento=e,this.filtrosService=n}],controllerAs:"vm",resolve:{serviceRel:["$injector",function(a){return a.get("relatorio"+o+e+"Service")}],linkNovoLancamento:function(){return n+".listar"},tipoRel:function(){return o},cadRel:function(){return e}}}),a.state(n+".listar",{url:"?inicio&fim&i&cat&cen&proj&con&tipol&regime&pendentes&filtro",views:{relatorio:{templateUrl:"partials/relatorios/rd/"+o+".html",controller:"RelatorioRDController",controllerAs:"vm"},resumo:{templateUrl:"partials/relatorios/rd/resumo.html",controllerAs:"vm",controller:["serviceRel",function(a){this.relatorio=a}]}}}),t.addStates(n+".listar")}))}))}a.$inject=["$stateProvider","lancamentosRoutesProvider"],angular.module("md").config(a)}(),function(){"use strict";var a=angular.module("md"),t=3;["categoria","centro","contato","projeto"].forEach((function(o){a.service("relatoriototais"+o+"Service",function(a,t){n.$inject=["$stateParams","mdwMoment","mdwObserver","configuracoesService","relatoriosDatasource","cadastrosDatasource","filtrosService","filtroStatusLancamentoService","googleChartApiPromise","mdwColors","$filter","mdwCalendarService"];var o="totais",e=o+a;return n;function n(n,r,i,c,s,l,u,d,m,f,p,v){var g=this,h=i(),C=c.getConfig(e,{intervalo:"m",regime:"ca",orderBy:"p",fs:0});function b(){c.updateConfig(e,{visao:g.visao,regime:g.regime,intervalo:g.intervalo,orderBy:g.orderBy,filtro:g.filterManager.getId(),fs:g.fullscreen?1:0,chartType:g.chartType})}function A(){var t=v.getDefaultParams(g.intervalo,!0);g.inicio=n.inicio?r(n.inicio).format("YYYY-MM-DD"):t.inicio,g.fim=n.fim?r(n.fim).format("YYYY-MM-DD"):t.fim,g.regime=n.regime||g.regime,g.loading=!0,angular.isDefined(n.pendentes)&&(g.filtroStatus.toggle(8,"1"==n.pendentes),g.filtroStatus.toggle(1,"1"==n.pendentes)),g.filterManager.ready((function(){n.cat&&(g.filterManager.clearAll(!0),g.filterManager.setFilter("categorias",n.cat,!1)),n.cen&&(g.filterManager.clearAll(!0),g.filterManager.setFilter("centros",n.cen,!1),n.tipo&&g.filterManager.setFilter("tipo",n.tipo,!1));var t=s.lancamentos.parseFiltros(g.filterManager),o=angular.extend(t,{inicio:g.inicio,fim:g.fim,regime:g.regime,status:g.filtroStatus.get()});return s.v2.totaisPor(a,o,{orderBy:g.orderBy,renderPieChart:"p"==g.chartType}).then((function(a){g.despesas=a.despesas,g.receitas=a.receitas,g.totais=a.totais,g.charts=a.charts})).then((function(){if("g"!=g.visao){for(var t,e="d"==g.tipoCategoriaDetalhada?g.totais.despesas:g.totais.receitas,n="d"==g.tipoCategoriaDetalhada?g.despesas:g.receitas,r=0;r<n.length;r++)if(n[r].categoria.id==g.categoriaDetalhadaId){t=n[r];break}return g.detalheSubcategoria&&(e=g.detalhamento.valor),g.categoriaDetalhada=t,g.detalhamento={valor:t?t.valor:0,part:t?Math.abs(t.valor/e):0,lancamentos:[]},s.v2.totaisPor(a,o,{orderBy:g.orderBy,renderPieChart:"p"==g.chartType},g.categoriaDetalhadaId,g.tipoCategoriaDetalhada).then((function(a){g.loading=!1,g.detalhamento.subcategorias=a.subcategorias,g.detalhamento.chart=a.chart,g.detalhamento.paginator=a.lancamentos,a.lancamentos.onFetch=function(a,t){g.detalhamento.lancamentos=a,g.detalhamento.totalLancamentos=t.total},a.lancamentos.onCompleteIterate=function(a){g.detalhamento.lancamentosImp=a},a.lancamentos.fetch(1)}))}g.loading=!1}))}))}function x(a){g.orderBy=a,b(),A()}function S(){g.fullscreen=!g.fullscreen,b()}function D(){g.chartType="p"==g.chartType?"c":"p",b(),A()}function $(){g.regime="ca"==g.regime?"co":"ca",n.regime&&(n.regime=g.regime),b(),A()}function M(a,t){g.visao="dg",g.categoriaDetalhadaId=a,g.tipoCategoriaDetalhada=t,A()}function w(a){g.detalheSubcategoria?(g.filterManager.clearValue("categorias",g.detalheSubcategoria),g.detalheSubcategoria=null):(g.filterManager.addValue("categorias",a),g.detalheSubcategoria=a,A())}function E(){g.detalheSubcategoria&&(g.filterManager.clearValue("categorias",g.detalheSubcategoria),g.detalheSubcategoria=null),g.visao="g",g.categoriaDetalhada=null,g.categoriaDetalhadaId=null,A()}function y(){g.visao=g.categoriaDetalhadaId?"dg":"g",b()}g.printConfig={controller:function(){this.relatorio=g},templateUrl:"/partials/relatorios/rd/"+o+"_print.html",paginate:function(){if("dg"==g.visao)return g.detalhamento.paginator}},g.grupo=a,g.lancamentosBase=[],g.lancamentos=[],g.visao="g",g.regime=C.regime,g.intervalo=C.intervalo,g.fullscreen=1==C.fs,g.orderBy=C.orderBy,g.chartType=C.chartType,g.calendarioConfig={restrict:["d","w","m","t","s","y","p"],interval:g.intervalo,onUpdate:function(){g.intervalo!=this.currentInterval&&"p"!=this.currentInterval&&(g.calendarioConfig.interval=this.currentInterval,g.intervalo=this.currentInterval,b())}},s.addObserver("rd",(function(a){h.notify(a)})),g.filterManager=u.getManagerLancamentos({funcionalidade:t,onUpdate:function(){g.detalheSubcategoria=!1,g.filterManager.getId()!=C.filtro&&b(),A()},status:!1,semTransferencia:!0,plasticos:!0}),g.filterManager.startWith(C.filtro),g.filtroStatus=d(A),g.carregar=A,g.toggleGrafico=y,g.detalhar=M,g.fecharDetalhe=E,g.updateConfig=b,g.addObserver=h.add,g.toggleRegime=$,g.toggleFullscreen=S,g.changeChartType=D,g.toggleSort=x,g.detalharSubcategoria=w,g.loading=!0}}(o,t++))}))}(),function(){"use strict";function a(a,t,o){a.title="Relatórios";var e=o.usuario.conta,n=t.carregarContasCaixa().map((function(a){return a.id}));this.relatorios=[{nome:"Receitas e despesas",rels:[{nome:"Totais por categoria",href:"relatorios/totais/categoria",rest:!o.hasPerm("relatorios.totaiscategoria","v")},{nome:"Lançamentos por categoria",href:"relatorios/lancamentos/categoria",rest:!o.hasPerm("relatorios.lancamentoscategoria","v")},{nome:"Totais por centro",href:"relatorios/totais/centro",rest:!o.hasPerm("relatorios.totaiscentro","v")},{nome:"Lançamentos por centro",href:"relatorios/lancamentos/centro",rest:!o.hasPerm("relatorios.lancamentoscentro","v")},{nome:"Totais por contato",href:"relatorios/totais/contato",rest:!o.hasPerm("relatorios.totaiscontato","v")},{nome:"Lançamentos por contato",href:"relatorios/lancamentos/contato",rest:!o.hasPerm("relatorios.lancamentoscontato","v")},{nome:"Totais por projeto",href:"relatorios/totais/projeto",rest:!o.hasPerm("relatorios.totaisprojeto","v")},{nome:"Lançamentos por projeto",href:"relatorios/lancamentos/projeto",rest:!o.hasPerm("relatorios.lancamentosprojeto","v")},{nome:"Evolução por categoria",href:"relatorios/evolucao/categoria",rest:!o.hasPerm("relatorios.evolucaocat","v")},{nome:"Evolução por centro",href:"relatorios/evolucao/centro",rest:!o.hasPerm("relatorios.evolucaocentro","v")},{nome:"Evolução por contato",href:"relatorios/evolucao/contato",rest:!o.hasPerm("relatorios.evolucaocontato","v")},{nome:"Evolução das metas de categorias",href:"metas/evolucao",rest:!o.hasPerm("metas.rd","v")},{nome:"Evolução das metas de centros",href:"metas/centros/evolucao",rest:!o.hasPerm("metas.centros","v")},{nome:"Resultado dos projetos",href:"relatorios/projetos",rest:!o.hasPerm("relatorios.resultadosprojetocategoria","v")}]},{nome:"Caixa",rest:o.hasRest("contas",0,"v",n),rels:[{nome:"Fluxo de caixa",href:"caixa/fluxo",rest:!o.hasPerm("relatorios.fluxodecaixa","v")},{nome:"Lançamentos de caixa",href:"caixa/lancamentos",rest:!o.hasPerm("relatorios.movimentacoes","v")||o.hasRest("lancamentos",0,"v",n)},{nome:"Contas a pagar",href:"caixa/pr/pagar",rest:!o.hasPerm("relatorios.contaspagar","v")||o.hasRest("lancamentos",0,"v",n)},{nome:"Contas a receber",href:"caixa/pr/receber",rest:!o.hasPerm("relatorios.contasreceber","v")||o.hasRest("lancamentos",0,"v",n)},{nome:"Contas pagas",href:"caixa/prc/pagas",rest:!o.hasPerm("relatorios.contaspagar","v")||o.hasRest("lancamentos",0,"v",n)},{nome:"Contas recebidas",href:"caixa/prc/recebidas",rest:!o.hasPerm("relatorios.contasreceber","v")||o.hasRest("lancamentos",0,"v",n)}]},{nome:"Instituto Bulla",rest:12!=e.parceiro,rels:[{nome:"Demonstrativo de Fluxo de Caixa",href:"relatorios/ibulla/dfc"}]}]}a.$inject=["mdwTopmenu","contasService","usuariosService"],angular.module("md").controller("RelatoriosController",a)}(),function(){"use strict";function a(a,t,o,e,n,r,i,c,s,l,u,d,m,f,p,v,g){var h=this,C={extrato:r("/relatorios/extrato"),pendentes:r("/relatorios/pendentes"),movimentacoes:r("/relatorios/movimentacoes"),rd:r("/relatorios/rd"),pr:r("/relatorios/contasapagar"),prc:r("/relatorios/contaspagas"),saldosContas:r("/relatorios/saldoscontas"),resultadosContas:r("/relatorios/resultadoscontas"),fluxodecaixa:r("/relatorios/fluxodecaixa"),metasorcamento:r("/relatorios/metasorcamento"),metascentros:r("/relatorios/metascentros"),rentabilidade:r("/relatorios/rentabilidade"),evolucaoCat:r("/relatorios/evolucaocat"),evolucaoMetas:r("/relatorios/evolucaometas"),evolucaoCentros:r("/relatorios/evolucaocentros"),metasinvestimentos:r("/relatorios/metasinvestimentos"),bp:r("/relatorios/bp"),resumoCartoes:r("/relatorios/resumoCartoes"),evolucaoProjeto:r("/relatorios/evolucaoprojeto/:id"),resultadosProjetos:r("/relatorios/resultadosprojetos/:id"),lancamentos:r("/api/v2/lancamentos"),metasOrcamentoV2:r("/api/v2/lancamentos/metasorcamento"),ibulladfc:r("/api/v2/lancamentos/ibulla/dfc")},b={},A={},x={},S={};function D(){angular.forEach(C,(function(a){a.reset()})),angular.forEach(S,(function(a){a.notify()}))}function $(a){return a.forEach((a=>{"i"==a.tipo?a._idLote=`vi${a.id}`:a.projecaoFatura?a._idLote=`vf${a.projecaoFatura}${a.dataPrevista}`:a.residuoMeta?a._idLote=`vr${a.categoria}${a.data}`:a._idLote=a.id})),a}angular.forEach(C,(function(a,t){S[t]=i()})),c.addGlobalObserver(D),l.addObserver(D),u.addObserver((function(a){C.metasorcamento.reset(),C.metasOrcamentoV2.reset(),S.metasorcamento.notify(a)})),d.addObserver((function(a){C.metasinvestimentos.reset(),C.metasOrcamentoV2.reset(),S.metasinvestimentos.notify(a)})),m.addObserverMetas((function(a){C.evolucaoProjeto.reset(),S.evolucaoProjeto.notify(a),C.resultadosProjetos.reset(),S.resultadosProjetos.notify(a)})),h.metasinvestimentos=function(a){return a.pendentesPresente=f.utilizacao.pendentesPresente,a.moeda=g.moeda,C.metasinvestimentos.get(a)},h.bp=function(a){return a=a||{},C.bp.get(a)},h.addObserver=function(a,t){return S[a].add(t)},h.resumoCartoes=function(a,t){return C.resumoCartoes.get({inicio:a,moeda:g.moeda,apenasContasAtivas:!1,utilizado:!!t})},h.evolucaoProjeto=function(a){return a.pendentesPresente=f.utilizacao.pendentesPresente,a.moeda=g.moeda,C.evolucaoProjeto.get(a)},h.resultadosProjetos=function(a){return a||(a={}),a.moeda=g.moeda,C.resultadosProjetos.get(a)},h.ibulladfc=function(a){return C.ibulladfc.get(a)},h.idLancGenerator=$,h.v2={fluxocaixa:function(o){var r=[],i=[],s=p.carregarContasCaixa(!0),l=s.map((function(a){return a.id})),u={contas:{},chartContas:{}};s.sort((function(a,t){return a.nome.toLowerCase()<t.nome.toLowerCase()?-1:a.nome>t.nome?1:0})),(o.contas||l).forEach((function(a){u.contas[a]=!0})),o.chartContas?o.chartContas.forEach((function(a){u.chartContas[a]=!0})):u.chartContas[0]=!0;return a.all([m(o.fim,o.inicio,!1!==o.transferenciasIntracaixa).then((function(a){i=a.sum})),m(n(o.inicio).subtract(1,"day").format("YYYY-MM-DD")).then((function(a){r=a.sum}))]).then((function(){var a={},m={total:0,residuo:0},f=0,p=0,v={},h={total:"#999"},C=[],b="d"==o.visao?"YYYY-MM-DD":"YYYY-MM",A="d"==o.visao?"day":"month";l.forEach((function(a){m[a]=0,h[a]=e.getColorAtIndex(f++)})),h.residuo=e.getColorAtIndex(f++),r.forEach((function(a){w(a),v[a.conta]=a.projetado})),i.forEach((function(a){w(a,n(a.data).format(b))}));for(var x=n(o.inicio).format(b),S=n(o.fim).format(b),D=0;x<=S;D++){var $=M(x,a[x],D>0?C[D-1].saldo:p);$.contas={},l.forEach((function(t){$.contas[t]=M(x,a[x]?a[x].contas[t]:void 0,D>0?C[D-1].contas[t].saldo:v[t])})),C.push($),"YYYY-MM"==b&&(x+="-01"),x=n(x).add(1,A).format(b)}return{fluxo:C,saldos:m,saldosAnt:r,saldoAnterior:p,contas:s,chart:E(),cores:h};function M(a,t,e){var n=moment(a);"d"!=o.visao&&n.date(n.daysInMonth());var r=angular.extend({data:n.format("YYYY-MM-DD"),entradas:0,saidas:0,resultado:0,saldo:0},t||{});return r.saldo=r.resultado+e,r}function w(t,o){var e="residuo"==t.conta?"r":t.conta,n=t.conta;o?(a[o]||(a[o]={entradas:0,saidas:0,resultado:0,contas:{}}),a[o].contas[n]||(a[o].contas[n]={entradas:0,saidas:0,resultado:0}),t.tipo&&("d"==t.tipo||"ts"==t.tipo?(u.contas[e]&&(a[o].saidas+=t.projetado),a[o].contas[n].saidas+=t.projetado):(u.contas[e]&&(a[o].entradas+=t.projetado),a[o].contas[n].entradas+=t.projetado)),u.contas[e]&&(a[o].resultado+=t.projetado),a[o].contas[n].resultado+=t.projetado):u.contas[e]&&(p+=t.projetado),u.contas[e]&&(m.total+=t.projetado),m[n]+=t.projetado}function E(){var a=d(),o=d(),e=!1,r=!1;o.type="ComboChart",o.data.cols=[{type:"string"}],o.options.seriesType="line",o.options.bar={groupWidth:"35%"};a.data.rows=[],o.data.rows=[];var i={};return C.forEach((function(s,l){var d=[{v:n(s.data).toDate()}],m=[{v:n(s.data).format("D MMM")+"."}],f=0,p=0;s.contas&&angular.forEach(s.contas,(function(o,e){u.contas[e]&&"residuo"!=e&&(f+=o.entradas,p+=o.saidas),u.contas[e]&&u.chartContas[e]&&"residuo"!=e&&(i[e]||(i[e]=!0,a.options.series.push({color:h[e],lineWidth:2}),a.data.cols.push({type:"number",label:c.get("contas",e,!0).nome})),d.push({v:Math.abs(o.saldo)<.001?0:o.saldo,f:t("currency")(o.saldo,t("moeda")(g.moeda)+" ")}))})),u.chartContas[0]&&(i.total||(i.total=!0,a.data.cols.push({type:"number",label:"Total"}),a.options.series.push({color:h.total,lineWidth:3}),o.data.cols.push({type:"number",label:"Resultado"}),o.options.series.push({color:"#c0c0c0",lineWidth:3})),d.push({v:Math.abs(s.saldo)<.001?0:s.saldo,f:t("currency")(s.saldo,t("moeda")(g.moeda)+" ")}),m.push({v:Math.abs(s.resultado)<.001?0:s.resultado,f:t("currency")(s.resultado,t("moeda")(g.moeda)+" ")}),r||(r=!r,a.data.cols.push({type:"string",role:"style"})),d.push({v:(!l||C[l].saldo<0)&&s.saldo<-.001?"#c62828":"#999"})),e||(e=!e,o.options.isStacked=!0,o.options.series.push({type:"bars",color:"#179428"}),o.options.series.push({type:"bars",color:"#ce6060"}),o.data.cols.push({type:"number",label:"Entradas"}),o.data.cols.push({type:"number",label:"Saídas"})),m.push({v:Math.abs(f)<.001?0:f,f:t("currency")(f,t("moeda")(g.moeda)+" ")}),m.push({v:Math.abs(p)<.001?0:p,f:t("currency")(p,t("moeda")(g.moeda)+" ")}),0==f&&0==p||o.data.rows.push({c:m}),a.data.rows.push({c:d})})),{resultado:o,fluxo:a}}}));function d(){return angular.merge({type:"LineChart",data:{cols:[{type:"date"}],rows:[]},options:v.prepareChartOptions({backgroundColor:"transparent",chartArea:{width:"90%"},hAxis:{gridlines:{color:"transparent"},format:"dd MMM"},vAxis:{baselineColor:"#e2e2e2",gridlines:{color:"#e2e2e2"},format:"short",textPosition:"in"},legend:{position:"bottom"},series:[]})},o.chartOptions||{})}function m(a,t,e){var n={groupBy:"conta"};t&&(n.groupByData="d"==o.visao?"day":"month",n.groupByTipo=!0);var r=h.lancamentos.STATUS_PROJETADO;return!1===o.pendentes&&(r&=~h.lancamentos.STATUS_PENDENTE),h.lancamentos.sum({inicio:t,fim:a,status:r,finalidade:h.lancamentos.FIN_EXTRATO,contas:{ids:l,residuo:f.utilizacao.residuo,faturas:!0,transferenciasIntracaixa:e}},n)}},totaisPor:function(a,o,n,r,i){n=angular.extend({orderBy:"p",renderPieChart:!0},n||{});var s={id:0,nome:"Sem "+a},l="p"==n.orderBy?function(a,t){return Math.abs(t.valor)-Math.abs(a.valor)}:function(a,t){return a.categoria.nome.toLowerCase()<t.categoria.nome.toLowerCase()?-1:1};return void 0===r?function(){var t=[];return n().then(o);function o(){var o=[],n=[],r=0,i=0,c={despesas:0,receitas:0,total:0};return t.forEach((function(t){var l={valor:t.projetado,categoria:t[a]?u(t[a]):s},d="categoria"==a&&"d"==l.categoria.tipo||"categoria"!=a&&t.tipo&&"d"==t.tipo||"categoria"!=a&&!t.tipo&&l.valor<0,m=d?o:n;d?c.despesas+=l.valor:c.receitas+=l.valor,l.tipo=d?"d":"r",l.cor=e.getColorAtIndex(d?r++:i++),c.total+=l.valor,m.push(l)})),o.sort(l),n.sort(l),{despesas:o,receitas:n,totais:c,charts:{d:m(o),r:m(n)}}}function n(){var o=d();return o.categorias=angular.extend({subcategorias:!1},o.categorias||{}),h.lancamentos.sum(o,{groupBy:a,groupByTipo:"categoria"!=a}).then((function(a){t=a.sum}))}}():function(t){var o=[];return s().then(n);function n(){var t=[],n=0;return o.forEach((function(o){var r={valor:o.projetado,categoria:u(o[a]),cor:e.getColorAtIndex(n++)};t.push(r)})),t.sort(l),{subcategorias:t,chart:m(t),lancamentos:f()}}function r(){var o=d(),e=a+"s";if(!i||"d"!=i&&"r"!=i||(o.tipoLancamento="d"==i?1:2),"categoria"==a&&o.categorias&&o.categorias.ids){var n=[];o.categorias.ids.forEach((function(a){var o=c.get(e,a,!0);o&&o.pai==t&&n.push(o.id)}));var r=!1;if(o.categorias.inverse){r=!0;var s=[t];c.categorias.forEach((function(a){a.pai==t&&-1==n.indexOf(a.id)&&s.push(a.id)})),n=s}o[e]=n.length>0?{ids:n}:{ids:[t]},r&&(o[e].restrictPai=!0)}else o[e]={ids:[t]};return o}function s(){return h.lancamentos.sum(r(),{groupBy:a}).then((function(a){o=a.sum}))}function f(){return h.lancamentos.list(r(),{orderBy:[{t:"data"},{t:"datac"},{t:"valor"}]},{pageSize:100})}}(r);function u(t){return c.get(a+"s",t,!0)}function d(){var a=angular.copy(o);return a.tipoLancamento||(a.tipoLancamento=h.lancamentos.TIPO_TODOS),a.tipoLancamento=a.tipoLancamento&~h.lancamentos.TIPO_TRANSFERENCIA_ENTRADA&~h.lancamentos.TIPO_TRANSFERENCIA_SAIDA,a.pendentesPresente=f.utilizacao.pendentesPresente,a.moeda=g.moeda,a}function m(o){function r(t){var o="categoria"==a&&t.valor<0;A[a]||(A[a]=0),x[a]||(x[a]=0),b[a]||(b[a]={}),b[a][t.categoria.id]||(t.categoria.cor?b[a][t.categoria.id]=`#${t.categoria.cor}`:b[a][t.categoria.id]=e.getColorAtIndex(o?A[a]++:x[a]++)),t.cor=b[a][t.categoria.id]}for(var i,c=!1,s=0;s<o.length;s++){var l=o[s];if(c="d"==(l.tipo||l.categoria.tipo)&&l.valor>0||"r"==l.categoria.tipo&&l.valor<0)break}if(c||!n.renderPieChart)i={type:"ColumnChart",data:{cols:[{label:"Categoria",type:"string"},{label:"Total",type:"number"},{role:"style",type:"string"}],rows:[]},options:{backgroundColor:"transparent",tooltip:{trigger:"selection"},hAxis:{textPosition:"none"},vAxis:{textPosition:"none",gridlines:{color:"transparent"}},legend:{position:"none"},chartArea:{width:"90%",height:"90%"}}},o.forEach((function(a,o){var e="d"==(a.tipo||a.categoria.tipo)&&a.valor>0||"r"==a.categoria.tipo&&a.valor<0?-1:1;r(a),i.data.rows.push({c:[{v:a.categoria.nome},{v:Math.abs(a.valor)*e,f:t("currency")(a.valor,t("moeda")(g.moeda)+" ")},{v:a.cor}]})}));else{var u=[];i={type:"PieChart",data:{cols:[{id:"conta",label:"Conta",type:"string"},{id:"saldo",label:"Saldo total atualizado",type:"number"}],rows:[]},options:{pieHole:.4,backgroundColor:"transparent",legend:{position:"none"},chartArea:{width:"90%",height:"90%"},tooltip:{trigger:"selection"}}},o.forEach((function(a,o){r(a),u.push(a.cor);var e=[{v:a.categoria.nome,categoria:a.categoria.id},{v:Math.abs(a.valor),f:t("currency")(a.valor,t("moeda")(g.moeda)+" ")}];i.data.rows.push({c:e})})),i.options.colors=u}return i.canChangeChartType=!c,i}},metasOrcamento:function(a){var t=(a=angular.extend({apenasMetasDefinidas:f.utilizacao.metasRD,pendentesPresente:f.utilizacao.pendentesPresente,moeda:g.moeda,tipo:"categoria"},a)).tipo,o="centro"!=t;return C.metasOrcamentoV2.get(a).then((function(n){var r={},i={},c={};function s(a){var t=Math.abs(a.meta)-Math.abs(a.confirmado),o=Math.abs(a.meta)-Math.abs(a.projetado);t>0?a.realizarc=t:a.excedentec=t,o>0?a.realizarp=o:a.excedentep=o}return n.forEach((function(n){if(n.meta||a.indefinidas){var s=n.categoriaPai||n[t];if(e(n),s){o||(s+=n.tipo);var l=!n.categoriaPai;if(i[s]||(l?(i[s]=n,i[s].subcategorias=[]):i[s]={subcategorias:[]}),l){if(!i[s][t]){var u=i[s].subcategorias;i[s]=n,i[s].subcategorias=u}}else i[s].subcategorias.push(n)}else c[n.tipo]=n,r[n.tipo]||(r[n.tipo]=angular.extend({categorias:[],geral:c[n.tipo]},{confirmado:0,meta:0,projetado:0,realizarc:0,realizarp:0,excedentec:0,excedentep:0,residuo:0,tipo:n.tipo}))}})),angular.forEach(i,(function(a){r[a.tipo]||(r[a.tipo]=angular.extend({categorias:[],geral:c[a.tipo]},{confirmado:0,meta:0,projetado:0,realizarc:0,realizarp:0,excedentec:0,excedentep:0,residuo:0,tipo:a.tipo})),r[a.tipo].categorias.push(a),a.meta&&(r[a.tipo].projetado+=a.projetado,r[a.tipo].confirmado+=a.confirmado,r[a.tipo].meta+=a.meta,r[a.tipo].residuo+=a.residuo)})),r.d&&(s(r.d),e(r.d)),r.r&&(s(r.r),e(r.r)),r}));function e(a){var o=a.tipo;if(a[t]){var e=c.get(t+"s",a[t],!0);a.nome=e.nome,a.nomeRel=e.nomeRel||e.nome}function n(a){var t=function(a){return"d"==o?a<.7?"confortavel":a>1?"critica":"alerta":a<.3?"critica":a>=1?"confortavel":"alerta"}(a);return"confortavel"==t?"#22cc29":"critica"==t?"#f76d6d":"#ffba19"}a.realizarProjetado=a.realizarp,a.realizarConfirmado=a.realizarc,a.meta?(a.razaoConfirmada=a.confirmado/a.meta,a.razaoProjetada=a.projetado/a.meta,a.corConfirmada=n(a.razaoConfirmada),a.corProjetada=n(a.razaoProjetada)):a.razaoConfirmada=a.razaoProjetada=0}},evolucaoMetas:function(a){return C.metasOrcamentoV2.get(a)},evolucaoRd:function(a){var t=(a=angular.extend({intervalo:"y",investimentos:!0,tipo:"categoria",evolmetas:!1},a)).tipo,o=t+"s",e="categoria"===a.tipo,r=12;"t"==a.intervalo&&(r=3);"s"==a.intervalo&&(r=6);var i={inicio:n(a.inicio).startOf("month").format("YYYY-MM-DD"),fim:n(a.inicio).startOf("month").add(r,"months").subtract(1,"day").format("YYYY-MM-DD"),regime:a.regime,investimentos:a.investimentos,tipo:a.tipo,pendentesPresente:f.utilizacao.pendentesPresente,moeda:g.moeda,evolmetas:a.evolmetas};a.filtros&&angular.extend(i,h.lancamentos.parseFiltros(a.filtros));i.status=h.lancamentos.STATUS_PROJETADO,a.pendentes||(i.status&=~(h.lancamentos.STATUS_PENDENTE|h.lancamentos.STATUS_AGENDADO));i.tipoLancamento=h.lancamentos.TIPO_DESPESA|h.lancamentos.TIPO_RECEITA,a.metas&&(i.tipoLancamento|=h.lancamentos.TIPO_TRANSFERENCIA);return function(){if(e||a.evolmetas)return C.metasOrcamentoV2.get(angular.extend({apenasMetasDefinidas:a.metas,groupByData:!0},i));return h.lancamentos.sum(i,{groupBy:t,groupByData:"month",groupByTipo:!0}).then((function(a){return a.sum}))}().then((function(u){var d={},m={projetado:0,confirmado:0,meta:0,realizarp:0,realizarc:0},f=moment(i.inicio).format("YYYY-MM"),p=moment(i.fim).format("YYYY-MM");for(;f<=p;)d[f]=angular.copy(m),f=moment(f).add(1,"month").format("YYYY-MM");var v={},g={d:angular.copy(m),r:angular.copy(m),i:angular.copy(m),t:angular.copy(m),c:angular.copy(m)},h={despesas:[],receitas:[],investimentos:[],totalD:angular.copy(m),totalR:angular.copy(m),totalI:angular.copy(m),total:angular.copy(m),mediaD:angular.copy(m),mediaR:angular.copy(m),mediaI:angular.copy(m),mediaTotal:angular.copy(m),comprometimentoTotal:angular.copy(m),comprometimentoMedio:angular.copy(m),totaisD:angular.copy(d),totaisR:angular.copy(d),totaisI:angular.copy(d),totais:angular.copy(d),comprometimentosTotais:angular.copy(d),totalSem:{1:angular.copy(g),2:angular.copy(g)},gerarMeses:l};function C(a,t,o){o=o||1,a.projetado+=t.projetado*o,a.confirmado+=t.confirmado*o,t.meta&&(a.meta+=t.meta*o),t.realizarp&&(a.realizarp+=t.realizarp*o),t.realizarc&&(a.realizarc+=t.realizarc*o)}var b=null,A={nome:"Sem "+t,id:0};u.forEach((function(r,i){var s=n(r.data).month()<6?1:2,l="i"==r.tipo,f=l?r.conta:r.categoriaPai||r[t],p=f+r.tipo,g=(l?r.conta:r[t])+r.tipo,x=!e&&0==f;if(f||x){var S=!r.categoriaPai;if(!v[p]){var D=x?A:c.get(l?"contas":o,f,!0);v[p]={categoria:D,tipo:r.tipo,datas:angular.copy(d),sem1:angular.copy(m),sem2:angular.copy(m),total:angular.copy(m),media:angular.copy(m),filhos:{}}}var $=v[p],M=l?f:r.categoria,w=M+r.tipo;e&&!$.filhos[w]&&($.filhos[w]={categoria:c.get(l?"contas":o,M,!0),tipo:r.tipo,datas:angular.copy(d),sem1:angular.copy(m),sem2:angular.copy(m),total:angular.copy(m),media:angular.copy(m)});var E=S?v[p]:$.filhos[w];if(C(E.datas[r.data],r),C(E["sem"+s],r),C(E.total,r),a.acumular&&(1==s&&C(E.sem2,r),g==b)){var y=u[i-1];C(E.datas[r.data],E.datas[y.data]),C(E["sem"+s],E.datas[y.data]),C(E.total,E.datas[y.data])}}if(!e&&!a.evolmetas||!f){var I,O=r.tipo,T="d"==O,P=l?-1:1;if(C(h.totalSem[s][O],r),C(h.totalSem[s].t,r,P),l?(C(h.totalI,r),I=h.totaisI):T?(C(h.totalD,r),I=h.totaisD,C(h.totalSem[s].c,r)):(C(h.totalR,r),I=h.totaisR),C(I[r.data],r),C(h.totais[r.data],r,P),C(h.total,r,P),a.acumular&&g==b){y=u[i-1];C(I[r.data],I[y.data]),C(h.totais[r.data],I[y.data],P),C(h.total,I[y.data],P)}}b=g}));var x=[];function S(a){a.media.projetado=a.total.projetado/r,a.media.confirmado=a.total.confirmado/r,a.media.meta=a.total.meta/r}function D(a,t){a.projetado=t.projetado/r,a.confirmado=t.confirmado/r,a.meta=t.meta/r}function $(a,t){h.totaisR[t].projetado&&(a.comprometimento[t].projetado=Math.abs(a.datas[t].projetado/h.totaisR[t].projetado)),h.totaisR[t].confirmado&&(a.comprometimento[t].confirmado=Math.abs(a.datas[t].confirmado/h.totaisR[t].confirmado))}function M(a,t,o){a.projetado=o.projetado?Math.abs(t.projetado/o.projetado):0,a.confirmado=o.confirmado?Math.abs(t.confirmado/o.confirmado):0}return angular.forEach(v,(function(t){if(x.push(t),S(t),e){var o=[];angular.forEach(t.filhos,(function(t){a.evolmetas&&0==t.total.meta&&0==t.total.projetado||(a.evolmetas||0!=t.total.projetado)&&(o.push(t),S(t))})),t.filhos=o}})),D(h.mediaI,h.totalI),D(h.mediaD,h.totalD),D(h.mediaR,h.totalR),D(h.mediaTotal,h.total),s(x),angular.forEach(x,(function(t){("i"==t.tipo?h.investimentos:"d"==t.tipo?h.despesas:h.receitas).push(t),e&&(!a.subcategorias||1==t.filhos.length&&t.filhos[0].categoria.id==t.categoria.id||(s(t.filhos),angular.forEach(t.filhos,(function(a){a.isSub=!0})),"i"==t.tipo?h.investimentos=h.investimentos.concat(t.filhos):"d"==t.tipo?h.despesas=h.despesas.concat(t.filhos):h.receitas=h.receitas.concat(t.filhos)))})),h.despesas.forEach((function(a){"d"==a.tipo&&(a.comprometimento=angular.copy(d),a.cmpsem1=angular.copy(m),a.cmpsem2=angular.copy(m),a.comprometimentoMedio=angular.copy(m),a.comprometimentoTotal=angular.copy(m),angular.forEach(a.datas,(function(t,o){n(o).month()<6?C(a.cmpsem1,t):C(a.cmpsem2,t),$(a,o)})),M(a.cmpsem1,a.cmpsem1,h.totalSem[1].r),M(a.cmpsem2,a.cmpsem2,h.totalSem[2].r),M(a.comprometimentoMedio,a.media,h.mediaR),M(a.comprometimentoTotal,a.total,h.totalR))})),angular.forEach(h.totaisD,(function(a,t){M(h.comprometimentosTotais[t],a,h.totaisR[t])})),M(h.totalSem[1].c,h.totalSem[1].c,h.totalSem[1].r),M(h.totalSem[2].c,h.totalSem[2].c,h.totalSem[2].r),M(h.comprometimentoTotal,h.totalD,h.totalR),M(h.comprometimentoMedio,h.mediaD,h.mediaR),h}));function s(t){var o="a"==a.orderBy?function(a,t){return a.categoria.nome.toLowerCase()<t.categoria.nome.toLowerCase()?-1:1}:function(a,t){return Math.abs(t.media.projetado)-Math.abs(a.media.projetado)};t.sort(o)}function l(t){var o=[],e=6;"t"==a.intervalo&&(e=3);var r=0;for("y"==a.intervalo&&2==t&&(r=6,e=12);r<e;r++)o.push(n(a.inicio).add(r,"months").format("YYYY-MM"));return o}},evolucaoCentros:function(a){},evolucaoContatos:function(a){}},h.lancamentos=new function(){var t=this;function e(a,t){return t.type=a,t.moeda||(t.moeda=g.moeda),t.apenasMetasDefinidas=f.utilizacao.metasRD,t.pendentesPresente=angular.isDefined(t.pendentesPresente)?t.pendentesPresente:f.utilizacao.pendentesPresente,C.lancamentos.get(t)}t.FIN_EXTRATO=1,t.FIN_APURACAO_RESULTADO=2,t.FIN_BUSCA=3,t.STATUS_PENDENTE=1,t.STATUS_CONFIRMADO=2,t.STATUS_CONCILIADO=4,t.STATUS_AGENDADO=8,t.STATUS_PROJETADO=15,t.TIPO_DESPESA=1,t.TIPO_RECEITA=2,t.TIPO_TRANSFERENCIA_SAIDA=4,t.TIPO_TRANSFERENCIA_ENTRADA=8,t.TIPO_TRANSFERENCIA=12,t.TIPO_TODOS=15,t.REP_UNICO=1,t.REP_PARCELADO=2,t.REP_FIXO=4,t.REP_TODOS=7,t.CONFIRMACAO_AUTOMATICA=1,t.CONFIRMACAO_NAO_AUTOMATICA=2,t.CONFIRMACAO_TODOS=3,t.EXIBIR_PAGAR_RECEBER=1,t.NAO_EXIBIR_PAGAR_RECEBER=2,t.LANCAMENTOS_RECONHECIDOS=1,t.LANCAMENTOS_NAO_RECONHECIDOS=2,t.parseFiltros=function(a){var o={};return a.getActive(!0).forEach((function(a){var e=a.inverse?-1:1;if("tipo"==a.tipo){var n=a.inverse?t.TIPO_TODOS:0,r={d:t.TIPO_DESPESA,r:t.TIPO_RECEITA,ts:t.TIPO_TRANSFERENCIA_SAIDA,te:t.TIPO_TRANSFERENCIA_ENTRADA};a.filtros.forEach((function(a){"t"!=a?n+=e*r[a]:(n+=e*r.ts,n+=e*r.te)})),n&&(o.tipoLancamento=n)}else if("repeticao"==a.tipo){n=a.inverse?t.REP_TODOS:0,r={u:t.REP_UNICO,p:t.REP_PARCELADO,f:t.REP_FIXO};a.filtros.forEach((function(a){n+=e*r[a]})),n&&(o.tipoRepeticao=n)}else if(a.tipo.match(/^(contas|categorias|centros|projetos|formas|contatos|tags|plasticos)$/))o[a.tipo]={ids:a.filtros},a.inverse&&(o[a.tipo].inverse=!0);else if("confAuto"==a.tipo){let e={s:t.CONFIRMACAO_AUTOMATICA,n:t.CONFIRMACAO_NAO_AUTOMATICA},n=0;a.filtros.forEach((a=>{n+=e[a]})),n&&(o.confAuto=n)}else if("exibirCpr"==a.tipo){let e={s:t.EXIBIR_PAGAR_RECEBER,n:t.NAO_EXIBIR_PAGAR_RECEBER},n=0;a.filtros.forEach((a=>{n+=e[a]})),n&&(o.exibirCpr=n)}else if("exibirRn"==a.tipo){let e={s:t.LANCAMENTOS_RECONHECIDOS,n:t.LANCAMENTOS_NAO_RECONHECIDOS},n=0;a.filtros.forEach((a=>{n|=e[a]})),n&&(o.exibirRn=n)}})),o},t.list=function(t,n,r){return new function(){var i=0,c=[],s=this,l=s.paginator=o({pageSize:r.pageSize,getTotal:function(){return i},onFetch:function(a){return s.onBeforeFetch(a),d(a).then((function(a){return i=a.meta.total,l.currentPage=a.meta.page,a.meta.pageSize&&a.meta.pageSize>l.pageSize&&(l.pageSize=a.meta.pageSize),s.onFetch.call(s,a.list,a.meta)}))},onIterate:function(a){return 1==a&&(c=[]),d(a).then((function(t){c=c.concat(t.list),i=t.meta.total,l.currentPage=t.meta.page,t.meta.pageSize&&t.meta.pageSize>l.pageSize&&(l.pageSize=t.meta.pageSize),s.onIterate.call(s,a)}))},onCompleteIterate:function(){return s.onCompleteIterate.call(s,c)}});function u(){return t.list=angular.extend({sumPrevPages:!1,orderBy:[{t:"data"},{t:"datac"},{t:"valor"}]},n),t}function d(t){var o=u();return o.list=angular.extend(o.list,{page:t,pageSize:r.pageSize}),o.contas&&o.contas.ids&&0==o.contas.ids.length&&!o.contas.apenasResiduos?a.resolve({list:[],meta:{total:0,page:1,pageSize:0}}):e("list",o).then((a=>(a.list=$(a.list),a)))}s.onBeforeFetch=r.onBeforeFetch||function(a){},s.onFetch=r.onFetch||function(a,t){},s.onIterate=r.onIterate||function(a){},s.onCompleteIterate=r.onCompleteIterate||function(a){},s.getParams=u,angular.extend(s,l)}},t.sum=function(t,o){if(t.contas&&t.contas.ids&&0==t.contas.ids.length){var n=o.groupBy||o.groupByData||o.groupByTipo;return a.resolve({sum:n?[]:0})}return t.sum=o,e("sum",t)}}}a.$inject=["$q","$filter","mdwPaginator","mdwColors","mdwMoment","mdwCache","mdwObserver","cadastrosDatasource","investimentosDatasource","lancamentosDatasource","metasorcamentoDatasource","metasInvestimentosDatasource","projetosDatasource","configuracoesService","contasService","mdwDarkModeService","moedaService"],angular.module("md").service("relatoriosDatasource",a)}(),function(){"use strict";function a(a,t){t.state({id:"relatorios",title:"Relatórios",templates:["relatorios/relatorios.html"]},{url:"/relatorios",templateUrl:"partials/relatorios/relatorios.html",controller:"RelatoriosController",controllerAs:"vm"})}a.$inject=["$stateProvider","mdwBaseStateProvider"],angular.module("md").config(a)}(),function(){"use strict";function a(a,t,o,e,n,r,i){var c=this;c.itemAdded=!1;var s=a.uploader=new r({url:"/",autoUpload:!1,withCredentials:!0});c.ok=function(){return s.uploadItem(0)},c.excluir=function(){if(confirm("Confirma a exclusão desta imagem?"))return o.delete("/apiweb/avatar/"+c.tipo).then((function(a){c.model.avatar=null,t.hide()}))};var l={support:!(!e.FileReader||!e.CanvasRenderingContext2D),isImage:function(a){var t="|"+a.type.slice(a.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(t)}};function u(){}s.filters.push({name:"imageFilter",fn:l.isImage}),s.onWhenAddingFileFailed=function(a,t,o){console.info("onWhenAddingFileFailed",a,t,o)},s.onAfterAddingFile=function(a){c.itemAdded=!0;var t=new FileReader;t.onload=function(a){n((function(){c.url=a.target.result}))},t.readAsDataURL(a._file),c.progress=0,i.s3Credentials().then((function(t){var o=t.credentials,e=t.url,n=t.key+"/"+a.file.name.replace(/\,/g,"_");a.url=e,a.formData=[angular.extend(o,{key:n,"Content-Type":a.file.type})]}),u)},s.onBeforeUploadItem=function(a){var t=function(a){var t;t=a.split(",")[0].indexOf("base64")>=0?atob(a.split(",")[1]):decodeURI(a.split(",")[1]);for(var o=a.split(",")[0].split(":")[1].split(";")[0],e=[],n=0;n<t.length;n++)e.push(t.charCodeAt(n));return new Blob([new Uint8Array(e)],{type:o})}(c.croppedImg);a._file=t},s.onProgressAll=function(a){c.progress=a},s.onSuccessItem=function(a,e,n,r){const i=a.url+"/"+a.formData[0].key;return o.put("/apiweb/avatar",{avatar:i,tipo:c.tipo}).then((function(a){t.hide(),c.model.avatar=a.data.url||i}))},s.onErrorItem=function(a,t,o,e){c.progress=0}}a.$inject=["$scope","$mdDialog","$http","$window","$timeout","FileUploader","documentosService"],angular.module("md").controller("mdwAvatarUsrUploadController",a).directive("mdwAvatarUsr",(function(){return a.$inject=["$mdDialog","usuariosService"],{restrict:"E",require:"mdwAvatarUsr",link:function(a,t,o,e){},controller:a,bindToController:!0,controllerAs:"vm",scope:{size:"=",fontSize:"@",model:"=ngModel",tipo:"@",placeholder:"=",onUpdate:"=",editable:"=?"},template:['<div ng-if="!vm.url" class="placeholder" ng-style="vm.style">{{vm.placeholder.slice(0,1)}}</div>','<img ng-if="!!vm.url" ng-src="{{vm.url}}" ng-style="vm.style">','<div ng-if="vm.editable" class="editar" ng-style="vm.style"><a href ng-click="vm.editar()">Editar</a></div>'].join("")};function a(a,t){var o=this;o.$onInit=function(){o.url=o.model.avatar,o.editable=angular.isUndefined(o.editable)||o.editable,o.style={height:o.size+"px",width:o.size+"px","line-height":o.size+"px"},o.fontSize&&(o.style["font-size"]=o.fontSize+"px")},o.editar=function(){return a.show({id:"editar-avatar",templateUrl:"/partials/usuarios/mdwAvatarUsr.directive.html",controller:"mdwAvatarUsrUploadController",controllerAs:"vm",bindToController:!0,locals:{model:o.model,tipo:o.tipo,pf:"FISICA"==t.usuario.conta.tipoPessoa}}).then((function(){o.url=o.model.avatar}))}}}))}(),function(){"use strict";function a(a,t){var o=this;o.loading=!0,t.carregarEnviadas().then((function(a){o.nots=a,a.sort((function(a,t){return a.id.split(";")[1]<t.id.split(";")[1]?1:-1})),o.loading=!1})),o.preview=t.previewDialog}a.$inject=["mdwTopmenu","notificacoesService"],angular.module("md").controller("NotificacoesController",a)}(),function(){"use strict";angular.module("md").filter("notificacaoTipo",["usuariosService",function(a){return function(t){var o=t.emailDestino||a.getUsuarioConta(t.lid).login.email;switch(t.tipo){case 1:return"Email: "+o;case 2:case 4:return"Aviso interno: "+o;case 8:return"Notificação de push: "+o}return""}}])}(),function(){"use strict";function a(a,t,o,e,n){var r=this;function i(t){return t.status?o.resolve():(t.status=1,a.post("/apiweb/notificacoes/confirmar",{id:t.id}).then((function(a){t.dataHoraEnvio=a.data.dataHoraEnvio})))}function c(a){return 0==(a=angular.isArray(a)?a:[a]).length?o.resolve():t.show({id:"preview-notificacao",templateUrl:"/partials/usuarios/notificacoes/preview.html",controllerAs:"vm",bindToController:!0,escapeToClose:!0,wait:!0,locals:{nots:a},controller:["$scope",function(a){var t=this;t.cur=0,t.go=function(a){t.cur+=a,t.not=t.nots[t.cur]},t.not=t.nots[t.cur],i(t.not),a.$watch("vm.cur",(function(){i(t.not)}))}]})}r.carregarEnviadas=function(){return a.get("/apiweb/notificacoes").then((function(a){return a.data}))},r.carregarNaoLidas=function(){return a.get("/apiweb/notificacoes/naolidas",{cache:!0}).then((function(a){return a.data})).then((function(a){return n((function(){c(a.filter((function(a){return 2==a.tipo}))).finally((function(){!function(a){a.forEach((function(a){e.warning(a.shortText||"Clique para detalhar",a.titulo,{allowHtml:!0,closeButton:!0,timeOut:0,extendedTimeOut:0,onTap:function(){a.shortText||c(a)},onHidden:function(){i(a)},toastClass:"toast mdw-top-right-toast"})}))}(a.filter((function(a){return 4==a.tipo})))}))}),100),a}))},r.previewDialog=c}a.$inject=["$http","$mdDialog","$q","toastr","$timeout"],angular.module("md").service("notificacoesService",a)}(),function(){"use strict";angular.module("md").directive("mdwRenderNotificacao",["$compile","$sce",function(a,t){return{restrict:"A",scope:{html:"=mdwRenderNotificacao"},link:function(o,e,n){o.$watch((function(){return o.html}),(function(n){e.html(t.trustAsHtml(n)),a(e.contents())(o)}))}}}])}(),function(){"use strict";angular.module("md").filter("pagtoGw",(function(){return function(a){return 1==a.gateway?"PagSeguro":1==a.forma?"Crédito":2==a.forma?"Débito":3==a.forma?"Boleto":"-"}})).filter("pagtoForma",(function(){return function(a){return 3==a.status?"Boleto":""}})).filter("pagtoStatus",(function(){return function(a){return 1==a.status?"Iniciado":2==a.status?"Processando":3==a.status?"Confirmado":4==a.status?"Cancelado":5==a.status?"Estornado":void 0}}))}(),function(){"use strict";var a=angular.module("md"),t="meudinheiro::lastDisplayedTrialMessage",o=["assinatura"];a.component("mdwMensagemCortesia",{templateUrl:"partials/usuarios/usuario.mensagemCortesia.directive.html",controller:["$transitions","usuariosService","mdwTopmenu","MD_INVEST_MOD",function(a,e,n,r){var i=this,c=e.usuario,s=c.plano,l="FISICA"==c.conta.tipoPessoa;function u(){return moment(s.fim).diff(moment().startOf("day"),"days")}i.$onInit=function(){var e=u();if(!(!s.cortesia||e<0||e>7)&&(r||s.tipo)){if(s.planoVigente){if(s.planoVigente.tipo&&!r)return;if(s.planoVigente.inv_basico&&r)return}i.invest=r,i.nomePlano=l?"Família":"Empresarial 3",a.onSuccess({},(function(a){i.shouldShow=!1,function(){if(!localStorage)return!0;var a=localStorage.getItem(t);return!a||moment().startOf("day").diff(a,"days")>0}()&&-1==o.indexOf(a.to().name)&&(i.dias=u(),i.shouldShow=i.dias>=0)}))}},i.hide=function(){localStorage&&localStorage.setItem(t,moment().format("YYYY-MM-DD")),i.shouldShow=!1},i.saibaMais=n.experimentar}]})}(),function(){"use strict";angular.module("md").component("mdwMensagemLimiteLanc",{templateUrl:"partials/usuarios/usuario.mensagemLimiteLanc.directive.html",controller:["$mdDialog","$state","$timeout","$rootScope",function(a,t,o,e){const n=this;function r(){n.shouldShow=!1}n.$onInit=function(){e.$on("mdwLancUsageOverflowHeader",((a,t)=>{!function(a){const[,t,o,e]=a.split(",");n.maxLancamentosPlano=t,n.percentualExedido=o-1,n.anoMes=moment(`${e}-01`).format("MMMM YYYY")}(t),o((()=>{n.shouldShow=!0}),1500)}))},n.dismissDialog=r,n.upgrade=function(){r(),a.cancelAll(),t.go("assinatura")}}]})}(),function(){"use strict";function a(a,t){var o=this;o.apikeys=[],o.loading=!0,o.criarChave=function(){return a.post("usuarios/gerarApiKey").then((function(a){o.apikeys.push(a.data),t.showSimple("Chave de API criada")}))},a.get("usuarios/carregarApiKeys",{cache:!0}).then((function(a){o.apikeys=a.data,o.loading=!1}))}a.$inject=["$http","$mdToast"],angular.module("md").controller("UsuariosApiController",a)}(),function(){"use strict";o.$inject=["$stateParams","$timeout","$window","$rootScope","$scope","$http","$q","usuariosService","mdwTopmenu","$mdDialog","mdwMoment","configuracoesService","mdwAnalytics","$mdToast","MD_INVEST_MOD","conexoesService"],e.$inject=["$mdDialog","contatosService","$http","mdwAnalytics"],angular.module("md").controller("UsuariosAssinaturaController",o);var a=["inv_operacoes","inv_basico","inv_ir","inv_avancado","adicionais","propostas","anexos","moedas","conexoes","nlancamentos"];function t(a){return!a||isNaN(a)?0:parseFloat(a.toFixed(2))}function o(o,n,r,i,c,s,l,u,d,m,f,p,v,g,h,C){var b,A,x=this,S=0;x.conexoesEnabled=C.isEnabled(),v.planPageViewed(),x.originLegacy="1"==o.igl,x.isPf="FISICA"==u.usuario.conta.tipoPessoa,x.loadingTable=!0,x.moedaPadrao=p.utilizacao.moeda,x.usuario=u.usuario,d.enabled=!1,c.$on("$destroy",(function(){d.enabled=!0})),x.nomePeriodo={3:"Trimestral",6:"Semestral",12:"Anual"},x.nomePlano={1:"Pessoal",2:"Profissional",3:"Família",10:"Empresarial 1",11:"Empresarial 2",12:"Empresarial 3"},x.iuguCc=!1,x.iuguBoleto=!1,n((function(){r.Iugu?(Iugu.setAccountID("582793F8B83D4D0EBC26E6A5803D34DA"),Iugu.setTestMode(i.mdconfig.devmode),x.iuguBoleto=!0,x.psOn=!0,x.iuguCc=!0):x.psOn=!0}),200),x.cartao={number:"",verification_value:"",full_name:"",expiration:""},x.hasPagtoConf=!1,x.plano=angular.copy(x.usuario.plano.planoVigente||x.usuario.plano);var D,$={nlancamentos:x.plano.nlancamentos||100,adicionais:x.plano.adicionais||0,conexoes:x.plano.conexoes||0,propostas:x.plano.propostas||0,moedas:x.plano.moedas||0,anexos:x.plano.anexos?x.plano.anexos/1024/1024:0,operacoes:x.plano.inv_operacoes||0};function M(){x.exibirTotalMensal?(x.tipoPlano=3,b=x.isPf?3:12):(x.tipoPlano=!x.isPf||h?3:2,b=x.isPf?2:12),x.hasPagtoConf&&(x.tipoPlano=0==x.plano.tipo&&x.plano.inv_basico?1:x.plano.inv_basico?3:2,b=x.plano.tipo,A=3==x.tipoPlano&&x.isPf),x.dados={plano:b,periodo:12,parcelas:1,forma:"cartao",cupons:[],inv_basico:x.hasPagtoConf?x.plano.inv_basico:!!x.exibirTotalMensal||(h||!x.isPf),inv_ir:!x.hasPagtoConf||x.plano.inv_ir,inv_avancado:!x.hasPagtoConf||x.plano.inv_avancado},x.dados.nlancamentos=x.hasPagtoConf?x.plano.nlancamentos:R("nlancamentos"),x.dados.adicionais=x.hasPagtoConf?x.plano.adicionais:R("adicionais"),x.dados.conexoes=x.hasPagtoConf?x.plano.conexoes:R("conexoes"),x.dados.propostas=x.hasPagtoConf?x.plano.propostas:R("propostas"),x.dados.moedas=x.hasPagtoConf?x.plano.moedas:R("moedas"),x.dados.anexos=x.hasPagtoConf?x.plano.anexos/1024/1024:R("anexos"),x.dados.inv_operacoes=x.hasPagtoConf?x.plano.inv_operacoes:R("operacoes")}function w(a){var t=!1;x.hasPagtoConf&&(t=a<x.plano.tipo),x.dados.plano=a,a&&(b=a),x.dados.plano?(x.dados.nlancamentos=x.hasPagtoConf&&!t?Math.max(R("nlancamentos"),x.plano.propostas):R("nlancamentos"),x.dados.propostas=x.hasPagtoConf&&!t?Math.max(R("propostas"),x.plano.propostas):R("propostas")):(x.dados.nlancamentos=100,x.dados.propostas=0),x.dados.moedas=x.hasPagtoConf&&!t?Math.max(R("moedas"),x.plano.moedas):R("moedas"),x.dados.adicionais=x.hasPagtoConf&&!t?Math.max(R("adicionais"),x.plano.adicionais):R("adicionais"),x.dados.anexos=x.hasPagtoConf&&!t?Math.max(R("anexos"),x.plano.anexos/1024/1024):R("anexos"),x.dados.conexoes=x.hasPagtoConf?Math.max(R("conexoes"),x.plano.conexoes):R("conexoes"),x.dados.inv_basico&&(x.dados.inv_operacoes=x.hasPagtoConf&&!t?Math.max(R("operacoes"),x.plano.inv_operacoes):R("operacoes"))}function E(a,o,e){if(e=angular.isDefined(e)?e:x.k,0===a)return 0;if(!o)return P(x.tabela.v[a][e],e);if(angular.isNumber(a))return x.dados.plano==a?P(x.tabela.v[a][e],e):0;var n=["inv_operacoes","adicionais","propostas","moedas","anexos","conexoes","nlancamentos"].indexOf(a)>-1;if(!n&&!x.dados[a])return 0;if(["adicionais","anexos"].indexOf(a)>-1&&!x.dados.plano&&!x.dados.inv_basico)return 0;if(0===a.search("inv_")&&!x.dados.inv_basico)return 0;var r=n?x.dados[a]:1,i=x.dados.plano?x.dados.plano:"anexos"==a&&x.dados.inv_basico||"adicionais"==a&&x.dados.inv_basico||"conexoes"==a&&x.dados.inv_basico||"moedas"==a&&x.dados.inv_basico||"nlancamentos"==a&&x.dados.inv_basico||"inv_operacoes"===a?1:0;if(n&&i&&x.tabela.i[a]){var c=0;1==e&&x.hasPagtoConf&&(c=x.plano[a],"anexos"==a&&(c=c/1024/1024));var s=Math.max(c,R("inv_operacoes"===a?"operacoes":a));if((r=x.dados[a]-s)<=0)return 0}return"anexos"!=a&&"nlancamentos"!=a||(r/=100),"inv_operacoes"==a&&(r/=50),t(P(x.tabela.v[a][e]*r,e))}function y(){return a.reduce((function(a,t){return a+E(t,!0)}),E(x.dados.plano,!0))}function I(){var a=x.descontoCupom||0;return x.possuiCupons&&x.dados.cupons.forEach((function(t){a+=x.cupons[t].valor})),a=Math.min(a,1),0===x.k?t((O()+y()*x.dados.periodo)*(1-a)):t(y()*(1-a))}function O(){return x.tabela.r<=10?0:a.reduce((function(a,t){return a+E(t,!0,1)}),E(x.dados.plano,!0,1))}function T(a,t){if(0!==x.k)return 0;a=a||x.dados.periodo;var o=1-x.descontos[a];return(A||t)&&(o*=1-(x.descontoCombo||0)),1-o}function P(a,t){return 0!==t?a:a*(1-T())}function R(a){var t=x.dados.plano||(x.isPf?1:10),o="operacoes"===a?x.tabela.i.inv_operacoes:x.tabela.i[a][t];return x.dados.plano||"adicionais"!=a||(o=0),0==x.k?o:Math.max($[a],o)}function Y(){return 0==x.k?moment.max(f(x.plano.fim),f()).add(x.dados.periodo,"months").format("YYYY-MM-DD"):f(x.plano.fim).format("YYYY-MM-DD")}function j(){var a;return x.dados.inv_basico&&(a=[],x.dados.inv_avancado&&a.push("Recursos adicionais"),x.dados.inv_ir&&a.push("Imposto de Renda")),{valorTotal:I(),planoFinanceiro:x.nomePlano[x.dados.plano],planoInvest:{investment_plan_manager_investment:x.dados.inv_basico,investment_plan_income_tax:x.dados.inv_basico&&x.dados.inv_ir,investment_plan_additional_resources:x.dados.inv_basico&&x.dados.inv_avancado,investment_plan_additional_operations:x.dados.inv_basico?x.dados.inv_operacoes:0},extras:{extra_additional_users:x.dados.adicionais,extra_attachments:x.dados.anexos,extra_different_currencies:x.dados.moedas,extra_commercial_proposals:x.dados.propostas},tipo:1==x.k?"Upgrade":"New",periodo:1==x.k?void 0:3==x.dados.periodo?"Trimestral":6==x.dados.periodo?"Semestral":"Anual"}}x.psOn="1"===o._r,x.$onInit=function(){x.exibirTotalMensal=!0;var a=l.all([s.get("/usuarios/carregarPlanos").then((function(a){x.tabela=a.data,x.descontos=x.tabela.d,x.descontoCombo=x.tabela.c,x.k=x.tabela.r>10?1:0})),u.hasPagamentoConfirmado().then((function(a){x.hasPagtoConf=a}))]).then((function(){x.loadingTable=!1,x.exibirTotalMensal?x.tipoPlano=3:x.tipoPlano=!x.isPf||h?3:2,A=3==x.tipoPlano&&x.isPf,x.tipoAlteracao=3,!x.plano.inv_basico&&x.plano.tipo?x.tipoAlteracao=2:x.plano.inv_basico&&!x.plano.tipo&&(x.tipoAlteracao=1),M()}));x.cupons={},s.get("/apiweb/cuponsPagamento").then((function(t){t.data.forEach((function(a){a.valido&&(x.cupons[a.id]=a)})),a.then((function(){angular.forEach(x.cupons,(function(a,t){x.dados.cupons.push(t)})),x.possuiCupons=x.dados.cupons.length>0}))}))},x.onChangeFormaContratacao=M,x.onChangeTipoPlano=function(){A=3==x.tipoPlano&&x.isPf,3==x.tipoPlano?(x.dados.inv_basico=!0,w(b)):2==x.tipoPlano?(w(b),x.dados.inv_basico=!1):1==x.tipoPlano&&(w(0),x.dados.inv_basico=!0)},x.toggleFinanceiro=w,x.valorMensal=E,x.totalMensal=y,x.calcularTotal=I,x.totalRestanteVigencia=O,x.getDescontoPlano=T,x.aplicarDesconto=P,x.minExtra=function(a){return"inv_operacoes"===a?x.tabela.i[a]:(x.dados.plano?x.dados.plano:!!x.dados.inv_basico)&&(x.dados.plano||"adicionais"!=a)?R("inv_operacoes"===a?"operacoes":a):0},x.buscarCupom=function(){return x.errosCupom=null,s.get("/apiweb/cupomDesconto",{cache:!0,params:{cupom:x.cupom},handleErrors:!1}).then((function(a){var t=a.data;return t.utilizado?x.errosCupom={utilizado:!0}:t.primeira_compra?x.errosCupom={primeira_compra:!0}:t.fim<f().format("YYYY-MM-DD")?x.errosCupom={expired:!0}:(x.infoCupom="Desconto de "+t.quantidade+"%",x.descontoCupom=t.quantidade/100,x.cupomUtilizado=t.id),t}),(function(){x.errosCupom={not_found:!0}}))},x.calcularVigencia=Y,x.abrirPagamento=function(){x.pagando=!0;var a=j();v.planPaymentViewed(a.valorTotal,a.planoFinanceiro,a.planoInvest,a.extras,a.periodo,a.tipo)},x.finalizarCompra=function(){var a=angular.copy(x.dados);a.anexos=1024*a.anexos*1024,a.fim=Y(),a.valor=I(),a.cupom=x.cupomUtilizado,1==x.k&&(a.periodo=0),a.iugu=!0,a.inv_basico||(a.inv_avancado=!1,a.inv_operacoes=0,a.inv_ir=0);var t=l.defer();if(x.error=!1,x.finalizando=!0,t.promise.catch((function(a){x.error=a||!0,S=0})).finally((function(){x.finalizando=!1})),a.valor<=1||"pagseguro"===a.forma||!Iugu)a.iugu=!1,u(),i().then(c,t.resolve);else if("cartao"===a.forma){if(x.form_cartao.$invalid)return angular.forEach(x.form_cartao.$error,(function(a,t){angular.forEach(a,(function(a){a.$setDirty()}))})),void t.resolve();var o=x.cartao.expiration.split("/"),n=x.cartao.full_name,r=Iugu.CreditCard(x.cartao.number,o[0],o[1],n.substr(0,n.indexOf(" ")),n.substr(n.indexOf(" ")+1),x.cartao.verification_value);u(),i().then((function(){Iugu.createPaymentToken(r,(function(o){if(o.id)return a.iugu_token=o.id,c();t.reject()}))}),t.resolve)}else"boleto"===a.forma&&(u(),i().then(c,t.resolve));return t.promise;function i(){var t=x.usuario.conta;return m.show({escapeToClose:!1,templateUrl:"/partials/usuarios/assinatura.rps.html",controllerAs:"vm",bindToController:!0,locals:{isPf:"FISICA"==t.tipoPessoa,dados:{cpfCnpj:t.cpfCnpj,cep:t.cep,numero:t.numero,logradouro:t.logradouro,bairro:t.bairro,cidade:t.cidade,uf:t.uf,complemento:t.complemento},conta:t},controller:e}).then((function(t){t&&t.cpf&&(a.cpf=t.cpf)}))}function c(){return s.post("/usuarios/iniciarPagamento",a,{handleErrors:!1}).then((function(a){var t=a.data;location.href=t.url}),(function(a){if(a.data&&"4"==a.data.error&&S++<2)return g.showSimple("Tentativa "+(S+1)+" de 3. Por favor, aguarde..."),c();x.psOn=a.data&&"4"==a.data.error,t.reject(a.data?a.data.error:-1==a.status?-1:null)}))}function u(){var t=j();v.planPaymentInserted("boleto"==a.forma?"Slip":"cartao"==a.forma?"Credit Card":"PagSeguro",t.valorTotal,t.planoFinanceiro,t.planoInvest,t.extras,t.periodo,t.tipo)}},x.validarCartao=function(a){return D=a,Iugu.utils.validateCreditCardNumber(a)},x.apenasNumeros=function(a){return a&&a.match(/^\d*$/)},x.validarCvv=function(a){return Iugu.utils.validateCVV(a,Iugu.utils.getBrandByCreditCardNumber(x.cartao.number||D))},x.validarData=function(a){return Iugu.utils.validateExpirationString(a)},x.getBandeira=function(){return x.cartao.number||D?Iugu.utils.getBrandByCreditCardNumber(x.cartao.number||D):null}}function e(a,t,o,e){var n=this;n.dismiss=a.hide,n.ok=function(){return n.informarCPF||(n.conta.cpfCnpj=n.dados.cpfCnpj),n.conta.cep=n.dados.cep,n.conta.numero=n.dados.numero,n.conta.logradouro=n.dados.logradouro,n.conta.bairro=n.dados.bairro,n.conta.cidade=n.dados.cidade,n.conta.uf=n.dados.uf,n.conta.complemento=n.dados.complemento,o.put("/apiweb/conta/"+n.conta.id,n.conta).then((function(){e.personalInformationInserted(),e.identifyCurrentUser();var t={};n.informarCPF&&(t.cpf=n.cpf),a.hide(t)}))},n.consultarCEP=function(){if(n.dados.cep&&n.dados.cep.match(/^[0-9]{8}$/))return n.loadingExtra=!0,t.consultarCep(n.dados.cep).then((function(a){function t(t,o,e){e=e||t,n.dados[t]=a[e]?a[e].slice(0,o):void 0}t("logradouro",50),t("bairro",40),t("cidade",40,"localidade"),t("uf",2),t("complemento",70)})).finally((function(){n.loadingExtra=!1}))},n.onChangeSemn=function(){n.semn&&(n.dados.numero="")}}}(),function(){"use strict";function a(a,o,e,n,r,i,c){var s=this;r.title="Configurações da conta e plano",s.usuarioService=i,s.conta=i.usuario.conta;var l=s.conta.id;s.acao=function a(t){e.show({id:"inativar-conta",templateUrl:"partials/usuarios/"+t+"Conta.html",bindToController:!0,controllerAs:"vm",controller:["$http","$timeout","mdwAnalytics","usuariosService",function(n,r,i,c){var s=this;s.opcao=1;var u=c.usuario.plano,d=moment().format("YYYY-MM-DD");function m(a){s.error="Ocorreu um erro. Atualize a página e tente novamente",2==a.data.type&&(s.error=a.data.error),r((function(){delete s.error}),2e3)}s.vencimentoPlanoAtivo=!!(u.fim&&u.fim>=d)&&u.fim,s.openDialogReset=function(){e.hide().then((function(){a("resetar")}))},s.acao=function(){var a={senha:s.senha,cid:l,token:s.token};return 2!=s.opcao||s.token?function(){2==s.opcao&&(t="excluir");return n.post("usuarios/"+t+"conta",a,{handleErrors:!1}).then((function(a){var e=a.data;return"resetar"==t&&i.accountReseted(),function(){if(localStorage){var a=localStorage.getItem("meudinheiro::rememberedUsers");a&&localStorage.setItem("meudinheiro::rememberedUsers",angular.toJson(angular.fromJson(a).filter((function(a){return a.id!=l}))))}}(),r((function(){location.href="resetar"==t?location.origin+"/u/"+e.id:"/"}),200),o.defer().promise}),m)}():n.post("usuarios/tokenEncerrarConta",{senha:s.senha},{handleErrors:!1}).then((function(){s.aguardandoToken=!0}),m)}}]})},s.moeda=c.utilizacao.moeda,s.alterarMoeda=function(){e.show({id:"alterar-moeda-padrao",templateUrl:"partials/usuarios/alterar-moeda-padrao.html",bindToController:!0,controllerAs:"vm",controller:t}).then((function(){s.moeda=c.utilizacao.moeda,n.showSimple("Moeda padrão alterada")}))}}function t(a,t,o,e,n,r,i,c){var s=this;s.autorizado=!1,s.moedaAtual=r.utilizacao.moeda,s.moeda=r.utilizacao.moeda,s.moedas=e.disponiveis,s.$onInit=function(){n.isAdmin()?s.autorizado=!0:(s.msgErro="Você deve possuir permissão de Administrador desta conta para efetuar esta alteração",s.adminErr=!0)},s.onChangeMoeda=function(){s.autorizado=!0,s.msgErro=null;s.moedaAtual,s.moeda},s.acao=function(){var a={senha:s.senha,moeda:s.moeda,converter:s.converter&&s.moedaAtual!=s.moeda};return e.alterarMoedaPadrao(a).then((function(){return c.identifyCurrentUser(),o.hide()}),(function(a){s.error=a.status,t((function(){delete s.error}),2e3)}))}}a.$inject=["$scope","$q","$mdDialog","$mdToast","mdwTopmenu","usuariosService","configuracoesService"],t.$inject=["$http","$timeout","$mdDialog","moedaService","usuariosService","configuracoesService","cadastrosDatasource","mdwAnalytics"],angular.module("md").controller("UsuariosController",a)}(),function(){"use strict";angular.module("md").filter("auditOp",(function(){return function(a){return 1==a?"Criou":2==a?"Editou":3==a?"Excluiu":void 0}})).filter("auditText",["$sce",function(a){return function(t){return a.trustAsHtml(t)}}])}(),function(){"use strict";function a(a,t,o,e,n,r){var i=this;i.usuario=angular.copy(o.usuario.conta),i.usuario.dataNascimento=i.usuario.dataNascimento?e(i.usuario.dataNascimento).toDate():null,i.salvar=function(){var n=angular.copy(i.usuario);return n.dataNascimento&&(n.dataNascimento=e(n.dataNascimento).format("YYYY-MM-DD")),a.put("/apiweb/conta/"+n.id,n).then((function(a){o.usuario.conta=a.data,r.identifyCurrentUser(),t.showSimple("Informações atualizadas")}))},i.consultarCEP=function(){if(i.usuario.cep&&i.usuario.cep.match(/^[0-9]{8}$/))return i.loadingExtra=!0,n.consultarCep(i.usuario.cep).then((function(a){i.usuario.logradouro=a.logradouro,i.usuario.bairro=a.bairro,i.usuario.cidade=a.localidade,i.usuario.uf=a.uf,i.usuario.complemento=a.complemento})).finally((function(){i.loadingExtra=!1}))}}a.$inject=["$http","$mdToast","usuariosService","moment","contatosService","mdwAnalytics"],angular.module("md").controller("UsuariosGeralController",a)}(),function(){"use strict";function a(a,t){this.calendarioConfig={restrict:["d"],interval:"d"}}function t(a,t,o){var e=this;e.detalhar=function(a){if(!("item"==a.type||"text"==a.type&&a.data&&a.data.data))return;t.show({id:"usuarios-log-detalhe",templateUrl:"/partials/usuarios/log.detalhe.html",controller:function(){var a=this;function t(t,o){angular.forEach(t.details,(function(t,e){o.details[e]!=t&&(a.diffs[e]=!0,o.details[e]||(o.details[e]="-"))}))}a.isDeep=angular.isArray,a.diffs={},a.h.data.item&&a.h.data.item.details&&a.h.data.prev&&a.h.data.prev.details&&(t(a.h.data.item,a.h.data.prev),t(a.h.data.prev,a.h.data.item))},controllerAs:"vm",bindToController:!0,locals:{h:a}})},e.loading=!0,e.data=a.inicio||moment().format("YYYY-MM-DD"),o.carregarTrilhaAuditoria(e.data).then((function(a){e.loading=!1,e.historicos=a})),e.muser=o.usuario.conta.usuarios.length>1}a.$inject=["$mdDialog","usuariosService"],t.$inject=["$stateParams","$mdDialog","usuariosService"],angular.module("md").controller("UsuariosLogController",a).controller("UsuariosLogListaController",t)}(),function(){"use strict";function a(a,t,o,e,n,r,i,c){var s=this;s.usuario=i.usuario,s.logomd="https://s3.amazonaws.com/img.meudinheiroweb.com.br/logo/logo_small.png",r.enabled=!1,a.$on("$destroy",(function(){r.enabled=!0})),s.usuario.conta.usuarios.forEach((function(a){1==a.papel&&(s.emailEnvio=a.login.email)})),s.capturado=!1,s.tempo=0;var l=t((function(){s.tempo+=.333333333,(s.tempo>100||s.capturado)&&(s.capturado?t.cancel(l):d().finally((function(){t.cancel(l)})))}),100);d();var u=!1;function d(){return n.put("/apiweb/pagamento/processar/"+e.pagid).then((function(a){var e=s.pagto=a.data,n=e.dadosAssinatura;if(n&&!u){c.thankYouPageViewed(1==e.gateway?"PagSeguro":1==e.forma?"Credit Card":"Slip",e.valor,{1:"Pessoal",2:"Profissional",3:"Família",10:"Empresarial 1",11:"Empresarial 2",12:"Empresarial 3"}[n.plano],{investment_plan_manager_investment:n.inv_basico,investment_plan_income_tax:n.inv_basico&&n.inv_ir,investment_plan_additional_resources:n.inv_basico&&n.inv_avancado,investment_plan_additional_operations:n.inv_basico?n.inv_operacoes:0},{extra_additional_users:n.adicionais,extra_attachments:n.anexos/1024/1024,extra_different_currencies:n.moedas,extra_commercial_proposals:n.propostas},0==n.periodo?void 0:3==n.periodo?"Trimestral":6==n.periodo?"Semestral":"Anual",0==n.periodo?"Upgrade":"New"),u=!0}s.gw=1==e.gateway?"pelo PagSeguro":2==e.gateway?"pela Cielo":"",3==e.forma&&3!=e.status?(s.capturado=!0,s.boleto=!0,s.vencido=e.assinatura.fim<moment().format("YYYY-MM-DD")):3==e.status?(t.cancel(l),s.capturado=!0,s.concluido=!0):4==e.status?(t.cancel(l),s.cancelado=!0,s.capturado=!0):s.tempo<100?o(d,5e3):(s.vencido=e.assinatura.fim<moment().format("YYYY-MM-DD"),s.capturado=!0,s.timeout=!0)}),(function(){t.cancel(l)}))}}a.$inject=["$scope","$interval","$timeout","$stateParams","$http","mdwTopmenu","usuariosService","mdwAnalytics"],angular.module("md").controller("UsuariosPagamentoController",a)}(),function(){"use strict";function a(a,t,o){var e=this;function n(a){if(a.fim){var o=t().format("YYYY-MM-DD"),e=t(a.fim).diff(a.inicio,"d")+1,n=t(a.fim).diff(t(o),"d")+1,r=t(o).diff(t(a.inicio),"d")+1;a.investimentos=[],a.inv_basico&&a.investimentos.push("Básico"),a.inv_ir&&a.investimentos.push("IR"),a.inv_avancado&&a.investimentos.push("Recursos adicionais"),a.inv_operacoes&&a.investimentos.push("+"+a.inv_operacoes+" operações"),n<0&&(n=0),a.dias=n,a.razao=r/e,a.cor=n>14?"#7fce7a":n>0?"#f7ea83":"#ff3a3a",a.isBasico=0==a.tipo&&!a.inv_basico}}e.$onInit=function(){e.usuario=o.usuario,e.plano=angular.copy(e.usuario.plano.planoVigente||e.usuario.plano),n(e.plano),e.usuario.plano.planoVigente&&(e.cortesia=angular.copy(e.usuario.plano),n(e.cortesia)),a.get("/apiweb/pontuacaoPdi",{cache:!0}).then((function(a){e.pontuacao=a.data})),o.carregarPagamentos().then((function(a){e.pagamentos=a}))}}a.$inject=["$http","mdwMoment","usuariosService"],angular.module("md").controller("UsuariosPlanoController",a)}(),function(){"use strict";function a(a,t){var o={permmdadmin:!0};t.state({id:"conta",title:"Configurações da conta e plano",templates:["partials/usuarios/usuario.html","partials/usuarios/geral.html","partials/usuarios/assinatura.html","partials/usuarios/plano.html"]},{abstract:!0,url:"/conta",templateUrl:"partials/usuarios/usuario.html",controller:"UsuariosController",controllerAs:"vm",data:o}),a.state("assinatura",{url:"/conta/assinatura?igl&_r",templateUrl:"partials/usuarios/assinatura.html",controller:"UsuariosAssinaturaController",controllerAs:"vm",params:{igl:null}}).state("pagamentoFinalizado",{url:"/conta/pagamento/:pagid",templateUrl:"partials/usuarios/pagamento.html",controller:"UsuariosPagamentoController",controllerAs:"vm"}).state("conta.geral",{url:"",templateUrl:"partials/usuarios/geral.html",controller:"UsuariosGeralController",controllerAs:"vm",data:o}).state("conta.usuarios",{url:"/usuarios",templateUrl:"partials/usuarios/usuarios/usuarios.html",controller:"UsuariosUsuariosController",controllerAs:"vm",data:o}).state("conta.plano",{url:"/plano",templateUrl:"partials/usuarios/plano.html",controller:"UsuariosPlanoController",controllerAs:"vm",data:o}).state("conta.log",{abstract:!0,url:"/log",templateUrl:"partials/usuarios/log.html",controller:"UsuariosLogController",controllerAs:"vm",data:o}).state("conta.log.lista",{url:"?inicio",templateUrl:"partials/usuarios/log.lista.html",controller:"UsuariosLogListaController",controllerAs:"vm",data:o}).state("conta.notificacoes",{url:"/notificacoes",templateUrl:"partials/usuarios/notificacoes/notificacoes.html",controller:"NotificacoesController",controllerAs:"vm"})}a.$inject=["$stateProvider","mdwBaseStateProvider"],angular.module("md").config(a)}(),function(){"use strict";function a(a,t,o,e,n,r,i,c,s,l,u){var d,m=this;function f(){return m.usuario.conta.usuarios.filter((function(a){return 1!=a.papel&&a.status})).map((function(a){return a.login}))}function p(a){for(var t=0;t<m.usuario.conta.usuarios.length;t++){var o=m.usuario.conta.usuarios[t];if(o.login.id==a)return o}}function v(){return 3!=m.usuario.papel}function g(a){return o.show({id:"editar-usuario",templateUrl:"partials/usuarios/usuarios/editarUsuario.html",controller:"UsuariosUsuariosEditarController",controllerAs:"vm",bindToController:!0,locals:{usuario:a||{}}}).then((function(a){return m.usuarios.push(a),m.usuario.conta.usuarios.push(a),n.showSimple("Usuário criado com sucesso"),h(a.login)}))}function h(a){return o.show({id:"editar-permissoes",templateUrl:"partials/usuarios/usuarios/permissoes.html",controller:"UsuariosUsuariosPermissoesController",controllerAs:"vm",resolve:{usuario:function(){return p(a.id)}}})}function C(a,t){return"v"==t?1==a||3==a||5==a||7==a:"g"==t?3==a||7==a:"e"==t?5==a||7==a:void 0}function b(a,t){if(!a)return!0;if("m"==t)return A(a);var o=a.split(/\s*\&\s*/);if(o.length>1){for(var e=0;e<o.length;e++)if(!b(o[e],t))return!1;return!0}var n=a.split("."),r=m.usuario.permissoes.funcionalidades;for(e=0;e<n.length;e++)r=r[n[e]];if(angular.isUndefined(r))return!0;if(!angular.isObject(r))return C(r,t);var i=Object.keys(r);for(e=0;e<i.length;e++)if(C(r[i[e]],t))return!0;return!1}function A(a){return x(a)||S(a)}function x(a){return b(a,"g")}function S(a){return b(a,"e")}function D(a,t){return v()&&0!=f().length?o.show({id:"restricoes-centro-projeto",templateUrl:"partials/usuarios/usuarios/restricoesCentroProjeto.html",controller:"UsuariosUsuariosRestricoesCentroProjetoController",controllerAs:"vm",locals:{tipo:t,cadastroId:a.id}}).then((function(t){for(var o=0;o<m.usuario.conta.usuarios.length;o++){var e=m.usuario.conta.usuarios[o].login.id;t[e]&&(m.usuario.conta.usuarios[o].permissoes=t[e])}return a}),(function(){return a})):r.resolve(a)}function $(){return m.usuario.plano.permissoes.adicionais}function M(){return m.usuario.plano.permissoes.propostas}function w(){return m.usuario.plano.permissoes.conexoes}function E(){return m.usuario.plano.permissoes.ncontas}function y(a){return a=a||{padrao:!0},o.show({templateUrl:"/partials/usuarios/planoInvalido.html",controllerAs:"vm",bindToController:!0,locals:a,controller:["mdwAnalytics",function(a){var t=this,n=m.usuario.plano,r=0==n.tipo;t.titulo="Recurso indisponível",t.texto="Esta funcionalidade não está disponível para o plano "+n.nome+".",t.txtBtn="Alterar plano",a.subcriptionIntentViewed(),n.status?!r||n.inv_basico?t.adicionais||t.ncontas?(t.titulo="Limite atingido",t.texto="O limite de "+(t.adicionais?n.adicionais+" usuários adicionais":n.ncontas+"contas")+" de seu plano foi atingido."):t.anexos?(t.titulo="Limite atingido",t.texto="O limite mensal de "+n.anexos/1024/1024+"MB de seu plano foi atingido."):t.investimentos?"basico"===t.investimentos?t.texto="O módulo de investimentos não está habilitado em seu plano atual.":"avancado"===t.investimentos?t.texto="Este recurso está disponível apenas no pacote de recursos adicionais de investimentos.":"ir"===t.investimentos&&(t.texto="O módulo de apuração de IR não está habilitado em seu plano atual."):angular.isDefined(t.propostas)?t.propostas>0?(t.titulo="Limite atingido",t.texto="O número de propostas disponível mensalmente em seu plano atingiu o limite."):t.texto="O módulo de propostas não está disponível em seu plano atual.":angular.isDefined(t.conexoes)&&(t.conexoes>0?(t.titulo="Limite atingido",t.texto="O número de conexões bancárias disponível em seu plano atingiu o limite."):t.texto="Nenhuma conexão bancária contratada em seu plano atual."):r&&(t.txtBtn="Contratar um plano pago"):(t.texto="Seu plano "+n.nome+" venceu e o acesso a este recurso está desabilitado.",t.txtBtn="Renovar assinatura"),t.ok=function(){o.cancelAll(),e.go("assinatura")}}]})}function I(){return a.get("/apiweb/pagamentos",{cache:!0}).then((function(a){return a.data}))}m.usuario={},m.usuarios=[],m.updateConfig=function(t){return a.put("/usuarios/configuracoes",{config:t})},m.updateConfigKey=function(t,o){var e=m.usuario.conta.config;return e[t]=o,a.put("/usuarios/configuracoes",{config:e})},m.fecharPosicaoMensal=function(){return o.show({id:"fechar-posicao-mensal",templateUrl:"/partials/usuarios/fecharPosicaoMensal.html",controllerAs:"vm",bindToController:!0,locals:{data:m.usuario.conta.config.fch},controller:["mdwAnalytics",function(t){var e=this;e.dataAnt=e.data,e.data=moment().startOf("month").subtract(1,"day").format(),e.ok=function(){return e.data?m.usuario.conta.config.fch=moment(e.data).format("YYYY-MM-DD"):m.usuario.conta.config.fch=null,a.put("/usuarios/atualizarDataFechamento",{data:m.usuario.conta.config.fch}).then((function(){o.hide(),n.showSimple("Fechamento atualizado com sucesso"),e.data&&t.positionClosed()}))}}]})},m.setarUsuarioLogado=function(a){m.usuario=a.usuario,m.usuarios=a.usuarios,m.usuarios.sort((function(a,t){return a.conta.nome<t.conta.nome?-1:1}))},m.criarAdicional=function(a){return t=function(){return g(a)},f().length<$()?t&&t():y({adicionais:!0});var t},m.editarAdicional=g,m.editarPermissoes=h,m.isAdmin=v,m.getUsuarioConta=p,m.getAdicionaisAtivos=f,m.hasPerm=b,m.canView=function(a){return b(a,"v")},m.canManage=A,m.canEdit=x,m.canDelete=S,m.hasRest=function(a,t,o,e){var n=m.usuario.permissoes.restricoes[a];if(!n)return!1;if(t=parseFloat(t||0),"lancamentos"==a){if(t)return angular.isDefined(n[t])&&!C(n[t],o);var r=Object.keys(n);if(e&&(r=r.filter((function(a){for(var t=0;t<e.length;t++)if(a==e[t])return!0;return!1}))),0==r.length)return!1;for(var i=0;i<r.length;i++)if(C(n[r[i]],o))return!1;return!0}if(!t){if(!e)return n.length>0;for(i=0;i<e.length;i++){a=!1;for(var c=0;c<n.length;c++)if(n[c]==e[i]){a=!0;break}if(!a)return!1}return!0}for(var i=0;i<n.length;i++)if(n[i]==t)return!0;return!1},m.planoHasCentros=function(){return m.usuario.plano.permissoes.centros},m.planoHasFormas=function(){return m.usuario.plano.permissoes.formas},m.planoHasContatos=function(){return m.usuario.plano.permissoes.contatos},m.planoHasProjetos=function(){return m.usuario.plano.permissoes.projetos},m.planoHasInvestimentos=function(a){var t="inv_"+(a=a||"basico");return m.usuario.plano.permissoes[t]},m.planoHasCartoes=function(){return m.usuario.plano.permissoes.cartoes},m.planoGetAdicionais=$,m.planoGetPropostas=M,m.planoGetMoedas=function(){return m.usuario.plano.permissoes.moedas},m.planoGetAnexos=function(){return m.usuario.plano.permissoes.anexos},m.planoGetConexoes=w,m.planoGetNLancamentos=function(){return m.usuario.plano.permissoes.nlancamentos},m.planoGetNContas=E,m.dialogPlano=function(a,t){return m.usuario.plano.permissoes[a]?t&&t():y()},m.dialogPlanoInvestimentos=function(a,t){var o="inv_"+(t=t||"basico");return m.usuario.plano.permissoes[o]?a&&a():y({investimentos:t})},m.dialogPlanoNcontas=function(a){return i.contas.length<E()?a&&a():y({ncontas:!0})},m.dialogPlanoBasico=function(a){return 0!=m.usuario.plano.tipo&&m.usuario.plano.status?a&&a():y()},m.dialogPlanoAnexos=function(){return y({anexos:!0})},m.dialogPlanoPropostas=function(a){return c.utilizacao().then((function(t){return t<M()?a&&a():y({propostas:M()})}))},m.dialogPlanoConexoes=function(a){return s.carregarConexoes().then((function(t){return t.length<w()?a&&a():y({conexoes:w()})}))},m.dialoPlanoInvalido=y,m.planoHas=function(a){return angular.isUndefined(m.usuario.plano.permissoes[a])||m.usuario.plano.permissoes[a]},m.definirRestricoesCentro=function(a){return D(a,"centros")},m.definirRestricoesProjeto=function(a){return D(a,"projetos")},m.definirRestricoesConta=function(a){return v()&&0!=f().length?o.show({id:"restricoes-conta",templateUrl:"partials/usuarios/usuarios/restricoesConta.html",controller:"UsuariosUsuariosRestricoesContaController",controllerAs:"vm",locals:{contaId:a.id,nome:a.nome},bindToController:!0}).then((function(t){for(var o=0;o<m.usuario.conta.usuarios.length;o++){var e=m.usuario.conta.usuarios[o].login.id;t[e]&&(m.usuario.conta.usuarios[o].permissoes=t[e])}return a}),(function(){return a})):r.resolve(a)},m.carregarHistoricosAcesso=function(t){return a.get("/usuarios/historicosConta",{params:{data:t}}).then((function(a){return a.data}))},m.carregarTrilhaAuditoria=function(t){return a.get("/usuarios/auditoria",{params:{data:t}}).then((function(a){return a.data}))},m.carregarPagamentos=I,m.registrarAcessoUsuario=function(){if(moment(function(a){for(var t=a+"=",o=decodeURIComponent(document.cookie).split(";"),e=0;e<o.length;e++){for(var n=o[e];" "==n.charAt(0);)n=n.substring(1);if(0==n.indexOf(t))return n.substring(t.length,n.length)}return""}("mdage"+m.usuario.id)).isBefore()){var t=platform.os.family;-1!=t.search(/.*(windows).*/i)&&(t=t.replace(/.*(windows).*/i,"$1"));var o={device:t+" "+platform.os.version,version:platform.name+" "+platform.version};a.post("/api/v1/usuarios/registrarAcesso",o)}},m.validarPlanoAtual=function(a){if(m.planoValidator&&!a)return m.planoValidator;if(m.planoValidator=m.planoValidator||{},m.usuario.conta.config.mfa&&!m.usuario.login.mfa&&!l)return m.planoValidator.valid=!1,m.planoValidator.target="login.geral",m.planoValidator.reason="mfa",m.planoValidator;if(m.usuario.conta.config.vsenha&&!m.usuario.login.validade_senha)return m.planoValidator.valid=!1,m.planoValidator.target="login.geral",m.planoValidator.reason="vsenha",m.planoValidator;var t=m.usuario.plano,o=-1;if(m.usuario.conta.usuarios.forEach((function(a){a.status&&o++})),o>t.permissoes.adicionais)return m.planoValidator.valid=!1,m.planoValidator.target=v()?"conta.usuarios":"login.geral",m.planoValidator.reason="adicionais",m.planoValidator;for(var e=i.contas,n=m.usuario.conta.config.moeda,r=0,c=0;c<e.length;c++)e[c].status&&"CARTEIRA_INVEST"!=e[c].tipo&&(e[c].moeda!=n&&r++);if(r>t.permissoes.moedas)return m.planoValidator.valid=!1,m.planoValidator.target="contas.listar",u&&(m.planoValidator.target="contas"),m.planoValidator.reason="moedas",m.planoValidator;if(s.carregarCacheConexoes().length>t.permissoes.conexoes)return m.planoValidator.valid=!1,m.planoValidator.target="contas.conexoes",m.planoValidator.reason="conexoes",m.planoValidator;return m.planoValidator.valid=!0,m.planoValidator},m.demoAvailable=function(){return a.get("usuarios/demoavailable",{cache:!0}).then((a=>a.data))},m.experimentar=function(o){return r.all([t(angular.noop,99999),a.post("usuarios/experimentar",{mod:o}).then((function(){location.reload()}))])},m.hasPagamentoConfirmado=function(){d||(d=I().then((function(a){for(var t=0;t<a.length;t++)if(3==a[t].status)return!0;return!1})));return d}}a.$inject=["$http","$timeout","$mdDialog","$state","$mdToast","$q","cadastrosDatasource","propostasDatasource","conexoesApi","IS_ADMIN_ACCESS","MD_INVEST_MOD"],angular.module("md").service("usuariosService",a)}(),function(){"use strict";function a(a){return{_status:{v:!!a&&(1==a||3==a||5==a||7==a),g:!!a&&(3==a||7==a),e:!!a&&(5==a||7==a),manageable:!1}}}function t(a,t){return angular.forEach(a,(function(a,o){if("_status"!=o)return t(a,o)}))}angular.module("md").directive("mdwConfigEdicaoUsr",(function(){return o.$inject=["$scope"],{restrict:"E",require:"mdwConfigEdicaoUsr",template:['<div layout="column" ng-cloak>','<div layout="row" style="font-size: 12px; margin-bottom: 10px;">',"<span flex></span>",'<div layout="column" flex="10" layout-align="center center">',"<span flex>Visualizar</span> ",'<input type="checkbox" flex ng-model="vm.config._status.v" ng-change="vm.onChangeV()">',"</div>",'<div layout="column" flex="10" layout-align="center center">',"<span flex>Gerenciar</span> ",'<input type="checkbox" flex ng-model="vm.config._status.g" ng-change="vm.onChangeG()">',"</div>",'<div layout="column" flex="10" layout-align="center center">',"<span flex>Excluir</span>",'<input type="checkbox" ng-model="vm.config._status.e" ng-change="vm.onChangeE()">',"</div>","</div>",'<div class="mdw-list lista-funcionalidades" ng-transclude></div>',"</div>"].join(""),transclude:!0,scope:{config:"=ngModel"},controller:o,link:function(a,t,o,n){e(n.config)},controllerAs:"vm"};function o(o){var n=this;n.config=a(),angular.forEach(o.config,(function(t,o){n.config[o]=a(),angular.forEach(t,(function(t,e){n.config[o][e]=a(t)}))})),n.onChangeV=function(){t(n.config,(function(a,t){a._status.v=n.config._status.v,n.config._status.v||(n.config._status.g=!1,n.config._status.e=!1),a._status.v||(a._status.g=!1,a._status.e=!1)})),e(n.config),o.$broadcast("mdwConfigEdicaoUsrListOnChange",{type:"v",value:n.config._status.v})},n.onChangeG=function(){t(n.config,(function(a,t){a._status.g=n.config._status.g,a._status.g&&(a._status.v=!0)})),e(n.config),o.$broadcast("mdwConfigEdicaoUsrListOnChange",{type:"g",value:n.config._status.g})},n.onChangeE=function(){t(n.config,(function(a,t){a._status.e=n.config._status.e,a._status.e&&(a._status.v=!0)})),e(n.config),o.$broadcast("mdwConfigEdicaoUsrListOnChange",{type:"e",value:n.config._status.e})},o.$on("mdwConfigEdicaoUsrGroupOnChange",(function(){e(n.config)})),o.$watch("vm.config",(function(a){o.config={},t(a,(function(a,e){o.config[e]=o.config[e]||{},t(a,(function(a,t){o.config[e][t]=0,a._status.v&&(o.config[e][t]+=1),a._status.g&&(o.config[e][t]+=2),a._status.e&&(o.config[e][t]+=4)}))}))}),!0)}function e(a){var o=!0,e=!0,n=!0;t(a,(function(a,t){a._status.v||(o=!1),a._status.manageable&&!a._status.g&&(e=!1),a._status.manageable&&!a._status.e&&(n=!1)})),a._status.v=o,a._status.g=e,a._status.e=n}})).directive("mdwConfigEdicaoUsrFunc",(function(){return a.$inject=["$scope"],{restrict:"E",require:["^mdwConfigEdicaoUsrGrupo","mdwConfigEdicaoUsrFunc"],template:['<div class="funcionalidade">','<div layout="column" flex>','<div layout="row" flex>','<div flex  class="func-title">{{::vm.title}}</div>','<span flex="10" layout="column" layout-align="start center">','<input type="checkbox" ng-if="::vm.config._status.enableview" ng-model="vm.config._status.v" ng-change="vm.onChangeV()">',"</span>",'<span flex="10" layout="column" layout-align="start center">','<input type="checkbox" ng-if="::vm.config._status.manageable" ng-model="vm.config._status.g"  ng-change="vm.onChangeG()">',"</span>",'<span flex="10" layout="column" layout-align="start center">','<input type="checkbox" ng-if="::vm.config._status.manageable" ng-model="vm.config._status.e"  ng-change="vm.onChangeE()">',"</span>","</div>","</div>","</div>"].join(""),transclude:!0,scope:{id:"@mdwId",title:"@mdwTitle"},link:function(a,t,o,e){e[1].config=e[0].config[a.id],e[1].config._status.manageable=angular.isUndefined(o.viewonly),e[1].config._status.enableview=angular.isUndefined(o.lockview)},controller:a,controllerAs:"vm"};function a(a){var t=this;t.title=a.title,t.onChangeV=function(){t.config._status.v||(t.config._status.g=!1,t.config._status.e=!1);a.$emit("mdwConfigEdicaoUsrFuncOnChange")},t.onChangeG=function(){t.config._status.g&&(t.config._status.v=!0);a.$emit("mdwConfigEdicaoUsrFuncOnChange")},t.onChangeE=function(){t.config._status.e&&(t.config._status.v=!0);a.$emit("mdwConfigEdicaoUsrFuncOnChange")}}})).directive("mdwConfigEdicaoUsrGrupo",(function(){return e.$inject=["$scope"],{restrict:"E",template:['<div class="grupo-funcionalidade" ng-cloak>','<div layout="column" flex>','<div layout="row" flex>','<div flex class="group-title">{{::vm.title}}</div>','<span flex="10" layout="column" layout-align="start center">','<input type="checkbox" ng-model="vm.config._status.v" ng-change="vm.onChangeV()">',"</span>",'<span flex="10" layout="column" layout-align="start center">','<input type="checkbox"  ng-if="::vm.config._status.manageable" ng-model="vm.config._status.g" ng-change="vm.onChangeG()">',"</span>",'<span flex="10" layout="column" layout-align="start center">','<input type="checkbox"  ng-if="::vm.config._status.manageable" ng-model="vm.config._status.e" ng-change="vm.onChangeE()">',"</span>","</div>","<div ng-transclude></div>","</div>","</div>"].join(""),transclude:!0,require:["^mdwConfigEdicaoUsr","mdwConfigEdicaoUsrGrupo"],scope:{id:"@mdwId",title:"@mdwTitle"},compile:function(){return{pre:a,post:o}},controller:e,controllerAs:"vm"};function a(a,t,o,e){var n=e[1];n.config=e[0].config[a.id],n.config._status.manageable=angular.isUndefined(o.viewonly)}function o(a,t,o,e){n(e[1].config)}function e(a){var o=this;function e(e){t(o.config,(function(a,t){a._status.g=o.config._status.g,a._status.g&&(a._status.v=!0)})),n(o.config),!1!==e&&a.$emit("mdwConfigEdicaoUsrGroupOnChange")}function r(){t(o.config,(function(a,t){a._status.v=o.config._status.v,o.config._status.v||(o.config._status.g=!1,o.config._status.e=!1),a._status.v||(a._status.g=!1,a._status.e=!1)})),n(o.config),a.$emit("mdwConfigEdicaoUsrGroupOnChange")}function i(){t(o.config,(function(a,t){a._status.e=o.config._status.e,a._status.e&&(a._status.v=!0)})),n(o.config),a.$emit("mdwConfigEdicaoUsrGroupOnChange")}o.title=a.title,o.onChangeV=r,o.onChangeG=e,o.onChangeE=i,a.$on("mdwConfigEdicaoUsrListOnChange",(function(a,t){"g"==t.type?e(!1):"e"==t.type?i():r()})),a.$on("mdwConfigEdicaoUsrFuncOnChange",(function(){n(o.config),a.$emit("mdwConfigEdicaoUsrGroupOnChange")}))}function n(a){var o=!0,e=!0,n=!0;t(a,(function(a,t){a._status.v||(o=!1),a._status.manageable&&!a._status.g&&(e=!1),a._status.manageable&&!a._status.e&&(n=!1)})),a._status.v=o,a._status.g=e,a._status.e=n}}))}(),function(){"use strict";function a(a){return{v:a&&(1==a||3==a||5==a||7==a),g:a&&(3==a||7==a),e:a&&(5==a||7==a)}}angular.module("md").directive("mdwConfigEdicaoUsrConta",(function(){return t.$inject=["$scope","cadastrosDatasource"],{restrict:"E",require:"mdwConfigEdicaoUsr",transclude:!0,templateUrl:"/partials/usuarios/usuarios/listaContas.html",scope:{contas:"=",lancamentos:"=",service:"@"},controller:t,controllerAs:"vm"};function t(t,o){var e=this;function n(){t.contas=[],t.lancamentos={},angular.forEach(e.cs,(function(a,o){a||t.contas.push(o)})),angular.forEach(e.ls,(function(a,o){t.lancamentos[o]=0,a.v&&(t.lancamentos[o]+=1),a.g&&(t.lancamentos[o]+=2),a.e&&(t.lancamentos[o]+=4)}))}function r(a,t){e.ls[a].v=e.cs[a],e.cs[a]||(e.ls[a].g=!1,e.ls[a].e=!1),t||(i(),s()),n()}function i(){for(var a=Object.keys(e.cs),t=0;t<a.length;t++)if(!e.cs[a[t]])return void(e.csAll=!1);e.csAll=!0}function c(a,t,o){var r=e.ls[a];"v"==t?r.v||(r.g=!1,r.e=!1):(r.g||r.e)&&(r.v=!0),(r.v||r.g||r.e)&&(e.cs[a]=!0),o||(i(),s()),n()}function s(){for(var a=Object.keys(e.ls),t={v:!0,g:!0,e:!0},o=0;o<a.length&&(e.ls[a[o]].v||(t.v=!1),e.ls[a[o]].g||(t.g=!1),e.ls[a[o]].e||(t.e=!1),t.v||t.g||t.e);o++);e.lsAll=t}e.contas=o.contas.filter((function(a){return"CARTEIRA_INVEST"!=a.tipo})),e.cs={},e.ls={},e.lsAll=a(7),e.csAll=!0,e.changeC=r,e.changeL=c,e.changeLAll=function(a){"v"==a?e.lsAll.v||(e.lsAll.g=!1,e.lsAll.e=!1):(e.lsAll.g||e.lsAll.e)&&(e.lsAll.v=!0);angular.forEach(e.ls,(function(t,o){t[a]=e.lsAll[a],c(o,a,!0)})),i()},e.changeCAll=function(){angular.forEach(e.cs,(function(a,t){e.cs[t]=e.csAll,r(t,!0)}))},e.contas.forEach((function(t){e.ls[t.id]=a(7),e.cs[t.id]=!0})),angular.forEach(t.lancamentos,(function(t,o){e.ls[o]=a(t)})),angular.forEach(t.contas,(function(a){e.cs[a]=!1})),n(),i(),s()}}))}(),function(){"use strict";angular.module("md").directive("mdwConfigEdicaoUsrRestricao",(function(){return a.$inject=["$scope","cadastrosDatasource"],{restrict:"E",transclude:!0,require:"mdwConfigEdicaoUsr",templateUrl:"/partials/usuarios/usuarios/listaRestricoes.html",scope:{config:"=ngModel",service:"@",textNoItems:"@noitems"},controller:a,controllerAs:"vm"};function a(a,t){var o=this;o.textNoItems=a.textNoItems,o.changePerm=function(t){var o=a.config.indexOf(t.id);t.permissao&&-1!=o?a.config.splice(o,1):t.permissao||-1!=o||a.config.push(t.id)};var e=[];angular.forEach(a.config,(function(a){e.push(parseFloat(a))})),a.config=e,o.items=angular.copy(t[a.service]),o.items.map((function(t){t.permissao=-1==a.config.indexOf(t.id)}))}}))}(),function(){"use strict";var a=angular.module("md");function t(t,o,e){return a.directive(t,(function(){return{restrict:"A",priority:1,require:t,controllerAs:"ctrl",controller:["usuariosService",function(a){this.service=a}],compile:function(){return{pre:function(a,n,r,i){var c=r[t],s=angular.element(n).css("display");function l(){angular.element(n).css("display",o(i.service,c)?s:"none")}e&&(c=a.$eval(r[t]),a.$watch(r[t],(function(){c=a.$eval(r[t]),l()}))),l()}}}}}))}["v","g","e","m"].forEach((function(a){return t("mdwFuncPerm"+a.toUpperCase(),(function(t,o){return t.hasPerm(o,a)}))})),["lancamentos","contas","centros","projetos"].forEach((function(a){["v","g","e","m"].forEach((function(o){!function(a,o){t("mdwRestPerm"+a.slice(0,1).toUpperCase()+a.substr(1)+o.toUpperCase(),(function(t,e){return!t.hasRest(a,e,o)}),!0)}(a,o)}))})),t("mdwPlanoHas",(function(a,t){return a.planoHas(t)})),t("mdwIsAdmin",(function(a,t){return a.isAdmin()})),t("mdwIsNotAdmin",(function(a,t){return!a.isAdmin()}))}(),function(){"use strict";function a(a,t,o,e){var n=this;n.usuario=o.usuario,n.usuarios=n.usuario.conta.usuarios,n.mfa=e.utilizacao.mfa,n.vsenha=e.utilizacao.vsenha,n.validadorPlano=o.validarPlanoAtual(),n.toggleStatus=function(t){t.status=!t.status,a.put("/apiweb/usuarios/alterarStatus/"+t.login.id,{status:t.status}).then((function(){o.validarPlanoAtual(!0)}))},n.toggleAdmin=function(t){t.papel=2==t.papel?3:2,a.put("/apiweb/usuarios/alterarPapel/"+t.login.id,{papel:t.papel})},n.excluirUsuario=function(a){t.show({id:"excluir-usuario-adicional",templateUrl:"partials/usuarios/excluir-usuario-adicional.html",bindToController:!0,controllerAs:"vm",locals:{usuario:a},controller:["$http","$timeout",function(t,o){var e=this;function n(a){401==a.status?e.error="Senha inválida":403==a.status?e.error="Acesso à conta não autorizado":400==a.status&&(2==a.data.type?e.error=a.data.error:e.error="Erro inesperado. Tente novamente.")}e.excluir=function(r){return e.error=null,t.post("usuarios/excluirAdicional",{lid:a.login.id,senha:e.senha},{handleErrors:!1}).then((function(a){return location.reload(),o(angular.noop,1e4)}),n)}}]})},n.promoverPrincipal=function(a){t.show({id:"promover-conta",templateUrl:"partials/usuarios/promover-conta.html",bindToController:!0,controllerAs:"vm",locals:{usr:n.usuario,novoUsr:a},controller:["$http","$timeout",function(a,t){var o=this;function e(a){401==a.status?o.error="Senha inválida":403==a.status?o.error="Acesso à conta não autorizado":400==a.status&&(2==a.data.type?o.error=a.data.error:o.error="Erro inesperado. Tente novamente.")}o.promover=function(){return o.error=null,a.post("usuarios/promover",{lid:o.novoUsr.login.id,token:o.token,senha:o.senha},{handleErrors:!1}).then((function(a){return location.reload(),t(angular.noop,1e4)}),e)},o.enviarToken=function(){return o.error=null,a.post("usuarios/promoverToken",{lid:o.novoUsr.login.id,senha:o.senha},{handleErrors:!1}).then((function(a){o.tokenEnviado=!0}),e)}}]})},n.toggleMfa=function(){e.utilizacao.mfa=n.mfa,n.validadorPlano=o.validarPlanoAtual(!0),o.updateConfig(e.utilizacao)},n.toggleValidade=function(){e.utilizacao.vsenha=n.vsenha,n.validadorPlano=o.validarPlanoAtual(!0),o.updateConfig(e.utilizacao)}}a.$inject=["$http","$mdDialog","usuariosService","configuracoesService"],angular.module("md").controller("UsuariosUsuariosController",a)}(),function(){"use strict";function a(a,t,o,e){var n=this;n.administrador=2==n.usuario.papel,n.form={email:n.usuario.login?n.usuario.login.email:"",nome:n.usuario.login?n.usuario.login.nome:""},n.consultarLogin=function(){a.form.email.$valid&&(n.foundUser=!1,n.loadingInfo=!0,t.get("/apiweb/usuarios/infologin",{params:{email:n.form.email}}).then((function(a){if(a.data){n.foundUser=!0;var t=a.data;n.form.nome=t.nome}})).finally((function(){n.loadingInfo=!1})))},n.ok=function(){return n.form.papel=n.administrador?2:3,t.post("/apiweb/usuarios",n.form).then((function(a){return o.hide(a.data)}))}}a.$inject=["$scope","$http","$mdDialog","usuariosService"],angular.module("md").controller("UsuariosUsuariosEditarController",a)}(),function(){"use strict";function a(a,t,o,e,n,r){var i=this;i.usuario=r,i.funcs=angular.copy(i.usuario.permissoes.funcionalidades),i.restricoes=angular.copy(i.usuario.permissoes.restricoes),i.notificacoes={1:{email:1&i.usuario.permissoes.notificacoes[1],interna:2&i.usuario.permissoes.notificacoes[1]||4&i.usuario.permissoes.notificacoes[1],push:8&i.usuario.permissoes.notificacoes[1]},2:{email:1&i.usuario.permissoes.notificacoes[2],interna:2&i.usuario.permissoes.notificacoes[2]||4&i.usuario.permissoes.notificacoes[2],push:8&i.usuario.permissoes.notificacoes[2]}},i.ok=function(){var r={1:i.notificacoes[1].email|i.notificacoes[1].interna|i.notificacoes[1].push,2:i.notificacoes[2].email|i.notificacoes[2].interna|i.notificacoes[2].push};return a.put("/apiweb/usuarios/permissoes/"+i.usuario.login.id,{permissoes:{funcionalidades:i.funcs,restricoes:i.restricoes,notificacoes:r}}).then((function(a){return i.usuario.permissoes=a.data,n.usuario.login.id==i.usuario.login.id&&(n.usuario.permissoes=a.data,e.$broadcast("mdwUsuarioPermissoes")),o.showSimple("Permissões atualizadas"),t.hide()}))}}a.$inject=["$http","$mdDialog","$mdToast","$rootScope","usuariosService","usuario"],angular.module("md").controller("UsuariosUsuariosPermissoesController",a)}(),function(){"use strict";function a(a,t,o,e,n,r){var i=this;i.adicionais=o.getAdicionaisAtivos(),i.perm={},i.adicionais.forEach((function(a){for(var t=o.getUsuarioConta(a.id).permissoes.restricoes[n],r=0;r<t.length;r++)if(t[r]==e)return void(i.perm[a.id]=!1);i.perm[a.id]=!0})),i.permOrg=angular.toJson(i.perm),i.ok=function(){if(i.changed())return r.post("/apiweb/usuarios/restricoes",{tipo:n,id:e,usuarios:i.perm}).then((function(o){return t.showSimple("Restrições atualizadas"),a.hide(o.data)}));return t.showSimple("Restrições atualizadas"),a.cancel()},i.changed=function(){return i.permOrg!=angular.toJson(i.perm)}}a.$inject=["$mdDialog","$mdToast","usuariosService","cadastroId","tipo","$http"],angular.module("md").controller("UsuariosUsuariosRestricoesCentroProjetoController",a)}(),function(){"use strict";function a(a,t,o,e){var n=this,r=n.contaId;function i(a,t){n.cs[a]||(n.ls[a].v=!1,n.ls[a].g=!1,n.ls[a].e=!1),t||(c(),l())}function c(){for(var a=Object.keys(n.cs),t=0;t<a.length;t++)if(!n.cs[a[t]])return void(n.csAll=!1);n.csAll=!0}function s(a,t,o){var e=n.ls[a];"v"==t?e.v||(e.g=!1,e.e=!1):(e.g||e.e)&&(e.v=!0),(e.v||e.g||e.e)&&(n.cs[a]=!0),o||(l(),c())}function l(){for(var a=Object.keys(n.ls),t={v:!0,g:!0,e:!0},o=0;o<a.length&&(n.ls[a[o]].v||(t.v=!1),n.ls[a[o]].g||(t.g=!1),n.ls[a[o]].e||(t.e=!1),t.v||t.g||t.e);o++);n.lsAll=t}function u(a){return{v:angular.isUndefined(a)||1==a||3==a||5==a||7==a,g:angular.isUndefined(a)||3==a||7==a,e:angular.isUndefined(a)||5==a||7==a}}n.adicionais=o.getAdicionaisAtivos(),n.cs={},n.ls={},n.lsAll=u(7),n.csAll=!0,n.changeC=i,n.changeL=s,n.changeLAll=function(a){"v"==a?n.lsAll.v||(n.lsAll.g=!1,n.lsAll.e=!1):(n.lsAll.g||n.lsAll.e)&&(n.lsAll.v=!0);angular.forEach(n.ls,(function(t,o){t[a]=n.lsAll[a],s(o,a,!0)})),c()},n.changeCAll=function(){angular.forEach(n.cs,(function(a,t){n.cs[t]=n.csAll,i(t,!0)}))},n.ok=function(){if(n.changed()){var o={};return n.adicionais.forEach((function(a){var t=0;n.ls[a.id].v&&(t+=1),n.ls[a.id].g&&(t+=2),n.ls[a.id].e&&(t+=4),o[a.id]={lancamentos:t,contas:n.cs[a.id]}})),e.post("/apiweb/usuarios/restricoes",{tipo:"contas",id:r,usuarios:o}).then((function(o){return t.showSimple("Restrições atualizadas"),a.hide(o.data)}))}return t.showSimple("Restrições atualizadas"),a.cancel()},n.adicionais.forEach((function(a){for(var t=o.getUsuarioConta(a.id),e=!1,i=0;i<t.permissoes.restricoes.contas.length;i++)if(t.permissoes.restricoes.contas[i]==r){e=!0;break}n.ls[a.id]=u(t.permissoes.restricoes.lancamentos[r]),n.cs[a.id]=!e})),c(),l(),n.permOrg=angular.toJson(n.cs)+angular.toJson(n.ls),n.changed=function(){return n.permOrg!=angular.toJson(n.cs)+angular.toJson(n.ls)}}a.$inject=["$mdDialog","$mdToast","usuariosService","$http"],angular.module("md").controller("UsuariosUsuariosRestricoesContaController",a)}(),function(){"use strict";function a(a,t){a.state("conta.usuarios.novo",t.getState({url:"/novo",action:"usuariosService.criarAdicional"})).state("conta.usuarios.editar",t.getState({url:"/editar/:id",action:"usuariosService.editarAdicional"})).state("conta.usuarios.gerenciar",t.getState({url:"/gerenciar/:id",action:"usuariosService.editarPermissoes"}))}a.$inject=["$stateProvider","mdwStateDialogProvider"],angular.module("md").config(a)}(),function(){"use strict";function a(a,t){var o=this;o.hide=function(){o.mdPanelRef.close()},o.limit=5,o.usuario=a.usuario,o.usuariosCnt=0,o.usuarios=[],o.style={"max-height":.8*t.innerHeight+"px"},a.usuarios.forEach((function(a){a.conta.status&&(o.usuariosCnt<o.limit&&o.usuarios.push(a),o.usuariosCnt++)})),o.login=a.usuario.login,o.nomePlano=o.usuario.plano.nome}a.$inject=["usuariosService","$window"],angular.module("md").directive("mdwUsuariosTopmenu",(function(){return{restrict:"E",templateUrl:"/partials/usuarios/usuariosTopmenu.html",scope:{},controllerAs:"vm",controller:["usuariosService","MD_INVEST_MOD","$mdPanel",function(t,o,e){var n=this;n.usuario=t.usuario,n.usuarios=t.usuarios,n.login=t.usuario.login,n.nomePlano=n.usuario.plano.nome,n.openMenu=function(t){var o=e.newPanelPosition().relativeTo(t.srcElement).addPanelPosition(e.xPosition.ALIGN_START,e.yPosition.BELOW).withOffsetX(-30).withOffsetY(10),n=(e.newPanelAnimation().openFrom(t.srcElement).duration(100).withAnimation(e.animation.SLIDE),{attachTo:angular.element(document.body),controller:a,controllerAs:"vm",position:o,targetEvent:t,templateUrl:"/partials/usuarios/usuariosTopmenu.menu.html",clickOutsideToClose:!0,escapeToClose:!0});e.open(n)}}]}}))}(),function(){"use strict";angular.module("md").directive("mdwVgPlaceholderBasico",(function(){return a.$inject=["visaogeralService"],{restrict:"E",template:['<div class="conteudo plano-basico" ng-show="ctrl.hasLoaded">','<img style="max-width: 100%;" ng-src="{{ctrl.imgSrc()}}" mdw-vg-placeholder-img>',"<div>","<h3>Seu controle financeiro pode ficar ainda melhor.</h3>",'<md-button class="md-raised md-primary" ui-sref="assinatura">',"Adicionar este recurso agora","</md-button>","</div>","</div>"].join(""),require:["mdwVgPlaceholderBasico"],scope:{idCard:"@id"},controller:a,controllerAs:"ctrl",bindToController:!0};function a(a){var t=this;t.isBasico=a.isBasico,t.imgSrc=function(){return"https://s3.amazonaws.com/img.meudinheiroweb.com.br/app/visaogeral/"+t.idCard+"_"+a.colsn+".png"},t.hasLoaded=!1}})).directive("mdwVgPlaceholderImg",(function(){return{restrict:"A",require:["^mdwVgPlaceholderBasico","mdwVgPlaceholderImg"],scope:{},link:function(a,t,o,e){t.bind("load",(function(){e[0].hasLoaded=!0}))},controller:function(){},controllerAs:"ctrl",bindToController:!0}}))}(),function(){"use strict";function a(a,t){return{restrict:"A",require:"mdwCardvgContainer",scope:{cardsController:"=mdwCardvgContainer"},link:function(o,e,n,r){var i,c=angular.element(e),s=[],l=[],u=!1;function d(){if(0!=l.length||!u){for(var a=0,o=l[a],e=0;e<l.length;e++)l[e].dom[0].offsetTop<o.dom[0].offsetTop&&(o=l[e],a=e);if(o&&o.dom[0].offsetTop<c[0].clientHeight+c[0].scrollTop)return u=!0,t.when(o.card.service.init()).then((function(){l.splice(a,1),m()}));m()}}function m(){i||(i=a((function(){i=null,d()}),10))}function f(){s.forEach((function(a){a.card.service._initialized=!1})),s=[],l=[],u=!1}o.$on("$destroy",(function(){f(),i&&a.cancel(i)})),r.register=function(a,t){var o={card:a,dom:t};l.push(o),s.push(o),m()},r.cardsController.refresh=function(){l=[],s.forEach((function(a){a.card.service._initialized=!1,l.push(a)})),m()},r.cardsController.reset=f},controller:angular.noop,controllerAs:"ctrl",bindToController:!0}}a.$inject=["$timeout","$q"],angular.module("md").directive("mdwCardvgContainer",a).directive("mdwCardvg",(function(){return{restrict:"A",require:["^mdwCardvgContainer","mdwCardvg"],scope:{card:"=mdwCardvg"},link:function(a,t,o,e){var n=angular.element(t),r=e[0],i=e[1];r.register(i.card,n)},controller:angular.noop,controllerAs:"ctrl",bindToController:!0}}))}(),function(){"use strict";function a(a,t,o,e){var n=this;n.vg=t;var r=o.usuario.plano;n.isBasico=0==r.tipo||!r.status,n.invest=o.planoHasInvestimentos(),n.data=moment.min(moment(t.getData().inicio),moment()).startOf("month").format("YYYY-MM-DD");var i=n.vg.bp.addObserver(),c=e.onChange((function(){n.vg.bp.chart&&e.prepareChartOptions(n.vg.bp.chart.options)}));a.$on("$destroy",(function(){i(),c()}))}a.$inject=["$scope","visaogeralService","usuariosService","mdwDarkModeService"],angular.module("md").controller("VisaogeralBPController",a)}(),function(){"use strict";function a(a,t,o){this.vg=t,a.$on("$destroy",this.vg.ultimosLancamentos.addObserver())}a.$inject=["$scope","visaogeralService","lancamentosDatasource"],angular.module("md").controller("VisaogeralCartoesController",a)}(),function(){"use strict";function a(a,t,o){this.vg=t,a.$on("$destroy",this.vg.contasPagar.addObserver())}a.$inject=["$scope","visaogeralService","relatoriosDatasource"],angular.module("md").controller("VisaogeralContaspagarController",a)}(),function(){"use strict";function a(a,t,o){this.vg=t,a.$on("$destroy",this.vg.contasReceber.addObserver())}a.$inject=["$scope","visaogeralService","relatoriosDatasource"],angular.module("md").controller("VisaogeralContasreceberController",a)}(),function(){"use strict";function a(a,t,o){var e=this;e.vg=t;var n=e.vg.fluxocaixa.addObserver(),r=o.onChange((function(){e.vg.fluxocaixa.chart&&o.prepareChartOptions(e.vg.fluxocaixa.chart.fluxo.options)}));a.$on("$destroy",(function(){n(),r()}))}a.$inject=["$scope","visaogeralService","mdwDarkModeService"],angular.module("md").controller("VisaogeralFluxocaixaController",a)}(),function(){"use strict";function a(a,t,o,e){var n=this;n.vg=t,n.configSvc=e,n.isMoeda=!o.isDefaultActivated(),a.$on("$destroy",n.vg.metasOrcamentoD.addObserver()),n.isBasico=t.isBasico}a.$inject=["$scope","visaogeralService","moedaService","configuracoesService"],angular.module("md").controller("VisaogeralMetasDespesaController",a)}(),function(){"use strict";function a(a,t,o,e){var n=this;n.vg=t,n.configSvc=e,n.isMoeda=!o.isDefaultActivated(),a.$on("$destroy",n.vg.metasOrcamentoCentroD.addObserver()),n.isBasico=t.isBasico}a.$inject=["$scope","visaogeralService","moedaService","configuracoesService"],angular.module("md").controller("VisaogeralMetasDespesaCentroController",a)}(),function(){"use strict";function a(a,t,o){var e=this;e.vg=t,e.isMoeda=!o.isDefaultActivated(),a.$on("$destroy",e.vg.metasEconomia.addObserver()),e.isBasico=t.isBasico}a.$inject=["$scope","visaogeralService","moedaService"],angular.module("md").controller("VisaogeralMetasEconomiaController",a)}(),function(){"use strict";function a(a,t,o){var e=this;e.vg=t,e.isMoeda=!o.isDefaultActivated(),a.$on("$destroy",e.vg.metasInvestimentos.addObserver()),e.isBasico=t.isBasico}a.$inject=["$scope","visaogeralService","moedaService"],angular.module("md").controller("VisaogeralMetasInvestimentosController",a)}(),function(){"use strict";function a(a,t,o,e){var n=this;n.vg=t,n.configSvc=e,n.isMoeda=!o.isDefaultActivated(),a.$on("$destroy",n.vg.metasOrcamentoR.addObserver()),n.isBasico=t.isBasico}a.$inject=["$scope","visaogeralService","moedaService","configuracoesService"],angular.module("md").controller("VisaogeralMetasReceitaController",a)}(),function(){"use strict";function a(a,t,o,e){var n=this;n.vg=t,n.configSvc=e,n.isMoeda=!o.isDefaultActivated(),a.$on("$destroy",n.vg.metasOrcamentoCentroR.addObserver()),n.isBasico=t.isBasico}a.$inject=["$scope","visaogeralService","moedaService","configuracoesService"],angular.module("md").controller("VisaogeralMetasReceitaCentroController",a)}(),function(){"use strict";function a(a,t,o){var e=this;e.vg=t;var n=e.vg.resultadocontas.addObserver(),r=o.onChange((function(){e.vg.resultadocontas.chart&&o.prepareChartOptions(e.vg.resultadocontas.chart.options)}));a.$on("$destroy",(function(){n(),r()}))}a.$inject=["$scope","visaogeralService","mdwDarkModeService"],angular.module("md").controller("VisaogeralResultadosContaController",a)}(),function(){"use strict";function a(a,t,o){var e=this;e.vg=t,a.$on("$destroy",o.onChange((function(){e.vg.resultadosRd.chart&&o.prepareChartOptions(e.vg.resultadosRd.chart.options)})))}a.$inject=["$scope","visaogeralService","mdwDarkModeService"],angular.module("md").controller("VisaogeralResultadosRDController",a)}(),function(){"use strict";function a(a,t,o){this.vg=t,a.$on("$destroy",this.vg.saldocontas.addObserver())}a.$inject=["$scope","visaogeralService","relatoriosDatasource"],angular.module("md").controller("VisaogeralSaldoContasController",a)}(),function(){"use strict";function a(a,t,o){this.vg=t,a.$on("$destroy",this.vg.totaisCategoriaD.addObserver())}a.$inject=["$scope","visaogeralService","relatoriosDatasource"],angular.module("md").controller("VisaogeralTotaisCategoriaDespesaController",a)}(),function(){"use strict";function a(a,t,o){this.vg=t,a.$on("$destroy",this.vg.totaisCategoriaR.addObserver())}a.$inject=["$scope","visaogeralService","relatoriosDatasource"],angular.module("md").controller("VisaogeralTotaisCategoriaReceitaController",a)}(),function(){"use strict";function a(a,t){this.vg=t,a.$on("$destroy",this.vg.totaisCentroD.addObserver())}a.$inject=["$scope","visaogeralService"],angular.module("md").controller("VisaogeralTotaisCentroDespesaController",a)}(),function(){"use strict";function a(a,t){this.vg=t,a.$on("$destroy",this.vg.totaisCentroR.addObserver())}a.$inject=["$scope","visaogeralService"],angular.module("md").controller("VisaogeralTotaisCentroReceitaController",a)}(),function(){"use strict";function a(a,t,o){this.vg=t,a.$on("$destroy",this.vg.ultimosLancamentos.addObserver())}a.$inject=["$scope","visaogeralService","lancamentosDatasource"],angular.module("md").controller("VisaogeralUltimoLancamentosController",a)}(),function(){"use strict";function a(a,t,o){var e=this;a.title="Visão geral",e.service=t,e.dragDisabled=o.innerWidth<=960,e.sortableConfig={longTouch:!0,orderChanged:function(a){e.service.reorderCards(),e.service.updateConfig()},itemMoved:function(a){var t=a.source.itemScope.modelValue,o=e.service.getCard(t.id),n=a.dest.sortableScope.$parent.column.index;o=e.service.getCard(t.id),n=a.dest.sortableScope.$parent.column.index;o.col=t.col=n,e.service.reorderCards(),e.service.updateConfig()}}}a.$inject=["mdwTopmenu","visaogeralService","$window"],angular.module("md").controller("VisaogeralController",a)}(),function(){"use strict";function a(a,t,o,e,n,r){if(!r){var i={},c=["visaogeral/visaogeral.html"];angular.forEach(n.cards,(function(a){i[a.id]={templateUrl:a.tpl,controller:a.ctrl,controllerAs:"vm"},c.push(a.tpl)})),a.state("pdi",{url:"/pdi",template:"Carregando...",controller:["$state","loginService",function(a,t){t.iniciarPdi().finally((function(){a.go("visaogeral.paineis",{keepDialog:!0})}))}]}),e.state({id:"visaogeral",title:"Visão geral",templates:c},{abstract:!0,url:"/visaogeral",templateUrl:"partials/visaogeral/visaogeral.html",controller:"VisaogeralController",controllerAs:"vm"}),a.state("visaogeral.paineis",{url:"?inicio",views:i,params:{keepDialog:!1},data:{enableMoeda:!0}}),o.addStates("visaogeral.paineis")}}a.$inject=["$stateProvider","mdwStateDialogProvider","lancamentosRoutesProvider","mdwBaseStateProvider","visaogeralServiceProvider","MD_INVEST_MOD"],angular.module("md").config(a)}(),function(){"use strict";function a(a,t){const o={};return a.forEach((a=>{o[a]=t})),o}function t(a,t){for(let o of t)if(!a[o])return!1;return!0}function o(a,t){for(let o of t)if(a[o])return!0;return!1}angular.module("md").provider("visaogeralService",(function(){var e=this.cards={fluxocaixa:{id:"fluxocaixa",ctrl:"VisaogeralFluxocaixaController",title:"Fluxo de caixa",tpl:n("fluxocaixa"),col:0,visible:!0,opened:!0},saldocontas:{id:"saldocontas",ctrl:"VisaogeralSaldoContasController",title:"Saldos de caixa",tpl:n("saldoContas"),col:1,visible:!0,opened:!0},resultadocontas:{id:"resultadocontas",ctrl:"VisaogeralResultadosContaController",title:"Resultados de caixa",tpl:n("resultadoContas"),col:1,visible:!0,opened:!0},bp:{id:"bp",ctrl:"VisaogeralBPController",title:"Balanço patrimonial",tpl:n("bp"),visible:!0,opened:!0,col:0},ultimosLancamentos:{id:"ultimosLancamentos",ctrl:"VisaogeralUltimoLancamentosController",title:"Últimos lançamentos",tpl:n("ultimosLancamentos"),col:1,visible:!0,opened:!0},contaspagar:{id:"contaspagar",ctrl:"VisaogeralContaspagarController",title:"Contas a pagar",tpl:n("contaspagar"),col:0,visible:!0,opened:!0},contasreceber:{id:"contasreceber",ctrl:"VisaogeralContasreceberController",title:"Contas a receber",tpl:n("contasreceber"),col:1,visible:!0,opened:!0},resultadosRd:{id:"resultadosRd",ctrl:"VisaogeralResultadosRDController",title:"Resultado do mês",tpl:n("resultadosRd"),visible:!0,opened:!0,col:0},totaisCategoriaDespesa:{id:"totaisCategoriaDespesa",ctrl:"VisaogeralTotaisCategoriaDespesaController",title:"Despesas por categoria",tpl:n("totaisCategoriaDespesa"),visible:!0,opened:!0,col:0},totaisCategoriaReceita:{id:"totaisCategoriaReceita",ctrl:"VisaogeralTotaisCategoriaReceitaController",title:"Receitas por categoria",tpl:n("totaisCategoriaReceita"),visible:!0,opened:!0,col:1},totaisCentroDespesa:{id:"totaisCentroDespesa",ctrl:"VisaogeralTotaisCentroDespesaController",title:"Despesas por centro",tpl:n("totaisCentroDespesa"),visible:!0,opened:!0,col:0},totaisCentroReceita:{id:"totaisCentroReceita",ctrl:"VisaogeralTotaisCentroReceitaController",title:"Receitas por centro",tpl:n("totaisCentroReceita"),visible:!0,opened:!0,col:1},metasDespesa:{id:"metasDespesa",ctrl:"VisaogeralMetasDespesaController",title:"Metas de despesa",tpl:n("metasDespesa"),visible:!0,opened:!0,col:0},metasReceita:{id:"metasReceita",ctrl:"VisaogeralMetasReceitaController",title:"Metas de receita",tpl:n("metasReceita"),visible:!0,opened:!0,col:1},metasDespesaCentro:{id:"metasDespesaCentro",ctrl:"VisaogeralMetasDespesaCentroController",title:"Metas de despesa por centro",tpl:n("metasDespesaCentro"),visible:!0,opened:!0,col:0},metasReceitaCentro:{id:"metasReceitaCentro",ctrl:"VisaogeralMetasReceitaCentroController",title:"Metas de receita por centro",tpl:n("metasReceitaCentro"),visible:!0,opened:!0,col:1},metasEconomia:{id:"metasEconomia",ctrl:"VisaogeralMetasEconomiaController",title:"Metas de economia",tpl:n("metasEconomia"),visible:!0,opened:!0,col:0},metasInvestimentos:{id:"metasInvestimentos",ctrl:"VisaogeralMetasInvestimentosController",title:"Metas de investimentos",tpl:n("metasInvestimentos"),visible:!0,opened:!0,col:0},cartoes:{id:"cartoes",ctrl:"VisaogeralCartoesController",title:"Cartões de crédito",tpl:n("cartoes"),visible:!0,opened:!0,col:1}};function n(a){return"/partials/visaogeral/paineis/"+a+".html"}function r(n,r,i,c,s,l,u,d,m,f,p,v,g,h,C,b,A){var x=this,S=this,D=g.usuario.plano,$=x.isBasico=0==D.tipo||!D.status;x.calendarioConfig={restrict:["m"],interval:"m",onUpdate:function(){x.cardsController.refresh()}},x.cardsController={refresh:angular.noop},x.getFlexSize=function(){return 3==x.colsn?"30":2==x.colsn?"45":"90"},x.updateConfig=Y,x.personalizar=function(){return i.show({id:"personalizar-visao",templateUrl:"/partials/visaogeral/personalizar.html",controller:["$mdDialog",function(a){var t=this;t.ok=function(){a.hide({regime:t.regime,cards:t.cards,layout:t.layout,noScroll:!!t.noScroll,considerInvest:!t.considerInvest})}}],controllerAs:"vm",bindToController:!0,locals:{layout:x.colsn,noScroll:x.noScroll?1:0,cards:angular.copy(x.cards),regime:x.regime,considerInvest:x.considerInvest?0:1}}).then((function(a){x.colsn=a.layout,x.regime=a.regime,x.noScroll=a.noScroll,x.considerInvest=a.considerInvest,a.cards.forEach((function(a){var t=_(a.id);!t.visible&&a.visible&&(t.opened=!0,t.service.init()),t.visible=a.visible})),R(),T(),Y()}))},x.refreshCards=T,x.resultadosRd=new function(){var a,t=this;function o(){return a=_("resultadosRd"),!t._initialized&&a.opened?(I.resultadosRd=angular.extend({visualizacao:"p"},I.resultadosRd||{}),t.visualizacao=I.resultadosRd.visualizacao,t._initialized=!0,t.loading=!0,e()):t._initialized&&a.opened?e():void 0}function e(){if(!t._initialized)return o();if(a.opened){var e=P();return t.mes=s(e.inicio).endOf("month").format("MMM/YYYY"),d.lancamentos.sum({inicio:e.inicio,fim:e.fim,regime:S.regime,considerarInvestimentos:S.considerInvest},{groupByTipo:!0}).then((function(a){t.loading=!1,t.totalDespesas=0,t.totalReceitas=0;var o="c"==t.visualizacao?"confirmado":"projetado";if(a.sum.forEach((function(a){"d"==a.tipo?t.totalDespesas+=a[o]:"r"==a.tipo&&(t.totalReceitas+=a[o])})),t.semDados=0==t.totalDespesas&&0==t.totalReceitas,!t.semDados){t.chart=k("Resultado das receitas e despesas","Resultado"),t.corReceitas=p.getHexColor("green",400),t.corDespesas=p.getHexColor("red",400),t.chart.data.rows.push({c:[{v:"Receitas"},{v:t.totalReceitas,f:r("currency")(t.totalReceitas,r("moeda")(A.moeda)+" ")},{v:t.corReceitas}]}),t.chart.data.rows.push({c:[{v:"Despesas"},{v:-1*t.totalDespesas,f:r("currency")(t.totalDespesas,r("moeda")(A.moeda)+" ")},{v:t.corDespesas}]})}}))}}t._initialized=!1,t.init=o,t.carregar=e,t.toggleVisualizacao=function(){t.visualizacao="c"==t.visualizacao?"p":"c",I.resultadosRd.visualizacao=t.visualizacao,t.loading=!0,Y(),e()},t.addObserver=L("rd",e)},x.totaisCategoriaD=new F("d","categoria"),x.totaisCategoriaR=new F("r","categoria"),x.totaisCentroR=new F("r","centro"),x.totaisCentroD=new F("d","centro"),x.fluxocaixa=new function(){var e,n=this;function r(){return e=_("fluxocaixa"),!n._initialized&&e.opened?(n.cores={},n.filtroContas={},n.showContas={},I.fluxocaixa=angular.extend({ccontas:null,scontas:null,periodo:1,sz:!1},I.fluxocaixa||{}),n.filtrarSaldo=I.fluxocaixa.sz,I.fluxocaixa.ccontas?I.fluxocaixa.ccontas.forEach((function(a){n.filtroContas[a]=!0})):(u.carregarContasCaixa(!0).forEach((function(a){n.filtroContas[a.id]=!0})),n.filtroContas.r=v.utilizacao.residuo),I.fluxocaixa.scontas?I.fluxocaixa.scontas.forEach((function(a){n.showContas[a]=!0})):n.showContas[0]=!0,n.periodo=I.fluxocaixa.periodo,n._initialized=!0,n.loading=!0,i()):n._initialized&&e.opened?i():void 0}function i(){if(!n._initialized)return r();if(e.opened){var a=P();n.dataSaldo=a.fim,n.residuoHabilitado=v.utilizacao.residuo;var i=[],c=[0];return angular.forEach(n.filtroContas,(function(a,t){a&&i.push("r"==t?"r":parseFloat(t))})),angular.forEach(n.showContas,(function(a,t){a&&c.push(parseFloat(t))})),d.v2.fluxocaixa({inicio:a.inicio,fim:a.fim,visao:"d",contas:i,chartContas:c,chartOptions:{options:{legend:{position:"none"}}}}).then((function(a){return n.chart=a.chart,n.fluxo=a.fluxo,n.saldos=a.saldos,n.chart=a.chart,n.cores=a.cores,n.contasOriginal=a.contas,n.loading=!1,n.filtrarSaldo?n.contas=n.contasOriginal.filter((function(a){return Math.abs(n.saldos[a.id])>=.01})):n.contas=n.contasOriginal,n.contasId=s(),n.allMarked=t(n.filtroContas,s()),n.allMarkedIndeterminate=!n.allMarked&&o(n.filtroContas,s()),m}))}}function c(){I.fluxocaixa.ccontas=[],angular.forEach(n.filtroContas,(function(a,t){a&&I.fluxocaixa.ccontas.push(t)})),Y(),i()}function s(){return n.contas.map((a=>a.id))}n._initialized=!1,n.init=r,n.carregar=i,n.onselect=function(a){},n.toggleConta=function(a){n.showContas[a]=!n.showContas[a],I.fluxocaixa.scontas=[],angular.forEach(n.showContas,(function(a,t){a&&I.fluxocaixa.scontas.push(t)})),Y(),i()},n.filtrarContas=c,n.alterarPeriodo=function(a){n.periodo=a,I.fluxocaixa.periodo=a,n.loading=!0,Y(),i()},n.filtrarContasSaldo=function(){n.filtrarSaldo=!n.filtrarSaldo,I.fluxocaixa.sz=n.filtrarSaldo,Y(),i()},n.addObserver=L("fluxodecaixa",i),n.markAllOptions=function(){n.filtroContas=a(s(),n.allMarked),c()}},x.saldocontas=new function(){var e,n=this;n._initialized=!1,n.init=r,n.carregar=i,n.filtrarContas=l,n.filtrarContasSaldo=function(){n.filtrarSaldo=!n.filtrarSaldo,I.saldocontas.sz=n.filtrarSaldo,Y(),i()},n.addObserver=L("saldosContas",i),n.markAllOptions=function(){n.filtroContas=a(m(),n.allMarked),l()};function r(){return e=_("saldocontas"),!n._initialized&&e.opened?(I.saldocontas=angular.extend({periodo:1,s:"a",sz:!1},I.saldocontas||{}),n.filtrarSaldo=I.saldocontas.sz,n.filtroContas={},n.orderBy=I.saldocontas.s,I.saldocontas.contas?I.saldocontas.contas.forEach((function(a){n.filtroContas[a]=!0})):(u.carregarContasCaixa(!0).forEach((function(a){n.filtroContas[a.id]=!0})),n.filtroContas.r=v.utilizacao.residuo),n.periodo=I.saldocontas.periodo,n._initialized=!0,n.loading=!0,i()):n._initialized&&e.opened?i():void 0}function i(){if(!n._initialized)return r();if(e.opened){var a=P(),i=u.carregarContasCaixa(!0).map((function(a){return a.id}));({});s().isAfter(a.fim)&&a.fim;n.residuoHabilitado=v.utilizacao.residuo,n.totalResiduo=0,d.lancamentos.sum({finalidade:d.lancamentos.FIN_EXTRATO,fim:a.fim,contas:{ids:i,faturas:!0,residuo:n.residuoHabilitado}},{groupBy:"conta"}).then((function(a){n.loading=!1,n.saldos=[],n.saldoProjTotal=0,n.saldoConfTotal=0,a.sum.forEach((function(a){if("residuo"!=a.conta){var t=f.get("contas",a.conta,!0);if(1==n.filtrarSaldo&&Math.abs(a.projetado)<.01&&Math.abs(a.confirmado)<.01)return;n.saldos.push({conta:a.conta,encerrada:t.encerrada,nome:t.nome,saldoProj:a.projetado,saldoConf:a.confirmado}),n.filtroContas[a.conta]&&(n.saldoProjTotal+=a.projetado,n.saldoConfTotal+=a.confirmado)}else n.totalResiduo+=a.projetado,n.filtroContas.r&&(n.saldoProjTotal+=a.projetado)})),c(),n.contasId=m(),n.allMarked=t(n.filtroContas,m()),n.allMarkedIndeterminate=!n.allMarked&&o(n.filtroContas,m())}))}}function c(){n.saldos.sort("a"==n.orderBy?function(a,t){return a.nome.toLowerCase()>t.nome.toLowerCase()?1:a.nome.toLowerCase()<t.nome.toLowerCase()?-1:0}:function(a,t){var o=t.saldoConf-a.saldoConf;return Math.abs(o)>=.01?o:t.saldoProj-a.saldoProj})}function l(){I.saldocontas.contas=[],angular.forEach(n.filtroContas,(function(a,t){a&&I.saldocontas.contas.push(t)})),Y(),i()}function m(){const a=n.saldos.map((a=>a.conta));return n.residuoHabilitado&&a.push("r"),a}n.toggleSort=function(a){n.orderBy=a,I.saldocontas.s=n.orderBy,Y(),c()}},x.resultadocontas=new function(){var e,n=this;function i(){return e=_("resultadocontas"),!n._initialized&&e.opened?(I.resultadocontas=angular.extend({visualizacao:1,contas:[],sz:!1},I.resultadocontas||{}),n.filtrarSaldo=I.resultadocontas.sz,n.visualizacao=I.resultadocontas.visualizacao,n.filtroContas={},I.resultadocontas.contas.forEach((function(a){n.filtroContas[a]=!1})),n._initialized=!0,n.loading=!0,c()):n._initialized&&e.opened?c():void 0}function c(a){if(!n._initialized)return i();if(e.opened){var c=P();n.residuoHabilitado=v.utilizacao.residuo;var s,m,g,h=u.carregarContasCaixa(!0),C=h.map((function(a){return a.id}));return a||(n.loading=!0),n.corReceitas=p.getHexColor("green",400),n.corDespesas=p.getHexColor("red",400),1==n.visualizacao?(m=[],g={},h.forEach((function(a){var t={conta:a.id,nome:a.nome,encerrada:a.encerrada,entradas:0,saidas:0,resultado:0};m.push(t),g[a.id]=t,!1!==n.filtroContas[a.id]&&(n.filtroContas[a.id]=!0)})),m.sort((function(a,t){return a.nome.toLowerCase()>t.nome.toLowerCase()?1:a.nome.toLowerCase()<t.nome.toLowerCase()?-1:0})),n.resultado={contas:m,saidasContas:0,entradasContas:0},d.lancamentos.sum(b(),{groupByTipo:!0,groupBy:"conta"}).then((function(a){n.loading=!1,n.chart=k("Resultado das contas","Resultado"),a.sum.forEach((function(a){var t="d"==a.tipo||"ts"==a.tipo?"saidas":"entradas";"residuo"!=a.conta||g.residuo||(g.residuo={entradas:0,saidas:0,resultado:0,conta:"residuo"},m.push(g.residuo)),g[a.conta][t]+=a.projetado,g[a.conta].resultado+=a.projetado,!1!==n.filtroContas[a.conta]&&(n.resultado[t+"Contas"]+=a.projetado,n.filtroContas[a.conta]=!0)}));var e=[];m.forEach((function(a,t){1==n.filtrarSaldo&&Math.abs(a.entradas)<.01&&Math.abs(a.saidas)<.01||(!a.encerrada||a.entradas||a.saidas)&&e.push(a)})),n.resultado.contas=m=e,m.forEach((function(a,t){var o="residuo"!=a.conta?f.get("contas",a.conta,!0):{nome:"Resíduo de metas"};a.cor=p.getColorAtIndex(t,["green","red"]),n.chart.data.rows.push({c:[{v:o.nome},{v:a.resultado,f:r("currency")(a.resultado,r("moeda")(A.moeda)+" ")},{v:"color:"+a.cor}]})})),n.resultado.resultado=n.resultado.entradasContas+n.resultado.saidasContas,n.resultado.cor=n.resultado.resultado>0?n.corReceitas:n.corDespesas;var i=p.getHexColor(n.resultado.resultado>0?"green":"red","900");n.chart.data.rows.push({c:[{v:"Resultado"},{v:n.resultado.resultado,f:r("currency")(n.resultado.resultado,r("moeda")(A.moeda)+" ")},{v:"color:"+n.resultado.cor+";stroke-color:"+i+";stroke-width:3"}]}),n.contasId=l(),n.allMarked=t(n.filtroContas,l()),n.allMarkedIndeterminate=!n.allMarked&&o(n.filtroContas,l())}))):((s=b()).contas.transferenciasIntracaixa=!1,d.lancamentos.sum(s,{groupByTipo:!0}).then((function(a){n.loading=!1,n.chartTotal=k("Resultado das contas","Resultado"),n.resultado={entradas:0,saidas:0,resultado:0},a.sum.forEach((function(a){var t="d"==a.tipo||"ts"==a.tipo?"saidas":"entradas";n.resultado[t]+=a.projetado,n.resultado.resultado+=a.projetado})),n.chartTotal.data.rows.push({c:[{v:"Entradas"},{v:n.resultado.entradas,f:r("currency")(n.resultado.entradas,r("moeda")(A.moeda)+" ")},{v:n.corReceitas}]}),n.chartTotal.data.rows.push({c:[{v:"Saídas"},{v:-1*n.resultado.saidas,f:r("currency")(n.resultado.saidas,r("moeda")(A.moeda)+" ")},{v:n.corDespesas}]})})))}function b(){return{finalidade:d.lancamentos.FIN_EXTRATO,inicio:c.inicio,fim:c.fim,residuo:n.residuoHabilitado,contas:{ids:C,faturas:!0,residuo:v.utilizacao.residuo}}}}function s(){I.resultadocontas.contas=[],angular.forEach(n.filtroContas,(function(a,t){a||I.resultadocontas.contas.push(t)})),Y(),c(!0)}function l(){return n.resultado.contas.map((a=>a.conta))}n._initialized=!1,n.init=i,n.carregar=c,n.toggleVisualizacao=function(){n.visualizacao=1==n.visualizacao?2:1,I.resultadocontas.visualizacao=n.visualizacao,Y(),c()},n.filtrarContas=s,n.addObserver=L("resultadosContas",c),n.filtrarContasSaldo=function(){n.filtrarSaldo=!n.filtrarSaldo,I.resultadocontas.sz=n.filtrarSaldo,Y(),c()},n.markAllOptions=function(){n.filtroContas=a(l(),n.allMarked),s()}},x.contasPagar=new U("contaspagar"),x.contasReceber=new U("contasreceber"),x.ultimosLancamentos=new function(){var a,t=this;function o(){return a=_("ultimosLancamentos"),!t._initialized&&a.opened?(t.lancamentos=[],t._initialized=!0,t.loading=!0,e()):t._initialized&&a.opened?e():void 0}function e(){if(!t._initialized)return o();if(a.opened){var e={pageSize:50,onBeforeFetch:function(a){t.loading=!0},onFetch:function(a,o){t.loading=!1,t.lancamentos=a,t.semDados=0==o.total}},n={inicioc:s().format("YYYY-MM-DD"),fimc:s().format("YYYY-MM-DD"),finalidade:d.lancamentos.FIN_BUSCA,moeda:-1};t.paginator=d.lancamentos.list(n,{orderBy:[{t:"datac",v:"desc"}]},e),t.paginator.fetch(1)}}t._initialized=!1,t.init=o,t.carregar=e,t.addObserver=function(){return l.addObserver(e)}},x.metasOrcamentoD=new z("d"),x.metasOrcamentoR=new z("r"),x.metasOrcamentoCentroD=new z("d",!0),x.metasOrcamentoCentroR=new z("r",!0),x.bp=new function(){var a,t=this;function o(){return a=_("bp"),!t._initialized&&a.opened?(I.bp=angular.extend({visualizacao:1},I.bp||{}),t.visualizacao=I.bp.visualizacao,t.bp={},t.ultDia=s().endOf("M").format("DD/MM"),t._initialized=!0,t.loading=!0,e()):t._initialized&&a.opened?e():void 0}function e(){if(!t._initialized)return o();if(a.opened){if($||g.planoHasInvestimentos())return t.loading=!1,n.resolve();var e=f.contas.filter((function(a){return a.status&&"CARTAOCREDITO"!=a.tipo&&a.exibirBP&&"CARTEIRA_INVEST"!=a.tipo})).map((function(a){return a.id})),r=s().format("YYYY-MM-DD");n.all([d.lancamentos.sum({fim:r,status:d.lancamentos.STATUS_CONFIRMADO|d.lancamentos.STATUS_CONCILIADO,finalidade:d.lancamentos.FIN_EXTRATO,contas:{faturas:!0,ids:e}},{groupBy:"conta"}),d.resumoCartoes(r,!0)]).then((function(a){var o=a[0],e=a[1];return t.bp={ativo:{valor:0,disponivel:{valor:0,contas:[]},realizavel:{valor:0,contas:[]},imobilizado:{valor:0,contas:[]}},passivo:{valor:0,devedor:{valor:0,contas:[]},exigivel:{valor:0,contas:[]},imobilizado:{valor:0,contas:[]}},patrimonio:0},e.forEach((function(a){if(a.aberta&&a.aberta.utilizado){var o=a.aberta.utilizado>0?"ativo":"passivo",e="ativo"==o?"realizavel":"exigivel",n=f.get("contas",a.conta,!0);t.bp[o].valor+=a.aberta.utilizado,t.bp[o][e].valor+=a.aberta.utilizado,t.bp.patrimonio+=a.aberta.utilizado,t.bp[o][e].contas.push({nome:n.nome.toLowerCase(),conta:a.conta,valor:a.aberta.utilizado,url:"fatura.listar({conta :"+a.conta+"})"})}})),o.sum.forEach((function(a){if(0!=a.projetado){var o,e,n=a.projetado>0?"ativo":"passivo",r=f.get("contas",a.conta,!0);o="ativo"==n?1==r.liquidez?"disponivel":2==r.liquidez?"realizavel":"imobilizado":1==r.liquidez?"devedor":2==r.liquidez?"exigivel":"imobilizado",t.bp[n].valor+=a.projetado,t.bp[n][o].valor+=a.projetado,"CARTEIRA_INVEST"!=r.tipo&&(e="CARTAOCREDITO"==r.tipo?"fatura.listar":"extratoConta.listar",e+="({conta :"+r.id+"})"),t.bp[n][o].contas.push({nome:r.nome.toLowerCase(),conta:a.conta,valor:a.projetado,url:e}),t.bp.patrimonio+=a.projetado}})),i(),m.then((function(){t.loading=!1}))}))}}function i(){t.bp.ativo.cor=p.getHexColor("green",400),t.bp.passivo.cor=p.getHexColor("red",400),1==t.visualizacao&&(t.chart=k("Balanço patrimonial"),t.chart.data.rows.push({c:[{v:"Ativo"},{v:t.bp.ativo.valor,f:r("currency")(t.bp.ativo.valor,r("moeda")(A.moeda)+" ")},{v:t.bp.ativo.cor}]}),t.chart.data.rows.push({c:[{v:"Passivo"},{v:-1*t.bp.passivo.valor,f:r("currency")(t.bp.passivo.valor,r("moeda")(A.moeda)+" ")},{v:t.bp.passivo.cor}]}))}t._initialized=!1,t.init=o,t.carregar=e,t.alterarVisualizacao=function(){t.visualizacao=1==t.visualizacao?2:1,I.bp.visualizacao=t.visualizacao,Y(),i()},t.addObserver=L("bp",e)},x.cartoes=new function(){var a,t=this;function o(){return a=_("cartoes"),!t._initialized&&a.opened?(I.cartoes=angular.extend({visualizacao:1,od:"a"},I.cartoes||{}),t.visualizacao=I.cartoes.visualizacao,t.ordenacao=I.cartoes.od,t.cartoes=[],t._initialized=!0,t.loading=!0,e()):t._initialized&&a.opened?e():void 0}function e(){if(!t._initialized)return o();if(a.opened){var e=P();return t.dataSaldo=e.inicio,t.totalMes=0,t.totalAberto=0,t.totalDisponivel=0,d.resumoCartoes(e.inicio).then((function(a){t.loading=!1,t.cartoes=[],a.forEach((function(a){a.cartao=f.get("contas",a.conta,!0),t.cartoes.push(a),a.aberta&&(t.totalAberto+=a.aberta.valor||0),t.totalDisponivel+=a.disponivel||0,a.mes&&(t.totalMes+=a.mes.valor||0)})),n()}))}}function n(){"a"==t.ordenacao?t.cartoes.sort((function(a,t){return a.cartao.nome<t.cartao.nome?-1:1})):t.cartoes.sort((function(a,t){return a.cartao.proximoFechamento>t.cartao.proximoFechamento?-1:1}))}t._initialized=!1,t.init=o,t.carregar=e,t.alterarVisualizacao=function(a){t.visualizacao=1==t.visualizacao?2:1,I.cartoes.visualizacao=t.visualizacao,Y()},t.alterarOrdenacao=function(a){t.ordenacao=a,I.cartoes.od=t.ordenacao,n(),Y()},t.addObserver=function(){return l.addObserver(e)}},x.metasEconomia=new function(){var a,t=this;function o(){return a=_("metasEconomia"),!t._initialized&&a.opened?(I.metasEconomia=angular.extend({},I.metasDespesa||{}),t.metas={},t._initialized=!0,t.loading=!0,e()):t._initialized&&a.opened?e():void 0}function e(){return t._initialized?a.opened?$?(t.loading=!1,n.resolve()):C.query().then((function(a){return t.metas=a,t.metas&&(t.metas=t.metas.filter((function(a){return a.status})),t.metas.sort((function(a,t){return t.descricao<=a.descricao?1:-1}))),t.loading=!1,a})):void 0:o()}t._initialized=!1,t.init=o,t.carregar=e,t.addObserver=L("metasorcamento",e),t.metas={},t.mes=s().endOf("month").format("MMM/YYYY")},x.metasInvestimentos=new function(){var a,t=this;function o(){return a=_("metasInvestimentos"),!t._initialized&&a.opened?(I.metasInvestimentos=angular.extend({visualizacao:"p",visao:1},I.metasInvestimentos||{}),t.metas={},t.visualizacao=I.metasInvestimentos.visualizacao,t.visao=I.metasInvestimentos.visao,t._initialized=!0,t.loading=!0,e()):t._initialized&&a.opened?e():void 0}function e(){if(!t._initialized)return o();if(a.opened){if($)return t.loading=!1,n.resolve();var e=P();return d.metasinvestimentos({inicio:e.inicio,fim:e.fim}).then((function(a){t.loading=!1,t.metas=a,t.metas.contas&&(angular.forEach(t.metas.contas,r),r(t.metas),r(t.metas.geral))}))}}function r(a){"c"==t.visualizacao?(a.valor=a.confirmado,a.cor=a.corConfirmada,a.razao=a.razaoConfirmada,a.residuo=a.residuoConfirmado,a.situacao=a.situacaoconfirmada):(a.valor=a.projetado,a.cor=a.corProjetada,a.razao=a.razaoProjetada,a.residuo=a.residuoProjetado,a.situacao=a.situacaoprojetada)}t._initialized=!1,t.init=o,t.carregar=e,t.toggleVisualizacao=function(){t.visualizacao="c"==t.visualizacao?"p":"c",I.metasInvestimentos.visualizacao=t.visualizacao,t.loading=!0,Y(),e()},t.toggleVisao=function(a){t.visao=1==t.visao?2:1,I.metasInvestimentos.visao=t.visao,Y(),e()},t.addObserver=L("metasinvestimentos",e),t.metas={},t.mes=s().endOf("month").format("MMM/YYYY")};var M=u.carregarContasCaixa().map((function(a){return a.id})),w=u.carregarCartoes().map((function(a){return a.id})),E=angular.copy(e);function y(a,t,o){E[a].service=t,E[a].perm=o}y("fluxocaixa",x.fluxocaixa,g.canView("visaogeral.fluxodecaixa")&&!g.hasRest("contas",0,null,M)),y("saldocontas",x.saldocontas,g.canView("visaogeral.saldocontas")&&!g.hasRest("contas",0,null,M)),y("resultadocontas",x.resultadocontas,g.canView("visaogeral.resultadocontas")&&!g.hasRest("contas",0,null,M)),y("bp",x.bp,g.canView("visaogeral.bp")),y("ultimosLancamentos",x.ultimosLancamentos,g.canView("visaogeral.ultimosLancamentos")),y("contaspagar",x.contasPagar,g.canView("visaogeral.contaspagar")),y("contasreceber",x.contasReceber,g.canView("visaogeral.contasreceber")),y("resultadosRd",x.resultadosRd,g.canView("visaogeral.resultadosRd")),y("totaisCategoriaDespesa",x.totaisCategoriaD,g.canView("visaogeral.totaisCategoriaDespesa")),y("totaisCategoriaReceita",x.totaisCategoriaR,g.canView("visaogeral.totaisCategoriaReceita")),y("totaisCentroDespesa",x.totaisCentroD,g.canView("visaogeral.totaisCentroDespesa")),y("totaisCentroReceita",x.totaisCentroR,g.canView("visaogeral.totaisCentroReceita")),y("metasDespesa",x.metasOrcamentoD,g.canView("visaogeral.metasDespesa")&&g.canView("metas.rd")),y("metasReceita",x.metasOrcamentoR,g.canView("visaogeral.metasReceita")&&g.canView("metas.rd")),y("metasDespesaCentro",x.metasOrcamentoCentroD,g.canView("metas.centros")),y("metasReceitaCentro",x.metasOrcamentoCentroR,g.canView("metas.centros")),y("metasEconomia",x.metasEconomia,g.canView("visaogeral.metasEconomia")&&g.canView("metas.economia")),y("metasInvestimentos",x.metasInvestimentos,g.canView("investimentos.investimentos")),y("cartoes",x.cartoes,g.canView("visaogeral.cartoes")&&!g.hasRest("lancamentos",0,"v",w)),x.cards=[],angular.forEach(E,(function(a){x.cards.push(a)}));var I=v.getConfig("visaogeral",{colsn:2,cards:j(),regime:"ca",noScroll:!1,ci:!0});x.noScroll=I.noScroll,x.regime=I.regime,x.colsn=I.colsn,x.considerInvest=I.ci;E=x.cards.filter((function(a){for(var t=!1,o=0;o<I.cards.length;o++)if(I.cards[o].id==a.id){t=!0;break}return!t}));var O=[];function T(){x.cardsController.refresh()}function P(){var a={},t=h.getDefaultParams("m",!0);return a.inicio=c.inicio?s(c.inicio).format("YYYY-MM-DD"):t.inicio,a.fim=s(a.inicio).add(1,"month").subtract(1,"day").format("YYYY-MM-DD"),a}function R(){x.columns=[];for(var a=0;a<x.colsn;a++)x.columns[a]={index:a,cards:[]};x.cards.forEach((function(a){var t=Math.min(x.colsn-1,a.col);x.columns[t].cards.push(a)}))}function Y(){return I.cards=j(),I.colsn=x.colsn,I.regime=x.regime,I.noScroll=x.noScroll,I.ci=x.considerInvest,v.updateConfig("visaogeral",I)}function j(){return x.cards.map((function(a){return{id:a.id,v:a.visible,o:a.opened,c:a.col}}))}function _(a){for(var t=0;t<x.cards.length;t++)if(x.cards[t].id==a)return x.cards[t]}function L(a,t){return function(){return d.addObserver(a,t)}}function U(a){var t,o=this;function e(){return t=_(a),!o._initialized&&t.opened?(I[a]=angular.extend({visualizacao:1},I[a]||{}),o.visualizacao=I[a].visualizacao,o._initialized=!0,o.loading=!0,n()):o._initialized&&t.opened?n():void 0}function n(){if(!o._initialized)return e();if(t.opened){var n,r,i=P();1==o.visualizacao?(r={pageSize:100,onBeforeFetch:function(a){o.loading=!0},onFetch:function(a,t){o.loading=!1,o.lancamentos=a,o.semDados=0==t.total}},o.paginator=d.lancamentos.list(c(),{},r),o.paginator.fetch(1)):(n=c(),d.lancamentos.sum(n,{groupByData:"day"}).then((function(a){o.loading=!1,o.lancamentosDia=[];var t=s().format("YYYY-MM-DD");o.semDados=0==a.sum.length,a.sum.forEach((function(a){o.lancamentosDia.push({data:t==a.data?"Hoje":s(a.data).format("DD/MM/YYYY"),valor:a.projetado})}))}))),function(){var a=c();d.lancamentos.sum(a).then((function(a){o.total=a.sum.projetado}))}()}function c(){var t;return t="contaspagar"==a?-1:1,{inicio:i.inicio,fim:i.fim,cpr:!0,finalidade:d.lancamentos.FIN_EXTRATO,status:d.lancamentos.STATUS_PENDENTE|d.lancamentos.STATUS_AGENDADO,sinalLancamento:t,contas:{ids:u.carregarContasPR(!0).map((function(a){return a.id})),cartoes:!1,residuo:!1,faturas:!0},sinalLancamento:t}}}o._initialized=!1,o.init=e,o.carregar=n,o.alterarVisualizacao=function(t){o.visualizacao=1==o.visualizacao?2:1,I[a].visualizacao=o.visualizacao,Y(),n()},o.addObserver=L("lancamentos",n)}function F(a,t){var o,e=this;e._initialized=!1,e.init=l,e.carregar=u,e.detalharTotais=f,e.toggleVisualizacao=function(a){e.visualizacao="c"==e.visualizacao?"p":"c",I[c].visualizacao=e.visualizacao,e.loading=!0,Y(),u()},e.changeChartType=function(a){e.chartType="p"==e.chartType?"c":"p",I[c].chartType=e.chartType,e.loading=!0,Y(),u()},e.onselect=f,e.addObserver=L("rd",u);var n="totais"+r("firstToUpper")(t)+("d"==a?"Despesa":"Receita"),c="totais"+t+("d"==a?"D":"R");function l(){return o=_(n),!e._initialized&&o.opened?(I[c]=angular.extend({visualizacao:"p",chartType:"p"},I[c]||{}),e.visualizacao=I[c].visualizacao,e.chartType=I[c].chartType,e._initialized=!0,e.loading=!0,u()):e._initialized&&o.opened?u():void 0}function u(){if(!e._initialized)return l();if(o.opened){var a=m();return d.v2.totaisPor(t,a,{renderPieChart:"p"==e.chartType}).then((function(a){e.loading=!1,e.despesas=a.despesas,e.receitas=a.receitas,e.totais=a.totais,e.charts=a.charts}))}}function m(){var t=P();e.mes=s(t.inicio).endOf("month").format("MMM/YYYY");var o={inicio:t.inicio,fim:t.fim,regime:S.regime,tipoLancamento:"d"==a?d.lancamentos.TIPO_DESPESA:d.lancamentos.TIPO_RECEITA,considerarInvestimentos:S.considerInvest};return"c"==e.visualizacao&&(o.status=d.lancamentos.STATUS_CONFIRMADO|d.lancamentos.STATUS_CONCILIADO),o}function f(o){var n="d"==a?e.totais.despesas:e.totais.receitas;i.show({id:"totais-detalhe",controller:["$mdDialog","moment",function(a,e){var n=this;n.dismiss=a.cancel;var r=m();r[t+"s"]={ids:o.categoria.id},n.paginator=d.lancamentos.list(r,{},{pageSize:20,onBeforeFetch:function(){n.loading=!0},onFetch:function(a){n.ls=a,n.loading=!1}}),n.paginator.fetch(1)}],controllerAs:"vm",templateUrl:"/partials/visaogeral/paineis/totaisDetalhes.html",bindToController:!0,locals:{total:o.valor,cadastro:o.categoria,participacao:Math.abs(o.valor/n)}})}}function z(a,t){var o,e=this;e._initialized=!1,e.init=i,e.carregar=c,e.toggleVisualizacao=function(a){e.visualizacao="c"==e.visualizacao?"p":"c",I[r].visualizacao=e.visualizacao,e.loading=!0,Y(),c()},e.toggleVisao=function(a){e.visao=1==e.visao?2:1,I[r].visao=e.visao,Y(),c()},e.toggleSubcategorias=function(a){e.subcategorias=!e.subcategorias,I[r].subcategorias=e.subcategorias,Y(),c()},e.toggleIndefinidas=function(a){e.indefinidas=!e.indefinidas,I[r].indefinidas=e.indefinidas,Y(),c()},e.addObserver=L("metasorcamento",c),e.metas={},e.mes=s().endOf("month").format("MMM/YYYY");var r="d"==a?"metasDespesa":"metasReceita";function i(){return o=_(r),!e._initialized&&o.opened?(I[r]=angular.extend({visualizacao:"p",visao:1,subcategorias:!0,indefinidas:!1},I[r]||{}),e.visualizacao=I[r].visualizacao,e.visao=I[r].visao,e.subcategorias=I[r].subcategorias,e.indefinidas=I[r].indefinidas,e.metas={},e._initialized=!0,e.loading=!0,c()):e._initialized&&o.opened?c():void 0}function c(){if(!e._initialized)return i();if($)return e.loading=!1,n.resolve();var a,r,c=[];return o.opened&&c.push((a=S.regime,r=P(),e.mes=s(r.inicio).endOf("month").format("MMM/YYYY"),d.v2.metasOrcamento({inicio:r.inicio,fim:r.fim,regime:a,indefinidas:e.indefinidas,tipo:t?"centro":"categoria"}).then((function(a){return a.d&&(e.metas.d=angular.copy(a.d)),a.r&&(e.metas.r=angular.copy(a.r)),angular.forEach(e.metas,(function(a,t){angular.forEach(a.categorias,(function(a){l(a),a.subcategorias&&a.subcategorias.forEach((function(a){l(a)}))})),a.nome="Total",a.backgroundColor="#f2f2f2",l(a),l(a.geral)})),m})))),n.all(c).then((function(){e.loading=!1}))}function l(a){"c"==e.visualizacao?(a.valor=a.confirmado,a.cor=a.corConfirmada,a.razao=a.razaoConfirmada,a.residuo=a.realizarConfirmado,a.situacao=a.situacaoconfirmada):(a.valor=a.projetado,a.cor=a.corProjetada,a.razao=a.razaoProjetada,a.residuo=a.realizarProjetado,a.situacao=a.situacaoprojetada)}t&&(r+="Centro")}function k(a,t){return{type:"ColumnChart",data:{cols:[{label:a,type:"string"},{label:t||"Valor",type:"number"},{role:"style",type:"string"}],rows:[]},options:b.prepareChartOptions({backgroundColor:"transparent",tooltip:{trigger:"selection"},vAxis:{textPosition:"none",gridlines:{color:"white"},minValue:0},legend:{position:"none"},chartArea:{width:"90%",height:"90%"}})}}I.cards.forEach((function(a){var t=_(a.id);if(t){var o={id:a.id,visible:a.v,opened:a.v&&a.o,col:Math.min(a.c,x.colsn-1)};o.tpl=t.tpl,o.service=t.service,o.title=t.title,o.perm=t.perm,O.push(o)}})),x.cards=O.concat(E),x.togglePanel=function(a){a.opened=!a.opened,Y(),a.opened&&a.service.carregar()},x.getCard=_,x.reorderCards=function(){x.cards=[],x.columns.forEach((function(a){x.cards=x.cards.concat(a.cards)}))},x.getData=P,R()}this.$get=["$q","$filter","$mdDialog","$stateParams","moment","lancamentosDatasource","contasService","relatoriosDatasource","googleChartApiPromise","cadastrosDatasource","mdwColors","configuracoesService","usuariosService","mdwCalendarService","metaseconomiaDatasource","mdwDarkModeService","moedaService",function(a,t,o,e,n,i,c,s,l,u,d,m,f,p,v,g,h){return new r(a,t,o,e,n,i,c,s,l,u,d,m,f,p,v,g,h)}]}))}();