<div flex layout=column class=metasorcamentovg>
    <div layout=row layout-align="start center" class=titulo as-sortable-item-handle>
        <div flex>
            Metas de despesas<br>
            <em ng-if="card.opened && vm.vg.metasOrcamentoD._initialized" class=detalhe>Situação {{vm.vg.metasOrcamentoD.visualizacao == 'c' ? 'confirmada' : 'projetada'}}</em>
        </div>
        <div class=actions layout=row>
            <md-button ng-if="!vm.isBasico && card.opened && vm.vg.metasOrcamentoD._initialized" class="md-icon-button swap-view {{'v'+vm.vg.metasOrcamentoD.visao}}" ng-click=vm.vg.metasOrcamentoD.toggleVisao()>
                <md-tooltip>{{vm.vg.metasOrcamentoD.visao == 1 ? 'Alterar para visão do total' : 'Alterar para visão por categorias'}}</md-tooltip>
                <md-icon>swap_horiz</md-icon>
            </md-button>
            <md-button ng-if="!vm.isBasico && card.opened && vm.vg.metasOrcamentoD._initialized" class=md-icon-button ng-class=vm.vg.metasOrcamentoD.visualizacao ng-click=vm.vg.metasOrcamentoD.toggleVisualizacao()>
                <md-tooltip>{{vm.vg.metasOrcamentoD.visualizacao == 'c' ? 'Alterar para situação projetada' : 'Alterar para situação confirmada'}}</md-tooltip>
                <md-icon>{{vm.vg.metasOrcamentoD.visualizacao == 'c' ? 'check_circle' : 'check'}}</md-icon>
            </md-button>
            <md-menu ng-if="!vm.isBasico && card.opened && vm.vg.metasOrcamentoD._initialized">
                <md-button class=md-icon-button ng-click=$mdOpenMenu()>
                    <md-icon>visibility</md-icon>
                    <md-tooltip>Configurações de exibição</md-tooltip>
                </md-button>
                <md-menu-content width=3>
                    <md-menu-item>
                        <md-button ng-click=vm.vg.metasOrcamentoD.toggleSubcategorias()>{{vm.vg.metasOrcamentoD.subcategorias ? 'Esconder' : 'Exibir'}} subcategorias</md-button>
                    </md-menu-item>
                    <md-menu-item>
                        <md-button ng-click=vm.vg.metasOrcamentoD.toggleIndefinidas() ng-disabled=vm.configSvc.utilizacao.metasRD>{{vm.vg.metasOrcamentoD.indefinidas ? 'Esconder' : 'Exibir'}} categorias com metas não definidas</md-button>
                    </md-menu-item>
                </md-menu-content>
            </md-menu>
            <md-button class="md-icon-button toggle-card" ng-click=vm.vg.togglePanel(card)>
                <md-icon>keyboard_arrow_up</md-icon>
            </md-button>
        </div>
    </div>
    <md-progress-linear class=md-primary ng-if="vm.vg.metasOrcamentoD.loading && card.opened && vm.vg.metasOrcamentoD._initialized"></md-progress-linear>
    <div class="conteudo metas" ng-class="{'exibir-subcategorias' : vm.vg.metasOrcamentoD.subcategorias}" ng-if="!vm.isBasico && !vm.vg.metasOrcamentoD.loading && card.opened && vm.vg.metasOrcamentoD._initialized">
        <md-content ng-if="vm.vg.metasOrcamentoD.metas.d && !vm.isMoeda">
            <div ng-if="vm.vg.metasOrcamentoD.visao == 1" class="mdw-list mdw-list-bordered" flex>
                <div class="mdw-list-item meta" ng-class="{parent : vm.vg.metasOrcamentoD.subcategorias && (categoria.subcategorias.length > 0)}" layout-align="start center" layout=row ng-repeat-start="categoria in vm.vg.metasOrcamentoD.metas.d.categorias | orderBy : '-razao'" ng-include="'/partials/visaogeral/paineis/metaOrcamentoLinha.html'"></div>
                <div ng-if=categoria.subcategorias class="mdw-list-item meta sub" ng-class="{last : $last}" ng-show=vm.vg.metasOrcamentoD.subcategorias layout-align="start center" layout=row ng-repeat="subcat in categoria.subcategorias | orderBy : '-razao'" onload="categoria = subcat" ng-include="'/partials/visaogeral/paineis/metaOrcamentoLinha.html'"></div>
                <div style="display: none" ng-repeat-end></div>
            </div>
            <div ng-if="vm.vg.metasOrcamentoD.visao == 2" class="mdw-list mdw-list-bordered" flex>
                <mdw-pgbar-circular razao=vm.vg.metasOrcamentoD.metas.d.geral.razao cor=vm.vg.metasOrcamentoD.metas.d.geral.cor></mdw-pgbar-circular>
                <table>
                    <tbody>
                        <tr>
                            <td>Meta definida {{vm.vg.metasOrcamentoD.mes}}</td>
                            <td mdw-currency=vm.vg.metasOrcamentoD.metas.d.geral.meta mask=auto></td>
                        </tr>
                        <tr>
                            <td>Total {{vm.vg.metasOrcamentoD.visualizacao == 'p' ? 'projetado' : 'confirmado'}}</td>
                            <td mdw-currency=vm.vg.metasOrcamentoD.metas.d.geral.valor mask=auto></td>
                        </tr>
                        <tr ng-if=vm.vg.metasOrcamentoD.metas.d.geral.residuo>
                            <td>Total a realizar</td>
                            <td mdw-currency=vm.vg.metasOrcamentoD.metas.d.geral.residuo mask=auto></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </md-content>
        <div class=mdw-empty-space flex ng-if="!vm.isBasico && !vm.vg.metasOrcamentoD.metas.d && !vm.isMoeda">
            <md-icon>error_outline</md-icon>
            <p class=mdw-empty-space-text>
                Sem metas de despesa definidas para {{vm.vg.getData().fim | mdwDate : 'MMMM'}}.<br>Defina uma meta para o valor máximo que espera gastar.
            </p>
            <div class=mdw-empty-space-actions>
                <md-button class=md-primary ui-sref="metasrd.lista.despesa({inicio : vm.vg.getData().inicio , fim : vm.vg.getData().fim})">Gerenciar metas</md-button>
            </div>
        </div>
        <div flex ng-if=vm.isMoeda layout=column layout-align="start center">
            <div>
                <md-icon class=mdw-icon-noresults>error_outline</md-icon>
            </div>
            <p>Metas de orçamento disponíveis apenas na moeda padrão.</p>
        </div>
    </div>
    <mdw-vg-placeholder-basico ng-if="vm.isBasico && card.opened && !vm.vg.metasOrcamentoD.loading" id=metas></mdw-vg-placeholder-basico>
    <div class=rodape layout=row ng-if="!vm.isBasico && !vm.isMoeda && !vm.vg.metasOrcamentoD.loading && card.opened && vm.vg.metasOrcamentoD._initialized && vm.vg.metasOrcamentoD.metas.d && vm.vg.metasOrcamentoD.visao == 1">
        <div flex class=meta layout-align="start center" layout=row ng-repeat="categoria in [vm.vg.metasOrcamentoD.metas.d]" ng-include="'/partials/visaogeral/paineis/metaOrcamentoLinha.html'"></div>
    </div>
</div>
